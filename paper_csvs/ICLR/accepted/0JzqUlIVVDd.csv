Section,Section Appearance Order,Paragraph
ABSTRACT,0.0,ABSTRACT
ABSTRACT,0.0025974025974025974,"Domain adaptation is an important problem and often needed for real-world ap-
plications. In this problem, instead of i.i.d. training and testing datapoints, we
assume that the source (training) data and the target (testing) data have different
distributions. With that setting, the empirical risk minimization training proce-
dure often does not perform well, since it does not account for the change in
the distribution. A common approach in the domain adaptation literature is to
learn a representation of the input that has the same (marginal) distribution over
the source and the target domain. However, these approaches often require ad-
ditional networks and/or optimizing an adversarial (minimax) objective, which
can be very expensive or unstable in practice. To improve upon these marginal
alignment techniques, in this paper, we Ô¨Årst derive a generalization bound for the
target loss based on the training loss and the reverse Kullback-Leibler (KL) diver-
gence between the source and the target representation distributions. Based on this
bound, we derive an algorithm that minimizes the KL term to obtain a better gen-
eralization to the target domain. We show that with a probabilistic representation
network, the KL term can be estimated efÔ¨Åciently via minibatch samples without
any additional network or a minimax objective. This leads to a theoretically sound
alignment method which is also very efÔ¨Åcient and stable in practice. Experimental
results also suggest that our method outperforms other representation-alignment
approaches."
INTRODUCTION,0.005194805194805195,"1
INTRODUCTION"
INTRODUCTION,0.007792207792207792,"With advances in neural network architectures (He et al., 2016; Vaswani et al., 2017), machine
learning algorithms have achieved state-of-the-art performance in many tasks such as object classi-
Ô¨Åcation, object detection and natural language processing. However, machine learning models have
been focusing mostly on the case of independent and identically distributed (i.i.d.) datapoints; and
such an assumption often does not hold in practice. When the i.i.d. assumption is violated and the
target domain has a different distribution compared to the source domain, a typical learner trained
on the source data via empirical risk minimization would not perform well at test time, since it does
not account for the distribution shift. To tackle this problem, many methods have been proposed for
domain adaptation (Zhao et al., 2019; Zhang et al., 2019; Combes et al., 2020; Tanwani, 2020) and
domain generalization (Khosla et al., 2012; Muandet et al., 2013; Ghifary et al., 2015), the goal of
which is to train a machine learning algorithm that can generalize well to the target domain."
INTRODUCTION,0.01038961038961039,"A common approach to tackle these problems is to learn a representation such that its distribution
does not change across domains. There are two types of distribution alignment: marginal alignment
(aligning the marginal distribution of the representation) and conditional alignment (aligning the
conditional distribution of the label given the representation) (Nguyen et al., 2021; Tanwani, 2020).
For domain adaptation and domain generalization problems with multiple source domains, we can
use the data and labels to align both the marginal and the conditional distributions across the source
domains, aiming to generalize to the target domain. However, in a single-source domain adaptation
problem, with only unlabeled data from the target domain, it is often only possible to align the
marginal distribution of the representation. This marginal alignment should help the classiÔ¨Åer avoid
out-of-distribution data at test time."
INTRODUCTION,0.012987012987012988,"‚àóCorresponding author: A. Tuan Nguyen, tuan@robots.ox.ac.uk
‚Ä†University of Oxford, Oxford, United Kingdom
‚Ä°VinAI Research, Hanoi, Vietnam"
INTRODUCTION,0.015584415584415584,Published as a conference paper at ICLR 2022
INTRODUCTION,0.01818181818181818,"This paper focuses on such a single-source domain adaption problem, which is also one of the
most common settings in practice. Current marginal alignment techniques usually require addi-
tional computation (e.g., of an additional network) (Ganin et al., 2016; Li et al., 2018) and/or a
minimax objective (Ganin et al., 2016; Shen et al., 2018), leading to an expensive and/or unstable
training procedure (Goodfellow, 2016; Kodali et al., 2017). For example, DANN (Ganin et al., 2016)
employs an adversarial training procedure, with a domain discriminator that classiÔ¨Åes the domain
of the representation, and maximizes the adversarial loss of the discriminator. When the discrimina-
tor is completely fooled, the marginal distribution of the representation is aligned across domains.
MMD (Gretton et al., 2012; Li et al., 2018) utilizes maximum mean discrepancy to align the repre-
sentation distribution. This does not use a minimax objective, thus leading to a more stable training;
however, it does require additional computation of several Gaussian kernels. While more sophis-
ticated (non-marginal-alignment) methods have been proposed recently to achieve better results in
the domain adaptation problem, we argue that studying the family of plain marginal-alignment tech-
niques is still an important task, since they are the backbones that most other domain adaptation (and
domain generalization) methods are built upon."
INTRODUCTION,0.02077922077922078,"To address the above issues of existing marginal-alignment techniques, we Ô¨Årst derive a generaliza-
tion bound on the loss of the target domain using the training loss and a reverse Kullback‚ÄìLeibler
(KL) divergence between the source and target distributions. There are existing bounds of the target
loss in the literature (Ben-David et al., 2010), however, these analyses focus mostly on the case of
binary classiÔ¨Åcation and the bounds use a total variation distance or a H-divergence between the
distributions, which are not easy to estimate in practice (for example, Ajakan et al. (2014) require
an adversarial network to estimate the H-divergence). In this paper, we show that with a proba-
bilistic representation network, we can estimate the KL divergence easily using samples, leading
to an alignment method that requires virtually no additional computation nor a minimax objective.
Therefore, our training procedure is simple and stable in practice. Moreover, the reverse KL has the
zero-forcing effect (Minka et al., 2005), which is very effective to alleviate the out-of-distribution
problem in practice. This can be explained as follows: the out-of-distribution problem arises when
the classiÔ¨Åer faces a new representation at test time that is in a (near) zero mass region of the source
representation distribution (and thus it never faced before). The reverse KL tends to force the target
representation distribution to have (near) zero mass wherever the source distribution has (near) zero
mass (this is the zero-forcing property), which helps the classiÔ¨Åer avoid out-of-distribution data. The
reverse KL also has the mode-seeking effect (Minka et al., 2005) which allows for a more Ô¨Çexible
alignment of the representation (to one or some of the modes of the source domain). For example,
consider the classiÔ¨Åcation problem of buildings (houses, hotels, etc.) where source images are col-
lected from urban and remote areas of a country (two modes); while the target images are collected
from urban areas but from a different country. Ideally, we want to match the representation distri-
bution of the target domain to that of the Ô¨Årst mode of the source domain since they are both from
urban areas. The reverse KL allows this Ô¨Çexible alignment (as it results in a relatively small value
of the reverse KL) due to its mode-seeking property. Meanwhile, other distance metrics/divergences
aim to match the whole source and target representation distribution, which might collapse the two
modes of the source domains."
INTRODUCTION,0.023376623376623377,Our contributions in this work are:
INTRODUCTION,0.025974025974025976,"‚Ä¢ We construct a generalization bound of the test loss in the domain adaptation problem using
the reverse KL divergence.
‚Ä¢ We propose to reduce the generalization bound by minimizing the above KL term. Further-
more, we show that with a probabilistic representation, the KL term can be estimated easily
using minibatches, without any additional computation or a minimax objective as opposed
to most existing works.
‚Ä¢ We conduct extensive experiments and show that our method signiÔ¨Åcantly outperforms
relevant baselines, namely ERM (Bousquet et al., 2003), DANN (Ganin et al., 2016), MMD
(Gretton et al., 2012; Li et al., 2018), CORAL (Sun and Saenko, 2016) and WD (Shen
et al., 2018). We empirically show that the reverse KL divergence is very effective for
representation alignment since it is very stable and efÔ¨Åcient to compute in practice."
RELATED WORK,0.02857142857142857,"2
RELATED WORK"
RELATED WORK,0.03116883116883117,"Generalization bound for the distribution shift problem
There exist works studying bounds for
the distribution shift problem in the literature (Ben-David et al., 2010; Mansour et al., 2009). How-"
RELATED WORK,0.033766233766233764,Published as a conference paper at ICLR 2022
RELATED WORK,0.03636363636363636,"ever, their analyses of the classiÔ¨Åcation problem are limited to the case of binary labels. Moreover,
these bounds are only applicable or practical for deterministic labeling functions, which is not the
case for most datasets in practice. Therefore, their analyses cannot be generalized to the general case
of supervised learning. The differences between our bound and theirs are as follows. First of all, our
bound works for the general case of supervised learning: it works for both the classiÔ¨Åcation (includ-
ing multiclass classiÔ¨Åcation) and regression problems, it makes no assumptions about the labeling
mechanism (can be probabilistic or deterministic), and it works for virtually all predictive distribu-
tions commonly used in practice. Secondly, our bound uses a different divergence, namely the KL
divergence, which is easier to estimate in practice compared to total variation or H-divergence. We
provide a brief review of the above bounds and discuss their differences to ours in more detail in the
appendix. Recently, Acuna et al. (2021) revise the previous domain adaptation bounds and gener-
alize them to a multi-class classiÔ¨Åcation setting, as well as to the class of f-divergence (including
KL divergence). However, their setting is still very restricted: the loss function needs to satisfy the
triangle inequality (which does not hold for many loss functions in practice), and they need to know
the true labeling function (optimal Bayes classiÔ¨Åer) for a probabilistic labeling mechanism (which is
often not available). We also provide further analysis, that under some reasonable assumptions, the
conditional misalignment in the representation space is bounded by the conditional misalignment
in the input space, which allows for a sound marginal alignment method. This can be seen as an
improvement over prior works. Some speciÔ¨Åc cases of distribution shift have also been studied.
For example, Cortes et al. (2010) and Johansson et al. (2019) study the generalization bound for
the covariate shift problem, i.e., pT (x) Ã∏= pS(x) but pT (y|x) = pS(y|x), where pS is the source
distribution and pT is the target distribution. In contrast, Azizzadenesheli et al. (2019) provide a
generalization bound for the label shift problem, i.e., pT (y) Ã∏= pS(y) but pT (x|y) = pS(x|y)."
RELATED WORK,0.03896103896103896,"Domain adaptation
While the literature on the domain adaptation problem is vast, we cover the
most closely related works to ours here. A common method for the domain adaptation problem
is to align the marginal distribution of the representation between the source and target domains.
DANN (Ganin et al., 2016) employs a domain discriminator to classify the domain of a represen-
tation and maximizes its adversarial loss (a minimax game). WD (Shen et al., 2018) uses a neural
network function f (which is 1-Lipschitz continuous) to calculate the Wasserstein distance between
two distributions and minimizes it. This is also a minimax game since the Wasserstein distance is
the supremum over the search space of f. MMD (Gretton et al., 2012; Li et al., 2018) uses the
maximum mean discrepancy to align the representation distribution. This method does not need a
minimax objective; however, it requires the additional computation of several Gaussian kernels. Fi-
nally, CORAL (Sun and Saenko, 2016) matches the Ô¨Årst two moments of the distribution; and while
being a simple method, it fails to align more complex distributions. We consider these marginal
alignment techniques our main baselines since our method falls into this category, and investigate
the effectiveness of the reverse KL divergence in aligning the distributions of representation. Re-
cently, more sophisticated alignment methods (Kang et al., 2019; Xu et al., 2019; Zhu et al., 2020)
have been proposed for the domain adaptation problem, which achieve state-of-the-art performance.
Instead of simply aligning the marginal distribution of the representation, these methods minimize
the intra-class distance of the representation across domains, and possibly maximize the inter-class
distance between them, using the MMD or L2 distance. However, they require pseudo labels for
the target domain (often obtained via clustering). Moreover, they are complementary to our method,
as we conjecture that our method can also be used in conjunction with these, leading to the same
algorithms but with the KL distance instead of MMD or L2."
APPROACH,0.04155844155844156,"3
APPROACH"
PROBLEM STATEMENT,0.04415584415584416,"3.1
PROBLEM STATEMENT"
PROBLEM STATEMENT,0.046753246753246755,"In this paper, we consider one of the most common domain adaptation settings, which consists of
a single-source domain S with the joint data distribution pS(x, y) and a target domain T with the
data distribution pT (x, y), where x denotes the input sample and y is the label. We assume that
these two domains have the same support sets X, Y. Regarding the training process of the domain
adaptation problem, we further denote a labeled dataset of size NS sampled from the source domain
(x(i)
S , y(i)
S )NS
i=1, where (x(i)
S , y(i)
S ) ‚àºpS(x, y), and an unlabeled dataset of size NT from the target
domain (x(i)
T )NT
i=1, where x(i)
T ‚àºpT (x)."
PROBLEM STATEMENT,0.04935064935064935,"The goal of a typical domain adaptation framework is to train a model with the labeled dataset of
the source domain together with the unlabeled dataset from the target domain, so that the model will"
PROBLEM STATEMENT,0.05194805194805195,"Published as a conference paper at ICLR 2022 ùë¶ ùë•
 ùëß"
PROBLEM STATEMENT,0.05454545454545454,Source Distribution
PROBLEM STATEMENT,0.05714285714285714,"Joint: ùëù& ùë•, ùë¶, ùëß= ùëù& ùë•, ùë¶ùëù(ùëß|ùë•) ùë¶ ùë•
 ùëß"
PROBLEM STATEMENT,0.05974025974025974,Target Distribution
PROBLEM STATEMENT,0.06233766233766234,"Joint: ùëù, ùë•, ùë¶, ùëß= ùëù, ùë•, ùë¶ùëù(ùëß|ùë•)"
PROBLEM STATEMENT,0.06493506493506493,"Figure 1: Graphical model. Note that the distribution p(z|x) (green edge), corresponding to our representa-
tion network, is shared between the source and target domains."
PROBLEM STATEMENT,0.06753246753246753,"perform decently in the target domain. Note that this is only effective if the labeling mechanism is
not too different between the source and the target domains (Ben-David et al., 2010)."
PROBLEM STATEMENT,0.07012987012987013,"In the domain adaption problem, we expect the changes in the marginal distribution so that
pS(x) Ã∏= pT (x), or the conditional distribution so that pS(y|x) Ã∏= pT (y|x), or both, which often
render the typical empirical risk minimization training procedure ineffective. This motivates a line
of approaches that learn a representation z of x whose marginal and conditional distributions are
more aligned across the domains and use it for the prediction task, aiming at a better generalization
performance to the target domain."
PROBLEM STATEMENT,0.07272727272727272,"The general representation learning framework aims to learn a representation z from x with the
mapping p(z|x), which can be deterministic or probabilistic. That latent representation z is expected
to contain the label-related information; and is then used to predict the label y (by a classiÔ¨Åer). Note
that since the source and target domains have the same support set for x and share the representation
mapping p(z|x), they also have the same support set for z, denoted by Z. Given the representation z,
we learn a classiÔ¨Åer to predict y through the predictive distribution ÀÜp(y|z) that is an approximation
of the ground truth conditional distribution pS(y|z). During training, the representation network
p(z|x) and the classiÔ¨Åer ÀÜp(y|z) are trained jointly on the source domain and we ‚Äúhope‚Äù that they can
generalize to the target domain, meaning that both p(z|x) and ÀÜp(y|z) are kept unchanged between
training and testing. The graphical model of that representation learning process is represented
in Figure 1. In this paper, we consider a probabilistic representation mapping; speciÔ¨Åcally, the
representation network will output ¬µ(x) and œÉ2(x) and p(z|x) = N(z; ¬µ(x), diag(œÉ2(x))), where
N denotes a Gaussian distribution. This can also be thought of as a generalization of a deterministic
representation, as we recover the deterministic case if œÉ2(x) ‚Üí0. Also, note that our method is not
limited to the choice of this representation distribution, i.e., the discussion in this section holds for
virtually any other distribution."
PROBLEM STATEMENT,0.07532467532467532,"The joint distributions of x, y, z for the source and target domains can be represented as follows"
PROBLEM STATEMENT,0.07792207792207792,"pS(x, y, z) = pS(x, y)p(z|x) ,
pT (x, y, z) = pT (x, y)p(z|x) .
(1)"
PROBLEM STATEMENT,0.08051948051948052,and we deÔ¨Åne the predictive distribution of y given x as
PROBLEM STATEMENT,0.08311688311688312,"ÀÜp(y|x) = Ep(z|x)[ÀÜp(y|z)] .
(2)"
PROBLEM STATEMENT,0.08571428571428572,"Remark 1. On the inference complexity of a probabilistic representation.
Using a probabilistic representation, we need to sample multiple z from p(z|x) to estimate Eq. 2
during test time. However, this is not a big issue for the representation learning framework, since we
only need to run the representation network p(z|x) (which is usually deep) once to get a distribution
of z. After sampling multiple z from that distribution, we only need to rerun the classiÔ¨Åer ÀÜp(y|z),
which is usually a small network (e.g., often contains one layer). Furthermore, we can also run
ÀÜp(y|z) (a small network) in parallel for multiple z to reduce inference time if necessary."
PROBLEM STATEMENT,0.08831168831168831,"During training, we usually sample a single z from p(z|x) for each x. The training objective is"
PROBLEM STATEMENT,0.09090909090909091,"ltrain = Ex,y‚àºpS(x,y),z‚àºp(z|x)[‚àílog ÀÜp(y|z)]
(3)"
PROBLEM STATEMENT,0.09350649350649351,"(this is also the upper bound of EpS(x,y)[‚àílog ÀÜp(y|x)] via Jensen Inequality)"
PROBLEM STATEMENT,0.09610389610389611,"= EpS(z,y)[‚àílog ÀÜp(y|z)]
(4)"
PROBLEM STATEMENT,0.0987012987012987,"where ‚àílog ÀÜp(y|z) is the loss of a ‚Äúdata point‚Äù (z, y). For common choices of the predictive dis-
tribution in the classiÔ¨Åcation and regression problems, this is a non-negative quantity. For example,
for a classiÔ¨Åcation problem with a categorical predictive distribution, this becomes the cross-entropy"
PROBLEM STATEMENT,0.1012987012987013,Published as a conference paper at ICLR 2022
PROBLEM STATEMENT,0.1038961038961039,"loss, while for a regression problem with a Gaussian predictive distribution (with a Ô¨Åxed variance),
it becomes the squared error (with an additive constant)."
PROBLEM STATEMENT,0.10649350649350649,Minimizing ltrain will enforce ÀÜp(y|z) ‚âàpS(y|z).
PROBLEM STATEMENT,0.10909090909090909,"We consider the below two assumptions of the representation z on the source domain:
Assumption 1. IS(z, y) = IS(x, y), where IS(¬∑, ¬∑) is the mutual information term, calculated on
the source domain. In particular:"
PROBLEM STATEMENT,0.11168831168831168,"IS(z, y) = EpS(z,y)"
PROBLEM STATEMENT,0.11428571428571428,"
log
pS(z, y)
pS(z)pS(y)"
PROBLEM STATEMENT,0.11688311688311688,"
;
IS(x, y) = EpS(x,y)"
PROBLEM STATEMENT,0.11948051948051948,"
log
pS(x, y)
pS(x)pS(y) 
(5)"
PROBLEM STATEMENT,0.12207792207792208,"This is often referred to as the ‚ÄúsufÔ¨Åciency assumption‚Äù since it indicates that the representation z has
the same information about the label y as the original input x, and is sufÔ¨Åcient for this prediction task
(in the source domain). Note that the data processing inequality indicates that IS(z, y) ‚â§IS(x, y),
so here we assume that z contains maximum information about y.
Remark 2. Assumption 1 is an optimization goal of the training process on the source domain.
In particular, ltrain (with an additive constant) is an upper bound of ‚àíIS(z, y), which is an upper
bound of ‚àíIS(x, y). Thus, minimizing ltrain will enforce IS(z, y) to be equal to IS(x, y). For a
more detailed discussion of this, please refer to, for example, Alemi et al. (2016).
Assumption 2. pS(y|x) = Ep(z|x)[pS(y|z)]
‚àÄx, y ‚ààX, Y
When this assumption holds, the predictive distribution in Eq. 2 will approximate pS(y|x), as long
as ÀÜp(y|z) approximates pS(y|z).
Remark 3. Assumption 2 is also an optimization goal of the training process on the source domain.
This is because ltrain is an upper bound of EpS(x,y)[‚àílog ÀÜp(y|x)], which is an upper bound
of EpS(x,y)[‚àílog pS(y|x)]. Thus, minimizing ltrain will enforce ÀÜp(y|x) to be equal to pS(y|x).
Therefore, pS(y|x) ‚âàÀÜp(y|x) = Ep(z|x)[ÀÜp(y|z)] ‚âàEp(z|x)[pS(y|z)]."
PROBLEM STATEMENT,0.12467532467532468,"These two assumptions ensure that our network has good performance on the source domain. Note
also that we only make the above two assumptions about the source domain, where we can enforce
them through the training process. We do not make these assumptions about the target domain, since
we have no access to the full target distribution. These two assumptions will also be used to prove
our later theoretical result (Proposition 2)."
KL GUIDED DOMAIN ADAPTATION,0.12727272727272726,"3.2
KL GUIDED DOMAIN ADAPTATION"
KL GUIDED DOMAIN ADAPTATION,0.12987012987012986,"Now we will consider the test loss in the domain adaptation problem, and how we can reduce it. The
test loss (of the target domain) is:"
KL GUIDED DOMAIN ADAPTATION,0.13246753246753246,"ltest = EpT (x,y)[‚àílog ÀÜp(y|x)] = EpT (x,y)[‚àílog Ep(z|x)[ÀÜp(y|z)]]
(6)"
KL GUIDED DOMAIN ADAPTATION,0.13506493506493505,"‚â§EpT (x,y)[Ep(z|x)[‚àílog ÀÜp(y|z)]]
(Jensen Inequality)
(7)"
KL GUIDED DOMAIN ADAPTATION,0.13766233766233765,"= EpT (z,y)[‚àílog ÀÜp(y|z)]
(8)"
KL GUIDED DOMAIN ADAPTATION,0.14025974025974025,"Note that if the representation z is invariant (both marginally and conditionally), then pT (z, y) =
pS(z, y) and Eq. 8 becomes ltrain, and we have a perfect generalization between the source domain
and the target domain. However, there is no way to guarantee the invariance, since we do not
know the target domain and the target data distribution. In that case, we introduce the following
proposition that ensures a generalization bound of the test loss based on the training loss and the KL
divergence:
Proposition 1. If the loss ‚àílog ÀÜp(y|z) is bounded by M 1 ‚àÄz ‚ààZ, y ‚ààY, we have:"
KL GUIDED DOMAIN ADAPTATION,0.14285714285714285,"ltest ‚â§ltrain + M
‚àö 2 p"
KL GUIDED DOMAIN ADAPTATION,0.14545454545454545,"KL[pT (y, z)|pS(y, z)]
(9)"
KL GUIDED DOMAIN ADAPTATION,0.14805194805194805,"= ltrain + M
‚àö 2 q"
KL GUIDED DOMAIN ADAPTATION,0.15064935064935064,"KL[pT (z)|pS(z)] + EpT (z) [KL[pT (y|z)|pS(y|z)]]
(10)"
KL GUIDED DOMAIN ADAPTATION,0.15324675324675324,"1In the classiÔ¨Åcation problem, we can enforce this quite easily by augmenting the output softmax of the
classiÔ¨Åer so that each class probability is always at least exp (‚àíM). For example, if we choose M = 3 ‚áí
exp (‚àíM) ‚âà0.05, and if the output softmax is (p1, p2, ..., pC), we can augment it into (p1 ¬∑ K + 0.05, p2 ¬∑
K + 0.05, ..., pC ¬∑ K + 0.05), where K = 1 ‚àí0.05 ¬∑ C and C is the number of classes. This ensures the bound
for the loss of a datapoint, while remaining the output prediction class."
KL GUIDED DOMAIN ADAPTATION,0.15584415584415584,Published as a conference paper at ICLR 2022
KL GUIDED DOMAIN ADAPTATION,0.15844155844155844,Proof. provided in the appendix.
KL GUIDED DOMAIN ADAPTATION,0.16103896103896104,"This bound is similar to other bounds in the literature (e.g., Ben-David et al. (2010)) in the sense
that it also contains the training loss, a marginal misalignment term and a conditional misalignment
term (KL[pT (z)|pS(z)] and EpT (z) [KL[pT (z)|pS(z)]] respectively in our case). However, Ben-
David et al. (2010) consider a binary classiÔ¨Åcation problem and their bounds are only practical for a
deterministic labeling function (requires knowing the true labeling function, which is unknown for
a probabilistic labeling mechanism, to compute the bound); while our bound works for the general
case of supervised learning with any labeling mechanism. For a brief review of these bounds and a
detailed discussion about their differences to ours, please refer to the appendix. Note that the bound
in Proposition 1 is also true when applying to the input space directly (e.g., replacing z with x).
However, we are more interested in the bound in the representation space, since we can reduce it by
regularizing the KL term."
KL GUIDED DOMAIN ADAPTATION,0.16363636363636364,"To reduce the generalization gap, we want pT (z, y) to be close to pS(z, y). Aligning the marginal
distribution (i.e., pS(z) ‚âàpT (z)) helps the classiÔ¨Åer network ÀÜp(y|z) avoid out-of-distribution data
since the target representations it faces at test time belong to the source representation distribution
which it was trained on; while aligning the conditional distribution (pS(y|z) ‚âàpT (y|z)) makes sure
the classiÔ¨Åer gives more accurate predictions on the target domain since ÀÜp(y|z) was trained to ap-
proximate pS(y|z). In the domain adaptation problem, since we only have the unlabeled data from
the target domain, we often align the marginal distribution of z only. However, one problem is that
the conditional misalignment also depends on the representation z, and when learning a representa-
tion z that aligns the marginal, we might accidentally increase EpT (z) [KL[pT (y|z)|pS(y|z)]] at the
same time, leading to a net increase in the above generalization bound. For example, what if (and
is it possible that) the conditional misalignment increases to inÔ¨Ånity while we learn a representation
z?"
KL GUIDED DOMAIN ADAPTATION,0.16623376623376623,"Therefore, it is crucial that we can bound the above conditional misalignment. The below proposi-
tion handles this problem."
KL GUIDED DOMAIN ADAPTATION,0.16883116883116883,"Proposition 2. If Assumption 1 and 2 hold, and if pT (x,y)"
KL GUIDED DOMAIN ADAPTATION,0.17142857142857143,"pS(x,y) < ‚àû(i.e., there exists N, which can be"
KL GUIDED DOMAIN ADAPTATION,0.17402597402597403,"arbitrarily large, such that pT (x,y)"
KL GUIDED DOMAIN ADAPTATION,0.17662337662337663,"pS(x,y) < N ‚àÄx ‚ààX, y ‚ààY), we have:"
KL GUIDED DOMAIN ADAPTATION,0.17922077922077922,"EpT (z) [KL[pT (y|z)|pS(y|z)]] ‚â§EpT (x) [KL[pT (y|x)|pS(y|x)]]
(11)
Proof. provided in the appendix."
KL GUIDED DOMAIN ADAPTATION,0.18181818181818182,"This shows that the conditional misalignment in the representation space is bounded by the condi-
tional misalignment in the input space. This can also be viewed as an improvement over the analyses
of Ben-David et al. (2010), where it is not clear if the conditional misalignment in the representation
space is bounded or not. It then follows that:"
KL GUIDED DOMAIN ADAPTATION,0.18441558441558442,"ltest ‚â§ltrain + M
‚àö 2 q"
KL GUIDED DOMAIN ADAPTATION,0.18701298701298702,"KL[pT (z)|pS(z)] + EpT (x) [KL[pT (y|x)|pS(y|x)]].
(12)"
KL GUIDED DOMAIN ADAPTATION,0.18961038961038962,"As mentioned earlier, in order for domain adaptation to be effective, we should expect that the label-
ing mechanism does not change too much (Ben-David et al., 2010). Thus, the conditional misalign-
ment EpT (x) [KL[pT (y|x)|pS(y|x)]] is often small (and Ô¨Åxed ‚Äì not dependent on the representation
z). Therefore, to reduce the generalization bound, we can focus on minimizing KL[pT (z)|pS(z)],
with the objective:
ltrain + Œ≤KL[pT (z)|pS(z)]
(13)
where Œ≤ is a hyper-parameter."
KL GUIDED DOMAIN ADAPTATION,0.19220779220779222,"Discussion on the use of reverse KL:
Our derivation leads to the reverse KL term
KL[pT (z)|pS(z)] as a regularizer of the distance between the two domains representations. We
argue that there are several reasons that make this a good choice as a divergence between the source
and target representation distributions. (1) First of all, as mentioned earlier, the KL term can be com-
puted easily without any additional network or a minimax objective (details in Subsection 3.3). This
leads to an efÔ¨Åcient and stable training procedure, which often results in improved performance. (2)
Secondly, the reverse KL has the zero-forcing/mode-seeking effect (Minka et al., 2005) that helps to
alleviate the out-of-distribution problem. SpeciÔ¨Åcally, the reverse KL forces the target representation
distribution to have zero mass wherever the source distribution has zero mass (zero-forcing), thus"
KL GUIDED DOMAIN ADAPTATION,0.19480519480519481,Published as a conference paper at ICLR 2022
KL GUIDED DOMAIN ADAPTATION,0.1974025974025974,"(a)
(b)
(c)"
KL GUIDED DOMAIN ADAPTATION,0.2,"Figure 2: Reverse KL allows a Ô¨Çexible alignment of the representation while still effectively preventing the
out-of-distribution problem. (a) Source representation distribution (black). Consider the case where the data
distribution pS(x) of the source domain has two modes, then the representation distribution pS(z) will likely
also have two modes; and consider the case where the target distribution has only one mode. (b) An acceptable
target representation distribution (green) that helps the classiÔ¨Åer avoid the out-of-distribution problem. Reverse
KL allows for this type of Ô¨Çexible alignment (match to one/some of the modes) due to its mode-seeking nature.
(c) A problematic target representation distribution (red), since the classiÔ¨Åcation network will face out-of-
distribution data at test time, in the area between the two modes. Reverse KL will prevent this due to its
zero-forcing nature."
KL GUIDED DOMAIN ADAPTATION,0.2025974025974026,"preventing the out-of-distribution data at test time (Figure 2c). On the other hand, its mode-seeking
nature allows Ô¨Çexible alignment of the representation. For example, consider the case where the
source domain is a mixture of two components (Figure 2a, i.e., it has two modes), and the target dis-
tribution is close to one of the two components. Ideally, we want to learn a representation network
that matches the representation of the target domain to that of the corresponding component on the
source mixture (Figure 2b). This representation will still perform well at test time since we would
not have the out-of-distribution problem (the classiÔ¨Åcation network is already trained on this mode
of the source distribution). This Ô¨Çexible alignment (to one or some of the modes) is accepted by the
reverse KL since it leads to a relatively small reverse KL value. Meanwhile, other methods such as
DANN, MMD, CORAL and WD aim to match the representation distribution of the target domain
and that of the whole source domain together, which could compress the representation too much,
negatively affecting its expressive power. For instance, in the above example, trying to match the
whole distribution of source and target domains based on other distance metrics might force the two
modes of the source domain to collapse. The Ô¨Çexible alignment of the reverse KL (while still being
very effective to prevent out-of-distribution data) might be beneÔ¨Åcial in some practical cases."
KL GUIDED DOMAIN ADAPTATION,0.2051948051948052,"We also empirically found that adding an auxiliary term KL[pS(z)|pT (z)] (forward KL) with a small
coefÔ¨Åcient Œ≤aux to the objective can help to align the distribution faster, leading to the objective:"
KL GUIDED DOMAIN ADAPTATION,0.2077922077922078,"ltrain + Œ≤KL[pT (z)|pS(z)] + Œ≤auxKL[pS(z)|pT (z)]
(14)"
KL GUIDED DOMAIN ADAPTATION,0.21038961038961038,"In practice, setting Œ≤aux to a (very) small value or zero often leads to the best results (using larger
Œ≤aux can hurt the performance). Note that this does not invalidate our earlier discussion, as with
such small values of Œ≤aux, the alignment behavior is still dominated by the reverse KL."
OPTIMIZATION,0.21298701298701297,"3.3
OPTIMIZATION"
OPTIMIZATION,0.21558441558441557,"In practice, we estimate Eq. 14 using minibatches.
In particular, given a labelled minibatch
(Àúx(i)
S , Àúy(i)
S )B
i=1 of the source domain and an unlabelled one (Àúx(i)
T )B
i=1 of the target domain, and a
single sampled representation for each x: (Àúz(i)
S )B
i=1 and (Àúz(i)
T )B
i=1, we can get an unbiased estimator
of the objective 14 as follows:"
OPTIMIZATION,0.21818181818181817,"ltrain + Œ≤KL[pT (z)|pS(z)] + Œ≤auxKL[pS(z)|pT (z)]
=EpS(z,y)[‚àílog ÀÜp(y|z)] + Œ≤EpT (z)[log pT (z) ‚àílog pS(z)] + Œ≤auxEpS(z)[log pS(z) ‚àílog pT (z)] ‚âà1 B B
X"
OPTIMIZATION,0.22077922077922077,"i=1
‚àílog ÀÜp(Àúy(i)
S |Àúz(i)
S ) + Œ≤ 1 B B
X i=1"
OPTIMIZATION,0.22337662337662337,"h
log pT (Àúz(i)
T ) ‚àílog pS(Àúz(i)
T )
i"
OPTIMIZATION,0.22597402597402597,"+ Œ≤aux
1
B B
X i=1"
OPTIMIZATION,0.22857142857142856,"h
log pS(Àúz(i)
S ) ‚àílog pT (Àúz(i)
S )
i
(15)"
OPTIMIZATION,0.23116883116883116,Published as a conference paper at ICLR 2022
OPTIMIZATION,0.23376623376623376,"However, it still requires knowing pS(z) and pT (z) to compute Eq. 15. We also use the minibatch
to approximate these quantities:"
OPTIMIZATION,0.23636363636363636,"pS(z) = EpS(x)[p(z|x)] ‚âà1 B B
X"
OPTIMIZATION,0.23896103896103896,"i=1
p(z|x(i)
S );
pT (z) = EpT (x)[p(z|x)] ‚âà1 B B
X"
OPTIMIZATION,0.24155844155844156,"i=1
p(z|x(i)
T ). (16)"
OPTIMIZATION,0.24415584415584415,"Intuitively, we use a minibatch of data to construct a distribution of the representation z (which is a
mixture of B components), and match that distribution for the two domains with the KL divergence.
As mentioned earlier, we use a Gaussian distribution with a diagonal covariance matrix for p(z|x)
in practice, and employ the reparameterization trick (Kingma and Welling, 2013) to sample z."
OPTIMIZATION,0.24675324675324675,"Although the estimator in Eq. 15 is unbiased, the approximations in Eq. 16 will introduce some bias
into our estimator (however, the estimator is still consistent, i.e., it becomes exact when B ‚Üí‚àû).
Therefore, the batch size might have an effect on the performance of the model. However, via an
ablation study, we found that the effect of this bias estimator is not severe in practice, and our model
achieves good performance even with a batch size of 64. For detailed results and discussion of this
ablation study, please refer to the appendix C.4."
EXPERIMENTS,0.24935064935064935,"4
EXPERIMENTS"
DATASETS,0.2519480519480519,"4.1
DATASETS"
DATASETS,0.2545454545454545,"RotatedMNIST consists of 70,000 MNIST (LeCun et al., 2010) images that are divided into
six domains, each with 11,666 images.
The images in each domain are rotated counter-
clockwise by 0‚ó¶, 15‚ó¶, 30‚ó¶, 45‚ó¶, 60‚ó¶and 75‚ó¶respectively.
We denote the six domains as
M0, M15, M30, M45, M60 and M75. We use M0 as the source domain, and perform Ô¨Åve experi-
ments, each with M15, M30, M45, M60 or M75 as the target domain. The task is classiÔ¨Åcation of
the ten digit labels."
DATASETS,0.2571428571428571,"DIGITS is a common domain adaptation dataset, with 3 digit classiÔ¨Åcation sub-datasets, namely
MNIST, USPS (Hull, 1994) and SVHN (Netzer et al., 2011). Three common adaptation experiments
are MNIST ‚ÜíUSPS, USPS ‚ÜíMNIST and SVHN ‚ÜíMNIST."
DATASETS,0.2597402597402597,"VisDA17 (Peng et al., 2017) is a challenging real-world classiÔ¨Åcation dataset with a simulation-to-
real adaptation task. This dataset contains over 280K images from 12 classes. The source domain
contains renderings of 3D models, while the target domain contains real images."
DATASETS,0.2623376623376623,"Please refer to the appendix for results of datasets with more domains such as PACS (Li et al.,
2017)."
BASELINES,0.2649350649350649,"4.2
BASELINES"
BASELINES,0.2675324675324675,"We consider all common marginal alignment methods for domain adaptation as our baselines, in-
cluding DANN, MMD, CORAL and WD. We also consider ERM (empirical risk minimization)
and its variant ERM (prob) (same as ERM but with the probabilistic representation network used
in our model). For ERM, DANN, MMD and CORAL, we follow the implementation by Gulrajani
and Lopez-Paz (2020); while for ERM (prob) and WD, we use our own implementation in Pytorch
(Paszke et al., 2019). Note that we do not include methods that are not from the marginal-alignment
family since they are out of the scope of this paper. For the full description of these baselines, please
refer to our appendix and the ofÔ¨Åcial code at https://github.com/atuannguyen/KL."
EXPERIMENTAL SETTING,0.2701298701298701,"4.3
EXPERIMENTAL SETTING"
EXPERIMENTAL SETTING,0.2727272727272727,"For the RotatedMNIST and DIGITS experiments, we use a simple convolutional neural network
with four 3√ó3 convolutional layers (followed by an average pooling layer) as the representation
network. For VisDA17, we use a Resnet50 as the representation network. Only the last layer of the
representation network differs for a deterministic representation (ERM, DANN, CORAL, MMD,
WD) and a probabilistic one (ERM (prob) and KL (ours)). For a representation of size dz, the
last layer‚Äôs dimension of a deterministic representation network is dz, while that of a probabilistic
network is 2 ¬∑ dz (dz for ¬µ and dz for œÉ2). Please refer to the appendix for the detailed experimental
setting (including data split, hyper-parameter tuning for each model, evaluation protocol, etc.)"
EXPERIMENTAL SETTING,0.2753246753246753,Published as a conference paper at ICLR 2022
EXPERIMENTAL SETTING,0.2779220779220779,Table 1: Rotated MNIST experiments with M0 as the source domain.
EXPERIMENTAL SETTING,0.2805194805194805,Target Domain
EXPERIMENTAL SETTING,0.2831168831168831,"Model
M15
M30
M45
M60
M75
Average"
EXPERIMENTAL SETTING,0.2857142857142857,"ERM
97.5¬±0.2
84.1¬±0.8
53.9¬±0.7
34.2¬±0.4
22.3¬±0.5
58.4
ERM (prob)
96.8¬±0.3
83.2¬±1.6
51.3¬±0.9
31.4¬±1.1
20.7¬±0.7
56.7
DANN
97.3¬±0.4
90.6¬±1.1
68.7¬±4.2
30.8¬±0.6
19.0¬±0.6
61.3
MMD
97.5¬±0.1
95.3¬±0.4
73.6¬±2.1
44.2¬±1.8
32.1¬±2.1
68.6
CORAL
97.1¬±0.3
82.3¬±0.3
56.0¬±2.4
30.8¬±0.2
27.1¬±1.7
58.7
WD
96.7¬±0.3
93.1¬±1.2
64.1¬±3.3
41.4¬±7.6
27.6¬±2.0
64.6"
EXPERIMENTAL SETTING,0.2883116883116883,"KL (ours)
97.8¬±0.1
97.1¬±0.2
93.4¬±0.8
75.5¬±2.4
68.1¬±1.8
86.4"
EXPERIMENTAL SETTING,0.2909090909090909,Table 2: DIGITS and VisDA17 experiments.
EXPERIMENTAL SETTING,0.2935064935064935,"DIGITS
VisDA17"
EXPERIMENTAL SETTING,0.2961038961038961,"Model
M ‚ÜíU
U ‚ÜíM
S ‚ÜíM
Average
S ‚ÜíR"
EXPERIMENTAL SETTING,0.2987012987012987,"ERM
73.1¬±4.2
54.8¬±6.2
65.9¬±1.4
64.6
39.1¬±0.5
ERM (prob)
70.3¬±3.2
59.0¬±8.3
67.6¬±1.3
65.6
37.2¬±2.2
DANN
90.7¬±0.4
91.2¬±0.8
71.1¬±0.5
84.3
57.7¬±1.3
MMD
91.8¬±0.3
94.4¬±0.5
82.8¬±0.3
89.7
62.8¬±1.1
CORAL
88.0¬±1.9
83.3¬±0.1
69.3¬±0.6
80.2
39.5¬±4.5
WD
88.2¬±0.6
60.2¬±1.8
68.4¬±2.5
72.3
38.9¬±4.8"
EXPERIMENTAL SETTING,0.3012987012987013,"KL (ours)
98.2¬±0.2
97.3¬±0.5
92.5¬±0.9
96.0
70.6¬±0.5"
RESULTS,0.3038961038961039,"4.4
RESULTS"
RESULTS,0.3064935064935065,"RotatedMNIST and DIGITS: Table 1 and Table 2 show the results for the RotatedMNIST and
DIGITS experiments. It is clear that in these experiments, aligning the representation between
domains does help improve the generalization performance. Among the baselines (DANN, MMD,
CORAL, WD), MMD performs the best, which we attribute to the fact that it does not use a minimax
objective, leading to more stable optimization. Meanwhile, CORAL performs the worst, since it only
matches the Ô¨Årst two moments of the distributions and might fail to align complex distributions.
Our method, KL, largely outperforms the baselines, indicating its effectiveness. Visualization of
the representation space also shows that our method aligns the representation better than existing
methods. This visualization can be found in the appendix."
RESULTS,0.3090909090909091,"VisDA17 (Table 2): In this challenging dataset, many marginal alignment techniques (CORAL,
WD) fail the adaptation task (achieve similar accuracy as the ERM baselines). MMD and KL (ours)
are again the best performers, conÔ¨Årming that a stable training objective is beneÔ¨Åcial in practice.
Our method outperforms all other marginal-alignment approaches signiÔ¨Åcantly, suggesting the ef-
fectiveness of the KL divergence in representation alignment."
CONCLUSION,0.3116883116883117,"5
CONCLUSION"
CONCLUSION,0.3142857142857143,"In conclusion, in this paper, we derive a generalization bound of the target loss in the domain adapta-
tion problem using the reverse KL divergence. We then show that with a probabilistic representation,
the KL divergence can easily be estimated using Monte Carlo (minibatch) samples, without any ad-
ditional computation or adversarial objective. By minimizing the KL divergence, we can reduce the
generalization bound and have a better guarantee about the test loss. We also empirically show that
our method outperforms relevant baselines with large margins, which we attribute to its simple and
stable training procedure and the mode-seeking/zero-forcing nature of the reverse KL. We conclude
that KL divergence is very effective as a tool for representation alignment. In general, a limitation
of marginal alignment methods (ours included) is that when the conditional distribution changes
signiÔ¨Åcantly from the source domain to the target domain, aligning the marginal would not help the
target domain‚Äôs performance. This is also reÔ¨Çected in our generalization bound. For future work, we
would want to investigate the use of KL divergence in other types of alignment. For example, we can
follow the algorithm in Kang et al. (2019) to minimize the intra-class distance of the representation
across domains and maximize the inter-class distance between them, but using the KL divergence
instead of MMD as the distance between representation distributions. Another direction would be
using KL divergence to align the conditional distribution across domains in a multi-source setting."
CONCLUSION,0.3168831168831169,Published as a conference paper at ICLR 2022
CONCLUSION,0.3194805194805195,"Acknowledgments
This work is supported by the UKRI grant:
Turing AI Fellowship
EP/W002981/1 and EPSRC/MURI grant: EP/N019474/1. We would also like to thank the Royal
Academy of Engineering and FiveAI."
REFERENCES,0.3220779220779221,REFERENCES
REFERENCES,0.3246753246753247,"D. Acuna, G. Zhang, M. T. Law, and S. Fidler. f-domain-adversarial learning: Theory and algo-
rithms. arXiv preprint arXiv:2106.11344, 2021."
REFERENCES,0.32727272727272727,"H. Ajakan, P. Germain, H. Larochelle, F. Laviolette, and M. Marchand. Domain-adversarial neural
networks. arXiv preprint arXiv:1412.4446, 2014."
REFERENCES,0.32987012987012987,"A. A. Alemi, I. Fischer, J. V. Dillon, and K. Murphy. Deep variational information bottleneck. arXiv
preprint arXiv:1612.00410, 2016."
REFERENCES,0.33246753246753247,"K. Azizzadenesheli, A. Liu, F. Yang, and A. Anandkumar. Regularized learning for domain adapta-
tion under label shifts. arXiv preprint arXiv:1903.09734, 2019."
REFERENCES,0.33506493506493507,"S. Ben-David, J. Blitzer, K. Crammer, A. Kulesza, F. Pereira, and J. W. Vaughan. A theory of
learning from different domains. Machine learning, 79(1):151‚Äì175, 2010."
REFERENCES,0.33766233766233766,"J. Bergstra and Y. Bengio. Random search for hyper-parameter optimization. Journal of machine
learning research, 13(2), 2012."
REFERENCES,0.34025974025974026,"O. Bousquet, S. Boucheron, and G. Lugosi. Introduction to statistical learning theory. In Summer
School on Machine Learning, pages 169‚Äì207. Springer, 2003."
REFERENCES,0.34285714285714286,"R. T. d. Combes, H. Zhao, Y.-X. Wang, and G. Gordon. Domain adaptation with conditional distri-
bution matching and generalized label shift. arXiv preprint arXiv:2003.04475, 2020."
REFERENCES,0.34545454545454546,"C. Cortes, Y. Mansour, and M. Mohri. Learning bounds for importance weighting. In Nips, vol-
ume 10, pages 442‚Äì450. Citeseer, 2010."
REFERENCES,0.34805194805194806,"Y. Ganin, E. Ustinova, H. Ajakan, P. Germain, H. Larochelle, F. Laviolette, M. Marchand, and
V. Lempitsky. Domain-adversarial training of neural networks. The journal of machine learning
research, 17(1):2096‚Äì2030, 2016."
REFERENCES,0.35064935064935066,"M. Ghifary, W. B. Kleijn, M. Zhang, and D. Balduzzi. Domain generalization for object recognition
with multi-task autoencoders. In Proceedings of the IEEE International Conference on Computer
Vision, pages 2551‚Äì2559, 2015."
REFERENCES,0.35324675324675325,"I. Goodfellow.
Nips 2016 tutorial:
Generative adversarial networks.
arXiv preprint
arXiv:1701.00160, 2016."
REFERENCES,0.35584415584415585,"A. Gretton, K. M. Borgwardt, M. J. Rasch, B. Sch¬®olkopf, and A. Smola. A kernel two-sample test.
The Journal of Machine Learning Research, 13(1):723‚Äì773, 2012."
REFERENCES,0.35844155844155845,"I. Gulrajani and D. Lopez-Paz.
In search of lost domain generalization.
arXiv preprint
arXiv:2007.01434, 2020."
REFERENCES,0.36103896103896105,"K. He, X. Zhang, S. Ren, and J. Sun. Deep residual learning for image recognition. In Proceedings
of the IEEE conference on computer vision and pattern recognition, pages 770‚Äì778, 2016."
REFERENCES,0.36363636363636365,"J. J. Hull. A database for handwritten text recognition research. IEEE Transactions on Pattern
Analysis and Machine Intelligence, 16(5):550‚Äì554, 1994. doi: 10.1109/34.291440."
REFERENCES,0.36623376623376624,"F. D. Johansson, D. Sontag, and R. Ranganath. Support and invertibility in domain-invariant repre-
sentations. In The 22nd International Conference on ArtiÔ¨Åcial Intelligence and Statistics, pages
527‚Äì536. PMLR, 2019."
REFERENCES,0.36883116883116884,"G. Kang, L. Jiang, Y. Yang, and A. G. Hauptmann. Contrastive adaptation network for unsupervised
domain adaptation. In Proceedings of the IEEE/CVF Conference on Computer Vision and Pattern
Recognition, pages 4893‚Äì4902, 2019."
REFERENCES,0.37142857142857144,"A. Khosla, T. Zhou, T. Malisiewicz, A. A. Efros, and A. Torralba. Undoing the damage of dataset
bias. In European Conference on Computer Vision, pages 158‚Äì171. Springer, 2012."
REFERENCES,0.37402597402597404,Published as a conference paper at ICLR 2022
REFERENCES,0.37662337662337664,"D. P. Kingma and J. Ba.
Adam:
A method for stochastic optimization.
arXiv preprint
arXiv:1412.6980, 2014."
REFERENCES,0.37922077922077924,"D. P. Kingma and M. Welling. Auto-encoding variational bayes. arXiv preprint arXiv:1312.6114,
2013."
REFERENCES,0.38181818181818183,"N. Kodali, J. Abernethy, J. Hays, and Z. Kira. On convergence and stability of gans. arXiv preprint
arXiv:1705.07215, 2017."
REFERENCES,0.38441558441558443,"Y. LeCun, C. Cortes, and C. Burges. Mnist handwritten digit database. ATT Labs [Online]. Avail-
able: http://yann.lecun.com/exdb/mnist, 2, 2010."
REFERENCES,0.38701298701298703,"D. Li, Y. Yang, Y.-Z. Song, and T. Hospedales. Deeper, broader and artier domain generalization.
In International Conference on Computer Vision, 2017."
REFERENCES,0.38961038961038963,"H. Li, S. J. Pan, S. Wang, and A. C. Kot. Domain generalization with adversarial feature learning. In
Proceedings of the IEEE Conference on Computer Vision and Pattern Recognition, pages 5400‚Äì
5409, 2018."
REFERENCES,0.3922077922077922,"Y. Mansour, M. Mohri, and A. Rostamizadeh. Domain adaptation: Learning bounds and algorithms.
arXiv preprint arXiv:0902.3430, 2009."
REFERENCES,0.3948051948051948,"T. Minka et al. Divergence measures and message passing. Technical report, Citeseer, 2005."
REFERENCES,0.3974025974025974,"K. Muandet, D. Balduzzi, and B. Sch¬®olkopf. Domain generalization via invariant feature represen-
tation. In International Conference on Machine Learning, pages 10‚Äì18. PMLR, 2013."
REFERENCES,0.4,"Y. Netzer, T. Wang, A. Coates, A. Bissacco, B. Wu, and A. Y. Ng. Reading digits in natural images
with unsupervised feature learning. 2011."
REFERENCES,0.4025974025974026,"A. T. Nguyen, T. Tran, Y. Gal, and A. G. Baydin. Domain invariant representation learning with
domain density transformations. arXiv preprint arXiv:2102.05082, 2021."
REFERENCES,0.4051948051948052,"A. Paszke, S. Gross, F. Massa, A. Lerer, J. Bradbury, G. Chanan, T. Killeen, Z. Lin, N. Gimelshein,
L. Antiga, A. Desmaison, A. Kopf, E. Yang, Z. DeVito, M. Raison, A. Tejani, S. Chilamkurthy,
B. Steiner, L. Fang, J. Bai, and S. Chintala. Pytorch: An imperative style, high-performance
deep learning library. In H. Wallach, H. Larochelle, A. Beygelzimer, F. d'Alch¬¥e-Buc, E. Fox, and
R. Garnett, editors, Advances in Neural Information Processing Systems 32, pages 8024‚Äì8035.
2019."
REFERENCES,0.4077922077922078,"X. Peng, B. Usman, N. Kaushik, J. Hoffman, D. Wang, and K. Saenko. Visda: The visual domain
adaptation challenge, 2017."
REFERENCES,0.4103896103896104,"K. Saenko, B. Kulis, M. Fritz, and T. Darrell. Adapting visual category models to new domains. In
European conference on computer vision, pages 213‚Äì226. Springer, 2010."
REFERENCES,0.412987012987013,"J. Shen, Y. Qu, W. Zhang, and Y. Yu. Wasserstein distance guided representation learning for domain
adaptation. In Proceedings of the AAAI Conference on ArtiÔ¨Åcial Intelligence, volume 32, 2018."
REFERENCES,0.4155844155844156,"B. Sun and K. Saenko. Deep coral: Correlation alignment for deep domain adaptation. In European
conference on computer vision, pages 443‚Äì450. Springer, 2016."
REFERENCES,0.41818181818181815,"A. K. Tanwani. Domain-invariant representation learning for sim-to-real transfer. arXiv preprint
arXiv:2011.07589, 2020."
REFERENCES,0.42077922077922075,"L. Van der Maaten and G. Hinton.
Visualizing data using t-sne.
Journal of machine learning
research, 9(11), 2008."
REFERENCES,0.42337662337662335,"A. Vaswani, N. Shazeer, N. Parmar, J. Uszkoreit, L. Jones, A. N. Gomez, L. Kaiser, and I. Polo-
sukhin. Attention is all you need. arXiv preprint arXiv:1706.03762, 2017."
REFERENCES,0.42597402597402595,"X. Xu, X. Zhou, R. Venkatesan, G. Swaminathan, and O. Majumder. d-sne: Domain adaptation
using stochastic neighborhood embedding. In Proceedings of the IEEE/CVF Conference on Com-
puter Vision and Pattern Recognition, pages 2497‚Äì2506, 2019."
REFERENCES,0.42857142857142855,"Y. Zhang, T. Liu, M. Long, and M. Jordan. Bridging theory and algorithm for domain adaptation.
In International Conference on Machine Learning, pages 7404‚Äì7413. PMLR, 2019."
REFERENCES,0.43116883116883115,Published as a conference paper at ICLR 2022
REFERENCES,0.43376623376623374,"H. Zhao, R. T. Des Combes, K. Zhang, and G. Gordon. On learning invariant representations for
domain adaptation. In International Conference on Machine Learning, pages 7523‚Äì7532. PMLR,
2019."
REFERENCES,0.43636363636363634,"Y. Zhu, F. Zhuang, J. Wang, G. Ke, J. Chen, J. Bian, H. Xiong, and Q. He. Deep subdomain
adaptation network for image classiÔ¨Åcation. IEEE transactions on neural networks and learning
systems, 32(4):1713‚Äì1722, 2020."
REFERENCES,0.43896103896103894,"A
PROOFS"
REFERENCES,0.44155844155844154,"For the following proofs, we treat the variables as continuous variables and always use the inte-
gral. If one or some of the variables are discrete, it is straight-forward to replace the corresponding
integral(s) with summation sign(s) and the proofs still hold."
REFERENCES,0.44415584415584414,"A.1
PROPOSITION 1"
REFERENCES,0.44675324675324674,Proof. We have:
REFERENCES,0.44935064935064933,"ltest ‚â§EpT (z,y)[‚àílog ÀÜp(y|z)]
(17)"
REFERENCES,0.45194805194805193,"=
Z
‚àílog ÀÜp(y|z)pT (z, y)dzdy
(18)"
REFERENCES,0.45454545454545453,"=
Z
‚àílog ÀÜp(y|z)pS(z, y)dzdy +
Z
‚àílog ÀÜp(y|z) [pT (z, y) ‚àípS(z, y)] dzdy
(19)"
REFERENCES,0.45714285714285713,"= ltrain +
Z
‚àílog ÀÜp(y|z) [pT (z, y) ‚àípS(z, y)] dzdy
(20)"
REFERENCES,0.4597402597402597,"Let A = {(z, y)|pT (z, y)‚àípS(z, y) ‚â•0} and B = {(z, y)|pT (z, y)‚àípS(z, y) < 0}, using the fact
that ‚àílog ÀÜp(y|z) ‚â•0 ‚àÄz ‚ààZ, y ‚ààY we have:"
REFERENCES,0.4623376623376623,"Z
‚àílog ÀÜp(y|z) [pT (z, y) ‚àípS(z, y)] dzdy
(21) =
Z"
REFERENCES,0.4649350649350649,"A
‚àílog ÀÜp(y|z) [pT (z, y) ‚àípS(z, y)] dzdy +
Z"
REFERENCES,0.4675324675324675,"B
‚àílog ÀÜp(y|z) [pT (z, y) ‚àípS(z, y)] dzdy (22) ‚â§
Z"
REFERENCES,0.4701298701298701,"A
‚àílog ÀÜp(y|z) [pT (z, y) ‚àípS(z, y)] dzdy
(23) =
Z"
REFERENCES,0.4727272727272727,"A
‚àílog ÀÜp(y|z) |pT (z, y) ‚àípS(z, y)| dzdy
(24) ‚â§M
Z"
REFERENCES,0.4753246753246753,"A
|pT (z, y) ‚àípS(z, y)| dzdy
(25)"
REFERENCES,0.4779220779220779,"(since ‚àílog ÀÜp(y|z) ‚â§M)
(26)"
REFERENCES,0.4805194805194805,where |.| is the absolute value.
REFERENCES,0.4831168831168831,"Here,
R"
REFERENCES,0.4857142857142857,"A |pT (z, y) ‚àípS(z, y)| dzdy is also called the total variation of the two distributions pT (z, y)
and pS(z, y)."
REFERENCES,0.4883116883116883,Published as a conference paper at ICLR 2022
REFERENCES,0.4909090909090909,"Note that:
Z
pT (z, y) ‚àípS(z, y)dzdy = 0
(27) ‚áî
Z"
REFERENCES,0.4935064935064935,"A
pT (z, y) ‚àípS(z, y)dzdy +
Z"
REFERENCES,0.4961038961038961,"B
pT (z, y) ‚àípS(z, y)dzdy = 0
(28) ‚áî
Z"
REFERENCES,0.4987012987012987,"A
pT (z, y) ‚àípS(z, y)dzdy =
Z"
REFERENCES,0.5012987012987012,"B
pS(z, y) ‚àípT (z, y)dzdy
(29) ‚áî
Z"
REFERENCES,0.5038961038961038,"A
|pT (z, y) ‚àípS(z, y)| dzdy =
Z"
REFERENCES,0.5064935064935064,"B
|pT (z, y) ‚àípS(z, y)| dzdy
(30) ‚áî
Z"
REFERENCES,0.509090909090909,"A
|pT (z, y) ‚àípS(z, y)| dzdy = 1 2"
REFERENCES,0.5116883116883116,"Z
|pT (z, y) ‚àípS(z, y)| dzdy
(31)"
REFERENCES,0.5142857142857142,Therefore:
REFERENCES,0.5168831168831168,"ltest ‚â§ltrain + M
Z"
REFERENCES,0.5194805194805194,"A
|pT (z, y) ‚àípS(z, y)| dzdy
(32)"
REFERENCES,0.522077922077922,= ltrain + M 2
REFERENCES,0.5246753246753246,"Z
|pT (z, y) ‚àípS(z, y)| dzdy
(33)"
REFERENCES,0.5272727272727272,"Using the Pinsker‚Äôs inequality, we have:
Z
|pT (z, y) ‚àípS(z, y)| dzdy
2
‚â§2
Z
pT (z, y) log pT (z, y)"
REFERENCES,0.5298701298701298,"pS(z, y)dzdy
(34)"
REFERENCES,0.5324675324675324,"Therefore, we Ô¨Ånally have:"
REFERENCES,0.535064935064935,ltest ‚â§ltrain + M 2 s
Z,0.5376623376623376,"2
Z
pT (z, y) log pT (z, y)"
Z,0.5402597402597402,"pS(z, y)dzdy
(35)"
Z,0.5428571428571428,"= ltrain + M
‚àö 2 p"
Z,0.5454545454545454,"KL[pT (z, y)|pS(z, y)]
(36)"
Z,0.548051948051948,Which concludes our proof.
Z,0.5506493506493506,"Also note that the KL divergence between pT (z, y) and pS(z, y) can further be decomposed into the
marginal misalignment and conditional misalignment as follow:
KL[pT (z, y)|pS(z, y)] = EpT (z,y)[log pT (z, y) ‚àílog pS(z, y)]
(37)"
Z,0.5532467532467532,"= EpT (z,y)[log pT (z) + log pT (y|z) ‚àílog pS(z) ‚àílog pS(y|z)]
(38)"
Z,0.5558441558441558,"= EpT (z,y)[log pT (z) ‚àílog pS(z)] + EpT (z,y)[log pT (y|z) ‚àílog pS(y|z)]
(39)
= EpT (z)[log pT (z) ‚àílog pS(z)]"
Z,0.5584415584415584,"+ EpT (z)

EpT (y|z)[log pT (y|z) ‚àílog pS(y|z)]

(40)"
Z,0.561038961038961,"= KL[pT (z)|pS(z)] + EpT (z) [KL[pT (y|z)|pS(y|z)]]
(41)"
Z,0.5636363636363636,"A.2
PROPOSITION 2"
Z,0.5662337662337662,"Proof. According to Assumption 1, we have:
IS(z, y) = IS(x, y)
(42)
‚áîHS(y) ‚àíHS(y|z) = HS(y) ‚àíHS(y|x)
(43)
‚áîHS(y|z) = HS(y|x)
(44)
‚áîEpS(z,y)[log pS(y|z)] = EpS(x,y)[log pS(y|x)]
(45)"
Z,0.5688311688311688,"‚áîEpS(x,z,y)[log pS(y|z)] = EpS(x,y)[log pS(y|x)]
(46)"
Z,0.5714285714285714,"‚áîEpS(x,y)

Ep(z|x)[log pS(y|z)]

= EpS(x,y)[log pS(y|x)]
(47)"
Z,0.574025974025974,"‚áîEpS(x,y)

log pS(y|x) ‚àíEp(z|x)[log pS(y|z)]

= 0
(48)"
Z,0.5766233766233766,Published as a conference paper at ICLR 2022
Z,0.5792207792207792,"According to Assumption 2, ‚àÄx ‚ààX, y ‚ààY we have:"
Z,0.5818181818181818,"pS(y|x) = Ep(z|x)[pS(y|z)]
(49)"
Z,0.5844155844155844,"‚áîlog pS(y|x) = log Ep(z|x)[pS(y|z)]
(50)"
Z,0.587012987012987,"‚áílog pS(y|x) ‚â•Ep(z|x)[log pS(y|z)]
(51)"
Z,0.5896103896103896,"Since pT (x,y)"
Z,0.5922077922077922,"pS(x,y) < ‚àû, there exists N > 0 such that pT (x,y)"
Z,0.5948051948051948,"pS(x,y) ‚â§N ‚àÄx ‚ààX, y ‚ààY. Therefore:"
Z,0.5974025974025974,"EpT (x,y)

log pS(y|x) ‚àíEp(z|x)[log pS(y|z)]

(52)"
Z,0.6,"=EpS(x,y)"
Z,0.6025974025974026," 
log pS(y|x) ‚àíEp(z|x)[log pS(y|z)]
 pT (x, y)"
Z,0.6051948051948052,"pS(x, y)"
Z,0.6077922077922078,"
(53)"
Z,0.6103896103896104,"‚â§N.EpS(x,y)

log pS(y|x) ‚àíEp(z|x)[log pS(y|z)]

(54)
=0
(55)"
Z,0.612987012987013,Therefore:
Z,0.6155844155844156,"EpT (x,y)

log pS(y|x) ‚àíEp(z|x)[log pS(y|z)]

= 0
(56)"
Z,0.6181818181818182,"‚áîEpT (x,y) [log pS(y|x)] = EpT (x,y,z)[log pS(y|z)]
(57)"
Z,0.6207792207792208,"‚áîEpT (x,y) [log pS(y|x)] = EpT (z,y)[log pS(y|z)]
(58)"
Z,0.6233766233766234,We have:
Z,0.625974025974026,"EpT (z) [KL[pT (y|z)|pS(y|z)]] ‚â§EpT (x) [KL[pT (y|x)|pS(y|x)]]
(59)"
Z,0.6285714285714286,"‚áîEpT (z,y) [log pT (y|z) ‚àílog pS(y|z)] ‚â§EpT (x,y) [log pT (y|x) ‚àílog pS(y|x)]
(60)"
Z,0.6311688311688312,"Using Eq 58, we now only need to prove that:"
Z,0.6337662337662338,"EpT (z,y) [log pT (y|z)] ‚â§EpT (x,y) [log pT (y|x)]
(61)"
Z,0.6363636363636364,"‚áî‚àíHT (y|z) ‚â§‚àíHT (y|x)
(62)
‚áîHT (y) ‚àíHT (y|z) ‚â§HT (y) ‚àíHT (y|x)
(63)
‚áîIT (z, y) ‚â§IT (x, y)
(64)
(always true based on the Data Processing Inequality)
(65)"
Z,0.638961038961039,"B
REVIEW OF EXISTING GENERALIZATION BOUNDS"
Z,0.6415584415584416,"There have been several works studying the generalization bounds of the Domain Adaptation prob-
lem. We brieÔ¨Çy review the most important and common ones here with a discussion about their
differences to our proposed bound."
Z,0.6441558441558441,"B.1
BEN-DAVID ET AL. (2010)"
Z,0.6467532467532467,"Ben-David et al. (2010) consider a binary classiÔ¨Åcation problem. Let x be the input with the support
set X and y be the binary label with the support set Y = {0, 1}. Consider a source domain with
a distribution P s
X over the input x and the true labeling function f s : X ‚Üí{0, 1}; and similarly
a target domain with a distribution P t
X over the input x and the true labeling function f t : X ‚Üí
{0, 1}. Note that the authors claim that this labeling function can be probabilistic; in that case, f :
X ‚Üí[0, 1] denoting the probability. However, we argue that this probabilistic setting is impractical
since we would not know that true underlying function in order to calculate/estimate the bounds
in practice). Therefore, we found that the bound is only practical for the case of a deterministic
labeling mechanism."
Z,0.6493506493506493,"The error of the classiÔ¨Åer h, which is also a deterministc labeling function, on the source domain is:"
Z,0.6519480519480519,"œµs(h) = Ex‚àºP s
X[|h(x) ‚àíf s(x)|],
(66)"
Z,0.6545454545454545,Published as a conference paper at ICLR 2022
Z,0.6571428571428571,and similarly for the target domain:
Z,0.6597402597402597,"œµt(h) = Ex‚àºP t
X[|h(x) ‚àíf t(x)|].
(67)"
Z,0.6623376623376623,"Here |.| is the absolute value, which means the loss of a data point is the L1 distance of the labels."
Z,0.6649350649350649,"Consider a hypothesis space H and let a classiÔ¨Åer h be any function from that space. The Ô¨Årst
theorem in Ben-David et al. (2010) offers a bound of the target loss œµt(h) based on the source loss
œµs(h), and the total variation between P s
X and P t
X, and the difference between the two labeling
function f s and f t:"
Z,0.6675324675324675,Theorem 1 (Ben-David et al. (2010))
Z,0.6701298701298701,"œµt(h) ‚â§œµs(h) + 2d1(P s
X, P t
X) +
min
PX‚àà{P s
X,P t
X} Ex‚àºPX[|f s(x) ‚àíf t(x)|]
(68)"
Z,0.6727272727272727,"where d1(P s
X, P t
X) is the total variational distance, i.e., d1(P s
X, P t
X) := supA‚ààX [P s
X(A)‚àíP t
X(A)],
and X is the sigma-Ô¨Åeld of X (set of all subsets of X)."
Z,0.6753246753246753,"In
this
theorem,
the
term
2d1(P s
X, P t
X)
presents
the
marginal
misalignment
and
minPX‚àà{P s
X,P t
X} Ex‚àºPX[|f s(x) ‚àíf t(x)|] is the conditional misalignment."
Z,0.6779220779220779,"Ben-David et al. (2010) also propose another bound based on a variant of the H-divergence, which
is presented in the following theorem:"
Z,0.6805194805194805,Theorem 2 (Ben-David et al. (2010))
Z,0.6831168831168831,"œµt(h) ‚â§œµs(h) + dH‚àÜH(P s
X, P t
X) + ŒªH
(69)"
Z,0.6857142857142857,"where the H‚àÜH-divergence dH‚àÜH(P s
X, P t
X)
:=
suph1,h2‚ààH |Prx‚àºP s
X[h1(x)
Ã∏=
h2(x)] ‚àí
Prx‚àºP t
X[h1(x) Ã∏= h2(x)]| replaces the total variation to measure the marginal misalignment of the
two domains. Meanwhile, ŒªH = infh‚ààH[œµs(h) + œµt(h)] measures the conditional misalignment
of the two domains (if the two true labeling functions f s and f t are the same and belong to the
hypothesis space H, this quantity is zero)."
Z,0.6883116883116883,"The above bounds can also be applied to the representation space (similar to ours), leading to
the same bounds where the input x is replaced by its representation z. However, as mentioned
in the main text, it is not clear if the conditional misalignment in the representation space (e.g.,
minPZ‚àà{P s
Z,P t
Z} Ez‚àºPZ[|gs(z) ‚àígt(z)|]) is bounded or not."
Z,0.6909090909090909,"Difference to our bound
First of all, Ben-David et al. (2010) only consider a binary classiÔ¨Åcation
problem. Moreover, as discussed above, the bounds in Ben-David et al. (2010) are only practical
with deterministic labeling mechanisms for both domains. This assumption is hard to be true for
most datasets since the labeling mechanism is usually probabilistic. This makes it not generalizable
to the general case of supervised learning. Furthermore, the loss function is a L1 distance between
the labeling function, which is also not a common choice in practice, which makes it challenging to
generalize to the multiclass classiÔ¨Åcation set-up (even if there exists a deterministic labeling function
for a multiclass dataset, using the L1 loss for the one-hot encoded labels would be unreasonable; the
common loss function in practice for the multiclass classiÔ¨Åcation problem is the cross-entropy loss).
Finally, the total variation and H-divergence might be hard to estimate in practice since it requires
the computation of a supremum."
Z,0.6935064935064935,"B.2
MANSOUR ET AL. (2009)"
Z,0.6961038961038961,"Mansour et al. (2009) consider a more Ô¨Çexible problem set-up than Ben-David et al. (2010). Specif-
ically, instead of Y = {0, 1}, they consider the cases where Y = {0, 1} (for binary classiÔ¨Åcation)
or Y is a measurable subset of R (for regression). Note that their bound still cannot work for mul-
ticlass classÔ¨Åcation. They also generalize the L1 loss function to a loss function L : Y √ó Y ‚ÜíR;
however, this loss function must obey the triangle inequality. Although the L1 distance satisÔ¨Åes this
inequality, it is not generally true for other common loss functions in practice (e.g., cross-entropy).
They still consider deterministic labeling function f s and f t for the source and target domain."
Z,0.6987012987012987,"Similar to Ben-David et al. (2010), with a hypothesis h from the hypothesis space H, the error of
the source and target domain are:"
Z,0.7012987012987013,Published as a conference paper at ICLR 2022
Z,0.7038961038961039,"œµs(h) = Ex‚àºP s
X[L(h(x), f s(x))]
(70)"
Z,0.7064935064935065,"œµt(h) = Ex‚àºP t
X[L(h(x), f t(x))]
(71)"
Z,0.7090909090909091,"For convenience, denote also the error between two labeling function h and h‚Ä≤ in the source and
target distribution as:"
Z,0.7116883116883117,"œµs(h, h‚Ä≤) = Ex‚àºP s
X[L(h(x), h‚Ä≤(x))]
(72)"
Z,0.7142857142857143,"œµt(h, h‚Ä≤) = Ex‚àºP t
X[L(h(x), h‚Ä≤(x))]
(73)"
Z,0.7168831168831169,"(which means œµs(h) = œµs(h, f s) and œµt(h) = œµt(h, f t))."
Z,0.7194805194805195,"Also, let h‚àós and h‚àót be the minimizer of œµs(h) and œµt(h) respectively. In particular:"
Z,0.7220779220779221,"h‚àós = arg min
h‚ààH œµs(h) = arg min
h‚ààH Ex‚àºP s
X[L(h(x), f s(x))]
(74)"
Z,0.7246753246753247,"h‚àót = arg min
h‚ààH œµt(h) = arg min
h‚ààH Ex‚àºP t
X[L(h(x), f t(x))]
(75)"
Z,0.7272727272727273,Mansour et al. (2009) introduce a generalization bound as follow:
Z,0.7298701298701299,"Theorem 3 (Mansour et al. (2009)) Assume that the loss function L is symmetric and obeys the
triangle inequality. Then, for any hypothesis h ‚ààH , the following holds"
Z,0.7324675324675325,"œµt(h) ‚â§œµt(h‚àót) + œµs(h, h‚àós) + disc(P s
X, P t
X) + œµt(h‚àós, h‚àót)
(76)"
Z,0.7350649350649351,"where disc(P s
X, P t
X) := suph,h‚Ä≤‚ààH |œµs(h, h‚Ä≤) ‚àíœµt(h, h‚Ä≤)|, which is a generalized version of the
H‚àÜH-divergence."
Z,0.7376623376623377,"Here, the Ô¨Årst term œµt(h‚àót) is the ideal target loss (will be zero if the hypothesis space H contains ft),
the second term œµs(h, h‚àós) will be zero if we choose h = h‚àós (which is the common practice, e.g.,
train the classiÔ¨Åer h on the source domain), the third term disc(P s
X, P t
X) measures the marginal mis-
alignment, and the Ô¨Ånal term œµt(h‚àós, h‚àót) is somewhat an indicator of the conditional misalignment
(becomes zero if f s = f t ‚ààH)."
Z,0.7402597402597403,"Difference to our bound
The above bound is based on the ideal target loss, while our bound is
based on the source loss. In practice, we have (an estimate) of the source loss calculated on the
source domain‚Äôs training set; meanwhile, the ideal target loss is unknown. This makes the above
bound less useful in practice compared to ours. Furthermore, the above bound has similar problems
as the ones in Ben-David et al. (2010): it does not work for multiclass classiÔ¨Åcation, it assumes
a deterministic labeling mechanism (which does not hold in practice), it assumes the loss function
obeys the triangle inequality (which generally is not true in practice), and it contains terms that are
not easy to compute in practice (supremum and inÔ¨Åmum)."
Z,0.7428571428571429,"C
ADDITIONAL EXPERIMENTAL RESULTS"
Z,0.7454545454545455,"C.1
VISUALIZATION OF THE ROTATEDMNIST EXPERIMENTS"
Z,0.7480519480519481,"Figure 3 shows the representation space (for the RotatedMNIST experiment with source M0 and
target M45) of our method compared to the baselines, visualized using t-SNE (Van der Maaten and
Hinton, 2008). We can clearly see that the color clusters (which correspond to the digit classes) of
our method are much more aligned when compared to other baselines such as MMD, DANN and
ERM. This illustrates the effectiveness of our method in aligning the representation in the domain
adaptation problem."
Z,0.7506493506493507,"C.2
PACS"
Z,0.7532467532467533,"Table 3 presents the results for PACS, which is a challenging real-world dataset for domain adap-
tation/generalization. In this dataset, our model outperforms the ERM baselines by roughly 9%"
Z,0.7558441558441559,Published as a conference paper at ICLR 2022
Z,0.7584415584415585,"60
40
20
0
20
40
60
TSNE dim 1 40 30 20 10 0 10 20 30"
Z,0.7610389610389611,TSNE dim 2
Z,0.7636363636363637,TSNE Visualization
Z,0.7662337662337663,"0
1
2
3
4
5
6
7
8
9"
Z,0.7688311688311689,"60
40
20
0
20
40
60
TSNE dim 1 40 30 20 10 0 10 20 30"
Z,0.7714285714285715,TSNE dim 2
Z,0.7740259740259741,TSNE Visualization
Z,0.7766233766233767,(a) KL
Z,0.7792207792207793,"60
40
20
0
20
40
60
80
TSNE dim 1 60 40 20 0 20 40 60"
Z,0.7818181818181819,TSNE dim 2
Z,0.7844155844155845,TSNE Visualization
Z,0.787012987012987,"60
40
20
0
20
40
60
80
TSNE dim 1 60 40 20 0 20 40 60"
Z,0.7896103896103897,TSNE dim 2
Z,0.7922077922077922,TSNE Visualization
Z,0.7948051948051948,(b) MMD
Z,0.7974025974025974,"80
60
40
20
0
20
40
60
80
TSNE dim 1 60 40 20 0 20 40 60"
Z,0.8,TSNE dim 2
Z,0.8025974025974026,TSNE Visualization
Z,0.8051948051948052,"80
60
40
20
0
20
40
60
80
TSNE dim 1 60 40 20 0 20 40 60"
Z,0.8077922077922078,TSNE dim 2
Z,0.8103896103896104,TSNE Visualization
Z,0.812987012987013,(c) DANN
Z,0.8155844155844156,"80
60
40
20
0
20
40
60
TSNE dim 1 80 60 40 20 0 20 40 60"
Z,0.8181818181818182,TSNE dim 2
Z,0.8207792207792208,TSNE Visualization
Z,0.8233766233766234,"80
60
40
20
0
20
40
60
TSNE dim 1 80 60 40 20 0 20 40 60"
Z,0.825974025974026,TSNE dim 2
Z,0.8285714285714286,TSNE Visualization
Z,0.8311688311688312,(d) ERM
Z,0.8337662337662337,"Figure 3: Visualization using t-SNE of the representation space of our method KL and the baselines
MMD, DANN, ERM. For each method, the left subÔ¨Ågure corresponds to the source domain M0
and the right one corresponds to the target domain M45. Each color represents a digit class."
Z,0.8363636363636363,"on average, indicating the effectiveness of our representation-alignment technique. Our method is
the best performer (with a large margin) on 8 out of 12 experiments, showing a clear beneÔ¨Åt over
other representation alignment techniques. Together with our method, MMD again performs the
best among the representation-alignment baselines (DANN, MMD, CORAL and WD), conÔ¨Årming
that a stable training procedure (with no minimax objectives in MMD and our model) is important
and often leads to better results. It is also worth noting that our model still outperforms MMD de-
spite being less computationally expensive (in this implementation, MMD needs to compute seven
Gaussian kernels for each of three pairs of representation sets in each minibatch)."
Z,0.8389610389610389,"It is interesting that the ERM baselines perform the best in some experiments (e.g., S ‚ÜíC, S ‚ÜíP).
This result also agrees with the one observed in Gulrajani and Lopez-Paz (2020) that domain gener-
alization/adaptation techniques might have negative effects when applied unsuccessfully. It should
be noted that the S (sketch) domain is undoubtedly the most different compared to others (only black
sketch on a white background while other domains have colors), which might explain the difÔ¨Åculty
when learning to transfer between domains."
Z,0.8415584415584415,"C.3
OFFICE-31"
Z,0.8441558441558441,"We also provide additional results on the OfÔ¨Åce-31 dataset Saenko et al. (2010). Table 4 presents
the performance of our model and two of the best performing baselines, namely MMD and DANN.
Although our method is not state-of-the-art in this dataset (and understandingly so), it signiÔ¨Åcantly
outperforms the relevant baselines considered in this paper."
Z,0.8467532467532467,"C.4
ABLATION STUDY: EFFECT OF BATCH SIXE"
Z,0.8493506493506493,"In this subsection, we conduct an ablation study to investigate the effect of the batch size on our
model‚Äôs performance. Table 5 shows the performance of our method on the RotatedMNIST dataset,
with M0 as the source domain and M45 as the target domain and with various choices of the batch
size. As expected, our model‚Äôs performance tends to beneÔ¨Åt from a bigger batch size, since it would
alleviate the bias of our objective estimator. We therefore recommend increasing the batchsize
whenever possible. However, our model performs well even for a batch size as small as 64 (which
is considered small in this era of deep learning)."
Z,0.8519480519480519,Published as a conference paper at ICLR 2022
Z,0.8545454545454545,Table 3: PACS experiments. Model
Z,0.8571428571428571,"Experiments
ERM
ERM (prob)
DANN
MMD
CORAL
WD
KL (ours)"
Z,0.8597402597402597,"A ‚ÜíC
66.1¬±1.3
63.5¬±0.8
71.0¬±3.2
79.5¬±0.4
62.7¬±10.4
76.2¬±0.9
73.1¬±3.4
A ‚ÜíP
94.3¬±0.6
93.5¬±1.3
94.5¬±0.5
94.5¬±1.1
86.3¬±6.8
92.4¬±1.3
95.4¬±1.2
A ‚ÜíS
53.6¬±0.8
60.9¬±3.5
58.6¬±12.8
62.1¬±2.0
46.2¬±3.5
53.9¬±2.7
67.4¬±1.9
C ‚ÜíA
69.7¬±1.1
70.8¬±2.3
76.4¬±1.7
79.5¬±3.0
75.9¬±0.9
69.0¬±2.1
83.3¬±1.1
C ‚ÜíP
82.0¬±0.9
81.5¬±2.1
78.6¬±3.4
80.8¬±2.3
78.3¬±3.6
72.9¬±8.6
83.1¬±7.4
C ‚ÜíS
72.2¬±1.4
70.4¬±1.5
76.1¬±1.0
74.1¬±1.3
56.9¬±11.0
48.7¬±6.1
68.2¬±0.5
P ‚ÜíA
65.7¬±2.3
63.3¬±1.2
68.0¬±2.7
67.7¬±1.8
70.0¬±1.5
62.6¬±1.5
75.5¬±2.5
P ‚ÜíC
29.1¬±1.9
27.2¬±3.3
50.7¬±5.0
47.4¬±0.8
47.5¬±8.6
56.1¬±1.4
67.7¬±1.2
P ‚ÜíS
38.0¬±1.0
35.9¬±2.3
29.3¬±9.8
59.7¬±4.8
15.8¬±5.3
22.3¬±15.0
64.5¬±2.1
S ‚ÜíA
41.3¬±6.5
40.9¬±3.9
39.2¬±3.5
40.0¬±3.3
39.1¬±4.8
36.1¬±9.5
48.2¬±2.4
S ‚ÜíC
66.7¬±1.0
67.9¬±1.4
64.3¬±2.0
65.7¬±2.3
59.9¬±1.5
60.5¬±2.0
63.5¬±0.4
S ‚ÜíP
49.3¬±3.3
46.0¬±4.7
44.3¬±4.0
45.1¬±0.9
37.4¬±2.7
38.5¬±5.6
39.1¬±3.4"
Z,0.8623376623376623,"Average
60.6
60.2
62.6
66.3
56.3
57.4
69.1"
Z,0.8649350649350649,Table 4: OfÔ¨Åce-31 experiments
Z,0.8675324675324675,"Model
A‚ÜíD
A‚ÜíW
D‚ÜíA
D‚ÜíW
W‚ÜíA
W‚ÜíD
Average"
Z,0.8701298701298701,"DANN
79.7¬±0.4
82.0¬±0.4
68.2¬±0.4
96.9¬±0.2
67.4¬±0.5
99.1¬±0.1
82.2
MMD
75.5¬±0.6
73.4¬±0.4
60.8¬±1.0
97.4¬±0.5
61.5¬±1.1
99.5¬±0.2
78.0
KL
85.6¬±0.6
87.9¬±0.4
70.1¬±1.1
99.0¬±0.2
69.3¬±0.7
100.0¬±0.0
85.3"
Z,0.8727272727272727,Table 5: Ablation study: Effect of batch size. Rotated MNIST experiments with M0 source and M45 target.
Z,0.8753246753246753,"Batch size
256
128
64
32"
Z,0.8779220779220779,"KL (ours)
93.4¬±0.8
93.4¬±1.2
93.3¬±0.3
89.5¬±0.9"
Z,0.8805194805194805,Table 6: Ablation study: Effect of auxiliary term. RotatedMNIST.
Z,0.8831168831168831,"Model
M15
M30
M45
M60
M75
Average"
Z,0.8857142857142857,"KL (Œ≤aux = 0)
97.8¬±0.5
96.6¬±0.4
92.0¬±0.4
68.8¬±4.6
62.3¬±4.2
83.5
KL (reported in the paper)
97.8¬±0.1
97.1¬±0.2
93.4¬±0.8
75.5¬±2.4
68.1¬±1.8
86.4"
Z,0.8883116883116883,Table 7: Ablation study: Effect of auxiliary term. DIGITS and VisDA17.
Z,0.8909090909090909,"DIGITS
VisDA17"
Z,0.8935064935064935,"Model
M ‚ÜíU
U ‚ÜíM
S ‚ÜíM
Average
S ‚ÜíR"
Z,0.8961038961038961,"KL (Œ≤aux = 0)
98.2¬±0.2
97.1¬±0.4
90.0¬±1.1
95.1
67.8
KL (reported in the paper)
98.2¬±0.2
97.3¬±0.52
92.5¬±0.9
96.0
70.5"
Z,0.8987012987012987,"C.5
ABLATION STUDY: EFFECT OF THE AUXILIARY FORWARD KL"
Z,0.9012987012987013,"In this subsection, we investigate the contribution of the auxiliary forward KL term, by considering
a variant of our method without this term (Œ≤aux = 0). Table 6 and Table 7 show the results for this
ablation experiment. Clearly, most of the improvement comes from the reverse KL regularizer term.
And even without the auxiliary forward KL term, our results are still signiÔ¨Åcantly higher than the
baselines. Note that the auxiliary term requires virtually no extra computation, so we believe adding
the auxiliary term is reasonable."
Z,0.9038961038961039,"D
DETAILED EXPERIMENTAL SETTINGS"
Z,0.9064935064935065,"In each experiment, we split both the source and the target data into two portions: 80% and 20%.
We use 80% of the source domain data and 80% of the target domain data (without the labels) as the
training data. We use the remaining 20% of the source data as the validation set, and the remaining
20% of the target domain data as the test set. Note that we do not use the labeled data from the
target domain during training or validation. This evaluation protocol is recommended by Gulrajani
and Lopez-Paz (2020)."
Z,0.9090909090909091,Published as a conference paper at ICLR 2022
Z,0.9116883116883117,"D.1
BASELINES"
Z,0.9142857142857143,"ERM Bousquet et al. (2003) is the typical empirical risk minimization training procedure, meaning
that the model is trained normally in the training data and does not account for the distribution shift
(domain adaptation)."
Z,0.9168831168831169,"ERM (prob): since we use a probabilistic network, we also include the probabilistic version of
ERM. This is similar to ERM but uses a probabilistic representation network (same as ours)."
Z,0.9194805194805195,"DANN Ganin et al. (2016) utilizes a discriminator to distinguish the representation from the source
and target domains. It uses an adversarial loss to enforce that the distributions of the representation
from the source domain and the target domain are the same."
Z,0.922077922077922,"MMD Li et al. (2018) uses the maximum mean discrepancy (MMD) to align the representation‚Äôs
distributions."
Z,0.9246753246753247,"CORAL Sun and Saenko (2016) aligns the representation distributions of the source and target
domains by matching their Ô¨Årst two moments."
Z,0.9272727272727272,WD Shen et al. (2018) uses the Wasserstein distance to match the distribution of the representation.
Z,0.9298701298701298,"D.2
REPRESENTATION NETWORK USED IN ROTATEDMNIST AND DIGITS"
Z,0.9324675324675324,"We use a simple CNN as the representation network in this experiment. This network is exactly the
same as the one used in Gulrajani and Lopez-Paz (2020)."
Z,0.935064935064935,"Our code is in PyTorch.
The network is constructed by the following layers, where
output dim=256 for a deterministic representation network and output dim=512 for a prob-
abilistic representation network (256 for ¬µ and 256 for œÉ2):"
Z,0.9376623376623376,"- Conv2d(in channels=1,out channels=64,kernel size=3,stride=1,padding=1)
- ReLU()
- GroupNorm(num groups=8,num channels=64)
- Conv2d(in channels=64,out channels=128,kernel size=3,stride=2,padding=1)
- ReLU()
- GroupNorm(num groups=8,num channels=128)
- Conv2d(in channels=128,out channels=128,kernel size=3,stride=1,padding=1)
- ReLU()
- GroupNorm(num groups=8,num channels=128)
- Conv2d(in channels=128,out channels=output dim,kernel size=3,stride=1,padding=1)
- ReLU()
- GroupNorm(num groups=8,num channels=output dim)
- AdaptiveAvgPool2d(output size=(1,1))"
Z,0.9402597402597402,"D.3
HYPER-PARAMETERS TUNING"
Z,0.9428571428571428,"We train each model for 100 epochs. To avoid hyperparameter bias, we tune the hyperparameters
(learning rate, regularizer coefÔ¨Åcients, weight decay, representation dimension and dropout rate) for
each method and dataset independently. Following Gulrajani and Lopez-Paz (2020), we perform a
random search (Bergstra and Bengio, 2012) to tune hyperparameters for the baselines. We use the
Adam optimizer Kingma and Ba (2014) for all the models. We re-run each set of hyperparameters
three times. We train all models on an NVIDIA Quadro RTX 6000 GPU."
Z,0.9454545454545454,The readers can also refer to our source code for the experiment setting.
Z,0.948051948051948,"Below are the hyper-parameters considered by the random search in our experiments for each base-
line. {.} means a set of hyper-parameters considered, while [., .] means a range of hyper-parameters
considered."
Z,0.9506493506493506,"D.3.1
ROTATEDMNIST AND DIGITS"
Z,0.9532467532467532,"The representation‚Äôs dimension is 128 (details in Section D.2). For even more details about the
below hyper-parameters, please refer to our provided code."
Z,0.9558441558441558,Published as a conference paper at ICLR 2022
Z,0.9584415584415584,"- ERM: learning rate: [10‚àí4.5, 10‚àí2.5], weight decay: 0.0, dropout rate: 0.0, batch size: [8, 512],
number of layers of the classiÔ¨Åer (ÀÜp(y|z)): 1 or 3."
Z,0.961038961038961,"- ERM (prob): learning rate: [10‚àí4.5, 10‚àí2.5], weight decay: 0.0, dropout rate: 0.0, batch size:
[8, 512], number of layers of the classiÔ¨Åer (ÀÜp(y|z)): 1 or 3."
Z,0.9636363636363636,"- DANN Ganin et al. (2016): learning rate: [10‚àí4.5, 10‚àí2.5], weight decay: 0.0, dropout rate: 0.0,
batch size: [8, 512], number of layers of the classiÔ¨Åer (ÀÜp(y|z)): 1 or 3, adversarial loss coefÔ¨Åcient:
[10‚àí2, 102], weight decay of discriminator: [10‚àí6, 10‚àí2], number of discriminator steps per gener-
ator steps: {1, 2, 4, 8}, grad penalty coefÔ¨Åcient: [10‚àí2, 101]"
Z,0.9662337662337662,"- MMD Li et al. (2018): learning rate: [10‚àí4.5, 10‚àí2.5], weight decay: 0.0, dropout rate: 0.0, batch
size: [8, 512], number of layers of the classiÔ¨Åer (ÀÜp(y|z)): 1 or 3, MMD coefÔ¨Åcient: [10‚àí3, 10‚àí1]"
Z,0.9688311688311688,"- CORAL Sun and Saenko (2016): learning rate: [10‚àí4.5, 10‚àí2.5], weight decay: 0.0, dropout rate:
0.0, batch size: [8, 512], number of layers of the classiÔ¨Åer (ÀÜp(y|z)): 1 or 3, CORAL loss coefÔ¨Åcient:
[10‚àí3, 10‚àí1]"
Z,0.9714285714285714,"- WD Shen et al. (2018): learning rate: [10‚àí4.5, 10‚àí2.5], weight decay: 0.0, dropout rate: 0.0, batch
size: [8, 512], number of layers of the classiÔ¨Åer (ÀÜp(y|z)): 1 or 3, wasserstein distance coefÔ¨Åcient:
[10‚àí2, 102], weight decay of network f: [10‚àí6, 10‚àí2], number of f optimization steps per normal
optimization steps: {1, 2, 4, 8}, grad penalty coefÔ¨Åcient: [10‚àí2, 101]"
Z,0.974025974025974,"- KL (ours): learning rate: [10‚àí4.5, 10‚àí2.5], weight decay: 0.0, dropout rate: 0.0, batch size: 256,
number of layers of the classiÔ¨Åer (ÀÜp(y|z)): 1, Œ≤ : 0.3, Œ≤aux : 0.1"
Z,0.9766233766233766,"D.3.2
VISDA17 AND PACS"
Z,0.9792207792207792,"The representation network for VisDA17 is a Resnet50, while the one for PACS is a Resnet18. For
even more details about the below hyper-parameters, please refer to our provided code."
Z,0.9818181818181818,"- ERM: learning rate: [10‚àí5, 10‚àí3.5], weight decay: [10‚àí6, 10‚àí2], dropout rate: {0.0, 0.1, 0.5},
batch size: [8, 45], representation dimension: {16, 128, 256, 512}, number of layers of the classiÔ¨Åer
(ÀÜp(y|z)): 1 or 3."
Z,0.9844155844155844,"- ERM (prob):
learning rate:
[10‚àí5, 10‚àí3.5], weight decay:
[10‚àí6, 10‚àí2], dropout rate:
{0.0, 0.1, 0.5}, batch size: [8, 45], representation dimension: {16, 128, 256, 512}, number of lay-
ers of the classiÔ¨Åer (ÀÜp(y|z)): 1 or 3."
Z,0.987012987012987,"- DANN Ganin et al. (2016): learning rate: [10‚àí5, 10‚àí3.5], weight decay: [10‚àí6, 10‚àí2], dropout
rate: {0.0, 0.1, 0.5}, batch size: [8, 45], representation dimension: {16, 128, 256, 512}, number of
layers of the classiÔ¨Åer (ÀÜp(y|z)): 1 or 3, adversarial loss coefÔ¨Åcient: [10‚àí2, 102], weight decay of
discriminator: [10‚àí6, 10‚àí2], number of discriminator steps per generator steps: {1, 2, 4, 8}, grad
penalty coefÔ¨Åcient: [10‚àí2, 101]"
Z,0.9896103896103896,"- MMD Li et al. (2018): learning rate: [10‚àí5, 10‚àí3.5], weight decay: [10‚àí6, 10‚àí2], dropout rate:
{0.0, 0.1, 0.5}, batch size: [8, 45], representation dimension: {16, 128, 256, 512}, number of layers
of the classiÔ¨Åer (ÀÜp(y|z)): 1 or 3, MMD coefÔ¨Åcient: [10‚àí3, 10‚àí1]"
Z,0.9922077922077922,"- CORAL Sun and Saenko (2016): learning rate: [10‚àí5, 10‚àí3.5], weight decay: [10‚àí6, 10‚àí2],
dropout rate: {0.0, 0.1, 0.5}, batch size: [8, 45], representation dimension: {16, 128, 256, 512},
number of layers of the classiÔ¨Åer (ÀÜp(y|z)): 1 or 3, CORAL loss coefÔ¨Åcient: [10‚àí3, 10‚àí1]"
Z,0.9948051948051948,"- WD Shen et al. (2018): learning rate: [10‚àí5, 10‚àí3.5], weight decay: [10‚àí6, 10‚àí2], dropout rate:
{0.0, 0.1, 0.5}, batch size: [8, 45], representation dimension: {16, 128, 256, 512}, number of layers
of the classiÔ¨Åer (ÀÜp(y|z)): 1 or 3, wasserstein distance coefÔ¨Åcient: [10‚àí2, 102], weight decay of
network f: [10‚àí6, 10‚àí2], number of f optimization steps per normal optimization steps: {1, 2, 4, 8},
grad penalty coefÔ¨Åcient: [10‚àí2, 101]"
Z,0.9974025974025974,"- KL (ours): learning rate: 10‚àí4, weight decay: [10‚àí6, 10‚àí2], dropout rate: 0.0, batch size: 256,
representation dimension: 16, number of layers of the classiÔ¨Åer (ÀÜp(y|z)): 1, Œ≤ : {0.1, 0.05, 0.001},
Œ≤aux : {0.1, 0.05, 0.01, 0.0}"
