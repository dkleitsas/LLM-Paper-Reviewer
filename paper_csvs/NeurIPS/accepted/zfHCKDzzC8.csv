Section,Section Appearance Order,Paragraph
ABSTRACT,0.0,Abstract
ABSTRACT,0.0015037593984962407,"Deciding on an appropriate intervention requires a causal model of a treatment, the
outcome, and potential mediators. Causal mediation analysis lets us distinguish be-
tween direct and indirect effects of the intervention, but has mostly been studied in a
static setting. In healthcare, data come in the form of complex, irregularly sampled
time-series, with dynamic interdependencies between a treatment, outcomes, and
mediators across time. Existing approaches to dynamic causal mediation analysis
are limited to regular measurement intervals, simple parametric models, and disre-
gard long-range mediator–outcome interactions. To address these limitations, we
propose a non-parametric mediator–outcome model where the mediator is assumed
to be a temporal point process that interacts with the outcome process. With this
model, we estimate the direct and indirect effects of an external intervention on
the outcome, showing how each of these affects the whole future trajectory. We
demonstrate on semi-synthetic data that our method can accurately estimate direct
and indirect effects. On real-world healthcare data, our model infers clinically
meaningful direct and indirect effect trajectories for blood glucose after a surgery."
INTRODUCTION,0.0030075187969924814,"1
Introduction"
INTRODUCTION,0.004511278195488722,"In healthcare, a key challenge is to design interventions that effectively control a target outcome
[Vamathevan et al., 2019, Ghassemi et al., 2020]. To design an efficient intervention, decision-makers
need not only to estimate the total effect of the intervention, but also understand the underlying causal
mechanisms driving this effect. To this end, causal mediation analysis decomposes the total effect into:
(i) an indirect effect flowing through an intermediate variable (mediator), and (ii) a direct effect repre-
senting the rest of the effect. The statistical question is then to estimate the direct and indirect effects."
INTRODUCTION,0.006015037593984963,"As a running example, we consider the effect of bariatric surgery (treatment) on meal–blood glucose
(mediator–outcome) dynamics. In Fig. 1, we show how blood glucose changes after the surgery. This
change is partly mediated by the changes in diet before and after the surgery (alterations in meal size
and frequency). However, the surgery can also directly impact blood glucose levels (via metabolic
processes, regardless of meal size). To efficiently control glucose, we need to estimate to what extent
the effect of surgery is due to the post-surgery diet (indirect) or other metabolic processes (direct)."
INTRODUCTION,0.007518796992481203,"Causal mediation has been studied extensively in a static setting with three variables: a treatment A,
a mediator M, and an outcome Y [Robins and Greenland, 1992, Pearl, 2001, Robins, 2003, Vander-
Weele, 2009, Imai et al., 2010a,b, Tchetgen and Shpitser, 2012]. However, as the running example"
INTRODUCTION,0.009022556390977444,∗Correspondence: caglar.hizli@aalto.fi
INTRODUCTION,0.010526315789473684,"0.0
6.0
12.0
18.0
24.0
T
T+6.0
T+12.0
T+18.0
T+24.0
Time, τ 4.0 5.0 6.0 7.0 8.0"
INTRODUCTION,0.012030075187969926,"Glucose (mmol/l), y"
INTRODUCTION,0.013533834586466165,"|
{z
}"
INTRODUCTION,0.015037593984962405,Pre-surgery
INTRODUCTION,0.016541353383458645,"|
{z
}"
INTRODUCTION,0.01804511278195489,"Post-surgery
Intervention"
INTRODUCTION,0.019548872180451128,"Glucose, y
Meals, m
f
fb"
INTRODUCTION,0.021052631578947368,"10.0
30.0
50.0"
INTRODUCTION,0.022556390977443608,"Carb. intake (g), m"
INTRODUCTION,0.02406015037593985,"Figure 1: Comparison of the meal–blood glucose dynamics of one patient for the pre- and post-surgery
periods: meals (carbohydrate intake, cyan bars), glucose (black crosses), predicted glucose baseline
fb (red dashed line) and predicted glucose progression f (blue dashed line). For blood glucose, we
see, after the surgery, (i) the baseline fb declines (red dashed line, pre-surgery →post-surgery), and
(ii) the glucose response of a meal has a steeper rise and a steeper decline (blue peaks, pre-surgery →
post-surgery). For meals, we see, after the surgery, the patient eats (i) more frequently and (ii) less
carbohydrates (cyan bars, pre-surgery →post-surgery). A relevant research question is: how much of
the surgery effect is due to the post-surgery diet (indirect) or other biological processes (direct)?"
INTRODUCTION,0.02556390977443609,"illustrates, many real-world healthcare problems are dynamic, i.e., the variables evolve over time and
are measured at multiple time points, e.g., a patient’s state observed through electronic health records
(EHR) [Saeed et al., 2011, Soleimani et al., 2017, Schulam and Saria, 2017], tumour growth under
chemotherapy and radiotherapy [Geng et al., 2017, Bica et al., 2020, Seedat et al., 2022], and continu-
ous monitoring of blood glucose under meal and insulin events [Berry et al., 2020, Wyatt et al., 2021,
Hızlı et al., 2023]. Hence, instead of observing a single mediator and a single outcome after an inter-
vention, in many situations the intervention is followed by (i) sequences of mediators and outcomes
that vary over time. To complicate the matters further, these sequences may be complex, e.g., (ii)
sparse and irregularly-sampled, as in EHR, or (iii) with long-range mediator–outcome dependencies."
INTRODUCTION,0.02706766917293233,"Some existing works have addressed dynamic causal mediation for (i) a sequence of mediators and
outcomes [VanderWeele and Tchetgen Tchetgen, 2017, Lin et al., 2017, Zheng and van der Laan,
2017, Vansteelandt et al., 2019, Aalen et al., 2020]; however, they are limited to measurements at
regular time intervals. Furthermore, they are based on the parametric g-formula [Robins, 1986] and
marginal structural models [Robins et al., 2000a], which can handle time-varying confounding but rely
on simple linear models. A recent work by Zeng et al. [2021] (Fig. 2a) studied causal mediation for
(ii) sparse and irregular longitudinal data, but considered neither (iii) long-range mediator–outcome
dependencies nor the interaction between past outcomes and future mediators (
, Fig. 2c)."
INTRODUCTION,0.02857142857142857,"We address these limitations in dynamic causal mediation by introducing a method where both the
mediator as well as the outcome are stochastic processes (as opposed to single variables in the static
case). In this setup, we provide the estimated direct and indirect effects as longitudinal counterfactual
trajectories, and theoretically, we present causal assumptions required to identify them. We model
the mediator sequence as a marked point process (MPP), and the outcome sequence as a continuous-
valued stochastic process, building on a non-parametric model [Hızlı et al., 2023]. This allows for
irregularly-sampled measurements of mediator and outcome processes, while capturing non-linear,
long-range interactions between them. Recently, a different line of research investigated causal
inference for MPPs [Gao et al., 2021, Zhang et al., 2022, Noorbakhsh and Rodriguez, 2022], but
they have not considered a causal mediation setting. Compared to the existing literature [Hızlı et al.,
2023], our model enables the estimation of the direct and indirect effects separately by incorporating
an external intervention that jointly affects both mediator and outcome processes (Fig. 2b vs. Fig. 2c)."
INTRODUCTION,0.03007518796992481,Our contributions are as follows:
INTRODUCTION,0.031578947368421054,"• Dynamic causal mediation with a point process mediator. We generalize the dynamic
causal mediation problem by modeling the mediator as a point process, which can have a ran- Time"
INTRODUCTION,0.03308270676691729,Mediator
INTRODUCTION,0.03458646616541353,Outcome
INTRODUCTION,0.03609022556390978,Intervention
INTRODUCTION,0.03759398496240601,"(a) Direct and indirect effects with
non-interacting longitudinal medi-
ators [Zeng et al., 2021]. Time"
INTRODUCTION,0.039097744360902256,Mediator
INTRODUCTION,0.0406015037593985,Outcome
INTRODUCTION,0.042105263157894736,Intervention
INTRODUCTION,0.04360902255639098,"(b) Fully-mediated policy effect
with interacting point process me-
diators [Hızlı et al., 2023]. Time"
INTRODUCTION,0.045112781954887216,Mediator
INTRODUCTION,0.04661654135338346,Outcome
INTRODUCTION,0.0481203007518797,Intervention
INTRODUCTION,0.04962406015037594,"(c) Direct and indirect effects with
interacting point process media-
tors (Our work)."
INTRODUCTION,0.05112781954887218,"Figure 2: Comparison of available implementations for dynamic causal mediation. (a) Zeng et al.
[2021] studied dynamic causal mediation for a sparse and irregularly-sampled mediator–outcome
sequence; their counterfactual formulation allows for only uni-directional effects from mediator to
outcome (
), while their implementation assumes the effects are instantaneous. (b) Hızlı et al.
[2023] considered the long-range interaction between mediator and outcome processes (
+
),
but did not allow the intervention to directly affect the outcome. (c) While capturing long-range
dependencies, our work allows for an intervention that affects both processes jointly (
)."
INTRODUCTION,0.05263157894736842,"dom number of occurrences at random times and complex interactions with the outcome. Fur-
thermore, we provide causal assumptions required to identify the direct and indirect effects.
• A mediator–outcome model with an external intervention. We extend a previous
non-parametric model for mediators and outcomes [Hızlı et al., 2023] to include an external
intervention that affects the joint dynamics of these two processes.
• In a real-world experiment, we study in a data-driven manner the effect of bariatric surgery
for treatment of obesity on blood glucose dynamics, and separately estimate the direct
effect from the indirect effect whereby surgery affects blood glucose through changed diet."
DYNAMIC CAUSAL MEDIATION,0.05413533834586466,"2
Dynamic Causal Mediation"
DYNAMIC CAUSAL MEDIATION,0.055639097744360905,"In this section, we formulate the dynamic causal mediation problem for a treatment process A, a
mediator process M and an outcome process Y , and contrast this with the static causal mediation
definition for single variables A, M and Y . Our formulation builds on structural causal models [SCM,
Pearl, 2009] and an interventionist approach to causal mediation [Robins et al., 2022]. A M Y"
DYNAMIC CAUSAL MEDIATION,0.05714285714285714,(a) Classical. A A→Y A→M M Y
DYNAMIC CAUSAL MEDIATION,0.058646616541353384,(b) Interventionist.
DYNAMIC CAUSAL MEDIATION,0.06015037593984962,"Figure 3:
Graphical models for
causal mediation. Mediation is de-
fined in (a) using nested counter-
factuals, while in (b) using path-
specific treatments A→M and A→Y ."
DYNAMIC CAUSAL MEDIATION,0.061654135338345864,"Structural Causal Model. An SCM M = (S, p(U)) of a set
of variables X = {Xk}K
k=1 is defined as a pair of (i) struc-
tural equations S = {Xk := fk(pa(Xk), Uk)}K
k=1 and (ii) a
noise distribution U = {Uk}K
k=1 ∼p(U) [Pearl, 2009, Peters
et al., 2017]. The SCM entails an observational distribution
X ∼p(X). To see this, consider sampling noise U ∼p(U)
and then performing a forward pass through the structural equa-
tions S. In the SCM, an intervention do(Xk = ˜xk) is defined
as an operation that removes the structural equation fk(·, ·)
corresponding to Xk and sets Xk to the value ˜xk, yielding an
interventional distribution p(X | do(Xk = ˜xk))."
DYNAMIC CAUSAL MEDIATION,0.06315789473684211,"Interventionist Approach to Causal Mediation.
Consider
an SCM of a treatment A, a mediator M and an outcome Y
(Fig. 3a). For brevity, we focus on the indirect path, but the
same reasoning applies for the direct path. To estimate the
indirect effect, we want to intervene only on the indirect path (A→M→Y ), while keeping the direct
path (A→Y ) at its natural value. To achieve this, we follow an interventionist approach [Robins
et al., 2022]. We hypothetically duplicate the treatment A into an indirect-path treatment A→M and a
direct-path treatment A→Y , so that each of these affects only its target path (Fig. 3b). For instance,
in the surgery–diet–glucose example (treatment–mediator–outcome), the indirect-path treatment"
DYNAMIC CAUSAL MEDIATION,0.06466165413533835,"A→M corresponds to changing only the diet, without changing how the surgery affects blood glucose
through other metabolic processes. Using path-specific interventions, we follow Pearl [2001] and
define the natural indirect effect (NIE) as"
DYNAMIC CAUSAL MEDIATION,0.06616541353383458,"NIE(˜a) ≡Y [A→Y = ∅, A→M = ˜a] −Y [A→Y = ∅, A→M = ∅] ≡Y [∅, ˜a] −Y [∅, ∅],
(1)"
DYNAMIC CAUSAL MEDIATION,0.06766917293233082,"where we use the short-hand notation for an intervention [˜a1, ˜a2] ≡do(A→Y = ˜a1, A→M = ˜a2),
and Y [˜a1, ˜a2] is the potential outcome after setting the direct-path treatment (first argument) to ˜a1 and
the indirect-path treatment to ˜a2. The value ∅means that the corresponding pathwise treatment is set
to its natural value, i.e., the value the variable would have attained without our doing any intervention.
Hence, the indirect effect is intuitively defined in Eq. (1) as the difference of the outcome Y when the
direct-path treatment is fixed to ∅while the indirect-path treatment is either ˜a or ∅."
DYNAMIC CAUSAL MEDIATION,0.06917293233082707,"The natural direct effect (NDE) is similarly defined as [Pearl, 2001, Robins et al., 2022]"
DYNAMIC CAUSAL MEDIATION,0.07067669172932331,"NDE(˜a) ≡Y [A→Y = ˜a, A→M = ˜a] −Y [A→Y = ∅, A→M = ˜a] ≡Y [˜a, ˜a] −Y [∅, ˜a],
(2)"
DYNAMIC CAUSAL MEDIATION,0.07218045112781955,"However, these definitions are limited to the static case with single variables A, M and Y . Hence, they
are not applicable as such to complex, real-world dynamics of healthcare data sets, where a treatment
is typically followed by sequences of irregularly-sampled mediator and outcome measurements."
DIRECT AND INDIRECT EFFECTS AS STOCHASTIC PROCESSES,0.07368421052631578,"2.1
Direct and Indirect Effects as Stochastic Processes"
DIRECT AND INDIRECT EFFECTS AS STOCHASTIC PROCESSES,0.07518796992481203,"We extend the static definitions of natural direct and indirect effects by formulating them as stochastic
processes. In the following, we assume a single patient is observed over a period [0, T]. The
formulation trivially generalizes to multiple patients, assuming exchangeability."
DIRECT AND INDIRECT EFFECTS AS STOCHASTIC PROCESSES,0.07669172932330827,"For each patient, we define a mediator process M and an outcome process Y . We assume the
treatment A represents a single intervention occurring once at time ta ∈[0, T], e.g., a surgery. For
completeness, we define also the treatment as a stochastic process A corresponding to a binary
counting process NA : [0, T] →{0, 1} that specifies the pre- and post-intervention periods. The
treatment is applied to control an outcome of interest over time, e.g. continuously-monitored blood
glucose, which is defined as the outcome process Y : [0, T] →R. We assume the treatment affects
the outcome process Y via two separate causal paths, where the indirect path (
, Fig. 2c) that goes
through mediators occurring at non-deterministic times, e.g., meals, is of special interest. Hence, we
define this causal path explicitly through the mediator process M : [0, T] →N×{R∪{∅}}, such that
M(τ) = (k, m), where k is the number of occurrences of the mediating event up until time τ and m
is the value of the mediator at time τ. Occurrences k follow a counting process NM : [0, T] →N and
values m follow a dosage process DM : [0, T] →{R ∪{∅}}, such that these two processes contain
all the information about the mediator process on the period [0, T]. At occurrence times, the mediator
gets a value m ∈R and at other times m = ∅. The rest of the possible causal paths are not modeled
explicitly but instead their effect is jointly represented as the direct path A →Y (
, Fig. 2c)."
DIRECT AND INDIRECT EFFECTS AS STOCHASTIC PROCESSES,0.07819548872180451,"We define direct and indirect treatment effects formally analogously to the static case, and assume that
the treatment process A(τ) is hypothetically duplicated into the direct-path treatment A→Y (τ) and
the indirect-path treatment A→M(τ) [Robins and Richardson, 2010, Didelez, 2019]. The indirect-
path treatment A→M(τ) affects the outcome only through the mediator process M. Similarly, the
direct-path treatment A→Y (τ) affects the outcome through processes other than the mediator."
DIRECT AND INDIRECT EFFECTS AS STOCHASTIC PROCESSES,0.07969924812030076,"In practice, we assume that we observe the mediator process M at I time points: {(ti, mi)}I
i=1,
where ti is the occurrence time of the ith mediator event and mi the corresponding value. Similarly,
we observe the outcome process Y as {(tj, yj)}J
j=1. We observe A(τ) as the occurrence of a single
treatment event at time ta ∈[0, T]. In the ‘factual’ world, treatments A, A→Y and A→M occur at
the same time, i.e., their respective counting processes coincide:"
DIRECT AND INDIRECT EFFECTS AS STOCHASTIC PROCESSES,0.081203007518797,"NA(τ) = NA→Y (τ) = NA→M (τ) = 1{τ ≥ta}.
(3)"
DIRECT AND INDIRECT EFFECTS AS STOCHASTIC PROCESSES,0.08270676691729323,"For instance, in the surgery–diet–blood glucose (treatment–mediator–outcome) example, the surgery
starts to affect both the diet and the other metabolic processes immediately after it has occurred at
time ta. To measure how the surgery affects the blood glucose (indirectly) through diet or (directly)
through other metabolic processes, we consider a hypothetical intervention that changes either the
diet or the other metabolic processes, but not both at the same time. Formally, we devise these
hypothetical interventions that activate only the direct or the indirect causal path by setting treatment
times tA→Y and tA→M to distinct values."
DIRECT AND INDIRECT EFFECTS AS STOCHASTIC PROCESSES,0.08421052631578947,"Using these hypothetical interventions, we formulate two causal queries to understand how the
treatment affects the outcome process via direct and indirect casual mechanisms. The natural indirect
effect (NIE) is defined as"
DIRECT AND INDIRECT EFFECTS AS STOCHASTIC PROCESSES,0.08571428571428572,"NIE(˜ta) ≡Y>˜ta[A→Y = ∅, A→M = ˜ta] −Y>˜ta[A→Y = ∅, A→M = ∅]"
DIRECT AND INDIRECT EFFECTS AS STOCHASTIC PROCESSES,0.08721804511278196,"≡Y>˜ta[∅, ˜ta] −Y>˜ta[∅, ∅].
(4)"
DIRECT AND INDIRECT EFFECTS AS STOCHASTIC PROCESSES,0.0887218045112782,"A close comparison with the static case in Eq. (1) reveals that the outcome is here defined as a
stochastic process Y>˜ta which describes its entire future trajectory; i.e., a sample from this process
corresponds to an entire sequence of values representing the continuation of the outcome after the
intervention at time ˜ta. For example, Eq. (4) can quantify the contribution of the change of diet at
time ˜ta on the blood glucose progression, while other metabolic processes are fixed at their natural
state, ∅, before the surgery. Similarly, we estimate the natural direct effect (NDE) using"
DIRECT AND INDIRECT EFFECTS AS STOCHASTIC PROCESSES,0.09022556390977443,"NDE(˜ta) ≡Y>˜ta[A→Y = ˜ta, A→M = ˜ta] −Y>˜ta[A→Y = ∅, A→M = ˜ta]"
DIRECT AND INDIRECT EFFECTS AS STOCHASTIC PROCESSES,0.09172932330827067,"≡Y>˜ta[˜ta, ˜ta] −Y>˜ta[∅, ˜ta],
(5)"
DIRECT AND INDIRECT EFFECTS AS STOCHASTIC PROCESSES,0.09323308270676692,"which quantifies the contribution of the changes in other metabolic processes on the blood glucose
progression, while the diet is fixed at its natural state after the surgery. The total effect of the
intervention [ta = ˜ta] is equal to the sum of the NDE and the NIE:"
DIRECT AND INDIRECT EFFECTS AS STOCHASTIC PROCESSES,0.09473684210526316,"TE(˜ta) = NDE(˜ta) + NIE(˜ta) = Y>˜ta[˜ta, ˜ta] −Y>˜ta[∅, ∅].
(6)"
CAUSAL ASSUMPTIONS AND IDENTIFIABILITY,0.0962406015037594,"3
Causal Assumptions and Identifiability"
CAUSAL ASSUMPTIONS AND IDENTIFIABILITY,0.09774436090225563,"In this section, we first develop a mathematical formulation of the causal assumptions required to
identify direct and indirect effect trajectories NDE(˜ta) and NIE(˜ta). Under these assumptions, we
next represent the causal queries in the form of statistical terms, which we can estimate using a
mediator–outcome model. The proofs and further details are presented in Appendix A."
CAUSAL ASSUMPTIONS AND IDENTIFIABILITY,0.09924812030075188,"To identify the direct, indirect and total effects, we make the following Assumptions (A1, A2, A3):"
CAUSAL ASSUMPTIONS AND IDENTIFIABILITY,0.10075187969924812,"(A1):
p(· | do(A = ˜
NA)) ≡p(· | A = ˜
NA),
(A2):
A→Y ⊥⊥M(τ) | A→M, H<τ,
τ ∈[0, T],
(A3):
A→M ⊥⊥Y (τ) | A→Y , H<τ,
τ ∈[0, T],"
CAUSAL ASSUMPTIONS AND IDENTIFIABILITY,0.10225563909774436,"where H<τ is the history up to time τ, including both mediators and outcomes. (A1) is a continuous-
time version of the No-Unobserved-Confounders assumption for process pairs (A, M) and (A, Y )
[continuous-time NUC, Schulam and Saria, 2017]. (A2, A3) ensure that path-specific treatments
A→M and A→Y causally affect only their target path, conditioned on the past. Accordingly, they
imply no unobserved confounding between mediator and outcome processes (M, Y ). (A1, A2,
A3) might not hold in observational studies and they are not statistically testable. We discuss their
applicability in the running example in Section 5.1."
CAUSAL ASSUMPTIONS AND IDENTIFIABILITY,0.1037593984962406,"For the total effect, we need to estimate the trajectories Y>˜ta[˜ta, ˜ta] and Y>˜ta[∅, ∅], which are
identifiable under (A1). For direct and indirect effects, we further need to estimate the counterfactual
trajectory Y>˜ta[∅, ˜ta], i.e., the outcome process under a hypothetical intervention, which is identi-
fiable under (A1, A2, A3). We consider a counterfactual trajectory Y>˜ta under a paired intervention,
e.g. [∅, ˜ta], at R ordered query points q = {qr}R
r=1, qr > ˜ta: Yq[∅, ˜ta] = {Y (qr)[∅, ˜ta]}R
r=1.
Provided that (A1, A2, A3) hold, the interventional distribution of the counterfactual trajectory
Yq[∅, ˜ta] is given by"
CAUSAL ASSUMPTIONS AND IDENTIFIABILITY,0.10526315789473684,"P(Yq[∅, ˜ta]) =
X M>˜ta R−1
Y"
CAUSAL ASSUMPTIONS AND IDENTIFIABILITY,0.10676691729323308,"r=0
P(Yqr+1|M[qr,qr+1), ta = ∅, H≤qr)
|
{z
}
outcome term"
CAUSAL ASSUMPTIONS AND IDENTIFIABILITY,0.10827067669172932,"P(M[qr,qr+1)|ta = ˜ta, H≤qr)
|
{z
}
mediator term , (7)"
CAUSAL ASSUMPTIONS AND IDENTIFIABILITY,0.10977443609022557,"where M>˜ta = ∪R−1
r=0 M[qr,qr+1). The two terms in Eq. (7) can be estimated by an interacting
mediator–outcome model, discussed in Section 4. In addition, the definitions of the NIE(˜ta) and
the NDE(˜ta) in Eqs. (4) and (5) under a single treatment at time ˜ta can be extended to direct and
indirect effects under a sequence of healthcare interventions, if necessary. We further illustrate this
extension in Appendix A.3 and provide an identifiability analysis in such multiple treatment setups."
CAUSAL ASSUMPTIONS AND IDENTIFIABILITY,0.11127819548872181,"4
Interacting Mediator–Outcome Model"
CAUSAL ASSUMPTIONS AND IDENTIFIABILITY,0.11278195488721804,"To model the interacting mediator–outcome processes, we extend a non-parametric model for me-
diators and outcomes [Hızlı et al., 2023] to include an external intervention A that affects the joint
dynamics of these two processes. Similary, we combine a marked point process [MPP, Daley and
Vere-Jones, 2003] and a conditional Gaussian process [GP, Williams and Rasmussen, 2006]. For
background on MPP, GP, and details on model definitions, inference and scalability, see Appendix B."
CAUSAL ASSUMPTIONS AND IDENTIFIABILITY,0.11428571428571428,"Each patient is observed in two regimes: D = {D(a)}a∈{0,1}. Within each regime a ∈{0, 1},
the data set D(a) contains the measurements of mediator M and outcome Y at irregular times:
{(t(a)
i
, m(a)
i
)}I(a)
i=1 and {(t(a)
j , y(a)
j
)}J(a)
j=1 . For the full data set D, the joint distribution is"
CAUSAL ASSUMPTIONS AND IDENTIFIABILITY,0.11578947368421053,"p(D) =
Y"
CAUSAL ASSUMPTIONS AND IDENTIFIABILITY,0.11729323308270677,"a∈{0,1}"
CAUSAL ASSUMPTIONS AND IDENTIFIABILITY,0.11879699248120301,"h
exp(−Λ(a))
YI(a)"
CAUSAL ASSUMPTIONS AND IDENTIFIABILITY,0.12030075187969924,"i=1 λ(a)(ti, mi | H<ti)
|
{z
}
mediator intensity YJ(a)"
CAUSAL ASSUMPTIONS AND IDENTIFIABILITY,0.12180451127819548,"j=1 p(a)(yj | tj, H<tj)
|
{z
}
outcome model"
CAUSAL ASSUMPTIONS AND IDENTIFIABILITY,0.12330827067669173,"i
,
(8)"
CAUSAL ASSUMPTIONS AND IDENTIFIABILITY,0.12481203007518797,"where we denote the conditional intensity function of the mediator MPP by λ(a)(ti, mi | H<ti), and
the point process integral term by Λ(a) =
R T
0 λ(a)(τ | H<τ) dτ."
CAUSAL ASSUMPTIONS AND IDENTIFIABILITY,0.12631578947368421,"4.1
Mediator Intensity ( )"
CAUSAL ASSUMPTIONS AND IDENTIFIABILITY,0.12781954887218044,"The mediator intensity λ(ti, mi | H<ti) is defined as a combination of the mediator time intensity
λ(ti | H<ti) and the mediator mark or dosage density p(mi | ti, H<ti): λ(ti, mi | H<ti) = λ(ti |
H<ti)p(mi | ti, H<ti). Similar to [Hızlı et al., 2023], we model the time intensity λ(ti | H<ti) as
the squared sum of three components {β0, gm, go}, to ensure non-negativity:"
CAUSAL ASSUMPTIONS AND IDENTIFIABILITY,0.1293233082706767,"λ(τ | H<τ) =
 
β0
|{z}
PP
baseline"
CAUSAL ASSUMPTIONS AND IDENTIFIABILITY,0.13082706766917293,"+ gm(τ; m)
|
{z
}
mediator
effect"
CAUSAL ASSUMPTIONS AND IDENTIFIABILITY,0.13233082706766916,"+ go(τ; o)
| {z }
outcome
effect"
CAUSAL ASSUMPTIONS AND IDENTIFIABILITY,0.13383458646616542,"2,
(9)"
CAUSAL ASSUMPTIONS AND IDENTIFIABILITY,0.13533834586466165,"where m contains past mediators (meal times and sizes) and o contains past outcomes (glucose).
The constant β0 serves as a basic Poisson process baseline. The mediator-effect function gm and the
outcome-effect function go model how the intensity depends on the past mediators and outcomes,
respectively. The components gm and go are time-dependent functions with GP priors: gm, go ∼GP.
The mediator dosage density p(mi | ti, H<ti) is also modeled with an independent GP prior:
mi(ti) ∼GP."
CAUSAL ASSUMPTIONS AND IDENTIFIABILITY,0.1368421052631579,"4.2
Outcome Model ( )"
CAUSAL ASSUMPTIONS AND IDENTIFIABILITY,0.13834586466165413,"We model the outcome process Y = {Y (τ | H<τ) : τ ∈[0, T]} as a conditional GP prior, that is, a
sum of three independent functions [Schulam and Saria, 2017, Hızlı et al., 2023]:
Y (τ | H<τ) = fb(τ)
| {z }
baseline"
CAUSAL ASSUMPTIONS AND IDENTIFIABILITY,0.13984962406015036,"+ fm(τ; m)
|
{z
}
mediator response"
CAUSAL ASSUMPTIONS AND IDENTIFIABILITY,0.14135338345864662,"+ uY (τ)
| {z }
noise"
CAUSAL ASSUMPTIONS AND IDENTIFIABILITY,0.14285714285714285,",
(10)"
CAUSAL ASSUMPTIONS AND IDENTIFIABILITY,0.1443609022556391,"where the baseline and the mediator response have GP priors, fb, fm ∼GP, similar to Hızlı et al.
[2023], while the noise is sampled independently from a zero-mean Gaussian variable uY (τ) ∼
N(0, σ2
y). The mediator response function fm models the dependence of the future outcomes on
the past mediators. We assume that the effects of nearby mediators simply sum up: fm(τ; m) =
P"
CAUSAL ASSUMPTIONS AND IDENTIFIABILITY,0.14586466165413534,"i:ti≤τ l(mi)f 0
m(τ −ti), where f 0
m ∼GP describes a shared shape function and the magnitude of
the effect depends on the mark mi through a function l(mi)."
EXPERIMENTS,0.14736842105263157,"5
Experiments"
EXPERIMENTS,0.14887218045112782,"In this section, we validate the ability of our method to separate direct and indirect effects of a
healthcare intervention on interacting mediator–outcome processes. First, we show that our model
can support clinical decision-making in real-world data from a randomized controlled trial (RCT)
about the effect of gastric bypass surgery (treatment) on meal–blood glucose (mediator–outcome)
dynamics. Second, as the true causal effects are unknown in the real-world data, we set up a realistic,
semi-synthetic simulation study, where we evaluate the performance of our model on two causal tasks:
estimating direct and indirect effect trajectories. Our implementation and code to reproduce the study
can be found at https://github.com/caglar-hizli/dynamic-causal-mediation."
REAL-WORLD STUDY,0.15037593984962405,"5.1
Real-World Study"
REAL-WORLD STUDY,0.1518796992481203,"We first show on data from a real-world RCT [Saarinen et al., 2019, Ashrafi et al., 2021] that our model
can learn clinically-meaningful direct and indirect effects of bariatric surgery on blood glucose, by
analyzing how surgery affects glucose through changed diet (indirectly) or other metabolic processes
(directly). For further details, see Appendix C.1."
REAL-WORLD STUDY,0.15338345864661654,"Dataset. For 15 nondiabetic obesity patients (body mass index, BMI ≥35 kg/m2) undergoing a
gastric bypass surgery, a continuous-monitoring device measured the blood glucose of each patient at
15-minute intervals. Patients recorded their meals in a food diary, and the nutrient information was
processed into total carbohydrates (sugar + starch) for each meal. Data was collected over two 3-day
long periods: (i) pre-surgery and (ii) post-surgery."
REAL-WORLD STUDY,0.1548872180451128,"Causal Assumptions. Assumption (A1) implies a treatment that is non-informative. The surgery
does not depend on patient characteristics (each patient undergoes the surgery), therefore (A1) holds.
If this was not the case, we could have used a debiasing method such as inverse probability treatment
weighting [Robins et al., 2000a]. Assumptions (A2, A3) imply that (i) path-specific treatments A→M
and A→Y affect only their target path and (ii) there is no unobserved confounding between mediators
and outcomes. They do not exactly hold in the study. For (i), one way to realize A→M is a dietary
intervention that only changes the diet; however, it might not be possible to change the rest of the
metabolic processes through A→Y without affecting the diet. For (ii), demographic factors such
as age, gender, body weight, and height could be potential confounder variables that could bias the
estimation of surgery effects. Moreover, there can be unobserved processes such as exercising habits
that affect both meals and blood glucose, even though the impact of confounders other than meals
on blood glucose is likely modest for nondiabetics, since blood glucose is known to be relatively
stable between meals [Ashrafi et al., 2021]."
BARIATRIC SURGERY REGULATES GLUCOSE THROUGH MEALS AND OTHER METABOLIC PROCESSES,0.15639097744360902,"5.1.1
Bariatric Surgery Regulates Glucose Through Meals and Other Metabolic Processes"
BARIATRIC SURGERY REGULATES GLUCOSE THROUGH MEALS AND OTHER METABOLIC PROCESSES,0.15789473684210525,"0.0
6.0
12.0
18.0
24.0
Time (hours), τ 3.0 4.0 5.0 6.0 7.0"
BARIATRIC SURGERY REGULATES GLUCOSE THROUGH MEALS AND OTHER METABOLIC PROCESSES,0.1593984962406015,"Glucose (mmol/l), fb(·)"
BARIATRIC SURGERY REGULATES GLUCOSE THROUGH MEALS AND OTHER METABOLIC PROCESSES,0.16090225563909774,Pre-surgery
BARIATRIC SURGERY REGULATES GLUCOSE THROUGH MEALS AND OTHER METABOLIC PROCESSES,0.162406015037594,"0.0
6.0
12.0
18.0
24.0
Time (hours), τ"
BARIATRIC SURGERY REGULATES GLUCOSE THROUGH MEALS AND OTHER METABOLIC PROCESSES,0.16390977443609023,Post-surgery
BARIATRIC SURGERY REGULATES GLUCOSE THROUGH MEALS AND OTHER METABOLIC PROCESSES,0.16541353383458646,"fb | [∅, ·]
fb | [˜ta, ·]"
BARIATRIC SURGERY REGULATES GLUCOSE THROUGH MEALS AND OTHER METABOLIC PROCESSES,0.16691729323308271,(a) Baseline progression. 0.0 0.3 0.5 0.8 1.1
BARIATRIC SURGERY REGULATES GLUCOSE THROUGH MEALS AND OTHER METABOLIC PROCESSES,0.16842105263157894,"Glucose (mmol/l), fa(·)"
BARIATRIC SURGERY REGULATES GLUCOSE THROUGH MEALS AND OTHER METABOLIC PROCESSES,0.1699248120300752,"Pre-surgery
What if only the
metabolism behaves
like post-surgery?"
BARIATRIC SURGERY REGULATES GLUCOSE THROUGH MEALS AND OTHER METABOLIC PROCESSES,0.17142857142857143,"0.0
1.0
2.0
3.0
Time (hours), τ 0.0 0.3 0.5 0.8 1.1"
BARIATRIC SURGERY REGULATES GLUCOSE THROUGH MEALS AND OTHER METABOLIC PROCESSES,0.17293233082706766,"Glucose (mmol/l), fa(·)"
BARIATRIC SURGERY REGULATES GLUCOSE THROUGH MEALS AND OTHER METABOLIC PROCESSES,0.17443609022556392,"What if only the
patient eats
like post-surgery?"
BARIATRIC SURGERY REGULATES GLUCOSE THROUGH MEALS AND OTHER METABOLIC PROCESSES,0.17593984962406015,"0.0
1.0
2.0
3.0
Time (hours), τ"
BARIATRIC SURGERY REGULATES GLUCOSE THROUGH MEALS AND OTHER METABOLIC PROCESSES,0.1774436090225564,Post-surgery
BARIATRIC SURGERY REGULATES GLUCOSE THROUGH MEALS AND OTHER METABOLIC PROCESSES,0.17894736842105263,"0.0
12.7
25.4
38.1"
BARIATRIC SURGERY REGULATES GLUCOSE THROUGH MEALS AND OTHER METABOLIC PROCESSES,0.18045112781954886,"Carb. intake (g), m"
BARIATRIC SURGERY REGULATES GLUCOSE THROUGH MEALS AND OTHER METABOLIC PROCESSES,0.18195488721804512,"0.0
12.7
25.4
38.1"
BARIATRIC SURGERY REGULATES GLUCOSE THROUGH MEALS AND OTHER METABOLIC PROCESSES,0.18345864661654135,"Carb. intake (g), m"
BARIATRIC SURGERY REGULATES GLUCOSE THROUGH MEALS AND OTHER METABOLIC PROCESSES,0.1849624060150376,"m | [·, ∅]"
BARIATRIC SURGERY REGULATES GLUCOSE THROUGH MEALS AND OTHER METABOLIC PROCESSES,0.18646616541353384,"m | [·, ˜ta]"
BARIATRIC SURGERY REGULATES GLUCOSE THROUGH MEALS AND OTHER METABOLIC PROCESSES,0.18796992481203006,"fm | [∅, ∅]"
BARIATRIC SURGERY REGULATES GLUCOSE THROUGH MEALS AND OTHER METABOLIC PROCESSES,0.18947368421052632,"fm | [∅, ˜ta]"
BARIATRIC SURGERY REGULATES GLUCOSE THROUGH MEALS AND OTHER METABOLIC PROCESSES,0.19097744360902255,"fm | [˜ta, ∅]"
BARIATRIC SURGERY REGULATES GLUCOSE THROUGH MEALS AND OTHER METABOLIC PROCESSES,0.1924812030075188,"fm | [˜ta, ˜ta]"
BARIATRIC SURGERY REGULATES GLUCOSE THROUGH MEALS AND OTHER METABOLIC PROCESSES,0.19398496240601504,"Area under fm | [∅, ∅]"
BARIATRIC SURGERY REGULATES GLUCOSE THROUGH MEALS AND OTHER METABOLIC PROCESSES,0.19548872180451127,(b) Meal response functions.
BARIATRIC SURGERY REGULATES GLUCOSE THROUGH MEALS AND OTHER METABOLIC PROCESSES,0.19699248120300752,"Figure 4: Pre- vs. post-surgery predicted glucose pro-
gressions: (a) Baseline, (b) Meal response."
BARIATRIC SURGERY REGULATES GLUCOSE THROUGH MEALS AND OTHER METABOLIC PROCESSES,0.19849624060150375,"To visualize the effect of the surgery on
meal–blood glucose dynamics, we show 1-
day long meal–glucose measurements for
one patient together with predicted glu-
cose trajectories from our outcome model
in both pre- and post-surgery periods in
Fig. 1. For blood glucose, we see, after the
surgery, (i) the baseline declines, and (ii)
a meal produces a faster rise and decline.
For meals, we see, after the surgery, the
patient eats (i) more frequently and (ii) less
carbohydrate per meal."
"DIRECT AND INDIRECT EFFECTS OF
THE SURGERY ON MEAL RESPONSE CURVES",0.2,"5.1.2
Direct and Indirect Effects of
the Surgery on Meal Response Curves"
"DIRECT AND INDIRECT EFFECTS OF
THE SURGERY ON MEAL RESPONSE CURVES",0.20150375939849624,"We compare the predicted glucose base-
line fb and the predicted meal response
fm for all patients in Fig. 4. In Fig. 4a,
after the surgery, the glucose baseline de-
clines in agreement with previous findings
[Dirksen et al., 2012, Jacobsen et al., 2013].
In Fig. 4b, we see meal responses corre-
sponding to four hypothetical scenarios. In
the upper-left, we predict a typical pre-
surgery meal response and highlight the
area under this curve by shaded grey. In
the upper-right, we predict the hypothet-
ical meal response by considering only the
surgical effect on metabolism, while keep-
ing the diet in its natural pre-surgery state. Here, the meal response increases to a higher peak and
declines back to the baseline faster than the shaded pre-surgery response, as previously described"
"DIRECT AND INDIRECT EFFECTS OF
THE SURGERY ON MEAL RESPONSE CURVES",0.20300751879699247,"[Jacobsen et al., 2013, Bojsen-Møller et al., 2014]. Moreover, the response model captures the
decline under the baseline around 2 h after a meal and a correction afterwards, which is a clinically-
meaningful estimation suggesting overshooting of the glucose lowering due to the higher secretion
of insulin after the surgery [Jacobsen et al., 2013, Bojsen-Møller et al., 2014]. In the lower-left, we
predict the hypothetical meal response if patients only followed the post-surgery diet, while their
metabolism would be fixed in its natural pre-surgery state. Here, the meal response increases to a
lower peak due to a lower carbohydrate intake, while the shape of the response is preserved. In the
lower-right, we predict a typical post-surgery response, which increases to a lower peak due to lower
carbohydrate intake and declines back to the baseline faster compared to the pre-surgery response
due to the high insulin levels."
SURGERY LEADS TO SHORTER MEAL INTERVALS AND LESS CARBOHYDRATE INTAKE,0.20451127819548873,"5.1.3
Surgery Leads to Shorter Meal Intervals and Less Carbohydrate Intake"
SURGERY LEADS TO SHORTER MEAL INTERVALS AND LESS CARBOHYDRATE INTAKE,0.20601503759398496,"We compare meal data and predictions from the mediator model between the pre- and post-surgery
periods in Fig. 5. The surgery leads to a more regular, low-carb diet due to the post-surgery dietary
advice, a reduction in the stomach size, and an increase in appetite-regulating gut hormone levels
[Dirksen et al., 2012, Laferrère and Pattou, 2018]. In Fig. 5a, we see that the surgery leads to a
more peaky, unimodal distribution for the next meal time, compared to the multimodal pre-surgery
distribution. The average time interval until the next meal decreases from 3.16 h to 2.41 h. In Fig. 5b,
we see that the post-surgery carbohydrate intake is more concentrated around the mean. The median
per-meal carbohydrate intake decreases from 29.13 g to 11.94 g."
SURGERY LEADS TO SHORTER MEAL INTERVALS AND LESS CARBOHYDRATE INTAKE,0.2075187969924812,"5.1.4
Would intervening on the mediator (diet) suffice to regularize glucose progression? 0.0 0.1 0.2 0.3 0.4 0.5"
SURGERY LEADS TO SHORTER MEAL INTERVALS AND LESS CARBOHYDRATE INTAKE,0.20902255639097744,Density
SURGERY LEADS TO SHORTER MEAL INTERVALS AND LESS CARBOHYDRATE INTAKE,0.21052631578947367,Pre-surgery
SURGERY LEADS TO SHORTER MEAL INTERVALS AND LESS CARBOHYDRATE INTAKE,0.21203007518796993,"0.0
1.5
3.0
4.5
6.0
7.5
9.0
Next Meal Time, ∆t (hours) 0.0 0.1 0.2 0.3 0.4 0.5"
SURGERY LEADS TO SHORTER MEAL INTERVALS AND LESS CARBOHYDRATE INTAKE,0.21353383458646616,Density
SURGERY LEADS TO SHORTER MEAL INTERVALS AND LESS CARBOHYDRATE INTAKE,0.21503759398496242,Post-surgery
SURGERY LEADS TO SHORTER MEAL INTERVALS AND LESS CARBOHYDRATE INTAKE,0.21654135338345865,"Pre- ∆t
Post- ∆t"
SURGERY LEADS TO SHORTER MEAL INTERVALS AND LESS CARBOHYDRATE INTAKE,0.21804511278195488,"Pre- Posterior Kde
Post- Posterior Kde"
SURGERY LEADS TO SHORTER MEAL INTERVALS AND LESS CARBOHYDRATE INTAKE,0.21954887218045113,(a) Next meal arrival time. 0.0 0.2 0.5 0.8 1.0 1.2
SURGERY LEADS TO SHORTER MEAL INTERVALS AND LESS CARBOHYDRATE INTAKE,0.22105263157894736,Density
SURGERY LEADS TO SHORTER MEAL INTERVALS AND LESS CARBOHYDRATE INTAKE,0.22255639097744362,Pre-surgery
SURGERY LEADS TO SHORTER MEAL INTERVALS AND LESS CARBOHYDRATE INTAKE,0.22406015037593985,"1.0
2.0
3.0
4.0
5.0
6.0
Carb. intake per meal, m (log grams) 0.0 0.2 0.5 0.8 1.0 1.2"
SURGERY LEADS TO SHORTER MEAL INTERVALS AND LESS CARBOHYDRATE INTAKE,0.22556390977443608,Density
SURGERY LEADS TO SHORTER MEAL INTERVALS AND LESS CARBOHYDRATE INTAKE,0.22706766917293233,Post-surgery
SURGERY LEADS TO SHORTER MEAL INTERVALS AND LESS CARBOHYDRATE INTAKE,0.22857142857142856,"Pre- m
Post- m"
SURGERY LEADS TO SHORTER MEAL INTERVALS AND LESS CARBOHYDRATE INTAKE,0.23007518796992482,"Pre- Posterior Kde
Post- Posterior Kde"
SURGERY LEADS TO SHORTER MEAL INTERVALS AND LESS CARBOHYDRATE INTAKE,0.23157894736842105,(b) Carbohydrate intake.
SURGERY LEADS TO SHORTER MEAL INTERVALS AND LESS CARBOHYDRATE INTAKE,0.23308270676691728,"Figure 5: Pre- vs. post-surgery data (histograms) and
model posterior (kernel density estimate, dashed) for
(a) next meal time and (b) (log) carbohydrate intake."
SURGERY LEADS TO SHORTER MEAL INTERVALS AND LESS CARBOHYDRATE INTAKE,0.23458646616541354,"As shown in Figs. 1, 4 and 5, the surgery
affects glycemia through changing the diet
(indirect) and other biological processes (di-
rect). Then, a relevant research question is
how much of the surgery effect can be at-
tributed to the changed diet?"
SURGERY LEADS TO SHORTER MEAL INTERVALS AND LESS CARBOHYDRATE INTAKE,0.23609022556390977,"This question is crucial in assessing whether
surgery affects blood glucose levels inde-
pendently of dietary changes. If confirmed,
it implies that surgery can influence blood
glucose through two mechanisms: control-
ling meal size and independent hormonal
changes. Additionally, surgery can also in-
duce too low glucose levels (hypoglycemia),
if the glucose peak after the meal induces
too high insulin secretion [Lee et al., 2016]."
SURGERY LEADS TO SHORTER MEAL INTERVALS AND LESS CARBOHYDRATE INTAKE,0.23759398496240602,"Table 1: NDE, NIE and TE results for % time spent in
hypoglycemia %THG and in above-normal-glycemia
%TANG, to investigate how much of the surgery effect
can be attributed to a changed diet?"
SURGERY LEADS TO SHORTER MEAL INTERVALS AND LESS CARBOHYDRATE INTAKE,0.23909774436090225,"DATA
TYPE
CAUSAL
EFFECT
∆%THG
∆%TANG"
SURGERY LEADS TO SHORTER MEAL INTERVALS AND LESS CARBOHYDRATE INTAKE,0.24060150375939848,"Empirical data
TE
+27.5
−27.0"
SURGERY LEADS TO SHORTER MEAL INTERVALS AND LESS CARBOHYDRATE INTAKE,0.24210526315789474,"Simulation
TE
+24.4 ± 0.2
−28.0 ± 0.5
NDE
+24.7 ± 0.2
−26.4 ± 0.5
NIE
−0.3 ± 0.2
−1.5 ± 0.3"
SURGERY LEADS TO SHORTER MEAL INTERVALS AND LESS CARBOHYDRATE INTAKE,0.24360902255639097,"To measure the contribution of direct and
indirect causal paths, we use two metrics: (i)
the percentage time spent in hypoglycemia
(HG) %THG = {t : y(t) ≤3.9 mmol/l}/T,
and (ii) the percentage time spent in above-
normal-glycemia (ANG) %TANG = {t :
y(t) ≥5.6 mmol/l}/T. We estimate di-
rect, indirect and total effects on %THG and
%TANG, as in Eqs. (4) to (6). We show the
results in Table 1. In the empirical data,
%THG increased 27.5 points, while %TANG
decreased 27.0 points. For the estimation of
direct and indirect effects, we train our joint
model on the RCT data set and use samples
from the posterior to obtain a Monte Carlo approximation. The results suggest that the contribution
of the changed diet (indirect, NIE) to the total effect in %THG and %TANG is much smaller compared
to other metabolic processes (direct, NDE). Our computational exploration of these effects from
observational data is supported empirically by Laferrère et al. [2008], who study the effects of two"
SURGERY LEADS TO SHORTER MEAL INTERVALS AND LESS CARBOHYDRATE INTAKE,0.24511278195488723,"Table 2: Mean squared error (MSE, mean ± std.dev. across 10 runs) for NDE, NIE and TE."
SURGERY LEADS TO SHORTER MEAL INTERVALS AND LESS CARBOHYDRATE INTAKE,0.24661654135338346,"JOINT
MODEL
MODEL COMPONENTS
CAUSAL QUERY (MSE ↓)"
SURGERY LEADS TO SHORTER MEAL INTERVALS AND LESS CARBOHYDRATE INTAKE,0.24812030075187969,"A→Y
MEDIATOR
RESPONSE
NDE(˜ta)
NIE(˜ta)
TE(˜ta)"
SURGERY LEADS TO SHORTER MEAL INTERVALS AND LESS CARBOHYDRATE INTAKE,0.24962406015037594,"M1
✓
Non-interact. (L15)
Parametric (S17)
0.22 ± 0.02
0.12 ± 0.01
0.31 ± 0.02
M2
✓
Non-interact. (L15)
Non-param. (H22)
0.04 ± 0.00
0.15 ± 0.01
0.16 ± 0.02
M3
✓
Interacting (H22)
Parametric (S17)
0.23 ± 0.02
0.11 ± 0.01
0.31 ± 0.02"
SURGERY LEADS TO SHORTER MEAL INTERVALS AND LESS CARBOHYDRATE INTAKE,0.2511278195488722,"Z21-1
✓
Interacting (H22)
Parametric (Z21)
0.07 ± 0.00
0.09 ± 0.01
0.16 ± 0.01
Z21-2
✓
ORACLE
Parametric (Z21)
0.07 ± 0.00
0.04 ± 0.00
0.11 ± 0.01
H22
✗
Interacting (H22)
Non-param. (H22)
–
–
1.14 ± 0.07
Our
✓
Interacting (H22)
Non-param. (H22)
0.02 ± 0.00
0.09 ± 0.01
0.10 ± 0.01"
SURGERY LEADS TO SHORTER MEAL INTERVALS AND LESS CARBOHYDRATE INTAKE,0.25263157894736843,"different interventions — namely, dietary changes and surgical procedures — on individuals who had
lost equal amounts of weight. In the study, the blood glucose response to a fixed carbohydrate meal
shows a more pronounced decline in the surgery group compared to the control group. Because all
patients received the same meal, this decline corresponds to the direct effect. This direct effect can be
attributed to a range of intricate hormonal influences, including the involvement of gut hormones like
GLP-1, alongside heightened insulin peaks subsequent to surgical intervention."
SEMI-SYNTHETIC SIMULATION STUDY,0.25413533834586466,"5.2
Semi-Synthetic Simulation Study"
SEMI-SYNTHETIC SIMULATION STUDY,0.2556390977443609,"In this section, we set up a semi-synthetic simulation study to evaluate the proposed method on two
causal tasks: estimating (i) natural direct effect (NDE) and (ii) natural indirect effect (NIE). For
further details and additional results on sensitivity analysis, see Appendices C.2 and D."
SEMI-SYNTHETIC SIMULATION STUDY,0.2571428571428571,"Simulator. We train our joint model on the real-world RCT data set, and then use the learned model
as the ground-truth meal–blood glucose simulator. One joint model is learned for each of the pre- and
post-surgery periods. For the meal simulator, we use a mediator model learned on all patients. For
the glucose simulator, we use an outcome model learned on a subset of three patients with distinct
baselines and meal response functions to enable individualization between synthetic patients."
SEMI-SYNTHETIC SIMULATION STUDY,0.2586466165413534,"Semi-synthetic dataset. We use the ground-truth simulators to sample meal–glucose trajectories
for 50 synthetic patients. As in the RCT in Section 5.1, we assume each patient undergoes the
surgery in the semi-synthetic scenario while being observed in pre- and post-surgery periods. For the
training set, we sample 1-day long trajectories for pre- and post-surgery periods. For the test set, we
sample three interventional trajectories for each patient for the subsequent 1-day, corresponding to
three interventional distributions resulting from the following interventions: {[∅, ∅], [∅, ˜ta], [˜ta, ˜ta]}.
Then, the ground-truth NIE and NDE trajectories are calculated as in Eqs. (4) and (5), respectively."
SEMI-SYNTHETIC SIMULATION STUDY,0.26015037593984963,"Benchmarks. We compare methods with respect to their abilities in (i) allowing for an external
intervention that jointly affects mediator and outcome processes, and (ii) capturing non-linear,
long-range dependencies between these processes. For (i), we add a benchmark model [H22, Hızlı
et al., 2023] that excludes the direct arrows from the treatment to the outcomes (A→Y ). For (ii),
we combine different interacting/non-interacting mediator models and parametric/non-parametric
response functions to obtain baseline methods that include the direct arrows (A→Y ). The methods
Z21-1 and Z21-2 are named after a longitudinal causal mediation method [Zeng et al., 2021]
with linear, instantaneous effects from mediator to outcome [Parametric (Z21), Zeng et al., 2021]
(Fig. 2a). Additionally, we include a parametric response [Parametric (S17), Schulam and Saria, 2017]
(M1, M3), and a non-parametric response [Non-parametric (H22), Hızlı et al., 2023] (M2). The non-
interacting mediator model is chosen as a history-independent, non-homogeneous Poisson process
[Non-interacting (L15), Lloyd et al., 2015] (M1, M2), while the interacting mediator model is chosen as
a history-dependent, non-parametric point process model [Interacting (H22), Hızlı et al., 2023] (M3,
Z21-1). In the joint model Z21-2, we further combine the parametric response model by Zeng et al.
[2021] (Parametric (Z21)) with the ground-truth (ORACLE) mediator sequence."
SEMI-SYNTHETIC SIMULATION STUDY,0.26165413533834586,"Metric. On the test set, we report the mean squared error (MSE) between ground-truth and estimated
trajectories. To sample comparable glucose trajectories, three interventional trajectories are simulated
with fixed noise variables for meal (point process) sampling for all methods, as in Hızlı et al. [2023]."
SEMI-SYNTHETIC SIMULATION STUDY,0.2631578947368421,"Results. MSE results are shown in Table 2. For the natural direct effect, formalized as NDE(˜ta) =
Y>˜ta[˜ta, ˜ta] −Y>˜ta[∅, ˜ta], we answer the causal query: How differently will the glucose progress
if we change only the metabolic processes other than the diet, while keeping the diet at its natural
post-surgery value? We see that our joint model performs the best compared to the other methods.
The models with the non-parametric response produce better NDE trajectories than the models with
the parametric response, which fail to capture the glucose baseline and the meal response well. For
the natural indirect effect, formalized as NIE(˜ta) = Y>˜ta[∅, ˜ta] −Y˜ta[∅, ∅], we answer the causal
query: How will the glucose progress if we change only the diet, while keeping the rest of the
metabolic processes at their natural pre-surgery state? The oracle model Z21-2 that directly uses the
mediator sequences sampled from the ground-truth simulator performs better than other methods.
Our joint model performs better than the other methods that predict the mediator sequence, and it
performs the same compared to the model Z21-1 which also uses the interacting mediator model. In
contrast to the NDE results, the performance on the NIE improves with respect to the expressiveness
of the mediator model, e.g. models with the interacting point process (M3, Z21-1, Our) perform better
than the models with the non-interacting mediator (M1, M2). Similarly, the oracle model that has
access to the ground-truth mediator sequences performs the best. For the total effect, formalized as
TE(˜ta) = Y>˜ta[˜ta, ˜ta] −Y˜ta[∅, ∅], our joint model performs similar to the model Z21-2 that has
access to the ground-truth mediators, while performing better than all the rest."
LIMITATIONS AND FUTURE WORK,0.2646616541353383,"6
Limitations and Future Work"
LIMITATIONS AND FUTURE WORK,0.2661654135338346,"As required for causal inference, our identifiability result relies on causal assumptions, which may
not hold in an observational study and are not statistically testable. For example, our assumption that
there are no unobserved confounders between the mediator and outcome processes may not hold. To
understand the sensitivity to this assumption, we performed an additional preliminary analysis in
Appendix D, which can be refined in future work by extending the sensitivity analysis methods used
in the static setting [Robins et al., 2000b]. In addition, our method relies on a hypothetical division of
a treatment into path-specific treatments which solely affect the variables in their own path. This may
not be possible in reality, e.g., it is not trivial to come up with a treatment that changes all the other
metabolic processes without affecting the diet in our surgery–diet–blood glucose example."
LIMITATIONS AND FUTURE WORK,0.26766917293233083,"In our real-world application, we focus on the dynamic causal mediation problem where the sequence
of meals is the mediator of the effect of surgery on blood glucose. In this definition, the rest of the
metabolic processes, e.g., gut hormones, weight loss, hepatic insulin sensitivity, or any other mediator
through which the surgery could affect blood glucose, are included in the direct effect. An extension
to multiple mediators and an explicit quantification of the corresponding path-specific effects will be
an interesting future direction, especially from a medical point of view. In the semi-synthetic study,
our joint model matches the functional class of the simulator; in future work, it would be valuable to
further analyze the effect of model misspecification."
LIMITATIONS AND FUTURE WORK,0.26917293233082706,"From a modeling perspective, the main limitation is scalability of the outcome model to a larger
number of data points (see Appendix B.5 for details). This can be improved using separate sets of
inducing points for the baseline function and the treatment response function. Alternatively, the
GP models describing the components of our joint distribution (Eq. (8)) could be replaced by other
model classes (e.g., neural networks). Our dynamic causal mediation framework does not put any
fundamental limitations on the dimensionality of mediators or outcome."
CONCLUSION,0.2706766917293233,"7
Conclusion"
CONCLUSION,0.2721804511278195,"We investigated temporal causal mediation in complex healthcare time-series by defining direct and
indirect effects as stochastic processes instead of static random variables. Theoretically, we provided
causal assumptions required for identifiability. To estimate the effects, we proposed a non-parametric
mediator–outcome model that allows for an external intervention jointly affecting mediator and
outcome sequences, while capturing time-delayed interactions between them. Despite the limitations,
in a real-world study about the effect of bariatric surgery on meal–blood glucose dynamics, our
method identified clinically-meaningful direct and indirect effects. This demonstrates how the model
can be used for gaining insights from observational data without tedious or expensive experiments
and supports its use for generating novel, testable research hypotheses. We believe that our method
can lead to insightful analyses also in other domains such as epidemiology, public policy, and beyond."
REFERENCES,0.2736842105263158,References
REFERENCES,0.27518796992481204,"Odd O Aalen, Mats J Stensrud, Vanessa Didelez, Rhian Daniel, Kjetil Røysland, and Susanne
Strohmaier. Time-dependent mediators in survival analysis: modeling direct and indirect effects
with the additive hazards model. Biometrical Journal, 62(3):532–549, 2020."
REFERENCES,0.27669172932330827,"Reza A Ashrafi, Aila J Ahola, Milla Rosengård-Bärlund, Tuure Saarinen, Sini Heinonen, Anne
Juuti, Pekka Marttinen, and Kirsi H Pietiläinen. Computational modelling of self-reported dietary
carbohydrate intake on glucose concentrations in patients undergoing Roux-en-Y gastric bypass
versus one-anastomosis gastric bypass. Annals of Medicine, 53(1):1885–1895, 2021."
REFERENCES,0.2781954887218045,"Sarah E Berry, Ana M Valdes, David A Drew, Francesco Asnicar, Mohsen Mazidi, Jonathan Wolf,
Joan Capdevila, George Hadjigeorgiou, Richard Davies, Haya Al Khatib, et al. Human postprandial
responses to food and potential for precision nutrition. Nature Medicine, 26(6):964–973, 2020."
REFERENCES,0.2796992481203007,"Ioana Bica, Ahmed M Alaa, James Jordon, and Mihaela van der Schaar. Estimating counterfactual
treatment outcomes over time through adversarially balanced representations. In International
Conference on Learning Representations (ICLR), 2020."
REFERENCES,0.281203007518797,"Kirstine N. Bojsen-Møller, Carsten Dirksen, Nils B. Jørgensen, Siv H. Jacobsen, Annette K. Serup,
Peter H. Albers, Dorte L. Hansen, Dorte Worm, Lars Naver, Viggo B. Kristiansen, Jørgen F.P.
Wojtaszewski, Bente Kiens, Jens J. Holst, Erik A. Richter, and Sten Madsbad. Early enhancements
of hepatic and later of peripheral insulin sensitivity combined with increased postprandial insulin
secretion contribute to improved glycemic control after Roux-en-Y gastric bypass. Diabetes, 63
(5):1725–1737, 2014."
REFERENCES,0.28270676691729324,"Bob Carpenter, Andrew Gelman, Matthew D Hoffman, Daniel Lee, Ben Goodrich, Michael Be-
tancourt, Marcus Brubaker, Jiqiang Guo, Peter Li, and Allen Riddell. Stan: A probabilistic
programming language. Journal of Statistical Software, 76(1), 2017."
REFERENCES,0.28421052631578947,"Li-Fang Cheng, Bianca Dumitrascu, Michael Zhang, Corey Chivers, Michael Draugelis, Kai Li, and
Barbara Engelhardt. Patient-specific effects of medication using latent force models with Gaussian
processes. In Artificial Intelligence and Statistics (AISTATS), 2020."
REFERENCES,0.2857142857142857,"John Cunningham, Zoubin Ghahramani, and Carl Rasmussen. Gaussian processes for time-marked
time-series data. In Artificial Intelligence and Statistics (AISTATS), 2012."
REFERENCES,0.28721804511278193,"Daryl J Daley and David Vere-Jones. An introduction to the theory of point processes: volume I:
elementary theory and methods. Springer, 2003."
REFERENCES,0.2887218045112782,"Vanessa Didelez. Asymmetric separation for local independence graphs. In Uncertainty in Artificial
Intelligence (UAI), 2006."
REFERENCES,0.29022556390977444,"Vanessa Didelez. Graphical models for marked point processes based on local independence. Journal
of the Royal Statistical Society: Series B (Statistical Methodology), 70(1):245–264, 2008."
REFERENCES,0.29172932330827067,"Vanessa Didelez. Causal reasoning for events in continuous time: A decision-theoretic approach.
In Workshop on Advances in Causal Inference, Uncertainty in Artificial Intelligence (UAI 2015),
volume 1504 of CEUR Workshop Proceedings, pages 40–45. CEUR-WS.org, 2015."
REFERENCES,0.2932330827067669,"Vanessa Didelez. Defining causal mediation with a longitudinal mediator and a survival outcome.
Lifetime Data Analysis, 25:593–610, 2019."
REFERENCES,0.29473684210526313,"C Dirksen, NB Jørgensen, KN Bojsen-Møller, SH Jacobsen, DL Hansen, D Worm, JJ Holst, and
S Madsbad. Mechanisms of improved glycaemic control after Roux-en-Y gastric bypass. Dia-
betologia, 55:1890–1901, 2012."
REFERENCES,0.2962406015037594,"Tian Gao, Dharmashankar Subramanian, Debarun Bhattacharjya, Xiao Shou, Nicholas Mattei, and
Kristin P Bennett. Causal inference for event pairs in multivariate point processes. Advances in
Neural Information Processing Systems, 34:17311–17324, 2021."
REFERENCES,0.29774436090225564,"Changran Geng, Harald Paganetti, and Clemens Grassberger. Prediction of treatment response
for combined chemo-and radiation therapy for non-small cell lung cancer patients using a bio-
mathematical model. Scientific Reports, 7(1):13542, 2017."
REFERENCES,0.2992481203007519,"Marzyeh Ghassemi, Tristan Naumann, Peter Schulam, Andrew L Beam, Irene Y Chen, and Rajesh
Ranganath. A review of challenges and opportunities in machine learning for health. AMIA
Summits on Translational Science Proceedings, 2020:191, 2020."
REFERENCES,0.3007518796992481,"Clive WJ Granger. Investigating causal relations by econometric models and cross-spectral methods.
Econometrica: Journal of the Econometric Society, pages 424–438, 1969."
REFERENCES,0.3022556390977444,"James Hensman, Alexander G. de G. Matthews, and Zoubin Ghahramani. Scalable variational
Gaussian process classification. In Artificial Intelligence and Statistics (AISTATS), 2015."
REFERENCES,0.3037593984962406,"Ça˘glar Hızlı, S. T. John, Anne Tuulikki Juuti, Tuure Tapani Saarinen, Kirsi Hannele Pietiläinen, and
Pekka Marttinen. Causal modeling of policy interventions from treatment–outcome sequences. In
International Conference on Machine Learning (ICML), 2023."
REFERENCES,0.30526315789473685,"Kosuke Imai, Luke Keele, and Dustin Tingley. A general approach to causal mediation analysis.
Psychological Methods, 15(4):309, 2010a."
REFERENCES,0.3067669172932331,"Kosuke Imai, Luke Keele, and Teppei Yamamoto. Identification, inference and sensitivity analysis
for causal mediation effects. Statistical Science, 25(1):51 – 71, 2010b."
REFERENCES,0.3082706766917293,"Siv H Jacobsen, Kirstine N Bojsen-Møller, Carsten Dirksen, Nils B Jørgensen, Trine R Clausen,
Birgitte S Wulff, Viggo B Kristiansen, Dorte Worm, Dorte L Hansen, Jens J Holst, et al. Effects
of gastric bypass surgery on glucose absorption and metabolism during a mixed meal in glucose-
tolerant individuals. Diabetologia, 56:2250–2254, 2013."
REFERENCES,0.3097744360902256,"Blandine Laferrère and François Pattou. Weight-independent mechanisms of glucose control after
Roux-en-Y gastric bypass. Frontiers in Endocrinology, 9:530, 2018."
REFERENCES,0.3112781954887218,"Blandine Laferrère, Julio Teixeira, James McGinty, Hao Tran, Joseph R. Egger, Antonia Colarusso,
Betty Kovack, Baani Bawa, Ninan Koshy, Hongchan Lee, Kimberly Yapp, and Blanca Olivan.
Effect of weight loss by gastric bypass surgery versus hypocaloric diet on glucose and incretin
levels in patients with type 2 diabetes. The Journal of Clinical Endocrinology & Metabolism, 93
(7):2479–2485, 2008."
REFERENCES,0.31278195488721805,"Clare J Lee, G Craig Wood, Mariana Lazo, Todd T Brown, Jeanne M Clark, Christopher Still, and
Peter Benotti. Risk of post-gastric bypass surgery hypoglycemia in nondiabetic individuals: a
single center experience. Obesity, 24(6):1342–1348, 2016."
REFERENCES,0.3142857142857143,"Sheng-Hsuan Lin, Jessica Young, Roger Logan, Eric J Tchetgen Tchetgen, and Tyler J VanderWeele.
Parametric mediational g-formula approach to mediation analysis with time-varying exposures,
mediators, and confounders. Epidemiology, 28(2):266, 2017."
REFERENCES,0.3157894736842105,"Siqi Liu and Milos Hauskrecht. Nonparametric regressive point processes based on conditional
Gaussian processes. In Advances in Neural Information Processing Systems (NeurIPS), 2019."
REFERENCES,0.3172932330827068,"Chris Lloyd, Tom Gunter, Michael Osborne, and Stephen Roberts. Variational inference for Gaussian
process modulated Poisson processes. In International Conference on Machine Learning (ICML),
2015."
REFERENCES,0.318796992481203,"Alexander G de G Matthews, Mark Van Der Wilk, Tom Nickson, Keisuke Fujii, Alexis Boukouvalas,
Pablo León-Villagrá, Zoubin Ghahramani, and James Hensman. GPflow: A Gaussian process
library using TensorFlow. The Journal of Machine Learning Research, 18(40):1–6, 2017."
REFERENCES,0.32030075187969925,"Kimia Noorbakhsh and Manuel Rodriguez. Counterfactual temporal point processes. Advances in
Neural Information Processing Systems, 35:24810–24823, 2022."
REFERENCES,0.3218045112781955,"Judea Pearl. Direct and indirect effects. In Uncertainty in Artificial Intelligence (UAI), 2001."
REFERENCES,0.3233082706766917,"Judea Pearl. Causality. Cambridge University Press, 2009."
REFERENCES,0.324812030075188,"Judea Pearl. Interpretation and identification of causal mediation. Psychological methods, 19(4):459,
2014."
REFERENCES,0.3263157894736842,"Jonas Peters, Dominik Janzing, and Bernhard Schölkopf. Elements of causal inference: foundations
and learning algorithms. The MIT Press, 2017."
REFERENCES,0.32781954887218046,"Joaquin Quiñonero Candela and Carl Edward Rasmussen. A unifying view of sparse approximate
Gaussian process regression. The Journal of Machine Learning Research, 6:1939–1959, 2005."
REFERENCES,0.3293233082706767,"Jakob Gulddahl Rasmussen. Temporal point processes: the conditional intensity function. arXiv
preprint arXiv:1806.00221, 2011."
REFERENCES,0.3308270676691729,"James Robins. A new approach to causal inference in mortality studies with a sustained exposure
period—application to control of the healthy worker survivor effect. Mathematical Modelling, 7
(9-12):1393–1512, 1986."
REFERENCES,0.3323308270676692,"James M Robins. Semantics of causal DAG models and the identification of direct and indirect
effects. Oxford Statistical Science Series, pages 70–82, 2003."
REFERENCES,0.33383458646616543,"James M Robins and Sander Greenland. Identifiability and exchangeability for direct and indirect
effects. Epidemiology, 3(2):143–155, 1992."
REFERENCES,0.33533834586466166,"James M Robins and Thomas S Richardson. Alternative graphical causal models and the identification
of direct effects. Causality and Psychopathology: Finding the Determinants of Disorders and
Their Cures, 84:103–158, 2010."
REFERENCES,0.3368421052631579,"James M Robins, Miguel Angel Hernan, and Babette Brumback. Marginal structural models and
causal inference in epidemiology. Epidemiology, pages 550–560, 2000a."
REFERENCES,0.3383458646616541,"James M Robins, Andrea Rotnitzky, and Daniel O Scharfstein. Sensitivity analysis for selection bias
and unmeasured confounding in missing data and causal inference models. In Statistical models in
epidemiology, the environment, and clinical trials, pages 1–94. Springer, 2000b."
REFERENCES,0.3398496240601504,"James M Robins, Thomas S Richardson, and Ilya Shpitser. An interventionist approach to mediation
analysis. In Probabilistic and Causal Inference: The Works of Judea Pearl, pages 713–764.
Association for Computing Machinery, 2022."
REFERENCES,0.34135338345864663,"Robert Rutledge. The mini-gastric bypass: experience with the first 1,274 cases. Obesity surgery, 11
(3):276–280, 2001."
REFERENCES,0.34285714285714286,"Tuure Saarinen, Sanna Meriläinen, Vesa Koivukangas, Kirsi Hannele Pietiläinen, and Anne Juuti.
Prospective randomized controlled trial comparing the efficacy and safety of Roux-en-Y gastric
bypass and one-anastomosis gastric bypass (the RYSA trial): trial protocol and interim analysis.
Trials, 20(1):1–10, 2019."
REFERENCES,0.3443609022556391,"Mohammed Saeed, Mauricio Villarroel, Andrew T Reisner, Gari Clifford, Li-Wei Lehman, George
Moody, Thomas Heldt, Tin H Kyaw, Benjamin Moody, and Roger G Mark. Multiparameter
Intelligent Monitoring in Intensive Care II (MIMIC-II): a public-access intensive care unit database.
Critical Care Medicine, 39(5):952, 2011."
REFERENCES,0.3458646616541353,"Peter Schulam and Suchi Saria. Reliable decision support using counterfactual models. In Advances
in Neural Information Processing Systems (NeurIPS), 2017."
REFERENCES,0.3473684210526316,"Nabeel Seedat, Fergus Imrie, Alexis Bellot, Zhaozhi Qian, and Mihaela van der Schaar. Continuous-
time modeling of counterfactual outcomes using neural controlled differential equations. In
International Conference on Machine Learning (ICML), 2022."
REFERENCES,0.34887218045112783,"Hossein Soleimani, Adarsh Subbaswamy, and Suchi Saria. Treatment-response models for coun-
terfactual reasoning with continuous-time, continuous-valued interventions. In Uncertainty in
Artificial Intelligence (UAI), 2017."
REFERENCES,0.35037593984962406,"Eric J Tchetgen Tchetgen and Ilya Shpitser. Semiparametric theory for causal mediation analysis:
efficiency bounds, multiple robustness, and sensitivity analysis. Annals of Statistics, 40(3):1816,
2012."
REFERENCES,0.3518796992481203,"Jessica Vamathevan, Dominic Clark, Paul Czodrowski, Ian Dunham, Edgardo Ferran, George Lee,
Bin Li, Anant Madabhushi, Parantu Shah, Michaela Spitzer, et al. Applications of machine learning
in drug discovery and development. Nature Reviews Drug Discovery, 18(6):463–477, 2019."
REFERENCES,0.3533834586466165,"Tyler J VanderWeele. Marginal structural models for the estimation of direct and indirect effects.
Epidemiology, 20(1):18–26, 2009."
REFERENCES,0.3548872180451128,"Tyler J VanderWeele and Eric J Tchetgen Tchetgen. Mediation analysis with time varying exposures
and mediators. Journal of the Royal Statistical Society Series B: Statistical Methodology, 79(3):
917–938, 2017."
REFERENCES,0.35639097744360904,"Stijn Vansteelandt, Martin Linder, Sjouke Vandenberghe, Johan Steen, and Jesper Madsen. Mediation
analysis of time-to-event endpoints accounting for repeatedly measured mediators subject to
time-varying confounding. Statistics in Medicine, 38(24):4828–4840, 2019."
REFERENCES,0.35789473684210527,"Christopher KI Williams and Carl Edward Rasmussen. Gaussian processes for machine learning,
volume 2. MIT press Cambridge, MA, 2006."
REFERENCES,0.3593984962406015,"Alan C Wittgrove, G Wesley Clark, and Laurier J Tremblay. Laparoscopic gastric bypass, Roux-en-Y:
preliminary report of five cases. Obesity surgery, 4(4):353–357, 1994."
REFERENCES,0.3609022556390977,"Patrick Wyatt, Sarah E Berry, Graham Finlayson, Ruairi O’Driscoll, George Hadjigeorgiou, David A
Drew, Haya Al Khatib, Long H Nguyen, Inbar Linenberg, Andrew T Chan, et al. Postprandial
glycaemic dips predict appetite and energy intake in healthy individuals. Nature Metabolism, 3(4):
523–529, 2021."
REFERENCES,0.362406015037594,"Yanbo Xu, Yanxun Xu, and Suchi Saria.
A Bayesian nonparametric approach for estimating
individualized treatment-response curves. In Machine Learning for Healthcare Conference, pages
282–300. PMLR, 2016."
REFERENCES,0.36390977443609024,"Shuxi Zeng, Stacy Rosenbaum, Susan C Alberts, Elizabeth A Archie, and Fan Li. Causal mediation
analysis for sparse and irregular longitudinal data. Annals of Applied Statistics, 15(2):747–767,
2021."
REFERENCES,0.36541353383458647,"Guangyi Zhang, Reza A. Ashrafi, Anne Juuti, Kirsi Pietiläinen, and Pekka Marttinen. Errors-in-
variables modeling of personalized treatment-response trajectories. IEEE J. Biomed. Health
Informatics, 25(1):201–208, 2021."
REFERENCES,0.3669172932330827,"Yizhou Zhang, Defu Cao, and Yan Liu. Counterfactual neural temporal point process for estimating
causal influence of misinformation on social media. Advances in Neural Information Processing
Systems, 35:10643–10655, 2022."
REFERENCES,0.3684210526315789,"Wenjing Zheng and Mark van der Laan. Longitudinal mediation analysis with time-varying mediators
and exposures, with application to survival outcomes. Journal of Causal Inference, 5(2), 2017."
REFERENCES,0.3699248120300752,"A
Causal Assumptions and Identifiability"
REFERENCES,0.37142857142857144,"A.1
Static Causal Mediation A M Y"
REFERENCES,0.37293233082706767,(a) Classical. A A→Y A→M M Y
REFERENCES,0.3744360902255639,(b) Interventionist.
REFERENCES,0.37593984962406013,"Figure 6:
Graphical models for
causal mediation. Mediation is de-
fined in (a) using nested counter-
factuals, while in (b) using path-
specific treatments A→M and A→Y ."
REFERENCES,0.3774436090225564,"Consider a structural causal model (SCM) with a treatment
A, a mediator M and an outcome Y (Fig. 6a). We define the
total causal effect (TE) of the treatment A on the outcome Y
as the difference between setting the treatment A to a target
treatment value ˜a and no treatment ∅[Pearl, 2009]:
TE(˜a) = Y [˜a] −Y [∅],
where we use the short-hand notation [˜a] to denote an interven-
tion: [˜a] ≡do(A = ˜a)."
REFERENCES,0.37894736842105264,"In many situations, the total effect does not capture the target
of the scientific investigation. For instance, in the surgery–diet–
glucose (treatment–mediator–outcome) example of Section
5.1, we examine how much of the surgery’s effect is due to
the post-surgery diet or the rest of the metabolic processes.
This question can be formulated as a causal (mediation) query,
where we estimate the indirect effect flowing through the medi-
ator M (A→M→Y ), separately from the direct effect flowing
through the path A→Y . To measure the effect of a specific path, one can devise a pair of inter-
ventions on the treatment A and the mediator M so that only the specific target path is ‘active’. A
straightforward implementation of this idea leads to the definition of the controlled direct effect [CDE,
Pearl, 2001]
CDE(˜a, ˜m) = Y [A = ˜a, M = ˜m] −Y [A = ∅, M = ˜m]
= Y [˜a, ˜m] −Y [∅, ˜m],
(11)
where [˜a, ˜m] denotes a pair of interventions on A and M: [˜a, ˜m] ≡do(A = ˜a, M = ˜m). The CDE
is intuitively defined in Eq. (11) as the difference of the outcome Y when the mediator M is fixed to
˜m while the treatment A is either ˜a or ∅. In the surgery–diet–glucose example, this corresponds to
the difference in the outcome Y while the patient is set to either (i) the surgery ˜a and a certain diet ˜m
or (ii) no surgery ∅and the same diet ˜m. Hence, CDE(˜a, ˜m) has a prescriptive interpretation as we
prescribe both A and M to external intervention values, in contrast to the attributive interpretation
that we are after to understand the underlying causal mechanisms [Pearl, 2001]."
REFERENCES,0.3804511278195489,"To understand the underlying causal mechanisms, we rather want to estimate the contribution of direct
and indirect paths to the total causal effect. To achieve this, Pearl [2001] defines the natural direct
effect (NDE) and the natural indirect effect (NIE). In natural effects, we devise a pair of interventions
such that it sets a target path to a target intervention value while keeping the other path fixed in
its natural state, i.e., the state that it would have attained without our external ‘do’-intervention.
Traditionally, the NDE and NIE are defined as a contrast between nested counterfactuals [Pearl, 2001].
Accordingly, the NDE is
NDE(˜a) = Y [A = ˜a, M = ˜m[A=∅]] −Y [A = ∅, M = ∅]"
REFERENCES,0.3819548872180451,"= Y [˜a, ˜m[A=∅]] −Y [∅, ∅],
(12)
where [˜a, ˜m[A=∅]] ≡do(A = ˜a, M = ˜mdo(A=∅)) denotes a pair of interventions on A and M,
where the treatment A is set to ˜a and the mediator M is set to ˜m[A=∅], the value M would have
attained without our doing any intervention on the treatment [A = ∅], i.e., no treatment. The
counterfactual outcome Y [˜a, ˜m[A=∅]] is called ‘nested’ since we set the treatment to two distinct
values ˜a and ∅for the same individual data point Y , which is not possible in a real-world scenario.
Similarly, the NIE is
NIE(˜a) = Y [A = ˜a, M = ˜m[A=˜a]] −Y [A = ˜a, M = ˜m[A=∅]]"
REFERENCES,0.38345864661654133,"= Y [˜a, ˜m[A=˜a]] −Y [˜a, ˜m[A=∅]].
(13)"
REFERENCES,0.3849624060150376,"The NDE and NIE with nested counterfactuals are identifiable under the following causal assumptions
[Pearl, 2001, 2014, Imai et al., 2010b]:
(SA1):
p(· | do(A = ˜a)) ≡p(· | A = ˜a),
(SA2):
Y [˜a1, ˜m] ⊥⊥M[˜a2]."
REFERENCES,0.38646616541353385,"The static assumption (SA1) states that there is no unobserved confounding (NUC) between the pairs
(A, M) and (A, Y ). Pearl [2014] interprets the static assumption (SA2) as the mediator–outcome
relationship is deconfounded while keeping the treatment A fixed. Under these assumptions, the
distribution of the counterfactual outcome Y [˜a, ˜m[A=∅]] can be written as follows [Pearl, 2001]:"
REFERENCES,0.3879699248120301,"P(Y [˜a, ˜m[A=∅]]) =
X"
REFERENCES,0.3894736842105263,"m∗
P(Y | A = ˜a, M = m∗)P(M = m∗| A = ∅).
(14)"
REFERENCES,0.39097744360902253,"A.2
Dynamic Causal Mediation (with a Single Intervention)"
REFERENCES,0.3924812030075188,"We extend the static definitions of natural direct and indirect effects by formulating them as stochastic
processes over a period [0, T]. This leads to a definition of dynamic causal mediation. For each
patient, we define (i) a treatment process A that occurs only once at time ta ∈[0, T], (ii) a mediator
process M that is observed at I irregularly-sampled time points: {(ti, mi)}I
i=1, and (iii) an outcome
process Y that is observed at J irregularly-sampled time points: {(tj, yj)}J
j=1. For a detailed
problem formulation, see Section 2.1."
REFERENCES,0.39398496240601505,"The identifiability in the nested-counterfactual based mediation is only possible if there exist no
post-treatment confounders, i.e., confounder variables between a mediator and an outcome must
not be causally affected by the treatment [Pearl, 2014]. However, in dynamic causal mediation,
past mediators and outcomes causally affect future mediators and outcomes. This means that a past
outcome measurement acts as a post-treatment confounder for a future mediator and a future outcome,
and the NDE and NIE are non-identifiable without further assumptions [Pearl, 2014, Didelez, 2019]."
REFERENCES,0.3954887218045113,"To work around the post-treatment confounding problem, Zeng et al. [2021] assume that there exists
no interaction from past outcomes to future mediators (See Fig. 2a). However, in a real-world
healthcare setup, the mediator and outcome processes most likely interact, e.g., past glucose levels
should affect future glucose levels as well as future meals. To overcome this limitation, we follow
an interventionist approach to the causal mediation [Robins et al., 2022], similar to Didelez [2019],
Aalen et al. [2020]. In this approach, we hypothetically duplicate the treatment A into two path-
specific treatments: the direct-path treatment A→Y and the indirect-path treatment A→M (Fig. 6b).
For instance, in the surgery–diet–glucose example, the direct-path treatment A→Y corresponds
to changing only the metabolic processes (other than the diet), without affecting the diet. Using
path-specific interventions A→M and A→Y , we define the NDE as
NDE(˜ta) ≡Y>˜ta[A→Y = ˜ta, A→M = ˜ta] −Y>˜ta[A→Y = ∅, A→M = ˜ta]"
REFERENCES,0.3969924812030075,"≡Y>˜ta[˜ta, ˜ta] −Y>˜ta[∅, ˜ta],
(15)
where Y [˜a1, ˜a2] is the potential outcome after setting the direct-path treatment A→Y to ˜a1 and the
indirect-path treatment A→M to ˜a2. Similarly, the NIE is defined as
NIE(˜ta) ≡Y>˜ta[A→Y = ∅, A→M = ˜ta] −Y>˜ta[A→Y = ∅, A→M = ∅]"
REFERENCES,0.39849624060150374,"≡Y>˜ta[∅, ˜ta] −Y>˜ta[∅, ∅].
(16)
Accordingly, we define the total effect as follows
TE(˜ta) = NDE(˜ta) + NIE(˜ta) = Y>˜ta[˜ta, ˜ta] −Y>˜ta[∅, ∅].
(17)"
REFERENCES,0.4,"A.2.1
Causal Assumptions"
REFERENCES,0.40150375939849625,"To identify the NDE and the NIE, we make the causal assumptions (A1, A2, A3):"
REFERENCES,0.4030075187969925,"Assumption A1: Continuous-time NUC.
There are no unobserved confounders (NUC) between
the treatment–mediator process pair (A, M) and the treatment–outcome process pair (A, Y ), i.e.,
the treatment is randomized. Hence, the interventional distribution of a treatment intervention and
the conditional distribution of those who got treated are equivalent:"
REFERENCES,0.4045112781954887,"p(· | do(A = ˜
NA)) ≡p(· | A = ˜
NA).
(18)"
REFERENCES,0.40601503759398494,"Assumption A2: Local Independence of Mediator M and a Single Direct-Path Treatment
A→Y .
Conditioned on the history H<τ of the mediator and outcome processes up until time τ, the
mediator process M is independent of the direct-path treatment A→Y locally at time τ, for all times
τ ∈[0, T]:
A→Y ⊥⊥M(τ) | A→M, H<τ,
τ ∈[0, T].
(19)
Hence, there are no direct arrows from the direct-path treatment A→Y to the mediator process M."
REFERENCES,0.4075187969924812,"Assumption A3: Local Independence of Outcome Y and a Single Indirect-Path Treatment
A→M.
Conditioned on the history H<τ of the mediator and outcome processes up until time τ, the
outcome process Y (τ) is independent of the indirect-path treatment A→M locally at time τ, for all
time τ ∈[0, T]:
A→M ⊥⊥Y (τ) | A→Y , H<τ,
τ ∈[0, T].
(20)
Hence, there are no direct arrows from the indirect-path treatment A→M to the outcome process Y ."
REFERENCES,0.40902255639097745,"The static version of the NUC assumption in (A1) is common in the existing literature on longitudinal
causal mediation [Didelez, 2019, Aalen et al., 2020]. Here, we define it as a continuous-time
NUC [Schulam and Saria, 2017] for completeness, as we also define the treatment A as a process
in Section 2.1. (A2, A3) state that the path-specific treatments A→Y and A→M causally affect
only their target path for a given time τ conditioned on the past history. They can be seen as
the continuous-time generalizations of the similar causal assumptions provided for discrete-time
mediator–outcome measurements (M1, Y1, M2, Y2, . . . , Mn, Yn) in Didelez [2019] and Aalen et al.
[2020]. An interesting connection is between (A2, A3) and the notion of local independence [Didelez,
2006, 2008, 2015], a dynamic interpretation of independence that is the continuous-time version of
Granger causality [Granger, 1969]. In this regard, (A2, A3) state that the processes M and Y are
locally independent of the direct- and indirect-path treatments A→Y and A→M respectively, given the
history of the rest of the processes. Furthermore, (A2, A3) imply that there are no (continuous-time)
unobserved confounders between the mediator and outcome processes, otherwise an unobserved
confounder between them would render the process Y (or M) and A→M (or A→Y ) dependent as
we condition on the past history (See Didelez [2019] for a detailed explanation)."
REFERENCES,0.4105263157894737,"A.2.2
Proof of the Identifiability Result"
REFERENCES,0.4120300751879699,"For the total effect, we need to estimate the trajectories Y>˜ta[˜ta, ˜ta] and Y>˜ta[∅, ∅], which are
identifiable under (A1). For direct and indirect effects, we further need to estimate the counterfactual
trajectory Y>˜ta[∅, ˜ta], i.e., the outcome process under a hypothetical intervention, which is identifi-
able under (A1, A2, A3). In the following, we show the identification result for the outcome process
under a hypothetical intervention Y>˜ta[∅, ˜ta], since it is a generalization of the ‘factual’ trajectories
Y>˜ta[˜ta, ˜ta] and Y>˜ta[∅, ∅]."
REFERENCES,0.41353383458646614,"We consider a counterfactual trajectory Y>˜ta under a paired intervention, e.g. [∅, ˜ta], at R ordered
query points q = {qr}R
r=1, qr > ˜ta: Yq[∅, ˜ta] = {Y (qr)[∅, ˜ta]}R
r=1. We start by explicitly writing
the interventional trajectory in do-notation:"
REFERENCES,0.4150375939849624,"P(Yq[∅, ˜ta]) = P(Yq | do(tA→Y = ∅, tA→M = ˜ta))."
REFERENCES,0.41654135338345866,"Let M[qr,qr+1) denote the mediator occurrences between two consecutive query points qr and qr+1 and
M>˜ta = ∪R−1
r=0 M[qr,qr+1). We include the mediator process M>˜ta to the counterfactual trajectory
Yq[∅, ˜ta], and write the conditional distributions of Yq and M>˜ta using a factorization in temporal
order:"
REFERENCES,0.4180451127819549,"P(Yq[∅, ˜ta]) =
X M>˜ta R−1
Y"
REFERENCES,0.4195488721804511,"r=0
P(Yqr+1| do(tA→Y = ∅, tA→M = ˜ta), M[qr,qr+1), H≤qr)"
REFERENCES,0.42105263157894735,"P(M[qr,qr+1)| do(tA→Y = ∅, tA→M = ˜ta), H≤qr),
(21)"
REFERENCES,0.42255639097744363,"where q0 = ˜ta and H≤qr denotes the history that contains the past information on the path-specific
treatments (A→M,A→Y ) and past mediators up to (non-inclusive) qr, and past outcomes up until
(inclusive) qr: H≤qr = A→M ∪A→Y ∪{(ti, mi) : ti < qr} ∪{(tj, yj) : tj ≤qr}."
REFERENCES,0.42406015037593986,"(A3) states that the outcome Y (qr+1) is independent of the indirect-path treatment A→M conditioned
on the past history H<qr+1 including the direct-path treatment A→Y . Hence, we can change the
value of the intervention on tA→M without changing the first conditional distribution term in Eq. (21).
Using (A3), we re-write Eq. (21) as"
REFERENCES,0.4255639097744361,"P(Yq[∅, ˜ta]) =
X M>˜ta R−1
Y"
REFERENCES,0.4270676691729323,"r=0
P(Yqr+1| do(tA→Y = ∅, tA→M = ∅), M[qr,qr+1), H≤qr)"
REFERENCES,0.42857142857142855,"P(M[qr,qr+1)| do(tA→Y = ∅, tA→M = ˜ta), H≤qr).
(22)"
REFERENCES,0.43007518796992483,"Similarly, (A2) states that the mediators M[qr,qr+1) are independent of the direct-path treatment A→Y
conditioned on the past history H<qr including the indirect-path treatment A→M. Using (A2), we
re-write Eq. (22) as"
REFERENCES,0.43157894736842106,"P(Yq[∅, ˜ta]) =
X M>˜ta R−1
Y"
REFERENCES,0.4330827067669173,"r=0
P(Yqr+1| do(tA→Y = ∅, tA→M = ∅), M[qr,qr+1), H≤qr)"
REFERENCES,0.4345864661654135,"P(M[qr,qr+1)| do(tA→Y = ˜ta, tA→M = ˜ta), H≤qr).
(23)"
REFERENCES,0.43609022556390975,"In Eq. (23), the target quantities are considered under ‘factual’ intervention pairs:"
REFERENCES,0.43759398496240604,"do(tA→Y = ∅, tA→M = ∅) ≡do(tA = ∅),
(24)"
REFERENCES,0.43909774436090226,"do(tA→Y = ˜ta, tA→M = ˜ta) ≡do(tA = ˜ta).
(25)"
REFERENCES,0.4406015037593985,"Using Eqs. (24) and (25), we can simplify Eq. (23) as follows:"
REFERENCES,0.4421052631578947,"P(Yq[∅, ˜ta]) =
X M>˜ta R−1
Y"
REFERENCES,0.44360902255639095,"r=0
P(Yqr+1| do(tA = ∅), M[qr,qr+1), H≤qr)"
REFERENCES,0.44511278195488724,"P(M[qr,qr+1)| do(tA = ˜ta), H≤qr).
(26)"
REFERENCES,0.44661654135338347,"In Eq. (26), both terms in the product correspond to the mediator and outcome processes under the
interventions [∅] and [˜ta] respectively. These interventional distributions are identified under (A1),
as it states that there are no unobserved confounders between the process pairs (A, M) and (A, Y ).
Using (A1) on Eq. (26), we obtain the final identification result:"
REFERENCES,0.4481203007518797,"P(Yq[∅, ˜ta]) =
X M>˜ta R−1
Y"
REFERENCES,0.4496240601503759,"r=0
P(Yqr+1|tA = ∅, M[qr,qr+1), H≤qr)
|
{z
}
outcome term"
REFERENCES,0.45112781954887216,"P(M[qr,qr+1)|tA = ˜ta, H≤qr)
|
{z
}
mediator intensity . (27)"
REFERENCES,0.45263157894736844,"To estimate the direct and indirect effects, we model the two terms in Eq. (27) with an interacting
mediator–outcome model."
REFERENCES,0.45413533834586467,"A.3
Dynamic Causal Mediation (Generalization to a Treatment Sequence)"
REFERENCES,0.4556390977443609,"In this section, we extend the dynamic causal mediation definitions to multiple treatments. To achieve
this, we define the treatment as a non-binary, non-unitary process A : [0, T] →N × {R ∪{∅}}
similar to the mediator process M. Here, the difference between two processes A and M is that we
consider A to be a known, deterministic sequence, while M to be unknown and stochastic. Hence,
we assume that the treatment process A is given as a sequence a = {an}N
n=1, where each treatment
an = (tn, dn) is a tuple of a treatment time tn ∈[0, T] and a treatment type/dosage marker dn ∈A.
The type/dosage space can be chosen as a discrete space A = Z representing a set of treatment types,
a continuous space A = R representing a set of dosages, or a combination of both spaces A = N×R."
REFERENCES,0.45714285714285713,"We again hypothetically duplicate the treatment process A into two path-specific treatment sequences:
the direct-path treatments A→Y and the indirect-path treatments A→M (Fig. 6b). Using path-specific
interventions A→M and A→Y , we define the NDE as"
REFERENCES,0.45864661654135336,"NDE(˜a1, ˜a0) ≡Y>˜ta[A→Y = ˜a1, A→M = ˜a1] −Y>˜ta[A→Y = ˜a0, A→M = ˜a1]"
REFERENCES,0.46015037593984964,"≡Y>˜ta[˜a1, ˜a1] −Y>˜ta[˜a0, ˜a1],
(28)"
REFERENCES,0.4616541353383459,"where Y [˜a0, ˜a1] is the potential outcome after setting the direct-path treatment sequence
A→Y
to ˜a0 = {a0,1, a0,2, . . . , a0,N0} and the indirect-path treatment sequence A→M
to
˜a1 = {a1,1, a1,2, . . . , a1,N1}. Similarly, the NIE is defined as"
REFERENCES,0.4631578947368421,"NIE(˜a1, ˜a0) ≡Y>˜ta[A→Y = ˜a0, A→M = ˜a1] −Y>˜ta[A→Y = ˜a0, A→M = ˜a0]"
REFERENCES,0.46466165413533833,"≡Y>˜ta[˜a0, ˜a1] −Y>˜ta[˜a0, ˜a0].
(29)"
REFERENCES,0.46616541353383456,"Accordingly, we define the total effect as follows"
REFERENCES,0.46766917293233085,"TE(˜a1, ˜a0) = NDE(˜a1, ˜a0) + NIE(˜a1, ˜a0) = Y>˜ta[˜a1, ˜a1] −Y>˜ta[˜a0, ˜a0].
(30)"
REFERENCES,0.4691729323308271,"A.3.1
Causal Assumptions"
REFERENCES,0.4706766917293233,"To identify the NDE and the NIE, we make the causal assumptions (A4, A5, A6):"
REFERENCES,0.47218045112781953,"Assumption A4: Continuous-time NUC [Hızlı et al., 2023]. Let sequential treatments a occur at
a discrete set of time points on a given interval, characterized by the conditional intensity function
λ∗
a(t, d). The conditional treatment intensity λ∗
a(t, d) of a treatment a = (t, d), is independent of
the potential outcome trajectory Y>τ[˜a], conditioned on the past history H<τ, ∀t ∈R≥0, where the
history H<τ contains the past treatments, mediators and outcomes."
REFERENCES,0.47368421052631576,"Assumption A5: Local Independence of Mediator M and Direct-Path Treatment A→Y .
Con-
ditioned on the indirect-path treatment process A→M
<τ
and the history H<τ of the mediator and
outcome processes up until time τ, the mediator process M is independent of the history of the
direct-path treatment A→Y
<τ locally at time τ, for all times τ ∈[0, T]:"
REFERENCES,0.47518796992481205,"A→Y
<τ ⊥⊥M(τ) | A→M
<τ , H<τ,
τ ∈[0, T].
(31)
Hence, there are no direct arrows from the direct-path treatment A→Y to the mediator process M."
REFERENCES,0.4766917293233083,"Assumption A6: Local Independence of Outcome Y and Indirect-Path Treatment A→M.
Conditioned on the indirect-path treatment process A→Y
<τ and the history H<τ of the mediator and
outcome processes up until time τ, the outcome process Y (τ) is independent of the past of the
indirect-path treatment A→M
<τ
locally at time τ, for all time τ ∈[0, T]:"
REFERENCES,0.4781954887218045,"A→M
<τ
⊥⊥Y (τ) | A→Y
<τ , H<τ,
τ ∈[0, T].
(32)
Hence, there are no direct arrows from the indirect-path treatment A→M to the outcome process Y ."
REFERENCES,0.47969924812030074,"Assumptions (A5, A6) define the local independence with respect to the past sequences of the direct-
and indirect-path treatment processes A→Y
<τ and A→M
<τ . This is in contrast with the definitions of
Assumptions (A2, A3), where we only have a single treatment."
REFERENCES,0.48120300751879697,"A.3.2
Proof of the Identifiability Result"
REFERENCES,0.48270676691729325,"For the total effect, we need to estimate the trajectories Y>˜ta[˜a1, ˜a1] and Y>˜ta[˜a0, ˜a0], which are
identifiable under (A4). For direct and indirect effects, we further need to estimate the counterfactual
trajectory Y>˜ta[˜a0, ˜a1], i.e., the outcome process under a hypothetical intervention, which is identifi-
able under (A4, A5, A6). In the following, we show the identification result for the outcome process
under a hypothetical intervention Y>˜ta[˜a0, ˜a1], since it is a generalization of the ‘factual’ trajectories
Y>˜ta[˜a1, ˜a1] and Y>˜ta[˜a0, ˜a0]."
REFERENCES,0.4842105263157895,"We consider a counterfactual trajectory Y>˜ta under a paired intervention, e.g. [˜a0, ˜a1], at R ordered
query points q = {qr}R
r=1, qr > ˜ta: Yq[˜a0, ˜a1] = {Y (qr)[˜a0, ˜a1]}R
r=1. We again start by explicitly
writing the interventional trajectory in do-notation:"
REFERENCES,0.4857142857142857,"P(Yq[∅, ˜ta]) = P(Yq | do(A→Y = ˜a0, A→M = ˜a1)).
Similar to the analysis with a single intervention in Appendix A.2.2, we define M>˜ta
=
∪R−1
r=0 M[qr,qr+1) and write the conditional distributions of Yq and M>˜ta using a factorization in
temporal order:"
REFERENCES,0.48721804511278194,"P(Yq[˜a0, ˜a1]) =
X M>˜ta R−1
Y"
REFERENCES,0.48872180451127817,"r=0
P(Yqr+1| do(A→Y = ˜a0, A→M = ˜a1), M[qr,qr+1), H≤qr)"
REFERENCES,0.49022556390977445,"P(M[qr,qr+1)| do(A→Y = ˜a0, A→M = ˜a1), H≤qr),
(33)"
REFERENCES,0.4917293233082707,"where q0 = ˜ta and H≤qr denotes the history that contains the past information on the path-specific
treatments (A→M,A→Y ) and past mediators up to (non-inclusive) qr, and past outcomes up until
(inclusive) qr: H≤qr = A→M
≤qr ∪A→Y
≤qr ∪{(ti, mi) : ti < qr} ∪{(tj, yj) : tj ≤qr}."
REFERENCES,0.4932330827067669,"Let us start with the first term P(Yqr+1| do(A→Y = ˜a0, A→M = ˜a1), M[qr,qr+1), H≤qr). We know
that the outcome Yqr+1 at time point qr+1 is independent of any future interventions:"
REFERENCES,0.49473684210526314,"P(Yqr+1| do(A→Y = ˜a0, A→M = ˜a1), M[qr,qr+1), H≤qr) ="
REFERENCES,0.49624060150375937,"= P(Yqr+1| do(A→Y
<qr+1 = ˜a0,<qr+1, A→M
<qr+1 = ˜a1,<qr+1), M[qr,qr+1), H≤qr).
(34)"
REFERENCES,0.49774436090225566,"(A6) now states that the outcome Y (qr+1) is independent of the past of the indirect-path treatment
A→M
<qr+1 conditioned on the past history H<qr+1 including the past of the direct-path treatment
A→Y
<qr+1. Hence, we can change the value of the intervention on A→M
<qr+1 without changing probability
of the conditional term in Eq. (34). Using (A6), we re-write Eq. (34) as"
REFERENCES,0.4992481203007519,"P(Yqr+1| do(A→Y
<qr+1 = ˜a0,<qr+1, A→M
<qr+1 = ˜a1,<qr+1), M[qr,qr+1), H≤qr)"
REFERENCES,0.5007518796992482,"= P(Yqr+1| do(A→Y
<qr+1 = ˜a0,<qr+1, A→M
<qr+1 = ˜a0,<qr+1), M[qr,qr+1), H≤qr).
(35)"
REFERENCES,0.5022556390977444,"Let us continue with the mediator term P(M[qr,qr+1)| do(A→Y = ˜a0, A→M = ˜a1), H≤qr). The
steps will be similar to the discussion above, with one difference: there might be interventions
˜a[qr,qr+1) in the interval [qr, qr+1). Without loss of generality, let us assume there is only a single
intervention ap = (tp, dp) in the interval tp ∈[qr, qr+1). Then, we consider the mediator term in
two parts, namely up to tp and after tp:"
REFERENCES,0.5037593984962406,"P(M[qr,qr+1)| do(A→Y = ˜a0, A→M = ˜a1), H≤qr)"
REFERENCES,0.5052631578947369,"=P(M[qr,tp]| do(A→Y = ˜a0, A→M = ˜a1), H≤qr)"
REFERENCES,0.5067669172932331,"P(M(tp,qr+1)| do(A→Y = ˜a0, A→M = ˜a1), M[qr,tp], H≤qr)
(36)"
REFERENCES,0.5082706766917293,"We know that the mediators M[qr,tp] and M(tp,qr+1) are independent of any future interventions:"
REFERENCES,0.5097744360902255,"P(M[qr,tp]| do(A→Y = ˜a0, A→M = ˜a1), H≤qr)"
REFERENCES,0.5112781954887218,"=P(M[qr,tp]| do(A→Y
<qr = ˜a0,<qr, A→M
<qr = ˜a1,<qr), H≤qr)
(37)"
REFERENCES,0.512781954887218,"P(M(tp,qr+1)| do(A→Y = ˜a0, A→M = ˜a1), M[qr,tp), H≤qr)"
REFERENCES,0.5142857142857142,"=P(M(tp,qr+1)| do(A→Y
≤tp = ˜a0,≤tp, A→M
≤tp = ˜a1,≤tp), M[qr,tp], H≤qr)
(38)"
REFERENCES,0.5157894736842106,"(A5) states that the mediator M[qr,tp] (and M(tp,qr+1)) is independent of the direct-path treatment
A→Y
<qr conditioned on the past history H<qr including the indirect-path treatment A→M
<qr . Using (A5),
we re-write Eq. (37) and Eq. (38) as"
REFERENCES,0.5172932330827068,"P(M[qr,tp]| do(A→Y
<qr = ˜a0,<qr, A→M
<qr = ˜a1,<qr), H≤qr)"
REFERENCES,0.518796992481203,"= P(M[qr,tp]| do(A→Y
<qr = ˜a1,<qr, A→M
<qr = ˜a1,<qr), H≤qr)
(39)"
REFERENCES,0.5203007518796993,"P(M(tp,qr+1)| do(A→Y
≤tp = ˜a0,≤tp, A→M
≤tp = ˜a1,≤tp), M[qr,tp], H≤qr)"
REFERENCES,0.5218045112781955,"= P(M(tp,qr+1)| do(A→Y
≤tp = ˜a1,≤tp, A→M
≤tp = ˜a1,≤tp), M[qr,tp], H≤qr).
(40)"
REFERENCES,0.5233082706766917,"Using Eqs. (35), (39) and (40), we re-write Eq. (33) as"
REFERENCES,0.524812030075188,"P(Yq[˜a0, ˜a1]) =
X M>˜ta R−1
Y"
REFERENCES,0.5263157894736842,"r=0
P(Yqr+1| do(A→Y
<qr+1 = ˜a0,<qr+1, A→M
<qr+1 = ˜a0,<qr+1), M[qr,qr+1), H≤qr)"
REFERENCES,0.5278195488721804,"P(M[qr,tp]| do(A→Y
<qr = ˜a1,<qr, A→M
<qr = ˜a1,<qr), H≤qr)"
REFERENCES,0.5293233082706766,"P(M(tp,qr+1)| do(A→Y
≤tp = ˜a1,≤tp, A→M
≤tp = ˜a1,≤tp), M[qr,tp], H≤qr).
(41)"
REFERENCES,0.530827067669173,"In Eqs. (35), (39) and (40), the target quantities are considered under ‘factual’ intervention pairs:"
REFERENCES,0.5323308270676692,"do(A→Y
<τ = ˜a0,<τ, A→M
<τ
= ˜a0,<τ) ≡do(A<τ = ˜a0,<τ),
(42)"
REFERENCES,0.5338345864661654,"do(A→Y
<τ = ˜a1,<τ, A→M
<τ
= ˜a1,<τ) ≡do(A<τ = ˜a1,<τ).
(43)"
REFERENCES,0.5353383458646617,"Using Eqs. (42) and (43), we can simplify Eq. (41) as follows:"
REFERENCES,0.5368421052631579,"P(Yq[˜a0, ˜a1]) =
X M>˜ta R−1
Y"
REFERENCES,0.5383458646616541,"r=0
P(Yqr+1| do(˜a0,<qr+1), M[qr,qr+1), H≤qr)"
REFERENCES,0.5398496240601504,"P(M[qr,tp]| do(˜a1,<qr), H≤qr)"
REFERENCES,0.5413533834586466,"P(M(tp,qr+1)| do(˜a1,≤tp), M[qr,tp], H≤qr).
(44)"
REFERENCES,0.5428571428571428,"In Eq. (44), both terms in the product correspond to the mediator and outcome processes under the
interventions [˜a0] and [˜a1] respectively. These interventional distributions are identified under (A4),
as it states that there are no unobserved confounders between the process pairs (A, M) and (A, Y ).
Using (A4) on Eq. (44), we obtain the final identification result:"
REFERENCES,0.544360902255639,"P(Yq[˜a0, ˜a1]) =
X M>˜ta R−1
Y"
REFERENCES,0.5458646616541354,"r=0
P(Yqr+1|A = ˜a0,<qr+1, M[qr,qr+1), H≤qr)
|
{z
}
outcome term
P(M[qr,tp]|A = ˜a1,<qr, H≤qr)P(M(tp,qr+1)|A = ˜a1,≤tp, M[qr,tp], H≤qr)
|
{z
}
mediator intensity . (45)"
REFERENCES,0.5473684210526316,"To estimate the direct and indirect effects, now the joint mediator–outcome model needs to take the
treatment history ˜a into account."
REFERENCES,0.5488721804511278,"B
Interacting Mediator–Outcome Model"
REFERENCES,0.5503759398496241,"Our interacting mediator–outcome model builds on marked point processes [MPP, Daley and Vere-
Jones, 2003] and Gaussian processes [GP, Williams and Rasmussen, 2006]. Hence, we first introduce
MPPs (B.1) and GPs (B.2). We describe our model in detail in B.3 and discuss learning and inference
in B.4. Finally, we discuss computational complexity and scalability of our model in B.5."
REFERENCES,0.5518796992481203,"B.1
Marked Point Processes"
REFERENCES,0.5533834586466165,"A temporal point process (TPP) is a stochastic process that models continuous-time event sequences,
e.g., a sequence of treatment times D = {ti}I
i=1 over a period [0, T] [Daley and Vere-Jones, 2003,
Rasmussen, 2011]. A TPP can be represented by a counting process N : [0, T] →Z≥0, which
outputs the number of points until time τ: N(τ) = PN
i=1 1[ti ≤τ]. We assume that there
can be at most one point in an infinitesimal interval [τ −∆τ, τ]: ∆N ∈{0, 1}, where ∆N =
lim∆τ↓0(N(τ) −N(τ −∆τ)). The counting process N(τ), and hence the change ∆N, can be
decomposed into a predictable compensator function E[N(τ)] = Λ(τ) and a zero-mean noise process
(martingale) U(τ) by the Doob–Meyer theorem [Didelez, 2008]:"
REFERENCES,0.5548872180451128,"N(τ) = Λ(τ) + U(τ)
(46)"
REFERENCES,0.556390977443609,"Using the Doob–Meyer decomposition, a TPP can be uniquely determined by the expected rate
of change in its counting process: E[∆N | H<τ] = ∆Λ | H<τ = λ∗(τ) dτ, where the function
λ∗(τ) = λ(τ | H<τ) is called the conditional intensity function and the star superscript is shorthand
notation for the dependence on the history H<τ = {ti : ti < τ, i = 1, . . . , I}."
REFERENCES,0.5578947368421052,"When a temporal point carries additional information (mark, m), e.g., a sequence of treatment times
and dosages D = {(ti, mi)}I
i=1, we model a sequence of time–mark pairs using a marked point
process (MPP). Accordingly, the conditional intensity function λ∗(t, m) is extended such that it
includes the mark intensity: λ∗(t, m) = λ∗(t)λ∗(m | t). Using the conditional intensity function,
we can write the joint distribution of D as follows [Rasmussen, 2011]:"
REFERENCES,0.5593984962406015,p(D) = IY
REFERENCES,0.5609022556390978,"i=1
λ∗(mi | ti)λ∗(ti) exp  −
Z T"
REFERENCES,0.562406015037594,"0
λ∗(τ)dτ !"
REFERENCES,0.5639097744360902,".
(47)"
REFERENCES,0.5654135338345865,"B.2
Gaussian Processes"
REFERENCES,0.5669172932330827,"A Gaussian process [GP, Williams and Rasmussen, 2006] describes a prior distribution GP over a
continuous-valued function f : RD →R:"
REFERENCES,0.5684210526315789,"f(·) ∼GP(µ(·), k(·, ·′)),
(48)"
REFERENCES,0.5699248120300752,"where a mean function µ : RD →R represents the expectation µ(·) = E[f(·)], and a symmetric
positive-definite kernel function k : RD × RD →R represents the covariance k(·, ·′) = cov(·, ·′). In
practice, we do not deal with infinite-sized distributions, rather we only consider evaluations of the"
REFERENCES,0.5714285714285714,"GP at a finite number of input points. The GP prior f(x) of any subset of N data points x ∈RN×D
follows a joint Gaussian distribution:"
REFERENCES,0.5729323308270676,"f(x) = f ∼N(µx, Kxx),
(49)"
REFERENCES,0.5744360902255639,"where the mean µx = µ(x) ∈RN is obtained by evaluating the mean function µ(·) at N input points
and the covariance matrix Kxx = k(x, x′) ∈RN×N is obtained by evaluating the kernel function
k(·, ·′) at N × N input pairs. Commonly, we assume zero mean µx = 0."
REFERENCES,0.5759398496240602,"For a given set of N training points x and N∗test points x∗, we can use the joint Gaussian property
of GPs and write the joint distribution of f = f(x) and f∗= f(x∗):

f
f∗"
REFERENCES,0.5774436090225564,"
∼N

0,

Kxx
Kxx∗
Kx∗x
Kx∗x∗"
REFERENCES,0.5789473684210527,"
,
(50)"
REFERENCES,0.5804511278195489,"where the cross-covariance matrix Kxx∗∈RN×N∗is obtained by evaluating the kernel function at
N × N∗input pairs. Using the conditional distribution identities of the Gaussian distribution, we
write the posterior distribution p(f∗| f):"
REFERENCES,0.5819548872180451,"f∗| f ∼N(Kx∗xK−1
xx f, Kx∗x∗−Kx∗xK−1
xx Kxx∗).
(51)"
REFERENCES,0.5834586466165413,"Taking the inverse of a matrix is computationally expensive. Its computational complexity is O(N 3),
which is unfeasible for large data sets. To make the GP inference scalable, one common method is to
use inducing point approximations [Quiñonero Candela and Rasmussen, 2005]. For this, we choose
a set of M inducing variables u = f(z) ∈RM evaluated at M inducing points z ∈RM×D, where
M ≪N. Using the same conditional Gaussian identity, we can write the conditional distribution of
the function f conditioned on the inducing variables u as follows"
REFERENCES,0.5849624060150376,"f | u ∼N(KxzK−1
zz u, Kxx −KxzK−1
zz Kzx),
(52)"
REFERENCES,0.5864661654135338,where the inverse is now only required of a much smaller matrix Kzz ∈RM×M.
REFERENCES,0.58796992481203,"B.3
Model Definition"
REFERENCES,0.5894736842105263,"For the joint model definition, we extend a non-parametric mediator–outcome model [Hızlı et al.,
2023] to include an external intervention A that jointly affects both mediators and outcomes. Similar
to Hızlı et al. [2023], we combine an MPP and a conditional GP to model the interacting mediator–
outcome processes. The binary value of the treatment process A(τ) ∈{0, 1} acts as a regime
indicator, which specifies whether the treatment is active or not. The structural causal model for the
treatment process A, the mediator process M, and the outcome process Y can be written as follows:"
REFERENCES,0.5909774436090226,"A(τ) := 1{τ ≥˜ta} ∈{0, 1},"
REFERENCES,0.5924812030075188,"M(τ) := f (a)
M (τ, H<τ) + U (a)
M (τ),
(53)"
REFERENCES,0.5939849624060151,"Y (τ) := f (a)
Y (τ, H<τ) + U (a)
Y (τ),
(54)"
REFERENCES,0.5954887218045113,"where τ ∈[0, T], UM(τ) is a zero-mean noise process, and UY (τ) is a zero mean Gaussian noise.
Eqs. (53) and (54) capture the mediator term ( ) and the outcome term ( ) in Eq. (27) respectively.
The mediator and outcome terms are detailed in Appendices B.3.1 and B.3.2 for a single regime a,
since we use equivalent model definitions for both pre- and post-intervention regimes."
REFERENCES,0.5969924812030075,"B.3.1
Mediator Intensity"
REFERENCES,0.5984962406015037,"Considering Eq. (53) as the Doob–Meyer decomposition of the mediator process, we can interpret the
function fM(·, ·) as the compensator function Λ∗(·), and the noise UM as a zero-mean martingale.
Hence, we parameterize the function fM(·, ·) by a conditional intensity function λ∗(τ), where fM(·, ·)
is equivalent to the integral of λ∗(τ): fM(τ, H<τ) = Λ∗(τ) =
R"
REFERENCES,0.6,"[0,T ]×R λ(τ, m | H<τ)dτdm."
REFERENCES,0.6015037593984962,"The conditional intensity function λ(ti, mi | H<ti) consists of two main components: the mediator
time intensity λ(ti | H<ti) and the mediator dosage intensity λ(mi | ti, H<ti): λ(ti, mi | H<ti) =
λ(ti | H<ti)λ(mi | ti, H<ti). The dosage intensity is modeled as a simple GP prior with Matern-
1/2 kernel that does not depend on the history H<ti and takes the absolute time as input: λ(mi |
ti, H<ti) = λ(mi | ti) ∼GP."
REFERENCES,0.6030075187969924,"We model the mediator time intensity λ(ti | H<ti) using three independent components {β0, gm, go}
similar to Hızlı et al. [2023], where the constant β0 serves as a simple Poisson process baseline, the
time-dependent function gm captures the dependence on the past mediators, and the time-dependent
function go captures the dependence on the past outcomes. We assume the effects of these components
as additive, and their sum is squared to ensure non-negativity:"
REFERENCES,0.6045112781954888,"λ(τ | H<τ) =
 
β0
|{z}
PP
baseline"
REFERENCES,0.606015037593985,"+ gm(τ; m)
|
{z
}
mediator
effect"
REFERENCES,0.6075187969924812,"+ go(τ; o)
| {z }
outcome
effect"
REFERENCES,0.6090225563909775,"2.
(55)"
REFERENCES,0.6105263157894737,"The mediator effect function gm(τ; m) captures the dependence on the past mediators, e.g., the
intensity should decrease just after a meal as the patient is unlikely to eat at this moment. For this, it
regresses on the relative times of the last Qm mediators that occurred before time τ: (τ −t1, . . . , τ −
tQm), where tq < τ for q ∈1, . . . , Qm, with gm : RQm
≥0 →R [Liu and Hauskrecht, 2019, Hızlı et al.,
2023]. It is modeled as a GP prior gm ∼GP. Its input has Qm dimensions, where each dimension q
is modeled independently by a squared exponential (SE) kernel: kgm(·, ·) = PQm
q=1 k(q)
SE (·, ·)."
REFERENCES,0.6120300751879699,"The outcome effect function gm(τ; m) captures the dependence on the past outcomes, e.g., the
intensity should decrease when the blood glucose is high due to a previous meal. For this, it regresses
on the relative times of the last Qo outcomes that occurred before time τ: (τ−t1, y1, . . . , τ−tQo, yQo),
where tq < τ for q ∈1, . . . , Qo, with go : {R≥0 × R}Qo →R [Hızlı et al., 2023]. It is modeled as a
GP prior go ∼GP. Its input has Qo×2 dimensions, where Qo dimensions are modeled independently.
Each dimension q ∈1, . . . , Qo has a 2-dimensional SE kernel: kgo(·, ·) = PQ
q=1 k(q)
SE (·, ·): the first
axis represents the relative-time input and the second axis represents the measurement value, e.g.,
glucose levels. For more details on the non-parametric point process model, see Hızlı et al. [2023]."
REFERENCES,0.6135338345864662,"B.3.2
Outcome Model"
REFERENCES,0.6150375939849624,"For Eq. (54), we model the function fY (·, ·) using two components: (i) a baseline function fb(τ)
that is independent of the history (past mediators) and (ii) a mediator response function fm(·, ·) that
captures the outcome response due to a mediator occurrence [Schulam and Saria, 2017, Cheng et al.,
2020, Hızlı et al., 2023]. Together with the independent, zero-mean Gaussian noise uY ∼N(0, σ2
Y ),
we can write Eq. (54) as follows:"
REFERENCES,0.6165413533834586,"Y (τ) = fb(τ)
| {z }
baseline"
REFERENCES,0.6180451127819548,"+ fm(τ; m)
|
{z
}
mediator response"
REFERENCES,0.6195488721804512,"+ uY (τ)
| {z }
noise"
REFERENCES,0.6210526315789474,".
(56)"
REFERENCES,0.6225563909774436,"The baseline function has a GP prior fb ∼GP. Its kernel is a sum of a constant and a periodic (PER)
kernel kb(·, ·) = kCONST(·, ·) + kPER(·, ·). The mediator response function fm models the dependence
of the future outcomes on the past mediators. We assume that the effect of the past mediators is
additive, and the magnitude and the shape of the response are factorized as follows:"
REFERENCES,0.6240601503759399,"fm(τ; m) =
X"
REFERENCES,0.6255639097744361,"i:ti≤τ
l(mi)f 0
m(τ −ti),
(57)"
REFERENCES,0.6270676691729323,"where (i) the magnitude of the response depends on the mark mi through the linear function l(mi),
and (ii) the shape of the response depends on the relative time τ −ti through a GP prior f 0
m ∼GP
that has a SE kernel: km(·, ·) = kSE(·, ·). We ensure that a future mediator does not affect a past
outcome by using a ‘time-marked’ kernel [Cunningham et al., 2012] where the output of the kernel
is set to zero if the relative time input is negative, i.e., the mediator has occurred after the outcome,
similar to Cheng et al. [2020], Hızlı et al. [2023]. Besides, we assume that the mediator has a causal
effect on the outcome for an effective period Teff, e.g., the glucose response of a meal takes place in
the next 3 h [Wyatt et al., 2021]. For more details on the non-parametric outcome model, see Hızlı
et al. [2023]."
REFERENCES,0.6285714285714286,"B.3.3
Joint Distribution of Mediator–Outcome Model"
REFERENCES,0.6300751879699248,"In our problem setup, each patient undergoes the surgery and is observed in two regimes (pre-
and post-surgery): D = {D(a)}a∈{0,1}. Within each regime a ∈{0, 1}, the data set D(a) con-
tains the measurements of mediator M and outcome Y at irregular times: {(t(a)
i
, m(a)
i
)}I(a)
i=1 and"
REFERENCES,0.631578947368421,"{(t(a)
j , y(a)
j
)}J(a)
j=1 . For completeness, we repeat the joint distribution of D:"
REFERENCES,0.6330827067669172,"p(D) =
Y"
REFERENCES,0.6345864661654136,"a∈{0,1}"
REFERENCES,0.6360902255639098,"h
exp(−Λ(a))
YI(a)"
REFERENCES,0.637593984962406,"i=1 λ(a)(ti, mi | H<ti)
|
{z
}
mediator intensity YJ(a)"
REFERENCES,0.6390977443609023,"j=1 p(a)(yj | tj, H<tj)
|
{z
}
outcome model"
REFERENCES,0.6406015037593985,"i
,
(58)"
REFERENCES,0.6421052631578947,"B.4
Learning and Inference"
REFERENCES,0.643609022556391,"We use the likelihood in Eq. (58) to learn the joint mediator–outcome model. The mediator intensity
has a sparse GP prior using inducing point approximations [Hensman et al., 2015]. Hence, we
use variational inference and optimize the evidence lower bound (ELBO). The outcome model is a
standard GP prior. Hence, we use the marginal likelihood to learn the hyperparameters. For more
details on the derivations of the learning algorithms, see Hızlı et al. [2023]."
REFERENCES,0.6451127819548872,"Following Eq. (58), we learn a single joint model for each of pre-surgery (a = 0, [∅, ∅]) and post-
surgery regimes (a = 1, [˜ta, ˜ta]). With these two models, we can estimate the two interventional
trajectories Y>˜ta[∅, ∅] and Y>˜ta[˜ta, ˜ta] under ‘factual’ interventions. For the interventional tra-
jectory Y>˜ta[∅, ˜ta] under the hypothetical intervention [∅, ˜ta], Eq. (27) states that the outcomes
follow the pre-surgery outcome distribution while the mediators follow the post-surgery distribution.
Therefore, we combine the pre-surgery outcome model p(Y [A = ∅]) and the post-surgery mediator
intensity λ∗[A = ˜ta] to estimate the interventional trajectory Y>˜ta[∅, ˜ta]."
REFERENCES,0.6466165413533834,"B.5
Scalability"
REFERENCES,0.6481203007518797,"Outcome Model.
The computational complexity for the learning and inference in standard GPs
is O(N 3) where N is the number of training data points. In the RCT data set used in experiments,
we have ca. 5100 data points for each period, resulting from 17 patients with 3-day long glucose
measurements in approximately 15-minute intervals. This is a relatively large data set that renders
the standard GP inference slow. However, a straightforward inducing point approximation would
not work on the outcome model, due to the ‘time-marked’ mediator-response function where a past
mediator only affects the future outcomes. To make this approach more scalable, an efficient inducing
point implementation will be required and it will be considered as future work. We believe that this
will be a meaningful contribution for scalable Bayesian estimation of treatment-response curves
[Schulam and Saria, 2017, Xu et al., 2016, Soleimani et al., 2017, Cheng et al., 2020]."
REFERENCES,0.649624060150376,"Mediator Intensity.
The computational complexity for the learning and inference in GPs with
inducing point approximations is O(NM 2) where M is the number of inducing points. In our
experiments, we see that M can be chosen in the order of 10 and we use M = 20 in all experiments.
Hence, the learning and the inference for the mediator intensity is more scalable compared to the
outcome model. 3.0 4.0 5.0 6.0 7.0 8.0"
REFERENCES,0.6511278195488722,"Glucose (mmol/l), y"
REFERENCES,0.6526315789473685,"|
{z
}"
REFERENCES,0.6541353383458647,Pre-surgery
REFERENCES,0.6556390977443609,"|
{z
}"
REFERENCES,0.6571428571428571,"Post-surgery
Intervention"
REFERENCES,0.6586466165413534,"0.0
6.0
12.0
18.0
24.0
T
T+6.0
T+12.0
T+18.0
T+24.0
Time, τ 0.0 0.2 0.5 0.8 1.0"
REFERENCES,0.6601503759398496,Intensity λ∗(t)
REFERENCES,0.6616541353383458,"Glucose, y
Meals, m
f
fb
λ∗(τ)"
REFERENCES,0.6631578947368421,"10.0
30.0
50.0"
REFERENCES,0.6646616541353384,"Carb. intake (g), m"
REFERENCES,0.6661654135338346,(a) Example patient 1. 4.0 6.0 8.0
REFERENCES,0.6676691729323309,"Glucose (mmol/l), y"
REFERENCES,0.6691729323308271,"|
{z
}"
REFERENCES,0.6706766917293233,Pre-surgery
REFERENCES,0.6721804511278195,"|
{z
}"
REFERENCES,0.6736842105263158,"Post-surgery
Intervention"
REFERENCES,0.675187969924812,"0.0
6.0
12.0
18.0
24.0
T
T+6.0
T+12.0
T+18.0
T+24.0
Time, τ 0.0 0.2 0.5 0.8"
REFERENCES,0.6766917293233082,Intensity λ∗(t)
REFERENCES,0.6781954887218045,"Glucose, y
Meals, m
f
fb
λ∗(τ)"
REFERENCES,0.6796992481203008,"10.0
30.0
50.0"
REFERENCES,0.681203007518797,"Carb. intake (g), m"
REFERENCES,0.6827067669172933,(b) Example patient 2. 4.0 6.0 8.0
REFERENCES,0.6842105263157895,"Glucose (mmol/l), y"
REFERENCES,0.6857142857142857,"|
{z
}"
REFERENCES,0.687218045112782,Pre-surgery
REFERENCES,0.6887218045112782,"|
{z
}"
REFERENCES,0.6902255639097744,"Post-surgery
Intervention"
REFERENCES,0.6917293233082706,"0.0
6.0
12.0
18.0
24.0
T
T+6.0
T+12.0
T+18.0
T+24.0
Time, τ 0.0 0.2 0.5 0.8"
REFERENCES,0.6932330827067669,Intensity λ∗(t)
REFERENCES,0.6947368421052632,"Glucose, y
Meals, m
f
fb
λ∗(τ)"
REFERENCES,0.6962406015037594,"10.0
30.0
50.0"
REFERENCES,0.6977443609022557,"Carb. intake (g), m"
REFERENCES,0.6992481203007519,(c) Example patient 3.
REFERENCES,0.7007518796992481,"Figure 7: Example 1-day long meal-glucose data and joint model fits for three patients: meals
(carbohydrate intake, cyan bars), glucose (black crosses), predicted meal intensity λ∗(orange dashed
line), predicted glucose baseline fb (red dashed line) and predicted glucose progression f (blue dashed
line). For blood glucose, we see, after the surgery, (i) the baseline declines, and (ii) a meal produces
a faster rise and decline. For meals, we see, after the surgery, the patient eats (i) more frequently and
(ii) less carbohydrate per meal."
REFERENCES,0.7022556390977444,"C
Experiment Details"
REFERENCES,0.7037593984962406,"C.1
Real-world Study"
REFERENCES,0.7052631578947368,"For the real-world study, we consider data from a real-world randomized controlled trial (RCT)
about the effects of bariatric surgery on blood glucose [Saarinen et al., 2019, Ashrafi et al., 2021].
We investigate whether our model can learn clinically-meaningful direct and indirect effects of
bariatric surgery on blood glucose, by analyzing how surgery affects glucose through the changed
diet (indirectly) or other metabolic processes (directly)."
REFERENCES,0.706766917293233,"Dataset.
The RCT dataset consists of surgery–meal–blood glucose (treatment–mediator–outcome)
measurements of 15 obesity patients (body mass index, BMI ≥35 kg/m2) undergoing a gastric
bypass surgery. In the original study, patients are randomized into two types of surgeries: Roux-en-Y
gastric bypass (RYGB) [Wittgrove et al., 1994] and one-anastomosis gastric bypass (OAGB) [Rutledge,
2001]. Nevertheless, we consider both as a single surgery type since it has been previously reported
that two surgeries do not have a statistically-significant difference between their effects on the blood
glucose progression [Ashrafi et al., 2021]. A continuous-monitoring device measures the blood
glucose of each patient at 15-minute intervals. Patients record their meals in a food diary. Data is
collected over two 3-day long periods: (i) the pre-surgery period, which is 2-months prior to the
surgery at weight stability, and (ii) the post-surgery period, which takes place right after the surgery.
From the surgery-meal-glucose data set, we show 1-day long meal-glucose measurements in pre- and
post-surgery periods for three example patients in Fig. 7."
REFERENCES,0.7082706766917293,"Data Preprocessing.
Since patients record their meals with error, self-recorded food diaries contain
very noisy observations, especially in terms of the meal times. For example, a patient can record a
meal with a 30-min delay when the blood glucose already peaked to its local maxima (top of the meal
bump). Or, they can record a single meal as multiple meal records. This may cause a naive supervised
learning algorithm to come to a counterintuitive conclusion that a meal causes a temporary decrease
in the blood glucose. Therefore, we perform a data preprocessing step on the meals to correct their
occurrence times. To avoid multiple records, we combine multiple meals that occur within 30 min.
To align the meal response bumps and the meal times, i.e., to find the true meal time values, we use a
Bayesian error-in-variables model that accounts for the errors in meal timings [Ashrafi et al., 2021,
Zhang et al., 2021]. We train the error-in-variables model using the provided code in Stan [Carpenter
et al., 2017] and use the posterior means of the true meal times."
REFERENCES,0.7097744360902256,"Model.
We model the pre- and post-surgery sequences of meals and blood glucose measurements
using our interacting mediator–outcome model, given in Eqs. (55) and (56). We represent each of
pre- and post-surgery periods as a single regime a ∈{0, 1} using the binary-valued treatment process
A(τ) ∈{0, 1}. In the following, we explain the model parameters for a single regime a ∈{0, 1},
since we use the same model definition and initialisation for both regimes."
REFERENCES,0.7112781954887218,"The mediator dosage intensity λ(m | τ) ∼GP has a Matern-1/2 kernel with the variance and the
lengthscale parameters are initialized as follows: σ2
d = 1.0, ℓd = 1.0. Its hyperparameters are learned.
The mediator time intensity has three components: {β0, gm, go}. The hyperparameters of these
components are set using the domain knowledge. The Poisson process baseline β0 is initialized to 0.1.
The meal-effect function gm depends on the relative time to the last meal: Qm = 1. The variance and
the lengthscale parameters of its SE kernel are initialized as: σ2
m = 0.1, ℓm = 1.5. The lengthscale
value 1.5 captures the likely decline and rise in the meal intensity right after a previous meal in the
next 5 h. Similarly, the glucose-effect function go depends on the relative time and value of the last
glucose measurement: Qo = 1. The hyperparameters of its 2-dimensional SE kernel are initialized
as: σ2
o = 0.1, ℓo = [100.0, 5.0]. The large lengthscale value 100.0 in the time dimension encourages
a piecewise linear function that changes with a new glucose measurement in every ∼15 min, since
the glucose measurements are more frequent compared to the meal measurements (∼3 h). The large
lengthscale value 5.0 of the glucose dimension encourages a smooth, slow-changing function as
blood glucose levels fluctuate in the range [4.0, 9.0] to capture a monotonically decreasing intensity
as the blood glucose levels increase. The number of inducing points are chosen as M = 20 and
they are placed on a regular grid in the input space. The hyperparameters are not learned, while the
inducing variables Z are learned. The mediator intensity is shared among all patients."
REFERENCES,0.7127819548872181,"The outcome model has three components: {fb, fm, uY }. The most important hyperparameters
are the GP lengthscale parameters, which are selected by a combination of domain knowledge and
validation of the model fit. For meal-response, we considered lengthscales {0.15 h, 0.3 h, 0.5 h,
1.0 h}, and for the baseline, lengthscales {5 h, 10 h, 20 h}."
REFERENCES,0.7142857142857143,"The kernel of the baseline function fb is equal to the sum of a constant and a periodic kernel. The
intercept parameter of the constant kernel is initialized to 1.0. The period parameter p is set to 24 h
so that fb models the daily glucose profile. The variance and the lengthscale parameters of the kb are
initialized as: σ2
b = 1.0, ℓb = 10.0. The large lengthscale value 10.0 encourages a slow-changing,
smooth baseline function. We assume that each patient has an independent baseline function fb.
The meal response function fm = P"
REFERENCES,0.7157894736842105,"i:ti≤τ l(mi)f 0
m(τ −ti) consists of two functions: (i) a linear
function l(·) whose intercept and slope parameters are initialized to 0.1, and (ii) the response shape
function f 0
m ∼GP with a SE kernel whose variance and lengthscale parameters are initialized as:
σ2
0 = 1.0, ℓ0 = 0.5. The magnitude function l(mi) is modeled in a hierarchical manner, where
each patient has their own intercept and slope parameters and they all share hierarchical Gaussian
priors N(0, 0.12). The shape function f 0
m is shared among the patients as the meal responses for
different individuals are very similar. Furthermore, the effective period for a meal Teff is set to 3 h
following the empirical findings on the duration of the meal response in Wyatt et al. [2021]. The
hyperparameters of the outcome model are learned except the period of the baseline p (24 h) and the
effective period Teff of the shape function (3 h), which are chosen w.r.t. the domain knowledge."
REFERENCES,0.7172932330827068,"Training.
As described above, the interacting mediator–outcome model is trained on the surgery-
meal-glucose dataset. For each regime, one set of joint model is learned. We train the hyperparameters
of the meal dosage intensity using the marginal likelihood and the inducing variables of the meal time
intensity using the ELBO. For the outcome model, we learn the hyperparameters using the marginal
likelihood. We show three example training fits of the joint model on 1-day long meal-glucose
measurements in pre- and post-surgery periods in Fig. 7."
REFERENCES,0.718796992481203,"Next Meal Predictions in Section 5.1.3.
Once the models are learned, we can sample from the
GP posteriors. We take 5000 samples from the posterior of the time intensity for the next meal time
under a typical glucose level. Similarly, we take 5000 samples from the posterior of the dosage
intensity for the carbohydrate intake per meal. In Fig. 5 of the main text, we show the kernel density
estimations (KDE) using dashed lines. For the computation of the KDE, we use the built-in function
of the ‘seaborn’ library."
REFERENCES,0.7203007518796992,"Direct and Indirect Effects on Glycemia in Section 5.1.4.
In Section 5.1.4, we investigate the
direct and indirect effects of the surgery on the glycemia to answer the following causal query: how
much of the surgery effect can be contributed to the changed diet? To measure the contribution of the
direct and indirect effects, we use two metrics: (i) the percentage time spent in hypoglycemia (HG)
%THG = {t : Y (t) ≤3.9 mmol/l}/T, and (ii) the percentage time spent in above-normal-glycemia
(ANG) %TANG = {t : Y (t) ≥5.6 mmol/l}/T. In the following, we describe the computation for
one metric for brevity, e.g., %THG, as the computations of the two metrics are the same."
REFERENCES,0.7218045112781954,"The metrics can be calculated on the surgery-meal-glucose data set in a straightforward manner.
After we calculate them for the pre-surgery period [tA = ∅] ≡[∅, ∅] and the post-surgery period
[tA = ˜ta] ≡[˜ta, ˜ta], we compute the total causal effect (TE) as follows"
REFERENCES,0.7233082706766917,"TEHG(˜ta) = %THG[˜ta, ˜ta] −%THG[∅, ∅]."
REFERENCES,0.724812030075188,"For direct and indirect effects, we further need to estimate %THG[∅, ˜ta], i.e., the percentage time
spent in hypoglycemia under a hypothetical intervention [∅, ˜ta]. As the counterfactual %THG[∅, ˜ta]
is not available in closed form, we take samples from the posterior of the learned joint model and
perform a Monte Carlo approximation. As the posterior samples, we sample 3-day long meal-glucose
trajectories for 17 patients for each of the three interventional regimes: {[∅, ∅], [∅, ˜ta], [˜ta, ˜ta]}.
Each 1-day long trajectory has 40 glucose measurements, which makes 2040 samples for each regime.
For the interventional trajectories to be comparable, we fix the noise variables of the point process
sampling, similar to Hızlı et al. [2023]. Then, the Monte Carlo approximations of the NDE and the"
REFERENCES,0.7263157894736842,Table 3: Benchmark models considered in the semi-synthetic study.
REFERENCES,0.7278195488721805,"JOINT
MODEL
MODEL COMPONENTS"
REFERENCES,0.7293233082706767,"A→Y
MEDIATOR
RESPONSE"
REFERENCES,0.7308270676691729,"M1
✓
Non-interacting (L15)
Parametric (S17)
M2
✓
Non-interacting (L15)
Non-parametric (H22)
M3
✓
Interacting (H22)
Parametric (S17)"
REFERENCES,0.7323308270676692,"Z21-1
✓
Interacting (H22)
Parametric (Z21)
Z21-2
✓
ORACLE
Parametric (Z21)
H22
✗
Interacting (H22)
Non-parametric (H22)
OUR
✓
Interacting (H22)
Non-parametric (H22)"
REFERENCES,0.7338345864661654,NIE in %THG are computed as follows
REFERENCES,0.7353383458646616,NDEHG(˜ta) =
REFERENCES,0.7368421052631579,"17×3
X"
REFERENCES,0.7383458646616541,"i=1
%T (i)
HG[˜ta, ˜ta] −%T (i)
HG[∅, ˜ta],"
REFERENCES,0.7398496240601504,NIEHG(˜ta) =
REFERENCES,0.7413533834586467,"17×3
X"
REFERENCES,0.7428571428571429,"i=1
%T (i)
HG[∅, ˜ta] −%T (i)
HG[∅, ∅],"
REFERENCES,0.7443609022556391,"where each index i ∈1, . . . , 17 × 3 refers to a 1-day long trajectory sample."
REFERENCES,0.7458646616541353,"C.2
Semi-synthetic Study"
REFERENCES,0.7473684210526316,"The performance on the causal tasks are validated on synthetic studies, since the true causal effects are
unknown in real-world observational data sets. Hence, we set up a realistic, semi-synthetic simulation
study to evaluate the performance of our model on two causal tasks: estimating the NDE and NIE
trajectories."
REFERENCES,0.7488721804511278,"C.2.1
Simulator"
REFERENCES,0.750375939849624,"To set up a realistic semi-synthetic study, we design realistic ground-truth simulators, that are based
on the real-world data set of the RCT study. To achieve this, we train our joint mediator–outcome
model on the surgery-meal-blood glucose data to obtain a single joint simulator for each regime
a ∈{0, 1}. We use the same model definition, initialisation and learning procedure in Appendix C.1.
For a visual example on how the data and the simulator fits look, see Figs. 7 and 8."
REFERENCES,0.7518796992481203,"The ground-truth joint simulator has two components: the meal (mediator) simulator and the glucose
(outcome) simulator. To train the meal simulator, we use the meal-glucose data from all patients. We
show the training fits on 1-day long meal trajectories of three example patients in the bottom panels
of the sub-figures in Fig. 7. In addition, we show how the function components gm and go differs in
Figs. 9a and 9b. We see that in both pre- and post-surgery periods, the meal-time intensity decreases
after a meal event. Besides, the post-surgery meal-time intensity increases faster compared to the
pre-surgery meal-time intensity as expected, as the surgery leads to a diet with more frequent, smaller
meals. For the decrease in the size of the meals, we show how the carbohydrate intake (meal dosage)
intensity changes after the surgery in Fig. 9c."
REFERENCES,0.7533834586466165,"For the glucose simulator, we use the meal-glucose data for three patients. This enables individualiza-
tion between patients through their glucose baseline fb(·) and the meal response magnitude function
l(·). We chose to train the glucose simulator on three patients instead of all since (i) the usage of
all patients make the posterior sampling slow due to the increase in the simulator size and (ii) three
patients are enough to create a realistic individualization behavior where we have three patient groups
with similar glycemia: (gr1, gr2, gr3). We show 1-day long examples of the outcome simulator fit
in Fig. 8. Besides, we show how the glucose baseline fb and the meal response fm differs between
these three patients in Fig. 10."
REFERENCES,0.7548872180451128,"0.0
10.0
20.0
30.0
40.0
50.0
Time, τ 3.0 4.0 5.0 6.0 7.0"
REFERENCES,0.7563909774436091,"Glucose (mmol/l), y"
REFERENCES,0.7578947368421053,"|
{z
}"
REFERENCES,0.7593984962406015,Pre-surgery
REFERENCES,0.7609022556390977,"|
{z
}"
REFERENCES,0.762406015037594,"Post-surgery
Intervention"
REFERENCES,0.7639097744360902,"Glucose, y
Meals, m
f
fb"
REFERENCES,0.7654135338345864,"10.0
30.0
50.0"
REFERENCES,0.7669172932330827,"Carb. intake (g), m"
REFERENCES,0.7684210526315789,(a) Example 1-day long glucose predictions of patient group 1 for the outcome simulator.
REFERENCES,0.7699248120300752,"0.0
10.0
20.0
30.0
40.0
50.0
Time, τ 4.0 6.0 8.0"
REFERENCES,0.7714285714285715,"Glucose (mmol/l), y"
REFERENCES,0.7729323308270677,"|
{z
}"
REFERENCES,0.7744360902255639,Pre-surgery
REFERENCES,0.7759398496240602,"|
{z
}"
REFERENCES,0.7774436090225564,"Post-surgery
Intervention"
REFERENCES,0.7789473684210526,"Glucose, y
Meals, m
f
fb"
REFERENCES,0.7804511278195488,"10.0
30.0
50.0"
REFERENCES,0.7819548872180451,"Carb. intake (g), m"
REFERENCES,0.7834586466165413,(b) Example 1-day long glucose predictions of patient group 2 for the outcome simulator.
REFERENCES,0.7849624060150376,"0.0
10.0
20.0
30.0
40.0
50.0
Time, τ 3.0 4.0 5.0 6.0"
REFERENCES,0.7864661654135339,"Glucose (mmol/l), y"
REFERENCES,0.7879699248120301,"|
{z
}"
REFERENCES,0.7894736842105263,Pre-surgery
REFERENCES,0.7909774436090226,"|
{z
}"
REFERENCES,0.7924812030075188,"Post-surgery
Intervention"
REFERENCES,0.793984962406015,"Glucose, y
Meals, m
f
fb"
REFERENCES,0.7954887218045112,"10.0
30.0
50.0"
REFERENCES,0.7969924812030075,"Carb. intake (g), m"
REFERENCES,0.7984962406015037,(c) Example 1-day long glucose predictions of patient group 3 for the outcome simulator.
REFERENCES,0.8,"Figure 8: Example 1-day long meal-glucose data and outcome simulator fits for three patient patient
groups: meals (carbohydrate intake, cyan bars), glucose (black crosses), predicted glucose baseline
fb (red dashed line) and predicted glucose progression f (blue dashed line)."
REFERENCES,0.8015037593984963,"C.2.2
Benchmarks"
REFERENCES,0.8030075187969925,"In the semi-synthetic study, we use the benchmark models shown in Table 3. In the following, we
describe the model definitions and implementation details of the mediator and outcome models."
REFERENCES,0.8045112781954887,"Non-interacting mediator model (L15).
The non-interacting mediator model [Non-interacting (L15),
Lloyd et al., 2015] is a GP-modulated non-homogeneous Poisson process where the intensity λ(τ) =
f 2(τ) is the square transformation of a latent intensity f ∼GP with a GP prior. The GP model uses
inducing point approximations for scalable inference and variational inference is used for learning.
We use an implementation of the model in GPflow [Matthews et al., 2017]."
REFERENCES,0.806015037593985,"0.000
0.562
1.124
1.686
2.247
2.809
3.371
3.933
4.495
5.057
Time, τ −0.3 −0.2 −0.1 0.0 0.1 0.2 0.3"
REFERENCES,0.8075187969924812,"g∗
m(τ, m)"
REFERENCES,0.8090225563909774,"g∗
m,pre(τ)"
REFERENCES,0.8105263157894737,"g∗
m,post(τ)"
REFERENCES,0.8120300751879699,"(a) Mediator-effect function g∗
m."
REFERENCES,0.8135338345864662,"-2.9
-2.0
-1.2
-0.3
0.5
1.4
2.2
3.1
3.9
4.8
Glucose, y 0.33 0.35 0.38 0.40 0.43 0.45 0.48 0.50"
REFERENCES,0.8150375939849624,"g∗
o(τ, y)"
REFERENCES,0.8165413533834587,"g∗
o,pre(τ)"
REFERENCES,0.8180451127819549,"g∗
o,post(τ)"
REFERENCES,0.8195488721804511,"(b) Outcome-effect function g∗
o."
REFERENCES,0.8210526315789474,"0.00
2.67
5.33
8.00
10.67
13.33
16.00
18.67
21.33
24.00
Time, τ 1.5 2.0 2.5 3.0 3.5 4.0"
REFERENCES,0.8225563909774436,"Carb. Intake (Dosage, log g)"
REFERENCES,0.8240601503759398,λpre(m | τ)
REFERENCES,0.825563909774436,λop(m | τ)
REFERENCES,0.8270676691729323,(c) Carb. intensity λ(m | τ).
REFERENCES,0.8285714285714286,"Figure 9: Comparison of the ground-truth meal simulator intensity components between pre- and
post-surgery periods: (a) the mediator-effect function g∗
m that models the dependence of a future
meal on past meals, (b) the outcome-effect function g∗
o that models the dependence of a future meal
on past glucose levels, and (c) the carbohydrate intake intensity λ(m | τ)."
REFERENCES,0.8300751879699249,"0
5
10
15
20
25
Time, τ 0 1 2 3 4 5 6"
REFERENCES,0.8315789473684211,"Glucose Baseline, fb(τ)"
REFERENCES,0.8330827067669173,"fb,gr1
fb,gr2
fb,gr3"
REFERENCES,0.8345864661654135,(a) Pre-surgery glucose baseline fb.
REFERENCES,0.8360902255639098,"0
5
10
15
20
25
Time, τ 0 1 2 3 4 5 6"
REFERENCES,0.837593984962406,"Glucose Baseline, fb(τ)"
REFERENCES,0.8390977443609022,"fb,gr1
fb,gr2
fb,gr3"
REFERENCES,0.8406015037593985,(b) Post-surgery glucose baseline fb.
REFERENCES,0.8421052631578947,"0.0
0.5
1.0
1.5
2.0
2.5
3.0
Time, τ 0 1 2 3 4 5 6"
REFERENCES,0.843609022556391,"Mediator Response, fm(τ)"
REFERENCES,0.8451127819548873,"fm,gr1
fm,gr2
fm,gr3"
REFERENCES,0.8466165413533835,(c) Pre-surgery meal response fm.
REFERENCES,0.8481203007518797,"0.0
0.5
1.0
1.5
2.0
2.5
3.0
Time, τ 0 1 2 3 4 5 6"
REFERENCES,0.849624060150376,"Mediator Response, fm(τ)"
REFERENCES,0.8511278195488722,"fm,gr1
fm,gr2
fm,gr3"
REFERENCES,0.8526315789473684,(d) Post-surgery meal response fm.
REFERENCES,0.8541353383458646,"Figure 10: Comparison of the ground-truth glucose simulator components between pre- and post-
surgery periods for three patient groups {gr1, gr2, gr3} corresponding to three real-world patients.
For three groups, we show (a) pre-surgery glucose baseline fb, (b) post-surgery glucose baseline fb,
(c) pre-surgery meal response function fm, and (d) post-surgery meal response function fm."
REFERENCES,0.8556390977443609,"Parametric mediator-response (S17).
As a simple benchmark for the outcome model, we add
a highly-cited parametric response model [Parametric (S17), Schulam and Saria, 2017]. It has a
conditional GP prior with a parametric response function that models the mediator response in the
outcome as a constant effect. We use the implementation provided in the supplementary material in
Schulam and Saria [2017]."
REFERENCES,0.8571428571428571,"Parametric mediator-response (Z21).
Zeng et al. [2021] proposed a longitudinal causal mediation
model based on functional principal component analysis, where its response model [Parametric (Z21),
Zeng et al., 2021] is a simple linear function with a single slope parameter. The principal components
are chosen as a linear combination of a spline basis where the coefficients satisfy the orthogonality
constraint. They assume that the treatment intervention only affects the coefficients of the spline basis.
In their work, Zeng et al. [2021] consider the mediator as a continuous-valued stochastic process that
is observed at the same times with the outcome measurements, which is different than our problem
setup where the mediator is a marked point process. Therefore, we combine the outcome model of
[Zeng et al., 2021] with a point-process mediator model in the joint benchmark models Z21-1 and
Z21-2, and transform the meal sequence into a continuous-valued sequence that is observed at the
same times with the outcome measurements. For this, we use the carbohydrate intake values of the"
REFERENCES,0.8586466165413534,"meals in their effective periods and we simply add up the carbohydrate values if two meals are nearby
similar to the additive mediator response assumption in our outcome model definition. We use the
publicly available code implemented in R. For inference, the method uses Markov chain Monte Carlo
(MCMC). We use 20000 samples with a burn-in period of 2000 samples."
REFERENCES,0.8601503759398497,"Non-parametric model (H22).
The non-parametric model is a GP-based joint model that combines
an interacting mediator model [Interacting (H22), Hızlı et al., 2023] and a non-parametric response
model [Non-parametric (H22), Hızlı et al., 2023]. The model assumes that the intervention effect is
fully-mediated through meals, and hence it can not capture the direct arrows from the treatment to
the outcomes (A
Y ). Without explicitly modeling these direct effects, the learned outcome model
seems to average the baseline and response functions of the pre- and post-surgery periods. We use an
implementation of the model in GPflow [Matthews et al., 2017]."
REFERENCES,0.8616541353383459,"0.0
10.0
20.0
30.0
40.0
50.0
Time, τ 2.0 4.0 6.0"
REFERENCES,0.8631578947368421,"Glucose (mmol/l), y"
REFERENCES,0.8646616541353384,"|
{z
}"
REFERENCES,0.8661654135338346,Pre-surgery
REFERENCES,0.8676691729323308,"|
{z
}"
REFERENCES,0.869172932330827,"Post-surgery
Intervention"
REFERENCES,0.8706766917293233,"Glucose, y
Meals, m"
REFERENCES,0.8721804511278195,"25.0
50.0"
REFERENCES,0.8736842105263158,"Carb. intake (g), m"
REFERENCES,0.8751879699248121,(a) 1-day long example real-world data of patient group 2.
REFERENCES,0.8766917293233083,"Time, τ 3.0 4.0 5.0"
REFERENCES,0.8781954887218045,"Glucose, y"
REFERENCES,0.8796992481203008,"Glucose, y
Meals, m"
REFERENCES,0.881203007518797,"Time, τ 3.0 4.0 5.0 6.0"
REFERENCES,0.8827067669172932,"Glucose, y"
REFERENCES,0.8842105263157894,"Glucose, y
Meals, m"
REFERENCES,0.8857142857142857,"0.0
10.0
20.0
30.0
40.0
50.0
Time, τ 3.0 4.0 5.0 6.0"
REFERENCES,0.8872180451127819,"Glucose, y"
REFERENCES,0.8887218045112782,"Glucose, y
Meals, m"
REFERENCES,0.8902255639097745,"25.0
50.0"
REFERENCES,0.8917293233082707,"Carb., m"
REFERENCES,0.8932330827067669,"25.0
50.0"
REFERENCES,0.8947368421052632,"Carb., m"
REFERENCES,0.8962406015037594,"25.0
50.0"
REFERENCES,0.8977443609022556,"Carb., m"
REFERENCES,0.8992481203007519,(b) 1-day long example semi-synthetic data for patient group 2.
REFERENCES,0.9007518796992481,"Figure 11: Example semi-synthetic trajectories from the training set. (a) Example 1-day long real-
world data for patient group 2. (b) Example 1-day long semi-synthetic data for patient group 2."
REFERENCES,0.9022556390977443,"C.2.3
Semi-Synthetic Train and Test Trajectories"
REFERENCES,0.9037593984962407,"Using the ground-truth meal-glucose simulator, we sample 1-day long meal-glucose trajectories of
50 synthetic patients for both pre- and post-surgery periods, i.e., for each regime a ∈{0, 1}. We
show some examples of the simulated trajectories in Fig. 11. We train the benchmark models on both
periods, and hence obtain a single joint model for each regime a ∈{0, 1}. 3.0 3.5 4.0 4.5 5.0 5.5 6.0"
REFERENCES,0.9052631578947369,"Glucose (mmol/l), Y"
REFERENCES,0.9067669172932331,"Yoracle
YM1
YZ21−2
YH22
Your"
REFERENCES,0.9082706766917293,"moracle
mM1
mZ21−2
mH22
mour"
REFERENCES,0.9097744360902256,"0
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
Time (hours), τ 0.0 0.2 0.4 0.6 0.8 1.0"
REFERENCES,0.9112781954887218,"Intensity, λ(τ)"
REFERENCES,0.912781954887218,"λub
Accept
λoracle
λM1
λZ21−2
λH22
λour"
REFERENCES,0.9142857142857143,"(a) Glucose trajectories Y>˜ta[∅, ∅] for the pre-surgery regime [∅, ∅]. 3.0 3.5 4.0 4.5 5.0 5.5 6.0"
REFERENCES,0.9157894736842105,"Glucose (mmol/l), Y"
REFERENCES,0.9172932330827067,"Yoracle
YM1
YZ21−2
YH22
Your"
REFERENCES,0.9187969924812031,"moracle
mM1
mZ21−2
mH22
mour"
REFERENCES,0.9203007518796993,"0
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
Time (hours), τ 0.0 0.2 0.4 0.6 0.8 1.0"
REFERENCES,0.9218045112781955,"Intensity, λ(τ)"
REFERENCES,0.9233082706766917,"λub
Accept
λoracle
λM1
λZ21−2
λH22
λour"
REFERENCES,0.924812030075188,"(b) Glucose trajectories Y>˜ta[∅, ˜ta] for the hypothetical regime [∅, ˜ta]. 2.0 2.5 3.0 3.5 4.0 4.5 5.0"
REFERENCES,0.9263157894736842,"Glucose (mmol/l), Y"
REFERENCES,0.9278195488721804,"Yoracle
YM1
YZ21−2
YH22
Your"
REFERENCES,0.9293233082706767,"moracle
mM1
mZ21−2
mH22
mour"
REFERENCES,0.9308270676691729,"0
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
Time (hours), τ 0.0 0.2 0.4 0.6 0.8 1.0"
REFERENCES,0.9323308270676691,"Intensity, λ(τ)"
REFERENCES,0.9338345864661655,"λub
Accept
λoracle
λM1
λZ21−2
λH22
λour"
REFERENCES,0.9353383458646617,"(c) Glucose trajectories Y>˜ta[˜ta, ˜ta] for the post-surgery regime [˜ta, ˜ta]."
REFERENCES,0.9368421052631579,"Figure 12: Example 1-day long interventional (test) meal-glucose trajectories of the oracle model,
the proposed model and the benchmark models in the semi-synthetic study for three hypothetical
interventional regimes [∅, ∅], [∅, ˜ta] and [˜ta, ˜ta]. In all figures, (i) at top panels we show the meal-
glucose trajectories and (ii) at bottom panels we show the meal time intensities and the point process
sampling procedure. (a) The pre-surgery glucose trajectories Y>˜ta[∅, ∅] for the pre-surgery regime
[∅, ∅]. (b) The hypothetical glucose trajectories Y>˜ta[∅, ˜ta] for the hypothetical regime [∅, ˜ta]. (c)
The post-surgery glucose trajectories Y>˜ta[˜ta, ˜ta] for the post-surgery regime [˜ta, ˜ta]."
REFERENCES,0.9383458646616541,"Once the models are trained, we sample three 1-day long interventional trajectories Y>˜ta[∅, ∅],
Y>˜ta[∅, ˜ta] and Y>˜ta[˜ta, ˜ta], corresponding to three hypothetical interventional regimes [∅, ∅],"
REFERENCES,0.9398496240601504,"[∅, ˜ta] and [˜ta, ˜ta]. Three trajectories are sampled for the benchmarks and our model. These
estimated trajectories are compared to the ground-truth trajectories sampled from the ground-truth
simulator. To sample meal-glucose trajectories that are comparable w.r.t. their meal times, we fix the
noise variables of the point process sampling similar to Hızlı et al. [2023]. After the interventional
trajectories are sampled, we compute the TE(˜ta), NDE(˜ta) and NIE(˜ta) as described in Eqs. (15)
to (17). We show a 1-day long example for the three trajectories in Fig. 12. For all three trajectories
Y>˜ta[∅, ∅], Y>˜ta[∅, ˜ta] and Y>˜ta[˜ta, ˜ta], we see that our model follows the oracle meal intensity
and the glucose trajectory well. Hence, our model also follows the direct, indirect and total effect
trajectories well, since these effects are calculated by subtracting the three interventional trajectories."
REFERENCES,0.9413533834586466,"We can inspect Fig. 12 to understand how the considered benchmark models fit to the synthetic
training data. We see that the simple intercept response model of S17 does not capture the meal
response curves well, e.g., the constant response (pink dashed line) in Fig. 12c roughly between
5am - 6pm (in the effective meal periods). Similarly, the linear mediator response function of Z21 is
unable to capture the complex, non-linear meal response, e.g., simple constant responses in the purple
dashed line in Fig. 12c for the time periods [5, 8], [9, 17] and [19, 22]. We see that the non-parametric
benchmark model H22 has a glucose baseline and a meal response that is averaged over the pre- and
post-surgery periods, e.g., the under-oracle glucose baseline of H22 in Fig. 12a and the above-oracle
glucose baseline of H22 in Fig. 12c (brown dashed lines). Similarly, we see the model fit for the
non-interacting mediator benchmark model (pink dashed intensity lines in bottom panels of Figs. 12a
to 12c), and it does not capture the dynamic, long-range dependence between the past meal-glucose
measurements and the future meals."
REFERENCES,0.9428571428571428,"D
Additional Results"
REFERENCES,0.9443609022556391,"D.1
Sensitivity Analysis"
REFERENCES,0.9458646616541353,"In this section, we perform sensitivity analysis by creating a hypothetical hidden-confounding
scenario in which the causal assumptions do no longer hold. In such a scenario, a hidden confounder
that affects both the mediator and the outcome sequences also can be seen as a source of model
misspecification. Therefore, our goals are to understand: (i) how sensitive the model predictions are
to the causal assumptions, and (ii) how our model behaves under model misspecification."
REFERENCES,0.9473684210526315,"Setup.
To create a hypothetical hidden-confounding scenario, we assume that patients are advised to
be more active after the surgery in the observational (training) data. We sample an unobserved binary
confounder Ci for being active during the period of each meal i with probability β: Ci ∼BE(β). If
active in the meal period, a patient both (i) eats more (bias in meal dosage m: mactive = m2/2), and
(ii) their glucose peaks less (bias in response to a meal via the response magnitude meffective = m2/4).
We vary the amount of confounding by considering β ∈{0.0, 0.2, 0.4, 0.6, 0.8, 1.0}, where β = 0
corresponds to the case of no unobserved confounding (NUC). Under this scenario, the models will
learn biased estimates for meal amounts and meal responses."
REFERENCES,0.9488721804511279,"We consider three different interventional distributions at test time to understand how the models
behave under unbiased or biased estimates: (i) same as the observational data where the patients
are advised to be active with the same probability β in the post-surgery period, (ii) the patients are
advised to be active with the same probability β in the pre-surgery period, and (iii) the patients are
not advised at all. The interventional distribution in (i) is the closest to the observational distribution,
while the mismatch between the observational distribution and the interventional distributions in (ii)
and (iii) increase for larger β values."
REFERENCES,0.9503759398496241,"Results.
For each case, we report the MSE in the natural direct effect NDE(˜ta) = Y>˜ta[˜ta, ˜ta] −
Y>˜ta[∅, ˜ta], the natural indirect effect NIE(˜ta) = Y>˜ta[∅, ˜ta] −Y˜ta[∅, ∅], and the total effect
TE(˜ta) = Y>˜ta[˜ta, ˜ta] −Y˜ta[∅, ∅]. We repeat the experiments 10 times, and report the mean and
±1 standard deviation in Figs. 13 to 15."
REFERENCES,0.9518796992481203,"From Fig. 13, we see that the results are inconsistent when the same hidden confounding is applied
to the training and test data. Even though the model makes biased predictions of meal dosages and
responses, it is not penalized at test time since the test data has the same bias on average. In Figs. 14
and 15, the hidden confounding between the train and test data is different, i.e., the models are forced
to make biased estimates."
REFERENCES,0.9533834586466166,"In Figs. 14a and 15a, the MSE of NDE(˜ta) rises noticeably with the increased confounding level
β. This is not surprising as the confounding biases both the post-surgery glucose response to
meals (which affects Y>˜ta[˜ta, ˜ta]) and the post-surgery meal dosages (which affects Y>˜ta[˜ta, ˜ta]
and Y>˜ta[∅, ˜ta]). For our model, the MSE rises more pronouncedly compared to the baselines,
because the latter were already misspecified to start with. In Figs. 14b and 15b, the MSE of NIE(˜ta)
changes less with increased confounding compared to NDE(˜ta), as the post-surgery meal times are
not affected by the confounding, and the dosage bias (which affects only Y>˜ta[∅, ˜ta]) affects the
performance in NIE(˜ta) less compared to the response bias in NDE(˜ta). In Figs. 14c and 15c, the
MSE in TE(˜ta) increases with confounding. However, this is less pronounced than for NDE(˜ta), as
the confounding bias only affects Y>˜ta[˜ta, ˜ta]."
REFERENCES,0.9548872180451128,"0.0
0.2
0.4
0.6
0.8
1.0
Degree of confounding, β 0.0 0.1 0.2 0.3 0.4 0.5 Mse"
REFERENCES,0.956390977443609,"M3
Z21-1
Our"
REFERENCES,0.9578947368421052,(a) NDE(˜ta).
REFERENCES,0.9593984962406015,"0.0
0.2
0.4
0.6
0.8
1.0
Degree of confounding, β 0.0 0.1 0.2 0.3 0.4 0.5 Mse"
REFERENCES,0.9609022556390977,"M3
Z21-1
Our"
REFERENCES,0.9624060150375939,(b) NIE(˜ta).
REFERENCES,0.9639097744360903,"0.0
0.2
0.4
0.6
0.8
1.0
Degree of confounding, β 0.0 0.1 0.2 0.3 0.4 0.5 0.6 Mse"
REFERENCES,0.9654135338345865,"M3
Z21-1
Our"
REFERENCES,0.9669172932330827,(c) TE(˜ta).
REFERENCES,0.968421052631579,"Figure 13: MSE for NDE, NIE, TE for the confounding scenario (i), where the patients are advised to
be active also in the post-surgery period in the test data, i.e., the same hidden confounding in training
and test data."
REFERENCES,0.9699248120300752,"0.0
0.2
0.4
0.6
0.8
1.0
Degree of confounding, β 0.0 0.1 0.2 0.3 0.4 0.5 Mse"
REFERENCES,0.9714285714285714,"M3
Z21-1
Our"
REFERENCES,0.9729323308270676,(a) NDE(˜ta).
REFERENCES,0.9744360902255639,"0.0
0.2
0.4
0.6
0.8
1.0
Degree of confounding, β 0.0 0.1 0.2 0.3 0.4 0.5 Mse"
REFERENCES,0.9759398496240601,"M3
Z21-1
Our"
REFERENCES,0.9774436090225563,(b) NIE(˜ta).
REFERENCES,0.9789473684210527,"0.0
0.2
0.4
0.6
0.8
1.0
Degree of confounding, β 0.0 0.1 0.2 0.3 0.4 0.5 0.6 Mse"
REFERENCES,0.9804511278195489,"M3
Z21-1
Our"
REFERENCES,0.9819548872180451,(c) TE(˜ta).
REFERENCES,0.9834586466165414,"Figure 14: MSE for NDE, NIE, TE for the confounding scenario (ii), where the patients are advised
to be active in the pre-surgery period in the test data, i.e., different hidden confounding in training
and test data."
REFERENCES,0.9849624060150376,"0.0
0.2
0.4
0.6
0.8
1.0
Degree of confounding, β 0.0 0.1 0.2 0.3 0.4 0.5 Mse"
REFERENCES,0.9864661654135338,"M3
Z21-1
Our"
REFERENCES,0.98796992481203,(a) NDE(˜ta).
REFERENCES,0.9894736842105263,"0.0
0.2
0.4
0.6
0.8
1.0
Degree of confounding, β 0.0 0.1 0.2 0.3 0.4 0.5 Mse"
REFERENCES,0.9909774436090225,"M3
Z21-1
Our"
REFERENCES,0.9924812030075187,(b) NIE(˜ta).
REFERENCES,0.9939849624060151,"0.0
0.2
0.4
0.6
0.8
1.0
Degree of confounding, β 0.0 0.1 0.2 0.3 0.4 0.5 0.6 Mse"
REFERENCES,0.9954887218045113,"M3
Z21-1
Our"
REFERENCES,0.9969924812030075,(c) TE(˜ta).
REFERENCES,0.9984962406015038,"Figure 15: MSE for NDE, NIE, TE for the confounding scenario (iii), where the patients are
not advised to be active in the test data, i.e., hidden confounding in the training data, no hidden
confounding in the test data."
