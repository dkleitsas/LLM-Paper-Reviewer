Section,Section Appearance Order,Paragraph
ABSTRACT,0.0,ABSTRACT
ABSTRACT,0.0010460251046025104,"An important challenge facing modern machine learning is how to rigorously
quantify the uncertainty of model predictions. Conveying uncertainty is espe-
cially important when there are changes to the underlying data distribution that
might invalidate the predictive model. Yet, most existing uncertainty quantiﬁca-
tion algorithms break down in the presence of such shifts. We propose a novel
approach that addresses this challenge by constructing probably approximately
correct (PAC) prediction sets in the presence of covariate shift. Our approach fo-
cuses on the setting where there is a covariate shift from the source distribution
(where we have labeled training examples) to the target distribution (for which we
want to quantify uncertainty). Our algorithm assumes given importance weights
that encode how the probabilities of the training examples change under the co-
variate shift. In practice, importance weights typically need to be estimated; thus,
we extend our algorithm to the setting where we are given conﬁdence intervals
for the importance weights. We demonstrate the effectiveness of our approach on
covariate shifts based on DomainNet and ImageNet. Our algorithm satisﬁes the
PAC constraint, and gives prediction sets with the smallest average normalized
size among approaches that always satisfy the PAC constraint."
INTRODUCTION,0.0020920502092050207,"1
INTRODUCTION"
INTRODUCTION,0.0031380753138075313,"A key challenge in machine learning is quantifying prediction uncertainty. A promising approach is
via prediction sets, where the model predicts a set of labels instead of a single label. For example,
prediction sets can be used by a robot to navigate to avoid regions where the prediction set includes
an obstacle, or in healthcare to notify a doctor if the prediction set includes a problematic diagnosis."
INTRODUCTION,0.0041841004184100415,"Various methods based on these approaches can provide probabilistic correctness guarantees (i.e.,
that the predicted set contains the true label with high probability) when the training and test dis-
tributions are equal—formally, assuming the observations are exchangeable (Vovk et al., 2005; Pa-
padopoulos et al., 2002; Lei et al., 2015) or i.i.d. (Vovk, 2013; Park et al., 2020a; Bates et al., 2021).
However, this assumption often fails to hold in practice due to covariate shift—i.e., where the in-
put distribution changes but the conditional label distribution remains the same (Sugiyama et al.,
2007; Qui˜nonero-Candela et al., 2009). These shifts can be both natural (e.g., changes in color and
lighting) (Hendrycks & Dietterich, 2019) or adversarial (e.g., ℓ∞attacks) (Szegedy et al., 2014)."
INTRODUCTION,0.005230125523012552,"We consider unsupervised domain adaptation (Ben-David et al., 2007), where we are given labeled
examples from the source domain, but only unlabeled examples from the target (covariate shifted)
domain. We propose an algorithm that constructs probably approximately correct (PAC) prediction
sets under bounded covariate shifts (Wilks, 1941; Valiant, 1984)—i.e., with high probability over"
INTRODUCTION,0.006276150627615063,Published as a conference paper at ICLR 2022 ˆCPS   
INTRODUCTION,0.007322175732217573,"=
n
[
brain
o"
INTRODUCTION,0.008368200836820083,"ˆCPS-W    = 

 
"
INTRODUCTION,0.009414225941422594,"[
brain,
ﬁsh,
lion,
lollipop,
sea turtle 

 
"
INTRODUCTION,0.010460251046025104,(a) prediction set example
INTRODUCTION,0.011506276150627616,"0
50
100
150
200
250
300
350
size 0.00 0.05 0.10 0.15 0.20 0.25 error"
INTRODUCTION,0.012552301255230125,trade-off
INTRODUCTION,0.013598326359832637,= 0.10
INTRODUCTION,0.014644351464435146,"PS
WSCI
PS-W"
INTRODUCTION,0.015690376569037656,(b) size and error tradeoff
INTRODUCTION,0.016736401673640166,"0
50
100
150
200
size 0.00 0.05 0.10 0.15 0.20 0.25 0.30 0.35 0.40 error"
INTRODUCTION,0.01778242677824268,= 0.10
INTRODUCTION,0.01882845188284519,"PS
WSCI
PS-W"
INTRODUCTION,0.0198744769874477,(c) results across many shifts
INTRODUCTION,0.02092050209205021,"Figure 1: (a) An example of a covariate shifted image where an existing approach, PS (Park et al.,
2020a), constructs prediction sets that do not contain the true label (i.e., “sea turtle”); in contrast,
our proposed approach PS-W does. (b) The red curve shows the tradeoff between size and error
achieved by different choices of τ on a single shift; the goal is to be as far to the left as possible
without crossing the desired error bound ε = 0.1 shown as the black dashed line. The existing
approaches PS and WSCI (Tibshirani et al., 2019) fail to satisfy the desired error bound due to
covariate shift, whereas our approach satisﬁes it. (c) Our approach satisﬁes the error bound over
nine covariate shifts on DomainNet and ImageNet, whereas existing approaches do not."
INTRODUCTION,0.021966527196652718,"the training data (“probably”), the prediction set contains the true label for test instances (“approxi-
mately correct”)."
INTRODUCTION,0.02301255230125523,"Our algorithm uses importance weights to capture the likelihood of a source example under the target
domain. When the importance weights are known, it uses rejection sampling (von Neumann, 1951)
to construct the prediction sets. Often, the importance weights must be estimated, in which case we
need to account for estimation error. When only given conﬁdence intervals around the importance
weights, our algorithm constructs prediction sets that are robust to this uncertainty."
INTRODUCTION,0.02405857740585774,"We evaluate our approach in two settings. First, we consider rate shift, where the model is trained on
a broad domain, but deployed on a narrow domain—e.g., an autonomous car may be trained on both
daytime and nighttime images but operate at night. Even if the model continues to perform well,
this covariate shift may invalidate the prediction sets. We show that our approach constructs valid
prediction sets under rate shifts constructed from DomainNet (Peng et al., 2019), whereas several
existing approaches do not. Second, we consider support shift, where the model is trained on one
domain, but evaluated on another domain with shifted support. We train ResNet101 (He et al., 2016)
using unsupervised domain adaptation (Ganin et al., 2016) on both ImageNet-C synthetic perturba-
tions (Hendrycks & Dietterich, 2019) and PGD adversarial perturbations (Madry et al., 2017) to
ImageNet (Russakovsky et al., 2015). Our PS-W algorithm satisﬁes the PAC constraint, and gives
prediction sets with the smallest average normalized size among approaches that always satisfy the
PAC constraint. See Figure 1 for a summary of our approach and results."
INTRODUCTION,0.02510460251046025,"Related work. Our work is related to conformal prediction (Vovk et al., 2005; Balasubramanian
et al., 2014) without a shift, where the goal is to construct models that predict sets of labels designed
to include the true label with high probability (instead of predicting individual labels) under the
assumption that the source and target distributions are the same. In particular, our setting is related
to inductive (or split) conformal prediction (Papadopoulos et al., 2002; Vovk, 2013; Lei et al., 2015),
where the training set is split into a proper training set used to train a traditional predictive model,
and a calibration set used to construct the prediction sets. The general approach is to train a model
f : X × Y →R that outputs conformity scores, and then to choose a threshold τ ∈R that satisﬁes a
correctness guarantee, where the corresponding prediction sets are C(x) = {y ∈Y | f(x, y) ≥τ}
(Park et al., 2020a; Gupta et al., 2021); this notation is deﬁned in Section 2."
INTRODUCTION,0.02615062761506276,"Several kinds of correctness guarantees under no shift have been considered. One possibility is input
conditional validity (Vovk, 2013; Barber et al., 2020), which ensures correctness for all future co-
variates x, with high probability only over the conditional label distribution p(y | x). This guarantee
is very strong, and hard to ensure in practice. A weaker notion is approximate (Lei & Wasserman,
2014; Barber et al., 2020) or group (Romano et al., 2019) conditional validity, which ensures cor-
rectness with high probability over p(y | x) as well as some distribution p(x) over a subgroup.
Finally, unconditional validity ensures only correctness over the joint distribution p(x, y). We focus
on unconditional validity, though our approach extends readily to group conditional validity."
INTRODUCTION,0.027196652719665274,Published as a conference paper at ICLR 2022
INTRODUCTION,0.028242677824267783,"A separate issue, arising in the no shift setting, is how to condition on the calibration set Z. A
conventional goal is unconditional validity, over the distribution p(x, y, Z). We refer to this strategy
as fully unconditional validity. However, the guarantee we consider uses a separate conﬁdence level
for the training data, which is called a training conditional guarantee (Vovk, 2013); this correctness
notion is equivalent to a PAC correctness guarantee (Park et al., 2020a), and is also equivalent to
the standard “content” guarantee with a certain conﬁdence level for tolerance regions (Wilks, 1941;
Fraser, 1956). We build on Park et al. (2020a), which formulates the problem of choosing τ as
learning a binary classiﬁer where the input and parameter spaces are both one-dimensional; thus,
the correctness guarantee corresponds to a PAC generalization bound. This approach is widely
applicable since it can work with a variety of objectives (Bates et al., 2021)."
INTRODUCTION,0.029288702928870293,"Recent work has extended inductive conformal prediction to a setting with covariate shift (Tibshirani
et al., 2019; Lei & Cand`es, 2020); similarly, Podkopaev & Ramdas (2021) considers conformal
prediction under label shift (Lipton et al., 2018), i.e., assuming the conditional probabilities p(x |
y) do not change. These approaches start from the assumption that the true importance weights
(IWs) are known (Tibshirani et al., 2019; Podkopaev & Ramdas, 2021), or assume some properties
of the estimated IWs (Lei & Cand`es, 2020), whereas our approach considers a special form of
“ambiguity” in the estimated IWs. Furthermore, they are focused on fully unconditional validity,
whereas we obtain PAC prediction sets. In addition, Cauchois et al. (2020) designs conﬁdence sets
that are robust to all distribution shifts with bounded f-divergence; in contrast, we consider the
unsupervised learning setting where we have unlabeled examples from the target distribution. We
provide additional related work in Appendix A."
BACKGROUND ON PAC PREDICTION SETS,0.030334728033472803,"2
BACKGROUND ON PAC PREDICTION SETS"
BACKGROUND ON PAC PREDICTION SETS,0.03138075313807531,"We give background on PAC prediction sets (Park et al., 2020a); we also re-interpret this approach
using Clopper-Pearson conﬁdence intervals (Clopper & Pearson, 1934), which aids our analysis."
PAC PREDICTION SETS ALGORITHM,0.032426778242677826,"2.1
PAC PREDICTION SETS ALGORITHM"
PAC PREDICTION SETS ALGORITHM,0.03347280334728033,"Let x ∈X be covariates and y ∈Y be labels. We consider a source distribution P over X × Y with
probability density function (PDF) p(x, y).1 A prediction set2 is a set-valued function C : X →2Y."
PAC PREDICTION SETS ALGORITHM,0.034518828451882845,"Inputs. We are given a held-out calibration set Sm of i.i.d. samples (xi, yi) ∼P for i ∈[m] :=
{1, . . . , m}, written as Sm ∼P m, and a score function f : X × Y →R≥0. For example, f(x, y)
can be a prediction for the probability that y is the label for x. The score function can be arbitrary,
but score functions assigning higher scores to likely labels yield smaller prediction sets."
PAC PREDICTION SETS ALGORITHM,0.03556485355648536,"PAC prediction set. A PAC prediction set is a set-valued function C : X →2Y satisfying the
following two conditions. First, C is approximately correct in the sense that its expected error
(failing to contain the true label) is bounded by a given ε ∈(0, 1), i.e.,"
PAC PREDICTION SETS ALGORITHM,0.036610878661087864,"LP (C) := E(x,y)∼P [1(y /∈C(x))] = P(x,y)∼P [y /∈C(x)] ≤ε."
PAC PREDICTION SETS ALGORITHM,0.03765690376569038,"Second, noting that CSm is constructed based on a calibration set Sm ∼P m, the condition that CSm
is approximately correct must be satisﬁed with high probability—i.e., for given δ ∈(0, 1), we have"
PAC PREDICTION SETS ALGORITHM,0.038702928870292884,PSm∼P m [LP (CSm) ≤ε] ≥1 −δ.
PAC PREDICTION SETS ALGORITHM,0.0397489539748954,"Our goal is to devise an algorithm for constructing a PAC prediction set C. Letting C(x) = Y for
all x ∈X always satisﬁes both conditions above, but this extreme case would be uninformative if
used as a prediction set. Therefore, we additionally want to minimize the expected size E[S(C(x))]
of the prediction sets C(x), where S : 2Y →R≥0 is a size measure, which is application speciﬁc
(e.g., the cardinality of a set in classiﬁcation); however, we only rely on the monotonicity of the size
measure with respect to the prediction set parameterization in construction."
PAC PREDICTION SETS ALGORITHM,0.04079497907949791,"1All quantities that we deﬁne are measurable with respect to a ﬁxed σ-algebra on X × Y; for instance, p
is the density induced by a ﬁxed σ-ﬁnite measure. To be precise, we consider a probability measure P deﬁned
with respect to the base measure M on X ×Y; then, p = dP/dM is the Radon-Nykodym derivative of P with
respect to M. For classiﬁcation, M is the product of a Lebesgue measure on X and a counting measure on Y.
2We use the term “prediction set” to denote both the set-valued function and a set output by this function."
PAC PREDICTION SETS ALGORITHM,0.04184100418410042,Published as a conference paper at ICLR 2022
PAC PREDICTION SETS ALGORITHM,0.04288702928870293,"Algorithm. To construct C, we ﬁrst deﬁne the search space of possible prediction sets along with
the size measure S. We parameterize C by a scalar τ ∈T := R≥0 as"
PAC PREDICTION SETS ALGORITHM,0.043933054393305436,"Cτ(x) = {y ∈Y | f(x, y) ≥τ},"
PAC PREDICTION SETS ALGORITHM,0.04497907949790795,"i.e., τ is the threshold on f(x, y) above which we include y in C(x). Importantly, τ controls the
tradeoff between size and expected error. The reason is that if τ1 ≤τ2, then Cτ2(x) ⊆Cτ1(x)
for all x ∈X. Thus, size is monotonically decreasing in τ—i.e., S(Cτ2(x)) ≤S(Cτ1(x)) for all
x ∈X, and error is monotonically increasing in τ—i.e., LP (Cτ1) ≤LP (Cτ2). See Figure 1b for
an illustration, and Park et al. (2020a) and Gupta et al. (2021) for details."
PAC PREDICTION SETS ALGORITHM,0.04602510460251046,"As a consequence, a typical goal is to construct Cτ that provably contains the true label with high
probability, while empirically minimizing size (Vovk et al., 2005; Gupta et al., 2021). In our set-
ting, we want to maximize τ (equivalently, minimize expected size) subject to the constraint that
Cτ is PAC. Let ¯LSm(Cτ) := P"
PAC PREDICTION SETS ALGORITHM,0.04707112970711297,"(x,y)∈Sm 1(y /∈Cτ(x)) be the empirical error count on Sm, and"
PAC PREDICTION SETS ALGORITHM,0.04811715481171548,"F(k; m, ε) = Pk
i=0
 m
k

εi(1−ε)m−i be the cumulative distribution function (CDF) of the binomial
distribution Binom(m, ε) with m trials and success probability ε. In prior work, Park et al. (2020a)
constructs Cˆτ by solving the following problem:"
PAC PREDICTION SETS ALGORITHM,0.049163179916317995,"ˆτ = max
τ∈T τ
subj. to
¯LSm(Cτ) ≤k(m, ε, δ),
(1)"
PAC PREDICTION SETS ALGORITHM,0.0502092050209205,"where k(m, ε, δ) = maxk∈N∪{0} k subj. to F(k; m, ε) ≤δ. Intuitively, the PAC guarantee via this
construction is related to the Binomial distribution; ¯LSm(C) has distribution Binom(m, LP (C))
(given a ﬁxed C), since 1(y ̸∈C(x)) has a Bernoulli(LP (C)) distribution when (x, y) ∼P. Thus,
k(m, ε, δ) deﬁnes a “conﬁdence interval” such that if ¯LSm(C) ≤k(m, ε, δ), then LP (C) ≤ε
with probability at least 1 −δ. Below, we formalize this intuition by drawing a connection to the
Clopper-Pearson conﬁdence interval."
CLOPPER-PEARSON INTERPRETATION,0.051255230125523014,"2.2
CLOPPER-PEARSON INTERPRETATION"
CLOPPER-PEARSON INTERPRETATION,0.05230125523012552,"We interpret (1) using the Clopper-Pearson (CP) upper bound θ(k; m, δ) ∈[0, 1] (Clopper &
Pearson, 1934; Park et al., 2021).
This is an upper bound on the true success probability µ,
constructed from a sample k ∼Binom(m, µ), which holds with probability at least 1 −δ, i.e.,
Pk∼Binom(m,µ)[µ ≤θ(k; m, δ)] ≥1 −δ, where"
CLOPPER-PEARSON INTERPRETATION,0.053347280334728034,"θ(k; m, δ) := inf {θ ∈[0, 1] | F(k; m, θ) ≤δ} ∪{1}.
(2)"
CLOPPER-PEARSON INTERPRETATION,0.05439330543933055,"Intuitively, for a ﬁxed C, ¯LSm(C) ∼Binom(m, LP (C)), so the true error LP (C) is contained in
the CP upper bound θ(LSm(C); m; δ) with probability at least 1 −δ. Intuitively, we can therefore
choose τ so that this upper bound is ≤ε. However, we need to account for generalization error of
our estimator. To this end, we have the following (see Appendix D.1 for a proof and Algorithm 2 in
Appendix E for implementation details on the corresponding algorithm):"
CLOPPER-PEARSON INTERPRETATION,0.05543933054393305,"Theorem 1 Let UCP(C, Sm, δ) := θ(¯LSm(C); m; δ), where θ is deﬁned in (2). Let ˆτ be the solution
of the following problem3:"
CLOPPER-PEARSON INTERPRETATION,0.056485355648535567,"ˆτ = max
τ∈T τ
subj. to
UCP(Cτ, Sm, δ) ≤ε.
(3)"
CLOPPER-PEARSON INTERPRETATION,0.05753138075313807,"Then, we have PSm∼P m[LP (Cτ) ≤ε] ≥1 −δ for any τ ≤ˆτ."
PAC PREDICTION SETS UNDER COVARIATE SHIFT,0.058577405857740586,"3
PAC PREDICTION SETS UNDER COVARIATE SHIFT"
PAC PREDICTION SETS UNDER COVARIATE SHIFT,0.0596234309623431,"We extend the PAC prediction set algorithm described in Section 2 to the covariate shift setting. Our
novel approach combines rejection sampling (von Neumann, 1951) with Theorem 1."
PAC PREDICTION SETS UNDER COVARIATE SHIFT,0.060669456066945605,"3We consider a trivial solution τ = 0 when (3) is not feasible, but omitting here to avoid clutter."
PAC PREDICTION SETS UNDER COVARIATE SHIFT,0.06171548117154812,Published as a conference paper at ICLR 2022
PROBLEM FORMULATION,0.06276150627615062,"3.1
PROBLEM FORMULATION"
PROBLEM FORMULATION,0.06380753138075314,"We assume labeled training examples from the source distribution P are given, but want to construct
prediction sets that satisfy the PAC property with respect to a (possibly) shifted target distribution Q.
Both of these are distributions over X × Y; denote their PDFs by p(x, y) and q(x, y), respectively.
The challenge is that we are only given unlabeled examples from Q."
PROBLEM FORMULATION,0.06485355648535565,"Preliminaries and assumptions.
We denote the likelihood ratio of covariate distributions by
w∗(x) := q(x)/p(x), also called the importance weight (IW) of x. Our main assumption is the
covariate shift condition, which says the label distributions are equal (i.e., p(y | x) = q(y | x)),
while the covariate distributions may differ (i.e., we can have p(x) ̸= q(x))."
PROBLEM FORMULATION,0.06589958158995816,"Inputs. We assume a labeled calibration set Sm consisting of i.i.d. samples (xi, yi) ∼P (for
i ∈[m]) is given, and a score function f : X × Y →R≥0. For now, we also assume we have
the true importance weights w∗
i := w∗(xi) for each (xi, yi) ∼P, as well as an upper bound
b ≥maxx∈X w∗(x) on the IWs. In Sections 3.3 and Appendix B, we describe how to estimate these
quantities in a way that provides guarantees under smoothness assumptions on the distributions.4"
PROBLEM FORMULATION,0.06694560669456066,"Problem. Our goal is to construct CSm that is a PAC prediction set under Q—i.e.,"
PROBLEM FORMULATION,0.06799163179916318,"PSm∼P m [LQ(CSm) ≤ε] ≥1 −δ,"
PROBLEM FORMULATION,0.06903765690376569,"where LQ(C) := P(x,y)∼Q[y ̸∈C(x)] is the error of C on Q, while empirically controlling its size."
REJECTION SAMPLING STRATEGY,0.0700836820083682,"3.2
REJECTION SAMPLING STRATEGY"
REJECTION SAMPLING STRATEGY,0.07112970711297072,"Our strategy is to use rejection sampling to convert Sm consisting of i.i.d. samples from P into a
labeled calibration set consisting of i.i.d. samples from Q."
REJECTION SAMPLING STRATEGY,0.07217573221757322,"Rejection sampling. Rejection sampling (von Neumann, 1951; Owen, 2013; Rubinstein & Kroese,
2016) is a technique for generating samples from a target distribution q(x) based on samples from
a proposal distribution p(x). Given importance weights (IWs) w∗(x) and an upper bound b ≥
maxx∈X w∗(x), it constructs a set of i.i.d. samples from q(x). Typically, rejection sampling is used
when the proposal distribution is easy to sample compared to the target distribution. In contrast, we
use it to convert samples from the source distribution into samples from the target distribution."
REJECTION SAMPLING STRATEGY,0.07322175732217573,"In particular, our algorithm takes the proposal distribution to be the source covariate distribution PX,
and the target distribution to be our target covariate distribution QX. Let Vi ∼U := Uniform([0, 1])
be i.i.d., V := (V1, . . . , Vm), and ⃗w∗:= (w∗
1, . . . , w∗
m) with w∗
i = w∗(xi) as deﬁned before. Then,
given Sm, it uses rejection sampling to construct a randomly chosen set of N samples"
REJECTION SAMPLING STRATEGY,0.07426778242677824,"TN(Sm, V, ⃗w∗, b) := {(xi, yi) ∈Sm | Vi ≤w∗
i /b}
(4)"
REJECTION SAMPLING STRATEGY,0.07531380753138076,"from QX. The expected number of samples is E[N] = m/b; thus, rejection sampling is more
effective when the proposal distribution is similar to the target."
REJECTION SAMPLING STRATEGY,0.07635983263598327,"Rejection sampling Clopper-Pearson (RSCP) bound. Given TN, our algorithm uses the CP
bound to construct a PAC prediction set C for Q. Let σi := 1(Vi ≤w∗
i /b) indicate whether
example (xi, yi) ∈Sm is accepted—i.e., TN(Sm, V, ⃗w∗, b) = {(xi, yi) ∈Sm | σi = 1},where
|TN(Sm, V, ⃗w∗, b)| = Pm
i=1 σi. Then, it follows that URSCP bounds the error on Q, where"
REJECTION SAMPLING STRATEGY,0.07740585774058577,"URSCP(C, Sm, V, ⃗w∗, b, δ) := UCP(C, TN(Sm, V, ⃗w∗, b), δ).
(5)"
REJECTION SAMPLING STRATEGY,0.07845188284518828,"Thus, we have the following (see Appendix D.3 for the proof, and Algorithm 4 in Appendix E for a
detailed description of the PS-R algorithm that leverages this bound):"
REJECTION SAMPLING STRATEGY,0.0794979079497908,Theorem 2 Deﬁne URSCP as in (5). Let ˆτ be the solution of the following problem:
REJECTION SAMPLING STRATEGY,0.08054393305439331,"ˆτ = max
τ∈T τ
subj. to
URSCP(Cτ, Sm, V, ⃗w∗, b, δ) ≤ε.
(6)"
REJECTION SAMPLING STRATEGY,0.08158995815899582,"Then, we have PSm∼P m,V ∼U m [LQ(Cτ) ≤ε] ≥1 −δ for any τ ≤ˆτ."
REJECTION SAMPLING STRATEGY,0.08263598326359832,"Note that V is sampled only once for Algorithm 4, so the randomness in V can contribute to the
failure of the correctness guarantee; however, the failure rate is controlled by δ."
REJECTION SAMPLING STRATEGY,0.08368200836820083,"4In practice, we can improve stability of importance weights by considering source and target distributions
induced by a feature mapping, e.g., learned using unsupervised domain-adaptation (Park et al., 2020b)."
REJECTION SAMPLING STRATEGY,0.08472803347280335,Published as a conference paper at ICLR 2022
APPROXIMATE IMPORTANCE WEIGHTS,0.08577405857740586,"3.3
APPROXIMATE IMPORTANCE WEIGHTS"
APPROXIMATE IMPORTANCE WEIGHTS,0.08682008368200837,"So far, we have assumed that the true importance weight w∗(x) is known. Since in practice, it needs
to be estimated, we relax this assumption to only needing an uncertainty set of possible importance
weights. This allows us to handle estimation error in the weights."
APPROXIMATE IMPORTANCE WEIGHTS,0.08786610878661087,"Problem. Let SX
m be unlabeled calibration examples from the source distribution (i.e., the covariates
in Sm), T X
n be n unlabeled calibration examples from the target distribution (denoted by T X
n
∼
Qn
X), and ⃗w∗:= (w∗
1, ..., w∗
m) ∈Rm be the vector of true importance weights w∗
i := w∗(xi), for
(xi, yi) ∈Sm. Then, we assume an uncertainty set W ⊆Rm that has ⃗w∗with high probability, i.e.,"
APPROXIMATE IMPORTANCE WEIGHTS,0.08891213389121339,"PSX
m∼P m
X ,T X
n ∼Qn
X [⃗w∗∈W] ≥1 −δw,
(7)"
APPROXIMATE IMPORTANCE WEIGHTS,0.0899581589958159,"where δw ∈(0, 1). We assume W has the form"
APPROXIMATE IMPORTANCE WEIGHTS,0.09100418410041841,"W := {w ∈Rm | ∀i ∈[m] , wi ≤wi ≤wi} ,"
APPROXIMATE IMPORTANCE WEIGHTS,0.09205020920502092,for some wi and wi. See the discussion on our choice of W in Appendix C.1.
APPROXIMATE IMPORTANCE WEIGHTS,0.09309623430962342,"Robust Clopper-Pearson bound. To construct a PAC prediction set C for Q, it sufﬁces to bound
the worst-case error over w ∈W, i.e., we have the following (see Appendix D.4 for the proof):"
APPROXIMATE IMPORTANCE WEIGHTS,0.09414225941422594,Theorem 3 Suppose W satisﬁes (7). Deﬁne URSCP as in (5). Let ˆτ be the solution of the following:
APPROXIMATE IMPORTANCE WEIGHTS,0.09518828451882845,"ˆτ = max
τ∈T τ
subj. to
max
w∈W URSCP(Cτ, Sm, V, w, b, δC) ≤ε.
(8)"
APPROXIMATE IMPORTANCE WEIGHTS,0.09623430962343096,"Then, we have PSm∼P m,V ∼U m,T X
n ∼Qn
X[LQ(Cτ) ≤ε] ≥1 −δC −δw for any τ ≤ˆτ."
APPROXIMATE IMPORTANCE WEIGHTS,0.09728033472803348,"A key challenge applying Theorem 3 is solving the maximum over w ∈W. We propose a simple
greedy algorithm that achieves the maximum."
APPROXIMATE IMPORTANCE WEIGHTS,0.09832635983263599,"Greedy algorithm for robust URSCP. The RSCP bound URSCP satisﬁes certain monotonicity prop-
erties that enable us to efﬁciently compute an upper bound to the maximum in (8). In particular,
if C makes an error on (xi, yi) (i.e., yi ̸∈C(xi)), then URSCP is monotonically non-decreasing in
w∗
i = w∗(xi); intuitively, this holds since a larger w∗
i increases the probability that (xi, yi) is
included in TN(Sm, V, w∗, b), which in turn increases the empirical error ¯LTN(Sm,V,w∗,b)(C). Con-
versely, if C does not make an error on (xi, yi) (i.e., yi ∈C(xi)), URSCP is non-increasing in w∗
i .
More formally, we have the following result (see Appendix D.5 for a proof):"
APPROXIMATE IMPORTANCE WEIGHTS,0.09937238493723849,"Lemma 1 For any i ∈[m], URSCP(C, Sm, V, w∗, b, δ) is monotonically non-decreasing in w∗
i if
yi /∈C(xi), and monotonically non-increasing in w∗
i if yi ∈C(xi)."
APPROXIMATE IMPORTANCE WEIGHTS,0.100418410041841,"Our greedy algorithm leverages the monotonicity of URSCP. In particular, given W and C, the choice"
APPROXIMATE IMPORTANCE WEIGHTS,0.10146443514644352,"ˆw := ( ˆw1, . . . , ˆwm),
where
ˆwi =
wi
if yi ̸∈C(xi)
wi
if yi ∈C(xi)
(∀i ∈[m])
(9)"
APPROXIMATE IMPORTANCE WEIGHTS,0.10251046025104603,"is the maximum value over w ∈W of the constraint URSCP(Cτ, Sm, V, w, b, δC) in (8), i.e.,"
APPROXIMATE IMPORTANCE WEIGHTS,0.10355648535564854,"max
w∈W URSCP(C, Sm, V, w, b, δ) = URSCP(C, Sm, V, ˆw, b, δ).
(10)"
APPROXIMATE IMPORTANCE WEIGHTS,0.10460251046025104,"Thus, we have the following, which follows by (10) and the same argument as the Theorem 3:"
APPROXIMATE IMPORTANCE WEIGHTS,0.10564853556485355,"Theorem 4 Suppose W satisﬁes (7). Deﬁne ˆwτ,SX
m,T X
n as in (9), making the dependency on τ, SX
m,
and T X
n explicit, and URSCP as in (5). Let ˆτ be the solution of the following problem:"
APPROXIMATE IMPORTANCE WEIGHTS,0.10669456066945607,"ˆτ = max
τ∈T τ
subj. to
URSCP(Cτ, Sm, V, ˆwτ,SX
m,T X
n , b, δC) ≤ε.
(11)"
APPROXIMATE IMPORTANCE WEIGHTS,0.10774058577405858,"Then, we have PSm∼P m,V ∼U m,T X
n ∼Qn
X[LQ(Cτ) ≤ε] ≥1 −δC −δw for any τ ≤ˆτ. 5"
APPROXIMATE IMPORTANCE WEIGHTS,0.1087866108786611,"Importance weight estimation. In general, to estimate the importance weights (IWs), some as-
sumptions on their structure are required (Kanamori et al., 2009; Cortes et al., 2008; Nguyen et al.,"
APPROXIMATE IMPORTANCE WEIGHTS,0.1098326359832636,"5We assume b is given for simplicity, but our approach estimates it; see Appendix C.2 for details."
APPROXIMATE IMPORTANCE WEIGHTS,0.1108786610878661,Published as a conference paper at ICLR 2022
APPROXIMATE IMPORTANCE WEIGHTS,0.11192468619246862,Algorithm 1 PS-W: an algorithm using the robust RSCP bound in (20)
APPROXIMATE IMPORTANCE WEIGHTS,0.11297071129707113,"1: procedure PS-W(Sm, T X
n , f, g, T , ε, δw, δC, K, E)
2:
W ←ESTIMATEIWS(SX
m, T X
n , g, δw, K, E)
(▷) Compute an uncertainty set W
3:
b ←maxi∈[K] wi
(▷) Compute the maximum IW (see (19) in Appendix C.2)
4:
return PS-ROBUST(Sm, f, T , W, b, ε, δC)
5: procedure ESTIMATEIWS(SX
m, T X
n , g, δw, K, E)
6:
Construct bins B1, . . . , BK using g as described in Appendix B.2
7:
Construct W using B1, . . . , BK, SX
m, T X
n , g, δw and, E as described in Appendix B.1
8:
return W
9: procedure PS-ROBUST(Sm, f, g, T , W, b, ε, δC)
10:
V ∼Uniform([0, 1])m"
APPROXIMATE IMPORTANCE WEIGHTS,0.11401673640167365,"11:
ˆτ ←0
12:
for τ ∈T do
(▷) Grid search in ascending order
13:
Construct ˆw using (9) given τ, Sm, and W
14:
if URSCP(Cτ, Sm, V, ˆw, b, δC) ≤ε then
15:
ˆτ ←max(ˆτ, τ)
16:
else break
17:
return ˆτ"
APPROXIMATE IMPORTANCE WEIGHTS,0.11506276150627615,"2010; Lipton et al., 2018). We use a cluster-based approach (Cortes et al., 2008). In particular, we
heuristically partition the feature space of the score function f into K bins by using a probabilistic
classiﬁer g that separates source and target examples, and then estimate the source and target covari-
ate distributions p(x) and q(x) based on the smoothness assumption over the distributions, where
the degree of the smoothness is parameterized by E. Then, we can construct the uncertainty set W
that satisﬁes the speciﬁed guarantee in (7). See Appendix B for details."
APPROXIMATE IMPORTANCE WEIGHTS,0.11610878661087866,"Algorithm. Our algorithm, called PS-W, is detailed in Algorithm 1; it solves (20) and also performs
importance weight estimation according to (17) in Appendix B. In particular, Algorithm 1 constructs
a prediction set that satisﬁes the PAC guarantee in Theorem 4. See Section 4.1 for our choice of
parameters (e.g., K, E, and grid search parameters)."
EXPERIMENTS,0.11715481171548117,"4
EXPERIMENTS"
EXPERIMENTS,0.11820083682008369,We show the efﬁcacy of our approach on rate and support shifts on DomainNet and ImageNet.
EXPERIMENTAL SETUP,0.1192468619246862,"4.1
EXPERIMENTAL SETUP
Models. For each source-target distribution pair, we split each the labeled source data and unlabeled
target data into train and calibration sets. We use a separate labeled test set from the target for
evaluation. For each shift from source to target, we use a deep neural network score function f
based on ResNet101 (He et al., 2016), trained using unsupervised domain adaptation based on the
source and target training sets. See Appendix F for details, including data split."
EXPERIMENTAL SETUP,0.1202928870292887,"Prediction set construction. To construct our prediction sets, we ﬁrst estimate IWs by training
a probabilistic classiﬁer g using the source and target training sets. Next, we use g to construct
heuristic IWs w(x) = 1/g(s = 1 | x) −11, where s = 1 if x is from source. Then, we estimate the
lower and upper bound of the true IWs using Theorem 5 with E = 0.001 and K = 10 bins (chosen
to contain equal numbers of heuristic IWs), where we compute the lower and upper Clopper-Pearson
interval using the source and target calibration sets. Furthermore, given a conﬁdence level δ, we use
δC = δw = δ/2. For the grid search in line 12 of Algorithm 1, we increase τ by 10−7 until the
bound URSCP exceeds 1.5ε. Finally, we evaluate the prediction set error on the labeled target test set."
EXPERIMENTAL SETUP,0.12133891213389121,Baselines. We compare the proposed method in Algorithm 1 (PS-W) with the following:
EXPERIMENTAL SETUP,0.12238493723849372,"• PS: The prediction set using Algorithm 2 that satisﬁes the PAC guarantee from Theorem 1, based
on Park et al. (2020a), which makes the i.i.d. assumption.
• PS-C: A Clopper-Pearson method addressing covariate shift by a conservative upper bound on the
empirical loss (see Appendix E.2 for details), resulting in Algorithm 3 that solves the following:"
EXPERIMENTAL SETUP,0.12343096234309624,"ˆτ = arg max
τ∈T
τ
subj. to
UCP(Cτ, Sm, δ) ≤ε/b."
EXPERIMENTAL SETUP,0.12447698744769875,"• WSCI: Weighted split conformal inference, proposed in (Tibshirani et al., 2019). Under the ex-
changeability assumption (which is somewhat weaker than our i.i.d. assumption), this approach"
EXPERIMENTAL SETUP,0.12552301255230125,Published as a conference paper at ICLR 2022
EXPERIMENTAL SETUP,0.12656903765690378,"PS
WSCI
PS-C
PS-W
0.00 0.02 0.04 0.06 0.08 0.10 0.12"
EXPERIMENTAL SETUP,0.12761506276150628,prediction set error error
EXPERIMENTAL SETUP,0.12866108786610878,= 0.10
EXPERIMENTAL SETUP,0.1297071129707113,"PS
WSCI
PS-C
PS-W
0 200 400 600 800 1000"
EXPERIMENTAL SETUP,0.1307531380753138,prediction set size size
EXPERIMENTAL SETUP,0.13179916317991633,(a) Comparison
EXPERIMENTAL SETUP,0.13284518828451883,"PS-R
PS-M
PS-W
0.00 0.02 0.04 0.06 0.08 0.10"
EXPERIMENTAL SETUP,0.13389121338912133,prediction set error error
EXPERIMENTAL SETUP,0.13493723849372385,= 0.10
EXPERIMENTAL SETUP,0.13598326359832635,"PS-R
PS-M
PS-W
0 200 400 600 800 1000 size size"
EXPERIMENTAL SETUP,0.13702928870292888,"(b) Ablation study
Figure 2: The prediction set error and size over 100 random trials under synthetic shift from Ima-
geNet to ImageNet-C13. Parameters are m = 20, 000, ε = 0.1, and δ = 10−5. (a) and (b) shows
the box plots for comparison and ablation study, respectively."
EXPERIMENTAL SETUP,0.13807531380753138,"provides correctness guarantees only for a single future test instance, i.e., it includes an ε con-
ﬁdence level (denoted α in their paper) but not δ. Also, it assumes the true IWs are known;
following their experiments, we use the heuristic IWs constructed using g.
• PS-R: The prediction set using Algorithm 4 that satisﬁes the PAC guarantee from Theorem 2 with
the heuristic IWs constructed using a probabilistic classiﬁer g.
• PS-M: The prediction set using Algorithm 5, which is identical to PS-R except that PS-M esti-
mates IWs heuristically using histogram density estimation and a calibration set. In particular, we
partition the IW values into bins, project source and target calibration examples into bins based
on the value of the probabilistic classiﬁer g, and estimate the source density ˆpB and target density
ˆqB for each bin. The estimated importance weight is ˆw(x) = ˆqB(x)/ˆpB(x), where ˆpB and ˆqB are
deﬁned in (14) and (15), respectively."
EXPERIMENTAL SETUP,0.13912133891213388,"Metrics. We measure performance via the prediction set error and size on a held-out test set—i.e.,
error is the fraction of (x, y) such that y ̸∈C(x) and size is the average of |C(x)| over x."
EXPERIMENTAL SETUP,0.1401673640167364,"Rate shifts on DomainNet. We consider settings where the model is trained on data from a variety
of domains, but is then deployed on a speciﬁc domain; we call such a shift rate shift. For instance,
a self-driving car may be trained on both day and night images, but tested during the night time.
While the model should still perform well since the target is a subset of the source, the covariate shift
can nevertheless invalidate prediction set guarantees. We consider rate shifts on DomainNet (Peng
et al., 2019), which consists of images of 345 classes from six domains (sketch, clipart, painting,
quickdraw, real, and infograph); we use all domains as the source and each domain as a target."
EXPERIMENTAL SETUP,0.1412133891213389,"Support shifts on ImageNet. Next, we consider support shifts, where the support of the target is
different from the support of the source, but unsupervised domain adaptation is used to learn fea-
ture representations that align the two distributions (Ganin et al., 2016); then, the score function f
is trained on this representation. First, we consider ImageNet-C (Hendrycks & Dietterich, 2019),
which modiﬁes the original ImageNet dataset (Russakovsky et al., 2015) using 15 synthetic pertur-
bations with 5 severity levels. We use 13 perturbations, omitting “snow” and “glass blur”, which
are computationally expensive to run. We consider the original ImageNet dataset as the source,
and the all synthetic perturbations on all of ImageNet (denoted ImageNet-C13) as the target. See
Appendix F.3 for data split. Second, we consider adversarial shifts, where we generate adversarial
examples for ImageNet using the PGD attack (Madry et al., 2017) with 0.01 ℓ∞-norm perturbations
with respect to a pretrained ResNet101. We consider the original ImageNet as the source and the
adversarially perturbed ImageNet as the target."
EXPERIMENTAL RESULTS,0.14225941422594143,"4.2
EXPERIMENTAL RESULTS"
EXPERIMENTAL RESULTS,0.14330543933054393,"We summarize our results in Table 1, and provide more details in Figure 4 in Appendix G.2. Our
PS-W algorithm satisﬁes the PAC constraint, and gives prediction sets with the smallest average
normalized size among approaches that always satisfy the PAC constraint."
EXPERIMENTAL RESULTS,0.14435146443514643,"Rate shifts on DomainNet. We use ε = 0.1 and δ = 10−5. As can be seen in Table 1, the
prediction set error of our approach (PS-W) does not violate the error constraint ε = 0.1, while
all other comparing approaches (except for PS-C) violate it for at least one of the shifts. While
PS-C satisﬁes the desired bound, it is overly conservative; its prediction sets are signiﬁcantly larger
than necessary, making it less useful for uncertainty quantiﬁcation. For the shift to Infograph in
Table 1, PS-W achieves relatively larger average prediction set size compared to other shifts; this is
because the classiﬁcation error of the score function f over Infograph is large—71.28%, whereas"
EXPERIMENTAL RESULTS,0.14539748953974896,Published as a conference paper at ICLR 2022
EXPERIMENTAL RESULTS,0.14644351464435146,"Table 1: Average prediction set error and sizes over 100 random trials under rate shifts on Do-
mainNet (ﬁrst six shifts) and support shifts on ImageNet (last two shifts). We denote an approach
satisfying the ε error constraint by , and  otherwise. The “normalized size” is the size divided
by the total number of classes (i.e., 345 for DomainNet and 1000 for ImageNet). Parameters are
m = 50, 000 for DomainNet, m = 20, 000 for ImageNet, ε = 0.1, and δ = 10−5. Our approach
PS-W satisﬁes the ε constraint, while producing prediction sets with the smallest average normalized
size among approaches that always satisfy the error constraint. See Appendix G.2 for box plots. Shift"
EXPERIMENTAL RESULTS,0.14748953974895398,"Baselines
Ablations
Ours
PS
WSCI
PS-C
PS-R
PS-M
PS-W
error size error size error
size
error
size
error size
error size"
EXPERIMENTAL RESULTS,0.14853556485355648,"All

(0.094) 10.5

(0.099)
9.5

(0.093)
10.7

(0.094)
10.6

(0.094) 10.8

(0.070) 17.0"
EXPERIMENTAL RESULTS,0.14958158995815898,"Sketch

(0.142) 13.1

(0.116) 18.6

(0.020) 141.7

(0.097)
28.2

(0.105) 26.1

(0.078) 40.3"
EXPERIMENTAL RESULTS,0.1506276150627615,"Painting

(0.159) 15.4

(0.113) 30.0

(0.025) 125.4

(0.096)
37.7

(0.103) 34.5

(0.076) 52.8"
EXPERIMENTAL RESULTS,0.151673640167364,"Quickdraw

(0.069) 5.9

(0.097)
3.8

(0.021)
23.8

(0.088)
4.3

(0.087)
4.2

(0.067)
6.1"
EXPERIMENTAL RESULTS,0.15271966527196654,"Real

(0.079) 8.7

(0.087)
7.2

(0.032)
47.8

(0.080)
8.7

(0.087)
7.1

(0.068) 11.8"
EXPERIMENTAL RESULTS,0.15376569037656904,"Clipart

(0.105) 10.2

(0.101) 10.9

(0.000) 345.0

(0.080)
19.4

(0.086) 14.8

(0.060) 25.7"
EXPERIMENTAL RESULTS,0.15481171548117154,"Infograph

(0.363) 36.4

(0.114) 165.1

(0.000) 345.0

(0.085) 202.6

(0.107) 177.4

(0.078) 216.4"
EXPERIMENTAL RESULTS,0.15585774058577406,"ImageNet-PGD

(0.090) 5.5

(0.096)
4.7

(0.000) 1000.0

(0.000) 1000.0

(0.074)
7.8

(0.049) 13.9"
EXPERIMENTAL RESULTS,0.15690376569037656,"ImageNet-C13

(0.127) 9.3

(0.111) 67.0

(0.000) 1000.0

(0.000) 1000.0

(0.095) 15.9

(0.061) 35.8"
EXPERIMENTAL RESULTS,0.1579497907949791,"mean normalized size
–
–
0.0338
0.0257
–
0.0047"
EXPERIMENTAL RESULTS,0.1589958158995816,"that over Sketch is 37.16%. Even with the poor score function, our proposed approach still satisﬁes
the ε = 0.1 error constraint. Finally, while our approach PS-W generally performs best subject
to satisfying the error constraint, we note that our ablations PS-R and PS-M also perform well,
providing different tradeoffs. First, the performance of PS-W is signiﬁcantly more reliable than
PS-R, but in some cases PS-R performs better (e.g., it produces slightly smaller prediction sets on
rate shifts but signiﬁcantly larger sets on support shifts). Alternatively, PS-M consistently produces
smaller prediction sets, though it sometimes violates the ε error constraints."
EXPERIMENTAL RESULTS,0.1600418410041841,"Support shifts on ImageNet. We show results for synthetic and adversarial shifts in Table 1 (and
Figure 4 in Appendix G.2). As can be seen, the error of our approach (PS-W) is below the desired
level. PS-R performs poorly, likely due to the uncalibrated point IW estimation—we ﬁnd that cal-
ibrated importance weights mitigate these issues, though accounting for uncertainty in the IWs is
necessary for achieving the desired error rate; see Appendix G.3 for details."
EXPERIMENTAL RESULTS,0.16108786610878661,"For adversarial shifts, the target classiﬁcation error of the source-trained ResNet101 and the domain-
adapted ResNet101 is 99.97% and 28.05%, respectively. Domain adaptation can signiﬁcantly de-
crease average error rate, but label predictions still do not have guarantees. However, our prediction
set controls the prediction set error rate as speciﬁed by ε. As shown in Figure 4, our prediction set
function outputs a prediction set for a given example that includes the true label at least 90% of the
time. Thus, downstream modules can rely on this guarantee for further decision-making."
EXPERIMENTAL RESULTS,0.16213389121338911,"Ablation and sensitivity study. We conduct an ablation study on the effect of IW calibration and
the smoothness parameter E for PS-W. We observe that the IW calibration considering uncertainty
intervals around calibrated IWs is required for the PAC guarantee (e.g., Figure 2b). Also, we ﬁnd
that a broad range of E-s can be used to satisfy the PAC guarantee; we believe this result is due to
the use of a domain adapted score function. See Appendices G.3 & G.5 for details."
CONCLUSION,0.16317991631799164,"5
CONCLUSION"
CONCLUSION,0.16422594142259414,"We propose a novel algorithm for building PAC prediction sets under covariate shift; it leverages re-
jection sampling and the Clopper-Pearson interval, and accounts for uncertain IWs. We demonstrate
the efﬁcacy of our approach on natural, synthetic, and adversarial covariate shifts on DomainNet and
ImageNet. Future work includes providing optimality guarantees on the prediction set size, rigorous
estimation of the hyperparameter E, and incorporating probabilistic IW uncertainty estimates."
CONCLUSION,0.16527196652719664,Published as a conference paper at ICLR 2022
ETHICS STATEMENT,0.16631799163179917,"Ethics statement. We do not foresee any signiﬁcant ethical issues with our work. One possible
issue is that end-users may overly trust the prediction sets if they do not understand the limitations
of our approach—e.g., it is only a high probability guarantee."
REPRODUCIBILITY STATEMENT,0.16736401673640167,"Reproducibility statement. Algorithms used for evaluation, including ours, are stated in Algorithm
1, Algorithm 2, Algorithm 3, Algorithm 4, and Algorithm 5, along with hyperparameters for algo-
rithms in Section 4.1 and Appendix F. Related code is released6. The proof of our theorems are
stated in Appendix D; the required assumption is stated in Assumption 1."
REPRODUCIBILITY STATEMENT,0.1684100418410042,ACKNOWLEDGMENTS
REPRODUCIBILITY STATEMENT,0.1694560669456067,"This work was supported in part by ARO W911NF-20-1-0080, AFRL and DARPA FA8750-18-C-0090, NSF
award CCF 1910769, and NSF award 2031895 on the Mathematical and Scientiﬁc Foundations of Deep Learn-
ing (MoDL). Any opinions, ﬁndings and conclusions or recommendations expressed in this material are those
of the authors and do not necessarily reﬂect the views of the Air Force Research Laboratory (AFRL), the Army
Research Ofﬁce (ARO), the Defense Advanced Research Projects Agency (DARPA), or the Department of
Defense, or the United States Government. The authors are grateful to Art Owen for helpful comments."
REFERENCES,0.1705020920502092,REFERENCES
REFERENCES,0.17154811715481172,"Anastasios N Angelopoulos, Stephen Bates, Emmanuel J Cand`es, Michael I Jordan, and Lihua
Lei. Learn then test: Calibrating predictive algorithms to achieve risk control. arXiv preprint
arXiv:2110.01052, 2021."
REFERENCES,0.17259414225941422,"Vineeth Balasubramanian, Shen-Shyang Ho, and Vladimir Vovk. Conformal prediction for reliable
machine learning: theory, adaptations and applications. Newnes, 2014."
REFERENCES,0.17364016736401675,"Rina Foygel Barber, Emmanuel J. Cand`es, Aaditya Ramdas, and Ryan J. Tibshirani. The limits of
distribution-free conditional predictive inference, 2020."
REFERENCES,0.17468619246861924,"Stephen Bates, Anastasios Angelopoulos, Lihua Lei, Jitendra Malik, and Michael I Jordan.
Distribution-free, risk-controlling prediction sets. arXiv preprint arXiv:2101.02703, 2021."
REFERENCES,0.17573221757322174,"Shai Ben-David, John Blitzer, Koby Crammer, and Fernando Pereira. Analysis of representations
for domain adaptation. In Advances in neural information processing systems, pp. 137–144, 2007."
REFERENCES,0.17677824267782427,"Steffen Bickel, Michael Br¨uckner, and Tobias Scheffer. Discriminative learning for differing training
and test distributions. In Proceedings of the 24th international conference on Machine learning,
pp. 81–88. ACM, 2007."
REFERENCES,0.17782426778242677,"Glenn W Brier. Veriﬁcation of forecasts expressed in terms of probability. Monthly weather review,
78(1):1–3, 1950."
REFERENCES,0.1788702928870293,"Emmanuel J. Cand`es, Lihua Lei, and Zhimei Ren. Conformalized survival analysis, 2021."
REFERENCES,0.1799163179916318,"Maxime Cauchois, Suyash Gupta, Alnur Ali, and John C. Duchi. Robust validation: Conﬁdent
predictions even when distributions shift, 2020."
REFERENCES,0.1809623430962343,"Victor Chernozhukov, Kaspar W¨uthrich, and Zhu Yinchu. Exact and robust conformal inference
methods for predictive machine learning with dependent data. In Conference On Learning Theory,
pp. 732–749. PMLR, 2018."
REFERENCES,0.18200836820083682,"Charles J Clopper and Egon S Pearson. The use of conﬁdence or ﬁducial limits illustrated in the
case of the binomial. Biometrika, 26(4):404–413, 1934."
REFERENCES,0.18305439330543932,"Corinna Cortes, Mehryar Mohri, Michael Riley, and Afshin Rostamizadeh.
Sample selection
bias correction theory. In International conference on algorithmic learning theory, pp. 38–53.
Springer, 2008."
REFERENCES,0.18410041841004185,"David R Cox. Two further applications of a model for binary regression. Biometrika, 45(3/4):
562–565, 1958."
REFERENCES,0.18514644351464435,6https://github.com/sangdon/pac-ps-w
REFERENCES,0.18619246861924685,Published as a conference paper at ICLR 2022
REFERENCES,0.18723849372384938,"Morris H DeGroot and Stephen E Fienberg. The comparison and evaluation of forecasters. Journal
of the Royal Statistical Society: Series D (The Statistician), 32(1-2):12–22, 1983."
REFERENCES,0.18828451882845187,"Adam Fisch, Tal Schuster, Tommi Jaakkola, and Regina Barzilay. Few-shot conformal prediction
with auxiliary tasks, 2021."
REFERENCES,0.1893305439330544,"Donald Alexander Stuart Fraser. Nonparametric methods in statistics. John Wiley & Sons Inc, 1956."
REFERENCES,0.1903765690376569,"Yaroslav Ganin, Evgeniya Ustinova, Hana Ajakan, Pascal Germain, Hugo Larochelle, Francois
Laviolette, Mario Marchand, and Victor Lempitsky. Domain-adversarial training of neural net-
works. Journal of Machine Learning Research, 17(59):1–35, 2016. URL http://jmlr.org/
papers/v17/15-239.html."
REFERENCES,0.19142259414225943,"Isaac Gibbs and Emmanuel Cand`es. Adaptive conformal inference under distribution shift, 2021."
REFERENCES,0.19246861924686193,"Chuan Guo, Geoff Pleiss, Yu Sun, and Kilian Q Weinberger.
On calibration of modern neural
networks. arXiv preprint arXiv:1706.04599, 2017."
REFERENCES,0.19351464435146443,"Chirag Gupta, Arun K. Kuchibhotla, and Aaditya K. Ramdas. Nested conformal prediction and
quantile out-of-bag ensemble methods, 2021."
REFERENCES,0.19456066945606695,"Kaiming He, Xiangyu Zhang, Shaoqing Ren, and Jian Sun. Deep residual learning for image recog-
nition. In Proceedings of the IEEE Conference on Computer Vision and Pattern Recognition
(CVPR), pp. 770–778, 2016."
REFERENCES,0.19560669456066945,"Dan Hendrycks and Thomas Dietterich. Benchmarking neural network robustness to common cor-
ruptions and perturbations. Proceedings of the International Conference on Learning Represen-
tations, 2019."
REFERENCES,0.19665271966527198,"Ying Jin, Zhimei Ren, and Emmanuel J Cand`es. Sensitivity analysis of individual treatment effects:
A robust conformal inference approach. arXiv preprint arXiv:2111.12161, 2021."
REFERENCES,0.19769874476987448,"Takafumi Kanamori, Shohei Hido, and Masashi Sugiyama. A least-squares approach to direct im-
portance estimation. Journal of Machine Learning Research, 10(Jul):1391–1445, 2009."
REFERENCES,0.19874476987447698,"Danijel Kivaranovic, Kory D Johnson, and Hannes Leeb. Adaptive, distribution-free prediction
intervals for deep networks. In International Conference on Artiﬁcial Intelligence and Statistics,
pp. 4346–4356. PMLR, 2020."
REFERENCES,0.1997907949790795,"Volodymyr Kuleshov and Percy S Liang. Calibrated structured prediction. In Advances in Neural
Information Processing Systems, pp. 3474–3482, 2015."
REFERENCES,0.200836820083682,"Volodymyr Kuleshov, Nathan Fenner, and Stefano Ermon. Accurate uncertainties for deep learning
using calibrated regression. arXiv preprint arXiv:1807.00263, 2018."
REFERENCES,0.20188284518828453,"Ananya Kumar, Percy S Liang, and Tengyu Ma. Veriﬁed uncertainty calibration. In Advances in
Neural Information Processing Systems, pp. 3792–3803, 2019."
REFERENCES,0.20292887029288703,"Donghwan Lee, Xinmeng Huang, Hamed Hassani, and Edgar Dobriban. T-cal: An optimal test for
the calibration of predictive models. arXiv preprint arXiv:2203.01850, 2022."
REFERENCES,0.20397489539748953,"Jing Lei and Larry Wasserman. Distribution-free prediction bands for non-parametric regression.
Journal of the Royal Statistical Society: Series B (Statistical Methodology), 76(1):71–96, 2014."
REFERENCES,0.20502092050209206,"Jing Lei, Alessandro Rinaldo, and Larry Wasserman. A conformal prediction approach to explore
functional data. Annals of Mathematics and Artiﬁcial Intelligence, 74(1):29–43, 2015."
REFERENCES,0.20606694560669456,"Lihua Lei and Emmanuel J Cand`es. Conformal inference of counterfactuals and individual treatment
effects. arXiv preprint arXiv:2006.06138, 2020."
REFERENCES,0.20711297071129708,"Sarah Lichtenstein, Baruch Fischhoff, and Lawrence D Phillips. Calibration of probabilities: The
state of the art. Decision making and change in human affairs, pp. 275–324, 1977."
REFERENCES,0.20815899581589958,Published as a conference paper at ICLR 2022
REFERENCES,0.20920502092050208,"Zachary Lipton, Yu-Xiang Wang, and Alexander Smola. Detecting and correcting for label shift with
black box predictors. In International conference on machine learning, pp. 3122–3130. PMLR,
2018."
REFERENCES,0.2102510460251046,"Aleksander Madry, Aleksandar Makelov, Ludwig Schmidt, Dimitris Tsipras, and Adrian Vladu.
Towards deep learning models resistant to adversarial attacks. arXiv preprint arXiv:1706.06083,
2017."
REFERENCES,0.2112970711297071,"Ali Malik, Volodymyr Kuleshov, Jiaming Song, Danny Nemer, Harlan Seymour, and Stefano Er-
mon. Calibrated model-based deep reinforcement learning. In International Conference on Ma-
chine Learning, pp. 4314–4323, 2019."
REFERENCES,0.21234309623430964,"Robert G Miller. Statistical prediction by discriminant analysis. In Statistical Prediction by Dis-
criminant Analysis, pp. 1–54. Springer, 1962."
REFERENCES,0.21338912133891214,"Allan H Murphy. Scalar and vector partitions of the probability score: Part i. two-state situation.
Journal of Applied Meteorology, 11(2):273–282, 1972."
REFERENCES,0.21443514644351463,"XuanLong Nguyen, Martin J. Wainwright, and Michael I. Jordan. Estimating divergence functionals
and the likelihood ratio by convex risk minimization. IEEE Transactions on Information Theory,
56(11):5847–5861, Nov 2010. ISSN 1557-9654. doi: 10.1109/tit.2010.2068870. URL http:
//dx.doi.org/10.1109/TIT.2010.2068870."
REFERENCES,0.21548117154811716,"Art B. Owen. Monte Carlo theory, methods and examples. 2013."
REFERENCES,0.21652719665271966,"Artidoro Pagnoni, Stefan Gramatovici, and Samuel Liu. Pac learning guarantees under covariate
shift. arXiv preprint arXiv:1812.06393, 2018."
REFERENCES,0.2175732217573222,"Harris Papadopoulos, Kostas Proedrou, Volodya Vovk, and Alex Gammerman. Inductive conﬁdence
machines for regression. In European Conference on Machine Learning, pp. 345–356. Springer,
2002."
REFERENCES,0.2186192468619247,"Sangdon Park, Osbert Bastani, Nikolai Matni, and Insup Lee. Pac conﬁdence sets for deep neural
networks via calibrated prediction. In International Conference on Learning Representations,
2020a. URL https://openreview.net/forum?id=BJxVI04YvB."
REFERENCES,0.2196652719665272,"Sangdon Park, Osbert Bastani, James Weimer, and Insup Lee. Calibrated prediction with covariate
shift via unsupervised domain adaptation. In The 23rd International Conference on Artiﬁcial
Intelligence and Statistics, 2020b."
REFERENCES,0.22071129707112971,"Sangdon Park, Shuo Li, Insup Lee, and Osbert Bastani. PAC conﬁdence predictions for deep neu-
ral network classiﬁers. In International Conference on Learning Representations, 2021. URL
https://openreview.net/forum?id=Qk-Wq5AIjpq."
REFERENCES,0.2217573221757322,"Xingchao Peng, Qinxun Bai, Xide Xia, Zijun Huang, Kate Saenko, and Bo Wang. Moment matching
for multi-source domain adaptation. In Proceedings of the IEEE International Conference on
Computer Vision, pp. 1406–1415, 2019."
REFERENCES,0.22280334728033474,"John Platt. Probabilistic outputs for support vector machines and comparisons to regularized likeli-
hood methods. Advances in large margin classiﬁers, 1999."
REFERENCES,0.22384937238493724,"Aleksandr Podkopaev and Aaditya Ramdas. Distribution-free uncertainty quantiﬁcation for classi-
ﬁcation under label shift. arXiv preprint arXiv:2103.03323, 2021."
REFERENCES,0.22489539748953974,"Dimitris N Politis. Model-free prediction in regression. In Model-Free Prediction and Regression,
pp. 57–80. Springer, 2015."
REFERENCES,0.22594142259414227,"Hongxiang Qiu, Edgar Dobriban, and Eric Tchetgen Tchetgen. Distribution-free prediction sets
adaptive to unknown covariate shift. arXiv preprint arXiv:2203.06126, 2022."
REFERENCES,0.22698744769874477,"Joaquin Qui˜nonero-Candela, Masashi Sugiyama, Neil D Lawrence, and Anton Schwaighofer.
Dataset shift in machine learning. Mit Press, 2009."
REFERENCES,0.2280334728033473,"Yaniv Romano, Rina Foygel Barber, Chiara Sabatti, and Emmanuel J. Cand`es. With malice towards
none: Assessing uncertainty via equalized coverage, 2019."
REFERENCES,0.2290794979079498,Published as a conference paper at ICLR 2022
REFERENCES,0.2301255230125523,"Reuven Y Rubinstein and Dirk P Kroese. Simulation and the Monte Carlo method, volume 10. John
Wiley & Sons, 2016."
REFERENCES,0.23117154811715482,"Olga Russakovsky, Jia Deng, Hao Su, Jonathan Krause, Sanjeev Satheesh, Sean Ma, Zhiheng
Huang, Andrej Karpathy, Aditya Khosla, Michael Bernstein, et al. Imagenet large scale visual
recognition challenge. International journal of computer vision, 115(3):211–252, 2015."
REFERENCES,0.23221757322175732,"Masashi Sugiyama, Matthias Krauledat, and Klaus-Robert Muller. Covariate shift adaptation by
importance weighted cross validation. Journal of Machine Learning Research, 8(May):985–1005,
2007."
REFERENCES,0.23326359832635984,"Christian Szegedy, Wojciech Zaremba, Ilya Sutskever, Joan Bruna, Dumitru Erhan, Ian Goodfel-
low, and Rob Fergus. Intriguing properties of neural networks. In International Conference on
Learning Representations (ICLR), 2014."
REFERENCES,0.23430962343096234,"Ryan J Tibshirani, Rina Foygel Barber, Emmanuel Candes, and Aaditya Ramdas. Conformal predic-
tion under covariate shift. Advances in Neural Information Processing Systems, 32:2530–2540,
2019."
REFERENCES,0.23535564853556484,"Leslie G Valiant. A theory of the learnable. Communications of the ACM, 27(11):1134–1142, 1984."
REFERENCES,0.23640167364016737,"John von Neumann. Various techniques used in connection with random digits. In A. S. House-
holder, G. E. Forsythe, and H. H. Germond (eds.), Monte Carlo Method, volume 12 of National
Bureau of Standards Applied Mathematics Series, chapter 13, pp. 36–38. US Government Printing
Ofﬁce, Washington, DC, 1951."
REFERENCES,0.23744769874476987,"Vladimir Vovk. Conditional validity of inductive conformal predictors. Machine learning, 92(2-3):
349–376, 2013."
REFERENCES,0.2384937238493724,"Vladimir Vovk, Alex Gammerman, and Glenn Shafer. Algorithmic learning in a random world.
Springer Science & Business Media, 2005."
REFERENCES,0.2395397489539749,"Ximei Wang, Mingsheng Long, Jianmin Wang, and Michael Jordan. Transferable calibration with
lower bias and variance in domain adaptation. In H. Larochelle, M. Ranzato, R. Hadsell, M. F.
Balcan, and H. Lin (eds.), Advances in Neural Information Processing Systems, volume 33, pp.
19212–19223. Curran Associates, Inc., 2020.
URL https://proceedings.neurips.
cc/paper/2020/file/df12ecd077efc8c23881028604dbb8cc-Paper.pdf."
REFERENCES,0.2405857740585774,"Samuel S Wilks. Determination of sample sizes for setting tolerance limits. The Annals of Mathe-
matical Statistics, 12(1):91–96, 1941."
REFERENCES,0.24163179916317992,"Chen Xu and Yao Xie. Conformal prediction interval for dynamic time-series. In International
Conference on Machine Learning, pp. 11559–11569. PMLR, 2021."
REFERENCES,0.24267782426778242,"Yachong Yang, Arun Kumar Kuchibhotla, and Eric Tchetgen Tchetgen. Doubly robust calibration
of prediction sets under covariate shift. arXiv preprint arXiv:2203.01761, 2022."
REFERENCES,0.24372384937238495,"Bianca Zadrozny and Charles Elkan. Obtaining calibrated probability estimates from decision trees
and naive bayesian classiﬁers. In In Proceedings of the Eighteenth International Conference on
Machine Learning. Citeseer, 2001."
REFERENCES,0.24476987447698745,"Bianca Zadrozny and Charles Elkan. Transforming classiﬁer scores into accurate multiclass proba-
bility estimates. In Proceedings of the eighth ACM SIGKDD international conference on Knowl-
edge discovery and data mining, pp. 694–699. ACM, 2002."
REFERENCES,0.24581589958158995,Published as a conference paper at ICLR 2022
REFERENCES,0.24686192468619247,"A
ADDITIONAL RELATED WORK"
REFERENCES,0.24790794979079497,"Prediction sets under i.i.d. assumption. We built our proposed approach on the known PAC
prediction set approach (Wilks, 1941; Park et al., 2020a) due to its simplicity and sample efﬁciency.
As other candidates, nested conformal prediction (Vovk et al., 2005; Gupta et al., 2021) reinterprets
multiple known conformal prediction approaches using a scalar parameteriztion of prediction sets;
but different from Wilks (1941) and Park et al. (2020a), it is not known to provide PAC guarantees.
Kivaranovic et al. (2020) provides a PAC style guarantee, but their approach is limited to regression
and is sample-inefﬁcient, i.e., it requires a sample of size O(1/ϵ2), while Park et al. (2020a) has a
better sample complexity, as demonstrated in their paper."
REFERENCES,0.2489539748953975,"Prediction sets under various settings. Prior prediction set algorithms have been considered in
several settings. First, traditional conformal prediction (Vovk et al., 2005) often considers the setting
where labeled examples arrive sequentially from the same distribution; there has also been work
extending conformal prediction to the setting where the distribution is time-varying (Politis, 2015;
Chernozhukov et al., 2018; Xu & Xie, 2021; Gibbs & Cand`es, 2021). Alternatively, there has been
work on constructing risk-controlling prediction sets for supervised learning setting (Vovk, 2013;
Park et al., 2020a; Bates et al., 2021; Angelopoulos et al., 2021). Finally, there has been recent work
on conformal prediction in the meta-learning setting (Fisch et al., 2021); in particular, given a few
labeled examples drawn from the new task, their approach leverages labeled examples from previous
tasks to construct a conformal predictor for the new task, assuming the tasks are exchangeable."
REFERENCES,0.25,"Developments after our work. After our work was made publicly available, Jin et al. (2021)
has developed a different, robust conformal inference approach to constructing prediction sets with
estimated weights under covariate shift. Their algorithm assumes given upper and lower bounds on
the importance weights, and uses the worst-case quantile over all weights that satisfy the constraint
to set the critical values. Further, Yang et al. (2022) have developed a doubly robust approach to
construct prediction sets satisfying approximate marginal coverage under covariate shift (which can
be robust to estimating the weights and per-covariate prediction error), leveraging semiparametric
efﬁciency theory. Qiu et al. (2022) have developed a parallel approach for the PAC case."
REFERENCES,0.2510460251046025,"Calibration. An alternative way to quantify uncertainty is calibrated prediction (e.g., Brier, 1950;
Cox, 1958; Miller, 1962; Murphy, 1972; Lichtenstein et al., 1977; DeGroot & Fienberg, 1983; Guo
et al., 2017, etc), which aims to ensure that among instances with a predicted conﬁdence p, the
model is correct a fraction p of the time. Techniques have been proposed to re-scale predicted
conﬁdences to improve calibration (Platt, 1999; Guo et al., 2017; Zadrozny & Elkan, 2001; 2002;
Kuleshov & Liang, 2015; Kuleshov et al., 2018; Malik et al., 2019); including ones with theoretical
guarantees (Kumar et al., 2019; Park et al., 2021) and ones that handle covariate shift (Park et al.,
2020b; Wang et al., 2020). There are also methods to rigorously test calibration, dating back to Cox
(1958); Miller (1962), see e.g., Lee et al. (2022) for a recent approach. These approaches provide a
qualitatively different form of uncertainty quantiﬁcation compared to the one we consider."
REFERENCES,0.252092050209205,"Rejection sampling. Rejection sampling (sometimes accept-reject sampling) is a well-known tech-
nique (Owen, 2013; Rubinstein & Kroese, 2016) dating back at least to von Neumann (1951). We
highlight that most work on covariate shift relies on importance weighting; our rejection sampling
approach is relatively less common and more novel. In fact, to the best of our knowledge, only
Pagnoni et al. (2018) has used rejection sampling for a different problem in this area."
REFERENCES,0.25313807531380755,"IW estimation. There has been a long line of work studying the problem of estimating impor-
tance weights (IWs), also called likelihood ratios, in a way that provides theoretical guarantees.
For instance, (Nguyen et al., 2010) provides a convergence rate analysis of IW estimators—under
smoothness assumptions, they provide a ﬁnite sample bound on the Hellinger distance between the
true IW and estimated IW. Next, (Kanamori et al., 2009) shows a similar ﬁnite sample guarantee,
assuming the true IW can be represented as a linear combination of kernels. Finally, (Cortes et al.,
2008) proposes non-parametric IW estimators, modeling the source and target distribution by his-
tograms over clusters in sample space."
REFERENCES,0.25418410041841005,"The IW estimation approaches can be used in conjuction with prediction set construction. Compared
to Cand`es et al. (2021), which only guarantees asymptotic validity under certain assumptions on
the estimated IWs, Theorem 4 provides a ﬁnite-sample correctness guarantee. Furthermore, we
explicitly describe an algorithm for approximate IWs, required by Theorem 4, in Appendix B."
REFERENCES,0.25523012552301255,Published as a conference paper at ICLR 2022
REFERENCES,0.25627615062761505,"B
IMPORTANCE WEIGHT ESTIMATION"
REFERENCES,0.25732217573221755,"In general, to estimate the importance weights (IWs), some assumptions on their structure are re-
quired. A number of approaches have been proposed, with varying guarantees under different as-
sumptions (Kanamori et al., 2009; Cortes et al., 2008; Nguyen et al., 2010; Lipton et al., 2018). We
use a cluster-based approach (Cortes et al., 2008); our approach is compatible with any of these
strategies if they can be modiﬁed to provide uncertainty estimates of the IWs."
REFERENCES,0.2583682008368201,"In our approach, given a partition X = SK
j=1 Bj into bins, we can estimate the IWs based on the
fractions of source and target samples in each bin. If the partition is sufﬁciently ﬁne, then we can
obtain conﬁdence intervals around the estimated IWs with ﬁnite-sample guarantees. However, this
strategy requires the number of bins in the partition to be exponential in the dimension of X. Thus,
in practice, we use a heuristic to construct the partition. We describe the cluster-based approach and
our partition construction heuristic below."
REFERENCES,0.2594142259414226,"B.1
CLUSTER-BASED APPROACH"
REFERENCES,0.2604602510460251,"We assume given unlabeled calibration sets SX
m and T X
n , where SX
m consists of i.i.d. samples xi ∼
p(x) for i ∈[m], and T X
n consists of i.i.d. samples xi ∼q(x) for i ∈[n], respectively7. Roughly
speaking, the cluster-based strategy estimates the average IW in each bin Bj; assuming p and q are
roughly constant in each bin, these accurately estimate the true IWs. Let j(x) be the bin containing
x (i.e., x ∈Bj(x)), and let"
REFERENCES,0.2615062761506276,"pB(x) := pj(x) s.t. pj =
Z"
REFERENCES,0.2625523012552301,"Bj
p(x′) dx′
and
qB(x) := qj(x) s.t. qj =
Z"
REFERENCES,0.26359832635983266,"Bj
q(x′) dx′"
REFERENCES,0.26464435146443516,"be the (unnormalized) approximations of the densities p and q, respectively, that are constant on
each bin. We assume that pB and qB are accurate approximations:"
REFERENCES,0.26569037656903766,"Assumption 1 Given E ∈R≥0, the partition satisﬁes
Z"
REFERENCES,0.26673640167364016,"Bj
|p(x) −p(x′)|dx′ ≤E
and
Z"
REFERENCES,0.26778242677824265,"Bj
|q(x) −q(x′)|dx′ ≤E
(j ∈[K], ∀x ∈Bj).
(12)"
REFERENCES,0.2688284518828452,"Thus, p and q are roughly constant on the partitions. In general, (12) can hold for any E ∈R>0 if p
and q are Lipschitz continuous and each Bj is sufﬁciently small (see Appendix B.3 for discussion).
Then, under Assumption 1, it can be veriﬁed that"
REFERENCES,0.2698744769874477,"|v(x) · p(x) −pB(x)| ≤E
and
|v(x) · q(x) −qB(x)| ≤E
(∀x ∈X),
(13)"
REFERENCES,0.2709205020920502,"where v(x) = vj(x), and vj =
R"
REFERENCES,0.2719665271966527,"Bj dx′ is the volume of bin Bj (see the proof of Theorem 5 for the
validity of (13)). Next, we have the following empirical estimates of pB and qB, respectively:"
REFERENCES,0.2730125523012552,ˆpB(x) := ˆpj(x) s.t. ˆpj = 1 m X
REFERENCES,0.27405857740585776,"x′∈SX
m
1 (x′ ∈Bj) and
(14)"
REFERENCES,0.27510460251046026,ˆqB(x) := ˆqj(x) s.t. ˆqj = 1 n X
REFERENCES,0.27615062761506276,"x′∈T X
n
1 (x′ ∈Bj) .
(15)"
REFERENCES,0.27719665271966526,"Now, 1(x′ ∈Bj) has distribution Bernoulli(pj) when x ∼P, thus m · ˆpj has distribution
Binom(m, pj), and pj is contained in a Clopper-Pearson interval around ˆpj with high probabil-
ity; in particular, let θ be the Clopper-Pearson lower bound corresponding to the Clopper-Pearson
upper bound deﬁned in Section 2.2, i.e., Pk∼Binom(m,µ)[µ ≥θ(k; m, δ)] ≥1 −δ. Then, we have"
REFERENCES,0.27824267782426776,"θ(m · ˆpj; m, δ′) ≤pj ≤θ(m · ˆpj; m, δ′)
(16)"
REFERENCES,0.2792887029288703,"with probability at least 1 −δ′ with respect to the samples SX
m. Combining (13) and (16), we have
the following result (and see Appendix D.6 for a proof):"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.2803347280334728,"7We can use the same calibration set to construct IWs and prediction sets due to the union bound in Theo-
rem 3."
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.2813807531380753,Published as a conference paper at ICLR 2022
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.2824267782426778,"Theorem 5 Letting δ′ = δw/(2K) and [v]+ := max{0, v} for all v ∈R, we have"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.2834728033472803,"w(x) := [θ (n · ˆqB(x); n, δ′) −E]+"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.28451882845188287,"θ (m · ˆpB(x); m, δ′) + E ≤w∗(x) ≤w(x) :=
θ (n · ˆqB(x), n, δ′) + E
[θ (m · ˆpB(x), m, δ′) −E]+ (∀x ∈X) (17)"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.28556485355648537,"with probability at least 1 −δw over SX
m and T X
n ."
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.28661087866108786,"We use these upper and lower bounds on the IWs as the inputs w and w to our algorithm—i.e.,"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.28765690376569036,"W = {w : X →R | ∀x ∈X, w(x) ≤w(x) ≤w(x)} ,"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.28870292887029286,"and use b = maxx∈X w(x) = maxj∈[K] wj as the maximum IW. If b is known, we need importance
weights associated with source calibration samples SX
m; thus we use a simpler form of W as follows:"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.2897489539748954,"W = {w ∈Rm | ∀i ∈[m], wi ≤wi ≤wi} ,"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.2907949790794979,"where wi := w(xi) and wi := w(xi) for xi ∈SX
m."
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.2918410041841004,Theorem 5 under Assumption 1 is one way to construct uncertainty set W that contains the true IWs.
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.2928870292887029,"Corollary 1 Given K ∈N, E ∈R≥0, and δw ∈(0, 1), suppose Assumption 1 is satisﬁed and W is
constructed using Theorem 5. Then, we have"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.2939330543933054,"PSX
m∼P m
X ,T X
n ∼Qn
X [w∗∈W] ≥1 −δw."
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.29497907949790797,"B.2
PARTITION CONSTRUCTION HEURISTIC"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.29602510460251047,"In general, exponentially many bins are needed to guarantee Assumption 1. Instead, we consider
an intuitive heuristic for constructing these bins, so that the importance weights w(x)—rather than
the density functions p(x) and q(x) individually—are roughly constant on each bin, inspired by
(Park et al., 2021; 2020b); a standard heuristic for estimating IWs is to train a probabilistic classiﬁer
g(s | x) to distinguish source and target training examples, and then use these probabilities to
construct the IWs. In particular, deﬁne the distribution"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.29707112970711297,"g∗(x, y) = 1"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.29811715481171547,2p(x) · 1(s = 1) + 1
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.29916317991631797,2q(x) · 1(s = 0).
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.3002092050209205,"Then, letting g∗(y | x) be the conditional distribution, we have w∗(x) = 1/g∗(s = 1 | x)−1 (Bickel
et al., 2007). Thus, we train g(s | x) ≈g∗(s | x) and construct bins according to w(x) = 1/g(s =
1 | x) −1, i.e.,"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.301255230125523,"Bj = {x ∈X | w(x) ∈[wj, wj+1)},"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.3023012552301255,"where 0 = w1 ≤w2 ≤... ≤wK+1 = ∞. Finally, we describe how to train g. Let SX
m′ and T X
n′ be
unlabeled training examples from a source and target, respectively; then, the set"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.303347280334728,"RX
m′,n′ = {(x, 1) | x ∈SX
m′} ∪{(x, 0) | x ∈T X
n′ }"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.3043933054393305,"consists of i.i.d. samples (x, y) ∼s∗(x, y). Thus, we can train s on RX
m′,n′ using supervised
learning. In practice, the corresponding IW estimates w(x) can be inaccurate partly since w is likely
overﬁt to RX
m′,n′, which is why re-estimating the IWs in each bin according to Theorem 5 remains
necessary."
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.3054393305439331,"B.3
DENSITY ESTIMATION SATISFYING ASSUMPTION 1"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.3064853556485356,"We consider the following binning strategy that satisﬁes Assumption 1 for Lipschitz continuous
PDFs. In particular, assume the PDFs p(x) and q(x) are L-Lipschitz continuous for some norm ∥·∥.
Then, for any given E, construct each bin Bj such that"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.3075313807531381,"∥x −x′∥≤
E
L · vj
∀x, x′ ∈Bj,"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.30857740585774057,Published as a conference paper at ICLR 2022
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.30962343096234307,"where vj is the volume of bin Bj. Then, we know that"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.3106694560669456,"|p(x) −p(x′)| ≤L∥x −x′∥≤E vj
, so
Z"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.3117154811715481,"Bj
|p(x) −p(x′)|dx′ ≤E."
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.3127615062761506,"Similarly, we have
Z"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.3138075313807531,"Bj
|q(x) −q(x′)|dx′ ≤E."
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.3148535564853556,"Thus, the bins satisfy Assumption 1. Finally, assuming ∥· ∥is the L∞norm, we describe one way
to construct bins. In particular, construct bins by taking an ε-net with ε = (E/L)1/(d+1), where d
is the dimension of X. Then, we have"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.3158995815899582,∥x −x′∥≤ε = εd+1
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.3169456066945607,"εd
=
E
L · vj
,"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.3179916317991632,as desired.
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.3190376569037657,"C
ADDITIONAL DISCUSSION ON IMPORTANCE WEIGHTS"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.3200836820083682,"C.1
APPROXIMATE IMPORTANCE WEIGHTS"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.32112970711297073,"In Section 3.3, we assume W has the following form:"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.32217573221757323,W := {w ∈Rm | wi ≤wi ≤wi} .
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.32322175732217573,"However, considering the fact that the expected importance weight is one, i.e., Ex∼P [w∗(x)] = 1,
the uncertainty set W that contains the true importance weights with high probability can be further
constrained as follows:"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.32426778242677823,"W′ := {w ∈Rm | ∀i ∈[m] , wi ≤wi ≤wi , c ≤Pm
i=1 wi ≤c}"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.3253138075313807,"for some c and c. In particular, using the Hoeffding’s inequality for example, we can estimate c
and c such that w1, . . . , wm can be the part of the true importance weight w∗that satisﬁes the mass
constraint Ex∼P [w∗(x)] = 1."
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.3263598326359833,"Recall that we have to ﬁnd a maximizer in the uncertainty set W′ as in (8); however, due to the
additional constraint on Pm
i=1 wi in W′, it is challenging to solve the maximization problem exactly."
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.3274058577405858,"C.2
MAXIMUM IMPORTANCE WEIGHT ESTIMATION"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.3284518828451883,"To generalize our approach to estimate the maximum importance weight b, we redeﬁne the uncer-
tainty set W over importance weights as follows:"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.3294979079497908,"W := {w : X →R | ∀x ∈X, w(x) ≤w(x) ≤w(x)}"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.3305439330543933,"for some w : X →R and w : X →R such that it contains the true importance weight w∗with high
probability—i.e.,"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.33158995815899583,"PSX
m∼P m
X ,T X
n ∼Qn
X [w∗∈W] ≥1 −δw.
(18)"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.33263598326359833,"Given this, the maximum importance weight is obtained as follows:"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.33368200836820083,"ˆb = max
x∈X w(x)."
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.33472803347280333,"Considering that W can be estimated using binning as in Appendix B, the maximum importance
weight is rewritten as follows:"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.33577405857740583,"ˆb = max
x∈X w(x) = max
j∈[K] wj,
(19)"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.3368200836820084,Published as a conference paper at ICLR 2022 where
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.3378661087866109,"wj :=
θ (n · ˆqj, n, δ′) + E
[θ (m · ˆpj, m, δ′) −E]+ ."
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.3389121338912134,"Here, θ, θ, m, n, δ′, E, ˆpj, and ˆqj are deﬁned in Theorem 5 and Appendix B."
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.3399581589958159,"The guarantee (18) implies the guarantee (7). Thus, for the maximization over the uncertainty set in
(8), we use the original deﬁnition W and the greedy algorithm for ˆw in (9). Then, Theorem 4 with
the estimated b using (19) still holds as follows:"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.3410041841004184,"Theorem 6 Suppose Assumption 1 is satisﬁed and W is estimated using Theorem 5.
Deﬁne
ˆwτ,SX
m,T X
n as in (9) and ˆbSX
m,T X
n as in (19), making the dependency on τ, SX
m, and T X
n explicit,
and URSCP as in (5). Let ˆτ be the solution of the following problem:"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.34205020920502094,"ˆτ = max
τ∈T τ
subj. to
URSCP(Cτ, Sm, V, ˆwτ,SX
m,T X
n ,ˆbSX
m,T X
n , δC) ≤ε.
(20)"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.34309623430962344,"Then, we have PSm∼P m,V ∼U m,T X
n ∼Qn
X[LQ(Cτ) ≤ε] ≥1 −δC −δw for any τ ≤ˆτ."
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.34414225941422594,"C.3
CHOOSING HYPERPARAMETERS"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.34518828451882844,"In general, there is no systematic way to choose the smoothness parameter E and the number of bins
K; we brieﬂy discuss strategies for doing so."
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.34623430962343094,"Number of bins K. The bins are deﬁned in one dimensional space as described in Appendix B.2, so
we follow the standard practice in the calibration literature for binning (Guo et al., 2017; Park et al.,
2021), where K is between 10 and 20. As we are using equal-mass binning, we choose the number
of bins so that each bin contains sufﬁciently many source examples (in our case, 5000 examples) for
the length of the Clopper-Pearson interval over IWs of each bin to be below some threshold (in our
case, 10−3), which leads us to K = 10. We provide a sensitivity analysis in Appendix G.6."
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.3472803347280335,"Smoothness parameter E. Estimating E (i.e., computing the integral of the difference of source
and target probabilities) is intractable in general as it requires that we perform density estimation
in a high-dimensional space (i.e., 2048 in our case), and then integrate this density over each bin.
To avoid this hyperparameter selection, we choose E equal to zero or close to zero (in our case,
0.001). Intuitively, we ﬁnd that binning based on the source-discriminator scores is an effective way
to group examples with similar IWs; thus, the main contribution to the uncertainty is the error of
the point estimate. We provide a sensitivity analysis on E in Appendix G.5. Importantly, note that
PS-W even with E = 0 satisﬁes PAC criterion. One direction for future work is devising better
strategies for choosing E."
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.348326359832636,"C.4
COMPARISON WITH WSCI"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.3493723849372385,"Guarantee. The main difference between WSCI and PS-W lies in the guarantee provided (rather
than prediction set size); PS-W provides a stronger guarantee than WSCI. In particular, WSCI does
not provide a PAC guarantee. Instead, to satisfy the coverage probability guarantee, it requires a
new calibration set for every new test example. However, in practice, we usually have a single
held-out calibration set. Thus, our approach PS-W provides a guarantee that holds conditioned on
this set. This difference is illustrated in Figure 3a, which compares WSCI and PS-W given the
true importance weight. PS-W produces a larger set size than WSCI, but strictly satisﬁes the error
constraint. The shortcoming of WSCI can also be observed in Figure 2 in Tibshirani et al. (2019),
which empirically shows that the guarantee only holds on average over examples."
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.350418410041841,"Usage of IWs. WSCI requires the true IWs, whereas our method can use approximate IWs. Also,
IWs are used differently. Given the true importance weights, WSCI uses the importance weights to
reweight examples in the calibration set, and PS-W uses the importance weights to generate a target
labeled calibration set using rejection sampling."
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.3514644351464435,Published as a conference paper at ICLR 2022
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.35251046025104604,"D
PROOFS"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.35355648535564854,"D.1
PROOF OF THEOREM 1"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.35460251046025104,"First, note that the constraint in (1) implies F(¯LSm(Cτ); m, ε) ≤δ; conversely, any value of τ
satisfying F(¯LSm(Cτ); m, ε) ≤δ also satisﬁes ¯LSm(Cτ) ≤k(m, ε, δ). Thus, we can rewrite (1) as"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.35564853556485354,"ˆτ = arg max
τ∈T
τ
subj. to
F(¯LSm(Cτ); m, ε) ≤δ."
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.35669456066945604,"On the other hand, if τ satisﬁes (3), then by deﬁnition of UCP(Cτ, Sm, δ) = θ(k; m, δ), we have"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.3577405857740586,"inf{θ ∈[0, 1] | F(¯LSm(Cτ); m, θ) ≤δ} ∪{1} ≤ε,"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.3587866108786611,"which implies that F(¯LSm(Cτ); m, ε) ≤δ (since the inﬁmum is obtained within the set since the
binomial CDF F is continuous in ε). Conversely, any value of τ satisfying F(¯LSm(Cτ); m, ε) ≤δ
also satisﬁes UCP(Cτ, Sm, δ) ≤ε. Thus, we can rewrite (3) as"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.3598326359832636,"ˆτ = arg max
τ∈T
τ
subj. to
F(¯LSm(Cτ); m, ε) ≤δ,"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.3608786610878661,"implying (1) and (3) are equal. Thus, the claim follows from Theorem 1 of (Park et al., 2020a) and
the fact that the error LP (Cτ) is monotonically increasing in τ. □"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.3619246861924686,"D.2
MONOTONICITY OF THE CLOPPER-PEARSON BOUND"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.36297071129707115,"The CP bound UCP enjoys certain monotonicity properties that we will need. Intuitively, the CDF
decreases as the number of observations m increases while holding the number of successes k ﬁxed,
but increases if both m and k are increased by the same amount (i.e., holding the number of failures
m −k ﬁxed). In particular, we have the following:"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.36401673640167365,"Lemma 2 We have θ(k; m −1, δ) ≥θ(k; m, δ) and θ(k −1; m −1, δ) ≤θ(k; m, δ)."
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.36506276150627615,"Proof.
Recall that F(k; m, θ) is the cumulative distribution function of a binomial distribution
Binom (m, θ), or equivalently of the random variable Pm
i=1 Xi, where Xi ∼Bernoulli(θ) are i.i.d."
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.36610878661087864,"Decreasing case. If k ≤m −1, then we have m
X"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.36715481171548114,"i=1
Xi ≤k ⇒ m−1
X"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.3682008368200837,"i=1
Xi ≤k, hence P "" m
X"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.3692468619246862,"i=1
Xi ≤k # ⊆P"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.3702928870292887,"""m−1
X"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.3713389121338912,"i=1
Xi ≤k # ,"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.3723849372384937,"so F(k; m, θ) ≤F(k; m −1, θ)."
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.37343096234309625,"Then, we have"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.37447698744769875,"θ(k; m, δ) := inf {θ ∈[0, 1] | F(k; m, θ) ≤δ} ∪{1}
≤inf {θ ∈[0, 1] | F(k; m −1, θ) ≤δ} ∪{1}"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.37552301255230125,"=: θ(k; m −1, δ),"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.37656903765690375,thus θ is monotonically non-increasing in m.
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.3776150627615063,"Increasing case. We have
m−1
X"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.3786610878661088,"i=1
Xi ≤k −1 ⇒ m
X"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.3797071129707113,"i=1
Xi ≤k, hence P"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.3807531380753138,"""m−1
X"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.3817991631799163,"i=1
Xi ≤k −1 # ⊆P "" m
X"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.38284518828451886,"i=1
Xi ≤k # ,"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.38389121338912136,Published as a conference paper at ICLR 2022
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.38493723849372385,"so F(k −1; m −1, θ) ≤F(k; m, θ)."
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.38598326359832635,"Then, we have"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.38702928870292885,"θ(k; m, δ) := inf {θ ∈[0, 1] | F(k; m, θ) ≤δ} ∪{1}
≥inf {θ ∈[0, 1] | F(k −1; m −1, θ) ≤δ} ∪{1}"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.3880753138075314,"=: θ(k −1; m −1, δ),"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.3891213389121339,"thus θ is monotonically jointly non-decreasing in (m, k).
□"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.3901673640167364,"D.3
PROOF OF THEOREM 2"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.3912133891213389,"The rejection sampling prediction set consists of two steps: (i) generate target samples, using source
samples Sm, importance weights w, and an upper bound on their maximum value b, and (ii) construct
the Clopper-Pearson prediction set using the generated target samples."
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.3922594142259414,"From rejection sampling, we choose N := Pm
i=1 σi samples from Sm, denoting them by TN; here,
N ∼Binom (m, 1/b), and 1/b is the acceptance probability (von Neumann, 1951)—i.e.,"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.39330543933054396,"P

V ′ ≤w(X) b 
= 1 b ,"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.39435146443514646,"where V ′ ∼Uniform([0, 1]). The samples in TN are independent and identically distributed, con-
ditionally on the random number N of samples being equal to any ﬁxed value n. The reason is that
one can view the rejection sampling algorithm proceeding in stages, iterating through the samples
one by one. The ﬁrst stage starts at the very beginning, and then each stage ends when a datapoint
is accepted, followed by starting a new stage at the next datapoint. The last stage ends at the last
datapoint."
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.39539748953974896,"Based only on the source samples observed in one stage, rejection sampling produces a sample from
the target distribution. Thus, within each stage, we produce one sample from the target distribu-
tion, and because each stage is independent of all the other ones, conditionally on any number of
stages reached, our produced target samples are iid. Thus, we can use the Clopper-Pearson bound
conditionally on each N = n."
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.39644351464435146,"To this end, let ˆτ(Sm, V ) = ˆτ to explicitly denote the dependence on Sm and V , and let"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.39748953974895396,"˜τ(Tn) = arg max
τ∈T
τ
subj. to
URSCP(Cτ, Tn, δ) ≤ε."
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.3985355648535565,"Note that conditioned on obtaining n samples using rejection sampling (i.e., |Tn(Sm, V, w, b)| = n),
we have ˆτ(Sm, V )
D= ˜τ(Tn), where
D= denotes equality in distribution. Then, we have"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.399581589958159,"PSm∼P m,V ∼U m 
LQ(Cˆτ(Sm,V )) ≤ε
 = m
X"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.4006276150627615,"n=0
PSm∼P m,V ∼U m[LQ(Cˆτ(Sm,V )) ≤ε | N = n] · P[N = n] = m
X"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.401673640167364,"n=0
PTn∼Qn[LQ(C˜τ(Tn)) ≤ε] · P[N = n] ≥ m
X"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.4027196652719665,"n=0
(1 −δ) · P[N = n]"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.40376569037656906,"= 1 −δ,"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.40481171548117156,where the inequality follows by Theorem 1. The claim follows. □
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.40585774058577406,"D.4
PROOF OF THEOREM 3"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.40690376569037656,"First, let"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.40794979079497906,"˜τ = arg max
τ∈T
τ
subj. to
URSCP(Cτ, Sm, V, ⃗w∗, b, δC) ≤ε,
(21)"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.4089958158995816,Published as a conference paper at ICLR 2022
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.4100418410041841,"which satisﬁes PSm∼P m,V ∼U m [LQ(C˜τ) ≤ε] ≥1 −δC by Theorem 2. Now, with probability at
least 1 −δw, we have ⃗w∗∈W. Under this event, we have
URSCP(Cτ, Sm, V, ⃗w∗, b, δC) ≤max
w∈W URSCP(Cτ, Sm, V, w, b, δC),"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.4110878661087866,"so ˆτ satisﬁes the constraint in (21). Thus, we must have ˆτ ≤˜τ. By monotonicity of LQ(Cτ) in τ,
we have LQ(Cˆτ) ≤LQ(C˜τ), which implies that
PSm∼P m,V ∼U m,T X
n ∼Qn
X[LQ(Cˆτ) ≤ε] ≥PSm∼P m,V ∼U m[LQ(C˜τ) ≤ε] ≥1 −δC,"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.4121338912133891,"where the last step follows by Theorem 2. The claim follows by a union bound, since ⃗w∗∈W with
probability at least 1 −δw. □"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.4131799163179916,"D.5
PROOF OF LEMMA 1"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.41422594142259417,"Let w and v be IWs where w(xi) ≥v(xi) and w(xj) = v(xj) for j ̸= i. Additionally, we use the
following shorthands: nw := m
X"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.41527196652719667,"i=1
1

Vi ≤w(xi) b 
,"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.41631799163179917,"Tnw :=

(xi, yi) ∈Sm"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.41736401673640167,"Vi ≤w(xi) b 
,"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.41841004184100417,"kw :=
X"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.4194560669456067,"(x,y)∈Tnw
1 (y /∈C(x)) , nv := m
X"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.4205020920502092,"i=1
1

Vi ≤v(xi) b 
,"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.4215481171548117,"Tnv :=

(xi, yi) ∈Sm"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.4225941422594142,Vi ≤v(xi) b
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.4236401673640167,"
, and"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.4246861924686193,"kv :=
X"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.42573221757322177,"(x,y)∈Tnv
1 (y /∈C(x)) ."
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.42677824267782427,"Here, nw ≥nv since w(xi) ≥v(xi). Finally, recall that F(k; m, θ) be the cumulative distribution
function of a binomial random variable Pm
i=1 Xi, where Xi ∼Bern(θ)."
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.42782426778242677,"Non-decreasing case. If yi /∈C(xi), there are two cases to consider:"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.42887029288702927,1. If v(xi)
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.4299163179916318,"b
< Vi ≤w(xi)"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.4309623430962343,"b
, then we can verify that nw = nv + 1 and kw = kv + 1.
2. Otherwise, we can verify that nw = nv and kw = kv."
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.4320083682008368,"In both cases, kw ≥nv and nw ≥nv. Since θ is monotonically jointly non-decreasing in (m, k) as
in Lemma 2, we have
URSCP(C, Sm, V, w, b, δ) := UCP(¯LTnw (C), δ)"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.4330543933054393,":= θ(kw; nw, δ)"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.4341004184100418,"≥θ(kv; nv, δ)"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.4351464435146444,"=: UCP(¯LTnv (C), δ)"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.4361924686192469,"=: URSCP(C, Sm, V, v, b, δ),
thus URSCP is monotonically non-decreasing in w(xi)."
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.4372384937238494,"Non-increasing case. If yi ∈C(xi), then kw = kv. Since θ is monotonically non-increasing in m
as in Lemma 2, we have
URSCP(C, Sm, V, w, b, δ) := UCP(¯LTnw (C), δ)"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.4382845188284519,":= θ(kw; nw, δ)"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.4393305439330544,"≤θ(kv; nv, δ)"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.44037656903765693,"=: UCP(¯LTnv (C), δ)"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.44142259414225943,"=: URSCP(C, Sm, V, v, b, δ),"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.4424686192468619,Published as a conference paper at ICLR 2022
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.4435146443514644,thus URSCP is monotonically non-increasing in w(xi).
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.4445606694560669,"D.6
PROOF OF THEOREM 5"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.4456066945606695,Recall that
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.446652719665272,"ˆpB(x) := K
X"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.4476987447698745,"j=1
1 (x ∈Bj)  1 m X"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.448744769874477,"x′∈SX
m
1 (x′ ∈Bj)  ,"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.4497907949790795,"ˆqB(x) := K
X"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.45083682008368203,"j=1
1 (x ∈Bj)  1 n X"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.45188284518828453,"x′∈T X
n
1 (xi ∈Bj)  ,"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.45292887029288703,"pB(x) := K
X"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.45397489539748953,"j=1
1 (x ∈Bj)
Z"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.45502092050209203,"Bj
p(x′) dx′,"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.4560669456066946,"qB(x) := K
X"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.4571129707112971,"j=1
1 (x ∈Bj)
Z"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.4581589958158996,"Bj
q(x′) dx′, and"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.4592050209205021,"v(x) := vj(x) =
Z"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.4602510460251046,"Bj(x)
dx′."
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.46129707112970714,"Due to the assumption of (12), |v(x) · p(x) −pK(x)| is bounded for any x ∈Bj as follows:"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.46234309623430964,|v(x) · p(x) −pB(x)| =  Z
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.46338912133891214,"Bj
p(x) dx′ −
Z"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.46443514644351463,"Bj
p(x′) dx′
 =  Z"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.46548117154811713,"Bj
p(x) −p(x′)dx′ ≤
Z"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.4665271966527197,"Bj
|p(x) −p(x′)| dx′"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.4675732217573222,"= E.
(22)"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.4686192468619247,"Similarly,"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.4696652719665272,"|v(x) · q(x) −qB(x)| ≤E.
(23)"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.4707112970711297,"Observe that mˆp(x) ∼Binom

m,
R"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.47175732217573224,"Bj p(x′)dx′
for any x ∈Bj; thus pK is bounded with proba-"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.47280334728033474,"bility at least 1 −δ′ as follows due to the Clopper-Pearson interval (θ, θ):"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.47384937238493724,"θ(mˆp(x); m, δ′) ≤pK(x) ≤θ(mˆp(x); m, δ′).
(24)"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.47489539748953974,"Similarly,"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.47594142259414224,"θ(nˆq(x); n, δ′) ≤qK(x) ≤θ(nˆq(x); n, δ′).
(25)"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.4769874476987448,"From (22), (23), (24), and (25), the following holds:"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.4780334728033473,"θ(mˆp(x); m, δ′) −E ≤v(x) · p(x) ≤θ(mˆp(x); m, δ′) + E and"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.4790794979079498,"θ(nˆq(x); n, δ′) −E ≤v(x) · q(x) ≤θ(nˆq(x); n, δ′) + E."
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.4801255230125523,"Therefore, for any x ∈Bj, w∗(x) is bounded as follows:"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.4811715481171548,"θ(nˆq(x); n, δ′) −E
θ(mˆp(x); m, δ′) + E ≤w∗(x) = q(x)"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.48221757322175735,"p(x) ≤θ(nˆq(x); n, δ′) + E"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.48326359832635984,"θ(mˆp(x); m, δ′) −E ."
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.48430962343096234,"Since we apply the Clopper-Pearson interval for K partitions for both source and target, the claim
holds due to the union bound."
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.48535564853556484,Published as a conference paper at ICLR 2022
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.48640167364016734,"E
ADDITIONAL ALGORITHMS"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.4874476987447699,"E.1
PS ALGORITHM"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.4884937238493724,Algorithm 2 PS: an algorithm using the CP bound in (3)
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.4895397489539749,"procedure PS(Sm, f, T , ε, δ)"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.4905857740585774,"ˆτ ←0
for τ ∈T do
(▷) Grid search in ascending order
if UCP(Cτ, Sm, δ) ≤ε then"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.4916317991631799,"ˆτ ←max(ˆτ, τ)
else"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.49267782426778245,"break
return ˆτ"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.49372384937238495,"E.2
PS-C ALGORITHM"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.49476987447698745,Algorithm 3 PS-C: an algorithm using the CP bound in (3) with ε/b
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.49581589958158995,"procedure PS-C(Sm, f, T , b, ε, δ)"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.49686192468619245,"return PS(Sm, f, T , ε/b, δ)"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.497907949790795,"We describe the PS-C algorithm, which uses a conservative upper bound on the CP interval. Let"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.4989539748953975,"LP (C) :=
E
(x,y)∼P [1 (y /∈C(x))]"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5,"LQ(C) :=
E
(x,y)∼Q [1 (y /∈C(x))]"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5010460251046025,w∗(x) := q(x)
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.502092050209205,"p(x)
b := max
x∈X w∗(x)."
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5031380753138075,"Then, we have"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.50418410041841,"LQ(C) =
E
(x,y)∼Q [1 (y /∈C(x))]"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5052301255230126,"=
E
(x,y)∼P [w∗(x)1 (y /∈C(x))]"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5062761506276151,"≤
E
(x,y)∼P [b · 1 (y /∈C(x))]"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5073221757322176,"= b
E
(x,y)∼P [1 (y /∈C(x))]"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5083682008368201,= b · LP (C).
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5094142259414226,"Thus, LQ(C) ≤ε if b · LP (C) ≤ε. Equivalently, LQ(C) ≤ε if LP (C) ≤ε/b. As a consequence,
we can choose C based on the CP bound for the i.i.d. case (i.e., Algorithm 2), except using the
desired error of ε/b (instead of ε). The algorithm is described in Algorithm 3."
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5104602510460251,Published as a conference paper at ICLR 2022
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5115062761506276,"E.3
PS-R ALGORITHM"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5125523012552301,Algorithm 4 PS-R: an algorithm using the RSCP bound in (6)
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5135983263598326,"procedure PS-R(Sm, f, T , w, b, ε, δ)"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5146443514644351,"V ∼Uniform([0, 1])m"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5156903765690377,"ˆτ ←0
for τ ∈T do
(▷) Grid search in ascending order
if URSCP(Cτ, Sm, V, w, b, δ) ≤ε then"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5167364016736402,"ˆτ ←max(ˆτ, τ)
else"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5177824267782427,"break
return ˆτ"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5188284518828452,"E.4
PS-M ALGORITHM"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5198744769874477,Algorithm 5 PS-M: an algorithm using the RSCP bound in (6) along with IWs rescaling
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5209205020920502,"procedure PS-M(Sm, T X
n , f, T , w, b, ε, δ)
ˆw(x) ←ˆqB(x)"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5219665271966527,"ˆpB(x) for x ∈X, where ˆpB and ˆqB are deﬁned in (14) and (15), respectively
return PS-R(Sm, f, T , ˆw, b, ε, δ)"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5230125523012552,"F
EXPERIMENT DETAILS"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5240585774058577,"F.1
DOMAIN ADAPTATION"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5251046025104602,"We use a fully-connected network (with two hidden layers, where each layers has 500 neurons
followed by ReLU activations and a 0.5-dropout layer) as the domain classiﬁer (recall that the input
of this domain classiﬁer is the last hidden layer of ResNet101). We use the last hidden layer of
the model as example space X, where its dimension is 2048. For neural network training, we run
stochastic gradient descent (SGD) for 100 epochs with an initial learning rate of 0.1, decaying it by
half once every 20 epochs. The domain adaptation regularizer is gradually increased as in (Ganin
et al., 2016). We use the same hyperparameters for all experiments."
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5261506276150628,"F.2
DOMAINNET"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5271966527196653,"We split the dataset into 409,832 training, 88,371 calibration, and 88,372 test images."
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5282426778242678,"F.3
IMAGENETC-13"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5292887029288703,"We split ImageNet into 1.2M training, 25K calibration, and 25K test images, and ImageNet-C13
into 83M training, 1.6M calibration, and 1.6M test images."
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5303347280334728,"To train a model using domain adaptation, due to the large size of the target training set, we sub-
sample the target training set to be the same size as the source training set on for each random
trials."
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5313807531380753,"G
ADDITIONAL RESULTS"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5324267782426778,"G.1
SYNTHETIC RATE SHIFT BY TWO GAUSSIANS"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5334728033472803,"We demonstrate the efﬁcacy of the proposed approaches (i.e., PS-R with the known IWs and PS-W
with the estimated IWs) using a synthetic dataset consisting of samples from two Gaussian distribu-
tions."
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5345188284518828,"Dataset. We consider two Gaussian distributions N(µ, Σ) and N(µ, Σ′) over 2048-dimensional
covariate space X. Here, µ = 0; Σ and Σ′ are diagonal where Σ1,1 = 52, Σi,i = 10−1, Σ′
1,1 = 1,"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5355648535564853,Published as a conference paper at ICLR 2022
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5366108786610879,"PS
WSCI
PS-C
PS-W
0.00 0.01 0.02 0.03 0.04"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5376569037656904,prediction set error error
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5387029288702929,= 0.01
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5397489539748954,"PS
WSCI
PS-C
PS-W
0.00 0.25 0.50 0.75 1.00 1.25 1.50 1.75 2.00"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5407949790794979,prediction set size size
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5418410041841004,(a) With the known true IW
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5428870292887029,"PS
WSCI PS-C PS-R PS-W
0.00 0.01 0.02 0.03 0.04"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5439330543933054,prediction set error error
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5449790794979079,= 0.01
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5460251046025104,"PS
WSCI PS-C PS-R PS-W
0.00 0.25 0.50 0.75 1.00 1.25 1.50 1.75 2.00"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.547071129707113,prediction set size size
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5481171548117155,(b) With an estimated IW
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.549163179916318,"Figure 3: Error under the rate shift by Two Gaussians (over 100 random trials). Parameters are
m = 50, 000, ε = 0.01, and δ = 10−5."
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5502092050209205,"and Σ′
i,i = 10−1 for i ∈{2, . . . , 2048}. We consider the “ﬂat” Gaussian N(µ, Σ) as the source
and the “tall” Gaussian N(µ, Σ′) as the target. Intuitively, there is a rate shift from the source to the
target—i.e., the target examples are a subset of the source, but occur with higher frequencies. We
use the following labeling function: p(y | x) = σ(5x1), where σ is the sigmoid function. Finally,
we generate 50,000 labeled examples for each training, calibration, and test."
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.551255230125523,"Results. We consider two different setups: 1) the true IW is known, and 2) the true IW is unknown.
In Figure 3a, we demonstrate the prediction set errors given the true IW. As expected PS-R satisﬁes
the PAC guarantee—i.e., the error is below ε. However, as shown in Figure 3b, when we need to
estimate IWs, using just the point-estimate of the IW results in PS-R performing poorly in terms
of prediction set error; it still satisﬁes the ε constraint, but the error is close to zero, indicating that
the prediction set size is too large to be useful for an uncertainty quantiﬁer. In contrast, PS-W (i.e.,
rejection sampling based on interval estimates of IWs) produces a larger, more reasonable error rate
while still satisfying the PAC condition. These experiments demonstrate that PS-R works well when
given the true IW, but accounting for IW uncertainty is important when using estimated IWs."
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5523012552301255,Published as a conference paper at ICLR 2022
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.553347280334728,"G.2
PREDICTION SET SIZE AND ERROR"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5543933054393305,"PS
WSCI PS-C PS-R PS-W
0.00 0.02 0.04 0.06 0.08 0.10"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.555439330543933,prediction set error error
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5564853556485355,= 0.10
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5575313807531381,"PS
WSCI PS-C PS-R PS-W
0 20 40 60 80 100"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5585774058577406,prediction set size size
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5596234309623431,(a) All
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5606694560669456,"PS
WSCI
PS-C
PS-W
0.00 0.02 0.04 0.06 0.08 0.10 0.12 0.14"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5617154811715481,prediction set error error
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5627615062761506,= 0.10
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5638075313807531,"PS
WSCI
PS-C
PS-W
0 50 100 150 200 250 300 350"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5648535564853556,prediction set size size
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5658995815899581,(b) Sketch
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5669456066945606,"PS
WSCI
PS-C
PS-W
0.00 0.02 0.04 0.06 0.08 0.10"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5679916317991632,prediction set error error
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5690376569037657,= 0.10
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5700836820083682,"PS
WSCI
PS-C
PS-W
0 50 100 150 200 250 300 350"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5711297071129707,prediction set size size
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5721757322175732,(c) Clipart
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5732217573221757,"PS
WSCI
PS-C
PS-W
0.000 0.025 0.050 0.075 0.100 0.125 0.150"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5742677824267782,prediction set error error
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5753138075313807,= 0.10
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5763598326359832,"PS
WSCI
PS-C
PS-W
0 50 100 150 200 250 300 350"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5774058577405857,prediction set size size
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5784518828451883,(d) Painting
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5794979079497908,"PS
WSCI
PS-C
PS-W
0.00 0.02 0.04 0.06 0.08 0.10"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5805439330543933,prediction set error error
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5815899581589958,= 0.10
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5826359832635983,"PS
WSCI
PS-C
PS-W
0 25 50 75 100 125 150 175"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5836820083682008,prediction set size size
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5847280334728033,(e) Quickdraw
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5857740585774058,"PS
WSCI
PS-C
PS-W
0.00 0.02 0.04 0.06 0.08 0.10"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5868200836820083,prediction set error error
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5878661087866108,= 0.10
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5889121338912134,"PS
WSCI
PS-C
PS-W
0 25 50 75 100 125 150 175"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5899581589958159,prediction set size size
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5910041841004184,(f) Real
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5920502092050209,"PS
WSCI
PS-C
PS-W
0.00 0.05 0.10 0.15 0.20 0.25 0.30 0.35"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5930962343096234,prediction set error error
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5941422594142259,= 0.10
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5951882845188284,"PS
WSCI
PS-C
PS-W
0 50 100 150 200 250 300 350"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5962343096234309,prediction set size size
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5972803347280334,(g) Infograph
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5983263598326359,"PS
WSCI
PS-C
PS-W
0.00 0.02 0.04 0.06 0.08 0.10 0.12"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.5993723849372385,prediction set error error
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.600418410041841,= 0.10
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6014644351464435,"PS
WSCI
PS-C
PS-W
0 200 400 600 800 1000"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.602510460251046,prediction set size size
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6035564853556485,(h) ImageNet-C13
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.604602510460251,"PS
WSCI
PS-C
PS-W
0.00 0.02 0.04 0.06 0.08 0.10"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6056485355648535,prediction set error error
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.606694560669456,= 0.10
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6077405857740585,"PS
WSCI
PS-C
PS-W
0 200 400 600 800 1000"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.608786610878661,prediction set size size
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6098326359832636,(i) ImageNet + PGD
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6108786610878661,"Figure 4: Prediction set error and size under rate shifts on DomainNet (a-g) and under support shifts
on ImageNet (h, i) (over 100 random trials for error and over a held-out test set for size). Parameters
are m = 50, 000 for DomainNet and m = 20, 000 for ImageNet, ε = 0.1, and δ = 10−5."
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6119246861924686,Published as a conference paper at ICLR 2022
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6129707112970711,"G.3
ABLATION STUDY ON CALIBRATION"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6140167364016736,"PS-R
PS-M
PS-W
0.00 0.02 0.04 0.06 0.08 0.10"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6150627615062761,prediction set error error
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6161087866108786,= 0.10
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6171548117154811,"PS-R
PS-M
PS-W
0 50 100 150 200 250 300 size size"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6182008368200836,(a) DomainNet-Sketch
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6192468619246861,"PS-R
PS-M
PS-W
0.00 0.02 0.04 0.06 0.08 0.10"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6202928870292888,prediction set error error
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6213389121338913,= 0.10
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6223849372384938,"PS-R
PS-M
PS-W
0 25 50 75 100 125 150 175 200 size size"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6234309623430963,(b) DomainNet-Clipart
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6244769874476988,"PS-R
PS-M
PS-W
0.00 0.02 0.04 0.06 0.08 0.10"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6255230125523012,prediction set error error
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6265690376569037,= 0.10
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6276150627615062,"PS-R
PS-M
PS-W
0 50 100 150 200 250 size size"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6286610878661087,(c) DomainNet-Painting
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6297071129707112,"PS-R
PS-M
PS-W
0.00 0.02 0.04 0.06 0.08 0.10"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6307531380753139,prediction set error error
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6317991631799164,= 0.10
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6328451882845189,"PS-R
PS-M
PS-W
0 5 10 15 20 25 30 35 40 size size"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6338912133891214,(d) DomainNet-Quickdraw
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6349372384937239,"PS-R
PS-M
PS-W
0.00 0.02 0.04 0.06 0.08 0.10"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6359832635983264,prediction set error error
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6370292887029289,= 0.10
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6380753138075314,"PS-R
PS-M
PS-W
0 10 20 30 40 50 60 70 80 size size"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6391213389121339,(e) DomainNet-Real
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6401673640167364,"PS-R
PS-M
PS-W
0.00 0.02 0.04 0.06 0.08 0.10 0.12"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.641213389121339,prediction set error error
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6422594142259415,= 0.10
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.643305439330544,"PS-R
PS-M
PS-W
0 50 100 150 200 250 300 350 size size"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6443514644351465,(f) DomainNet-Infograph
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.645397489539749,"PS-R
PS-M
PS-W
0.00 0.02 0.04 0.06 0.08 0.10"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6464435146443515,prediction set error error
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.647489539748954,= 0.10
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6485355648535565,"PS-R
PS-M
PS-W
0 200 400 600 800 1000 size size"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.649581589958159,(g) ImageNet-C13
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6506276150627615,"PS-R
PS-M
PS-W
0.00 0.02 0.04 0.06 0.08 0.10"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6516736401673641,prediction set error error
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6527196652719666,= 0.10
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6537656903765691,"PS-R
PS-M
PS-W
0 200 400 600 800 1000 size size"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6548117154811716,(h) ImageNet-PGD
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6558577405857741,"Figure 5: Ablation study on calibration (over 100 random trial for error and over a held-out test set
for size). PS-R does not use rescaled IWs, PS-M uses point estimates of rescaled IWs, and PS-W
uses intervals around rescaled IWs. Parameters are m = 50, 000 for DomainNet shifts, m = 20, 000
for ImageNet shifts, ε = 0.1, and δ = 10−5. In particular, we consider a variant PS-M of PS-W that
ignores the worst-case IWs as in Theorem 3; instead, it rescales the importance weights in each bin
via a point estimate, i.e., Theorem 5 without the Clopper-Pearson interval (i.e., m = n = ∞) and
with E = 0. As can be seen in the results on the shift to various domains, our approach satisﬁes the
PAC guarantee but this version does not—in fact, its error is even worse than PS-R, which uses the
non-rescaled importance weights from the probabilistic classiﬁer s."
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6569037656903766,Published as a conference paper at ICLR 2022
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6579497907949791,"G.4
COMPARISON WITH VARIOUS TOP-K PREDICTION SETS"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6589958158995816,"Top1
Top5
Top10 Top50
PS-W
0.00 0.05 0.10 0.15 0.20 0.25 0.30 0.35"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6600418410041841,prediction set error error
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6610878661087866,= 0.10
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6621338912133892,"Top1
Top5
Top10 Top50
PS-W
0 20 40 60 80 100"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6631799163179917,prediction set size size
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6642259414225942,(a) All
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6652719665271967,"Top1
Top5
Top10 Top50
PS-W
0.00 0.05 0.10 0.15 0.20 0.25 0.30 0.35"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6663179916317992,prediction set error error
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6673640167364017,= 0.10
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6684100418410042,"Top1
Top5
Top10 Top50
PS-W
0 50 100 150 200 250 300"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6694560669456067,prediction set size size
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6705020920502092,(b) Sketch
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6715481171548117,"Top1
Top5
Top10 Top50
PS-W
0.00 0.05 0.10 0.15 0.20 0.25 0.30"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6725941422594143,prediction set error error
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6736401673640168,= 0.10
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6746861924686193,"Top1
Top5
Top10 Top50
PS-W
0 25 50 75 100 125 150 175 200"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6757322175732218,prediction set size size
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6767782426778243,(c) Clipart
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6778242677824268,"Top1
Top5
Top10 Top50
PS-W
0.0 0.1 0.2 0.3 0.4"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6788702928870293,prediction set error error
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6799163179916318,= 0.10
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6809623430962343,"Top1
Top5
Top10 Top50
PS-W
0 50 100 150 200 250"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6820083682008368,prediction set size size
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6830543933054394,(d) Painting
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6841004184100419,"Top1
Top5
Top10 Top50
PS-W
0.00 0.05 0.10 0.15 0.20 0.25 0.30"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6851464435146444,prediction set error error
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6861924686192469,= 0.10
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6872384937238494,"Top1
Top5
Top10 Top50
PS-W
0 10 20 30 40 50"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6882845188284519,prediction set size size
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6893305439330544,(e) Quickdraw
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6903765690376569,"Top1
Top5
Top10 Top50
PS-W
0.00 0.05 0.10 0.15 0.20 0.25"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6914225941422594,prediction set error error
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6924686192468619,= 0.10
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6935146443514645,"Top1
Top5
Top10 Top50
PS-W
0 10 20 30 40 50 60 70 80"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.694560669456067,prediction set size size
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6956066945606695,(f) Real
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.696652719665272,"Top1
Top5
Top10 Top50
PS-W
0.0 0.1 0.2 0.3 0.4 0.5 0.6 0.7"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6976987447698745,prediction set error error
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.698744769874477,= 0.10
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.6997907949790795,"Top1
Top5
Top10 Top50
PS-W
0 50 100 150 200 250 300 350"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.700836820083682,prediction set size size
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7018828451882845,(g) Infograph
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.702928870292887,"Top1
Top5
Top10 Top50
PS-W
0.0 0.1 0.2 0.3 0.4"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7039748953974896,prediction set error error
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7050209205020921,= 0.10
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7060669456066946,"Top1
Top5
Top10 Top50
PS-W
0 50 100 150 200 250"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7071129707112971,prediction set size size
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7081589958158996,(h) ImageNet-C13
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7092050209205021,"Top1
Top5
Top10 Top50
PS-W
0.00 0.05 0.10 0.15 0.20 0.25"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7102510460251046,prediction set error error
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7112970711297071,= 0.10
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7123430962343096,"Top1
Top5
Top10 Top50
PS-W
0 50 100 150 200 250"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7133891213389121,prediction set size size
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7144351464435147,(i) ImageNet + PGD
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7154811715481172,"Figure 6: Prediction set error size size under rate shifts on DomainNet (a-g) and under support shifts
on ImageNet (h, i) (over 100 random trial). Default parameters are m = 50, 000 for DomainNet
and m = 20, 000 for ImageNet, ε = 0.1, and δ = 10−5. A Top-K prediction set is a prediction
set that contains top K labels based on a domain-adapted score function; thus the set size is always
K. As can be seen in the prediction set error plots, Top-K prediction sets do not consistently satisfy
the desired ϵ guarantee. Moreover, the prediction set size is worse than PS-W. For example, when
the Top-50 prediction set error rate almost achieves the desired error rate, e.g., (6d), the mean and
medial of the corresponding prediction set size is larger than PS-W."
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7165271966527197,Published as a conference paper at ICLR 2022
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7175732217573222,"G.5
VARYING A SMOOTHNESS PARAMETER"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7186192468619247,"0
0.001
0.005
0.01
E 0.00 0.02 0.04 0.06 0.08 0.10"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7196652719665272,prediction set error
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7207112970711297,= 0.10
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7217573221757322,"0
0.001 0.005
0.01
0 25 50 75 100 125 150 175 size"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7228033472803347,(a) All
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7238493723849372,"0
0.001
0.005
0.01
E 0.00 0.02 0.04 0.06 0.08 0.10"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7248953974895398,prediction set error
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7259414225941423,= 0.10
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7269874476987448,"0
0.001 0.005
0.01
0 50 100 150 200 250 size"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7280334728033473,(b) Sketch
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7290794979079498,"0
0.001
0.005
0.01
E 0.00 0.02 0.04 0.06 0.08 0.10"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7301255230125523,prediction set error
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7311715481171548,= 0.10
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7322175732217573,"0
0.001 0.005
0.01
0 50 100 150 200 size"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7332635983263598,(c) Clipart
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7343096234309623,"0
0.001
0.005
0.01
E 0.00 0.02 0.04 0.06 0.08 0.10"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7353556485355649,prediction set error
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7364016736401674,= 0.10
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7374476987447699,"0
0.001 0.005
0.01
0 50 100 150 200 250 size"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7384937238493724,(d) Painting
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7395397489539749,"0
0.001
0.005
0.01
E 0.00 0.02 0.04 0.06 0.08 0.10"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7405857740585774,prediction set error
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7416317991631799,= 0.10
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7426778242677824,"0
0.001 0.005
0.01
0 10 20 30 40 50 60 70 80 size"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7437238493723849,(e) Quickdraw
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7447698744769874,"0
0.001
0.005
0.01
E 0.00 0.02 0.04 0.06 0.08 0.10"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.74581589958159,prediction set error
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7468619246861925,= 0.10
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.747907949790795,"0
0.001 0.005
0.01
0 50 100 150 200 250 size"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7489539748953975,(f) Real
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.75,"0
0.001
0.005
0.01
E 0.00 0.02 0.04 0.06 0.08 0.10"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7510460251046025,prediction set error
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.752092050209205,= 0.10
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7531380753138075,"0
0.001 0.005
0.01
0 50 100 150 200 250 300 350 size"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.75418410041841,(g) Infograph
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7552301255230126,"0
0.001
0.005
0.01
E 0.00 0.02 0.04 0.06 0.08 0.10"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7562761506276151,prediction set error
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7573221757322176,= 0.10
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7583682008368201,"0
0.001 0.005
0.01
0 100 200 300 400 500 size"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7594142259414226,(h) ImageNet-C13
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7604602510460251,"0
0.001
0.005
0.01
E 0.00 0.02 0.04 0.06 0.08 0.10"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7615062761506276,prediction set error
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7625523012552301,= 0.10
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7635983263598326,"0
0.001 0.005
0.01
0 25 50 75 100 125 150 175 200 size"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7646443514644351,(i) ImageNet + PGD
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7656903765690377,"Figure 7: Prediction set error size size under rate shifts on DomainNet (a-g) and under support
shifts on ImageNet (h, i) (over 100 random trial) for varying E. Parameters are m = 50, 000 for
DomainNet and m = 20, 000 for ImageNet, ε = 0.1, and δ = 10−5. In particular, the parameter
E in Assumption 1 bounds the quality of our estimates of p(x) and q(x); since these errors cannot
be conveniently measured, we have chosen it heuristically as a hyperparameter. In this ﬁgure, we
show the error of PS-W as a function of E. As E becomes smaller, the prediction sets become more
optimistic while still satisfying the PAC guarantee. Note that the optimal case is E = 0, since PS-W
still satisﬁes the PAC guarantee; this result suggests that our IW estimates are reasonably accurate."
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7667364016736402,Published as a conference paper at ICLR 2022
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7677824267782427,"G.6
VARYING A NUMBER OF BINS"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7688284518828452,"5
10
15
20
K 0.00 0.02 0.04 0.06 0.08 0.10"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7698744769874477,prediction set error
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7709205020920502,= 0.10
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7719665271966527,"5
10
15
20
0 25 50 75 100 125 150 175 200 size"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7730125523012552,(a) All
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7740585774058577,"5
10
15
20
K 0.00 0.02 0.04 0.06 0.08 0.10"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7751046025104602,prediction set error
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7761506276150628,= 0.10
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7771966527196653,"5
10
15
20
0 50 100 150 200 250 size"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7782426778242678,(b) Sketch
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7792887029288703,"5
10
15
20
K 0.00 0.02 0.04 0.06 0.08 0.10"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7803347280334728,prediction set error
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7813807531380753,= 0.10
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7824267782426778,"5
10
15
20
0 50 100 150 200 250 300 size"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7834728033472803,(c) Clipart
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7845188284518828,"5
10
15
20
K 0.00 0.02 0.04 0.06 0.08 0.10"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7855648535564853,prediction set error
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7866108786610879,= 0.10
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7876569037656904,"5
10
15
20
0 50 100 150 200 250 size"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7887029288702929,(d) Painting
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7897489539748954,"5
10
15
20
K 0.00 0.02 0.04 0.06 0.08 0.10"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7907949790794979,prediction set error
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7918410041841004,= 0.10
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7928870292887029,"5
10
15
20
0 10 20 30 40 50 size"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7939330543933054,(e) Quickdraw
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7949790794979079,"5
10
15
20
K 0.00 0.02 0.04 0.06 0.08 0.10"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7960251046025104,prediction set error
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.797071129707113,= 0.10
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.7981171548117155,"5
10
15
20
0 50 100 150 200 size"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.799163179916318,(f) Real
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8002092050209205,"5
10
15
20
K 0.00 0.02 0.04 0.06 0.08 0.10 0.12"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.801255230125523,prediction set error
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8023012552301255,= 0.10
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.803347280334728,"5
10
15
20
0 50 100 150 200 250 300 350 size"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8043933054393305,(g) Infograph
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.805439330543933,"5
10
15
20
K 0.00 0.02 0.04 0.06 0.08 0.10"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8064853556485355,prediction set error
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8075313807531381,= 0.10
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8085774058577406,"5
10
15
20
0 100 200 300 400 500 size"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8096234309623431,(h) ImageNet-C13
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8106694560669456,"5
10
15
20
K 0.00 0.02 0.04 0.06 0.08 0.10"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8117154811715481,prediction set error
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8127615062761506,= 0.10
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8138075313807531,"5
10
15
20
0 50 100 150 200 250 300 350 400 size"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8148535564853556,(i) ImageNet + PGD
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8158995815899581,"Figure 8: Prediction set error size size under rate shifts on DomainNet (a-g) and under support
shifts on ImageNet (h, i) (over 100 random trial) for varying K. Parameters are m = 50, 000
for DomainNet and m = 20, 000 for ImageNet, ε = 0.1, and δ = 10−5. In general, K must be
chosen to be small enough so each bin contains sufﬁciently many source examples to achieve a small
Clopper-Perason interval size (e.g., 10−3), though it also needs to be sufﬁciently large to satisfy the
smoothness assumption."
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8169456066945606,Published as a conference paper at ICLR 2022
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8179916317991632,"G.7
PREDICTION SET VISUALIZATION"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8190376569037657,"Example x
ˆCPS(x)
ˆCPS-W(x)
Example x
ˆCPS(x)
ˆCPS-W(x)"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8200836820083682,"
\
raccoon
	
"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8211297071129707,"owl,
\
raccoon"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8221757322175732,"
angel,
d
harp "
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8232217573221757,"





"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8242677824267782,"




"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8253138075313807,"angel,"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8263598326359832,"cello,
d
harp,"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8274058577405857,"microphone,
piano,
violin"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8284518828451883,"





"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8294979079497908,"




"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8305439330543933,"
\
wine bottle 

 
"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8315899581589958,"bread,
grapes,
\
wine bottle,
wine glass 

 
"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8326359832635983," [
shark,
snorkel "
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8336820083682008,"



"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8347280334728033,"


"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8357740585774058,"dolphin,
[
shark,
snorkel,
submarine, whale"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8368200836820083,"



"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8378661087866108,"


"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8389121338912134,"n
\
campﬁre
o



 

"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8399581589958159,"\
campﬁre,
ocean,"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8410041841004184,"star,
tent"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8420502092050209,"


 

"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8430962343096234,"
coffee cup,
c
cup  

 
"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8441422594142259,"coffee cup,
c
cup,
mug,
teapot 

 
"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8451882845188284,"
[
ocean 

 
"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8462343096234309,"hurricane,
[
ocean,
square,
tornado 

 
"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8472803347280334,"n
[
brain
o"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8483263598326359,"



"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8493723849372385,"


"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.850418410041841,"[
brain,
ﬁsh,
lion,
lollipop,
sea turtle"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8514644351464435,"



"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.852510460251046,"


"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8535564853556485,"n
\
penguin
o



 

"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.854602510460251,"ﬁre hydrant,"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8556485355648535,"foot,
\
penguin,
telephone"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.856694560669456,"


 

"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8577405857740585," hat,
\
hot tub "
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.858786610878661,"













"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8598326359832636,"












"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8608786610878661,"bed,
belt,
birthday cake,
guitar,
hat,
\
hot tub,
tiny paint can,
pillow,"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8619246861924686,"shoe,
table"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8629707112970711,"













"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8640167364016736,"












"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8650627615062761,"
\
asparagus "
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8661087866108786,"







"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8671548117154811,"






"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8682008368200836,"\
asparagus,
basket,
bread,
carrot,
harp,
lobster,
toothbrush"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8692468619246861,"







"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8702928870292888,"






"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8713389121338913," \
baseball,
onion"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8723849372384938,"






"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8734309623430963,"




"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8744769874476988,"\
baseball,
baseball bat,
bread,
light bulb,
onion,
potato"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8755230125523012,"





"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8765690376569037,"




"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8776150627615062,"Figure 9: Prediction sets of the DomainNet shift from All to Paint. Parameters are m = 50, 000,
ε = 0.1, and δ = 10−5. The green label is the true label and the label with the hat is the predicted
label. We choose examples where the two approaches differ; in particular, if PS-W is incorrect, then
PS is incorrect as well since the prediction set sizes are monotone in τ."
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8786610878661087,Published as a conference paper at ICLR 2022
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8797071129707112,"Example x
ˆCPS(x)
ˆCPS-W(x)
Example x
ˆCPS(x)
ˆCPS-W(x)"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8807531380753139,"n
\
photocopier
o

printer,
\
photocopier 

 "
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8817991631799164,"\
timber wolf,
red wolf,
dingo 
 "
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8828451882845189,"




"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8838912133891214,"



"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8849372384937239,"\
timber wolf,
white wolf,
red wolf,"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8859832635983264,"coyote,
dingo"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8870292887029289,"




"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8880753138075314,"



 
 "
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8891213389121339,"airliner,
airship,
\
warplane 
 "
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8901673640167364,"











"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.891213389121339,"










"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8922594142259415,"aircraft carrier,
airliner,
airship,
container ship,
stopwatch,
parachute,
tank,
\
warplane, wing"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.893305439330544,"











"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8943514644351465,"










"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.895397489539749,"





"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8964435146443515,"




"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.897489539748954,"forklift,
golfcart,
harvester,
\
lawn mower,
snowplow,
tracktor"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.8985355648535565,"





"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.899581589958159,"




"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9006276150627615,"











"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9016736401673641,"










"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9027196652719666,"forklift,
gokart,
golfcart,
harvester,
\
lawn mower,
pickup,
snowplow,"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9037656903765691,"thresher,
tracktor"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9048117154811716,"











"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9058577405857741,"










 
 "
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9069037656903766,"\
leopard,"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9079497907949791,"snow leopard,
cheetah 
 "
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9089958158995816,"


 

"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9100418410041841,"\
leopard,"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9110878661087866,"snow leopard,"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9121338912133892,"jaguar,
cheetah"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9131799163179917,"


 

"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9142259414225942,"
\
diamondback,
sidewinder 

 "
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9152719665271967,"hognose snake,
\
diamondback,
sidewinder 
 "
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9163179916317992,"n
\
television
o"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9173640167364017,"


 

"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9184100418410042,"ent. center,
monitor,"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9194560669456067,"screen,
\
television"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9205020920502092,"


 

"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9215481171548117,"




"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9225941422594143,"



"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9236401673640168,"analog clock,
barometer,
odometer,
stopwatch,
\
wall clock"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9246861924686193,"




"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9257322175732218,"



"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9267782426778243,"







"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9278242677824268,"






"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9288702928870293,"analog clock,
barometer,
digital watch,
mag. compass,
odometer,
stopwatch,
\
wall clock"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9299163179916318,"







"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9309623430962343,"






"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9320083682008368,"chameleon,
\
green lizard"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9330543933054394,"





"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9341004184100419,"



"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9351464435146444,"chameleon,
\
green lizard,
green snake,
waling stick,
mantis"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9361924686192469,"




"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9372384937238494,"



"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9382845188284519,"


 

"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9393305439330544,"\
barbell,
dumbbell,
lens cap,
puck"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9403765690376569,"


 

"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9414225941422594,"









"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9424686192468619,"








"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9435146443514645,"\
barbell,
barometer,
car wheel,
dumbbell,
lens cap,
power drill,
puck,
stethoscope"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.944560669456067,"









"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9456066945606695,"








"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.946652719665272,"
\
Pembroke,
Cardigan"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9476987447698745,"

\
Pembroke,
Cardigan 

 "
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.948744769874477,"face powder,
\
lipstick,
paintbrush 
 "
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9497907949790795,"





"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.950836820083682,"




"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9518828451882845,"ballpoint,
face powde,
\
lipstick,
paintbrush,
perfume,
sunscreen"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.952928870292887,"





"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9539748953974896,"




"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9550209205020921,"Figure 10: Prediction sets of the shift from ImageNet to ImageNet-C13. Parameters are m =
20, 000, ε = 0.1, and δ = 10−5. The green label is the true label and the label with the hat is
the predicted label. We choose examples where the two approaches differ; in particular, if PS-W is
incorrect, then PS is incorrect as well since the prediction set sizes are monotone in τ."
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9560669456066946,Published as a conference paper at ICLR 2022
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9571129707112971,"Example x
ˆCPS(x)
ˆCPS-W(x)
Example x
ˆCPS(x)
ˆCPS-W(x)"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9581589958158996,"n
\
box turtle
o
 terrapin,
\
box turtle  
 "
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9592050209205021,"brain coral,
\
starﬁsh,
sea urchin 
 "
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9602510460251046,"







"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9612970711297071,"






"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9623430962343096,"brain coral,"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9633891213389121,"chiton,
\
starﬁsh,
sea urchin,
sea cucumber,
coral reef,
stinkhorn"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9644351464435147,"







"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9654811715481172,"






 
 "
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9665271966527197,"\
white terrier,
kuvasz,
komondor 
 "
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9675732217573222,"




"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9686192468619247,"



"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9696652719665272,"Maltese dog,
\
white terrier,
kuvasz,
komondor,
Samoyed"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9707112970711297,"




"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9717573221757322,"



"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9728033472803347,"n
\
kit fox
o
red fox,
\
kit fox "
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9738493723849372,"n
\
ladybug
o
leaf beetle,
\
ladybug"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9748953974895398,"
n
\
tusker
o
 \
tusker,"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9759414225941423,"Afri. elephant  
 "
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9769874476987448,"banjo,"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9780334728033473,"elec. guitar,
[
stage 
  

 
"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9790794979079498,"aco. guitar,
banjo,"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9801255230125523,"elec. guitar,
[
stage 

 
"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9811715481171548,"


 

"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9822175732217573,"beaker,
\
pop bottle,"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9832635983263598,"water bottle,
wine bottle"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9843096234309623,"


 

"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9853556485355649,"





"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9864016736401674,"




"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9874476987447699,"beaker,
beer bottle,
perfume,
\
pop bottle,"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9884937238493724,"water bottle,
wine bottle"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9895397489539749,"





"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9905857740585774,"




"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9916317991631799,"n
\
cuirass
o
breastplate,
\
cuirass"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9926778242677824,"
convertible,
\
sports car 

 "
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9937238493723849,"car wheel,
convertible,
\
sports car 
 "
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9947698744769874,"n
\
confectionery"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.99581589958159,"o
n
\
confectionery"
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9968619246861925,"o
n
\
crash helmet o

 "
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.997907949790795,"bonnet,
\
crash helmet,
football helmet 
 "
WE CAN USE THE SAME CALIBRATION SET TO CONSTRUCT IWS AND PREDICTION SETS DUE TO THE UNION BOUND IN THEO-,0.9989539748953975,"Figure 11: Prediction sets of the shift from ImageNet to ImageNet-PGD. Parameters are m =
20, 000, ε = 0.1, and δ = 10−5. The green label is the true label and the label with the hat is
the predicted label. We choose examples where the two approaches differ; in particular, if PS-W is
incorrect, then PS is incorrect as well since the prediction set sizes are monotone in τ."
