Section,Section Appearance Order,Paragraph
ABSTRACT,0.0,ABSTRACT
ABSTRACT,0.002036659877800407,"Federated Adversarial Training (FAT) helps us address the data privacy and gover-
nance issues, meanwhile maintains the model robustness to the adversarial attack.
However, the inner-maximization optimization of Adversarial Training can exac-
erbate the data heterogeneity among local clients, which triggers the pain points
of Federated Learning. This makes that the straightforward combination of two
paradigms shows the performance deterioration as observed in previous works.
In this paper, we introduce an Œ±-Weighted Federated Adversarial Training (Œ±-
WFAT) method to overcome this problem, which relaxes the inner-maximization
of Adversarial Training into a lower bound friendly to Federated Learning. We
present the theoretical analysis about this Œ±-weighted mechanism and its effect
on the convergence of FAT. Empirically, the extensive experiments are conducted
to comprehensively understand the characteristics of Œ±-WFAT, and the results on
three benchmark datasets demonstrate Œ±-WFAT signiÔ¨Åcantly outperforms FAT
under different adversarial learning methods and federated optimization methods."
INTRODUCTION,0.004073319755600814,"1
INTRODUCTION"
INTRODUCTION,0.006109979633401222,"To handle the data privacy and governance issues, Federated Learning (McMahan et al., 2017) as
one promising paradigm of distributed training has drawn the increasing attention (McMahan et al.,
2017; Kairouz et al., 2019). However, training locally in Federated Learning also introduces the
vulnerability from the adversarial attacks (Goodfellow et al., 2015; Kurakin et al., 2016), which drives
us to consider the model robustness in this framework. Thus, recent advances (Kairouz et al., 2019)
explore to apply the Adversarial Training methods (Madry et al., 2018) into Federated Learning."
INTRODUCTION,0.008146639511201629,"However, the straightforward combination of Adversarial Training and Federated Learning presents
some potential challenges due to the communication cost and the hardware requirement. For example,
Shah et al. (2021) pointed out that the communication in Federated Learning may be a constraint to
Adversarial Training, and proposed a dynamic schedule on the local training epochs to achieve the
expected robustness in a short communication budget. Hong et al. (2021) considered the hardware
constraint where some clients are not able to participate Adversarial Training, and they proposed a
federated robust propagation method to share the adversarial robustness among the clients. Although
these previous works indeed addressed some realistic problems, one critical issue in the way is the
performance deterioration in the combination of two paradigms as observed in (Zizzo et al., 2020)."
INTRODUCTION,0.010183299389002037,"As shown in the left panel of Figure 1, one typical phenomenon in Federated Adversarial Training
(FAT) is the robust accuracy of FAT (Zizzo et al., 2020) based on FedAvg (McMahan et al., 2017)
will decrease signiÔ¨Åcantly at the later stage of learning compared with the centralized Adversarial
Training (Madry et al., 2018) that does not. Actually, it exists in many variants of Federated Learning
methods (Shah et al., 2021) under different communication rounds and different local training epochs.
However, it is still lack of the sufÔ¨Åcient algorithmic breakthrough to overcome this issue, since almost
all previous works (Zizzo et al., 2020; Shah et al., 2021; Hong et al., 2021) consistently apply the
conventional update framework of Federated Learning with Adversarial Training."
INTRODUCTION,0.012219959266802444,"We dive into this phenomenon and attribute it to the inner-maximization of Adversarial Training.
Compared with the centralized Adversarial Training (Madry et al., 2018), the training data of FAT is
distributed to each client, which leads to the Adversarial Training in each client unaware of the data in
the others. Therefore, the adversarial examples generated by the inner-maximization of Adversarial
Training tend to be highly biased to each local distribution, yielding the radical optimization to pursuit
the model robustness (as shown in Figure 2, it has a severe local bias to the global optimum). In"
INTRODUCTION,0.014256619144602852,Under review as a conference paper at ICLR 2022
INTRODUCTION,0.016293279022403257,"0
20
40
60
80
100
Communication 10 20 30 40 50 60 70"
INTRODUCTION,0.018329938900203666,Accuracy
INTRODUCTION,0.020366598778004074,"FAT: Natural
AT: Natural"
INTRODUCTION,0.02240325865580448,"FAT: Robust
AT: Robust"
INTRODUCTION,0.024439918533604887,"0
200
400
600
800
1000
Communication 5 10 15 20 25 30 35"
INTRODUCTION,0.026476578411405296,Robust Accuracy
INTRODUCTION,0.028513238289205704,"FAT-1-1000
FAT-5-200
FAT-10-100"
INTRODUCTION,0.03054989816700611,"-WFAT-10-100
0
20
40
60
80
100 10 20 30"
INTRODUCTION,0.032586558044806514,"Figure 1: Left: comparison between centralized Adversarial Training and Federated Adversarial
Training based on FedAvg. Right: comparison between FAT and Œ±-WFAT. All the experiments are
conducted on CIFAR-10 dataset (Non-IID) with 5 clients, and use AT (Madry et al., 2018) to train as
well as PGD-20 to evaluate the Robust Accuracy. Note that, the notation ‚Äúmethod-A-B"" in the right
panel means the method with A local training epochs and B communication rounds."
INTRODUCTION,0.034623217922606926,"short, the inner-maximization of Adversarial Training exacerbates the data heterogeneity among local
clients, which actually triggers the pain points of Federated Learning that are exploring urgently."
INTRODUCTION,0.03665987780040733,"To handle this problem, we propose a new learning framework based on a simple but effective re-
weighting mechanism, namely, Œ±-Weighted Federated Adversarial Training (Œ±-WFAT). Concretely,
we relax the objective of the inner-maximization in Adversarial Training into a lower bound by an Œ±-
weighting mechanism (as Eq. (3) in Section 4.2). Similar to the bias-variance trade-off (Kohavi et al.,
1996), we introduce the small bias to the original objective via a low-bound relaxation, facilitating
a friendly optimization in the combination of Adversarial Training and Federated Learning. This
constructs a conservative optimization for Adversarial Training that weights different population based
on their adversarial losses. Then, the harsh heterogeneous update can be down-weighted with this
Ô¨Çexible weighting mechanism, and the convergence could be accelerated at the same time. Applying
the similar idea to FAT, we propose Œ±-WFAT that emphasizes the robust clients more compared with
other non-robust clients to alleviate the heterogeneous bias caused by the local adversarial generation.
The right panel of Figure 1 gives a simple comparison between Œ±-WFAT and FAT. Empirically, we
conducted extensive experiments to provide a comprehensive understanding of the proposed Œ±-WFAT,
and the results of Œ±-WFAT in the context of different adversarial learning methods and federated
optimization methods demonstrate its superiority to improve the model performance."
INTRODUCTION,0.038696537678207736,Main Contributions
INTRODUCTION,0.04073319755600815,"‚Ä¢ We derive an Œ±-weighted relaxation for Adversarial Training to relax the inner-maximization
by a lower bound, which builds a mediating function to alleviate the potential radical
optimization in its straightforward combination with Federated Learning (in Section 4.2)."
INTRODUCTION,0.04276985743380855,"‚Ä¢ We propose a new learning framework, i.e., Œ±-Weighted Federated Adversarial Training
(Œ±-WFAT), to realize the relaxation of inner-maximization in FAT, which is simple and com-
patible with various Federated Learning or Adversarial Training methods (in Section 4.3)."
INTRODUCTION,0.04480651731160896,"‚Ä¢ We conduct extensive experiments to comprehensively understand the characteristics of the
Œ±-WFAT, and conÔ¨Årm its effectiveness on improving the model performance for both IID
and Non-IID settings in the context of several federated optimization methods (in Section 5)."
RELATED WORK,0.04684317718940937,"2
RELATED WORK"
RELATED WORK,0.048879837067209775,"Federated Learning
The representative work in Federated Learning is FedAvg (McMahan et al.,
2017), which has been proved effectiveness during the distributed training to maintain the data privacy.
To further address the heterogeneous issues, several optimization approaches have been proposed
e.g., FedProx (Li et al., 2018), FedNova (Wang et al., 2020b) and Scaffold (Karimireddy et al., 2020).
FedProx introduced a proximal term for FedAvg to constrain the model drift cause by heterogeneity;
FedNova proposed a general framework that eliminated the objective inconsistency and preserved
the fast convergence; Scaffold utilized the control variates to reduce the gradient variance in the"
RELATED WORK,0.05091649694501019,Under review as a conference paper at ICLR 2022
RELATED WORK,0.05295315682281059,"local updates and accelerate the convergence. MOON (Li et al., 2021a) alleviated the heterogeneity
by maximizing the agreement between the representation of the local model and that of the global
model, which helps correct the local training of individual parties. Reisizadeh et al. (2020) developed
a robust federated learning algorithm to against distribution shifts in clients samples. Our Œ±-WFAT
introduces the relaxation into federated adversarial training, which is orthogonal to and compatible
with the previous optimization methods."
RELATED WORK,0.054989816700611,"Adversarial Training
As one of the defensive methods (Papernot et al., 2016; Gao et al., 2021),
Adversarial Training (Madry et al., 2018; Zhang et al., 2019; Jiang et al., 2020; Chen et al., 2021)
is to improve the robustness of machine learning models. The classical AT (Madry et al., 2018)
is built upon on a min-max formula to optimize the worst case, e.g., the adversarial example near
the natural example (Goodfellow et al., 2015). Zhang et al. (2019) decomposed the prediction
error for adversarial examples as the sum of the natural error and the boundary error, and proposed
TRADES to balance the classiÔ¨Åcation performance between the natural and adversarial examples.
Wang et al. (2020c) further explored the inÔ¨Çuence of the misclassiÔ¨Åed examples on the robustness,
and proposed MART that emphasizes the minimization of the misclassiÔ¨Åed examples to boost the AT.
Zhang et al. (2020) investigated the ‚Äúbenign adversarial examples‚Äù in AT and further improve the
natural performance of robust model. In this work, our Œ±-WFAT framework leverages the client-level
measure to alleviate the heterogeneous issue in the straightforward combination of adversarial training
and federated learning. It is compatible to further incorporate those centralized adversarial training
methods to improve the model performance."
RELATED WORK,0.05702647657841141,"Federated Adversarial Training.
Recently, several works have made the exploration on the Ad-
versarial Training in the context of Federated Learning, which consider the data privacy and the
robustness in one framework. To our best knowledge, Zizzo et al. (2020) take the Ô¨Årst trial to study
the feasibility of extending Federated Learning (McMahan et al., 2017) with the standard AT on both
IID and Non-IID settings. Empirically, they found that there was a large performance gap existing
between the distributed and the centralized adversarial training, especially on the Non-IID data. Shah
et al. (2021) designed a dynamic schedule for the local training to pursue a larger robustness under
the constrained communication budget of Federated Learning. Hong et al. (2021) explored how to
effectively propagate the adversarial robustness when only limited clients in Federated Learning have
the sufÔ¨Åcient computational budget to afford AT. Although previous works have investigated to solve
the challenges about the constrained communication or computational budget, one critical issue that
affects the performance when combined Adversarial Training with Federated Learning has received
only few discussion. In this work, we consider such a basic issue (see Figure 1) in the straightforward
combination of AT with Federated Learning and introduce our solution to this problem."
PRELIMINARY,0.059063136456211814,"3
PRELIMINARY"
PRELIMINARY,0.06109979633401222,"In this section, we will brieÔ¨Çy formalize the notations of Adversarial Training (Goodfellow et al.,
2015; Madry et al., 2018) and Federated Learning as well as FedAvg (McMahan et al., 2017)."
ADVERSARIAL TRAINING,0.06313645621181263,"3.1
ADVERSARIAL TRAINING"
ADVERSARIAL TRAINING,0.06517311608961303,"Let (X, d‚àû) denote the input feature space X with the inÔ¨Ånity distance metric d‚àû(x, Àúx) = ‚à•x‚àíÀúx‚à•‚àû,
and Bœµ[x] = {Àúx ‚ààX | d‚àû(x, Àúx) ‚â§œµ} be the closed ball of radius œµ > 0 centered at x in X. Dataset
S = {(xn, yn)}N
n=1, where xn ‚ààX and yn ‚ààY = {0, 1, ..., C ‚àí1}. The objective function of the
standard adversarial training (AT) (Madry et al., 2018) is deÔ¨Åned as follows,"
ADVERSARIAL TRAINING,0.06720977596741344,"min
fŒ∏‚ààF
1
N N
X"
ADVERSARIAL TRAINING,0.06924643584521385,"n=1
max
Àúxn‚ààBœµ[xn] ‚Ñì(fŒ∏(Àúxn), yn),
(1)"
ADVERSARIAL TRAINING,0.07128309572301425,"where Àúx is the most adversarial data within the œµ-ball centered at x, fŒ∏(¬∑) : X ‚ÜíRC is a score
function, ‚Ñì: RC √ó Y ‚ÜíR is a composition of a base loss ‚ÑìB : ‚àÜC‚àí1 √ó Y ‚ÜíR (e.g., the Cross-
Entropy loss) and an inverse link function ‚ÑìL : RC ‚Üí‚àÜC‚àí1 (e.g., the Softmax). Here, ‚àÜC‚àí1
is the corresponding probability simplex that yields ‚Ñì(fŒ∏(¬∑), y) = ‚ÑìB(‚ÑìL(fŒ∏(¬∑)), y). For the inner-
maximization of Eq. (1), the multi-step projected gradient descent (PGD) (Madry et al., 2018) is
usually applied to Ô¨Ånd the most adversarial samples, which are then used for the outer-minimization."
ADVERSARIAL TRAINING,0.07331975560081466,Under review as a conference paper at ICLR 2022
ADVERSARIAL TRAINING,0.07535641547861507,"Client A
Client B
Global model (after FedAvg) Global model (after ùõº-WFAT)"
ADVERSARIAL TRAINING,0.07739307535641547,"Class 1, Class 2"
ADVERSARIAL TRAINING,0.07942973523421588,Unseen data
ADVERSARIAL TRAINING,0.0814663951120163,Decision boundary
ADVERSARIAL TRAINING,0.0835030549898167,"Globally optimal 
decision boundary"
ADVERSARIAL TRAINING,0.0855397148676171,Misclassified data
ADVERSARIAL TRAINING,0.08757637474541752,"Adversarial data
Small Large"
ADVERSARIAL TRAINING,0.08961303462321792,"Figure 2: Left panel: locally learned decision boundary on Client A; Middle left panel: locally
learned decision boundary on Client B; Middle right panel: globally aggregated decision boundary
based on FedAvg; Right panel: globally aggregated decision boundary based on Œ±-WFAT. Note that,
the distance between the correctly classiÔ¨Åed adversarial examples and the decision boundary (i.e.,
the bold line) can approximately reÔ¨Çect the client loss, and shows that ‚Ñìclient A > ‚Ñìclient B. Then,
selectively treating two client models in the aggregation can acquire a better global model (e.g., the
fourth panel), which is consistent with the intuition of Eq. (3)."
FEDERATED LEARNING,0.09164969450101833,"3.2
FEDERATED LEARNING"
FEDERATED LEARNING,0.09368635437881874,"Let Dk denotes a Ô¨Ånite set of samples from the k-th client, and in each round, a set of datasets
{Dk}K
k=1 from K clients are involved into the training. The objective of Federated Learning is to
learn a machine learning model without any exchange of the training data between the clients and
the server. The current popular strategy, namely FedAvg, is introduced by McMahan et al. (2017),
where the clients collaboratively send the locally trained model weights Œ∏k to the server for the global
average aggregation. Concretely, each client runs on a local copy of the global model (parameterized
by Œ∏t in the t-th round) with its local data to optimize the objective like Eq. (1). Then, the server
receives their updated model weights {Œ∏t
k}K
k=1 of all clients and performs the following aggregation"
FEDERATED LEARNING,0.09572301425661914,"Œ∏t+1 = 1 N K
X"
FEDERATED LEARNING,0.09775967413441955,"k=1
NkŒ∏t
k,
(2)"
FEDERATED LEARNING,0.09979633401221996,"where Nk denotes the number of the samples in Dk and N = PK
k=1 Nk. Then, the weights Œ∏t+1 for
the global model will be sent back to each client for another lifecycle. After the sufÔ¨Åcient rounds of
such a periodic synchronization and aggregation, we expect the stationary point of Federated Learning
will approximately approach to or have a small gap with that from the centralized counterpart."
FEDERATED LEARNING,0.10183299389002037,"4
Œ±-WEIGHTED FEDERATED ADVERSARIAL TRAINING"
FEDERATED LEARNING,0.10386965376782077,"In the following sections, we will Ô¨Årst introduce our motivation for Federated Adversarial Training
through analyzing the challenges brought by the straightforward combination. Then, we relax the
inner-maximization problem of Adversarial Training as a lower bound by an Œ±-weighted decompo-
sition, and present the theoretical understanding of such a relaxation. Finally, we will present the
Œ±-Weighted Federated Adversarial Training and the corresponding analysis."
MOTIVATION,0.10590631364562118,"4.1
MOTIVATION"
MOTIVATION,0.1079429735234216,"For the general FAT (Zizzo et al., 2020), in each round, the clients will receive the latest model from
the server. Then, they conduct Adversarial Training with the local data and send their optimized
model parameters to the server. The server will aggregate the parameters of all clients into a global
model with FedAvg or other methods in Federated Learning. However, considering the characteristics
of Federated Learning and Adversarial Training, it naturally brings the following critical challenge."
MOTIVATION,0.109979633401222,"The inner-maximization can enlarge the data heterogeneity in Federated Learning. In terms of the
combination of adversarial training and federated learning, the key point is that such adversarial
examples generated by the inner-maximization exacerbate the heterogeneity, which induces the
performance deterioration under the model aggregation methods. As the Figure 2 shows, the client A
with large adversarial loss might make a dominating effect on the convergence of the global model,
given the current model aggregation methods treat all client models indiscriminately. Thus, it might
be better to selectively weight the client models in the model aggregation."
MOTIVATION,0.1120162932790224,Under review as a conference paper at ICLR 2022
MOTIVATION,0.11405295315682282,"4.2
Œ±-WEIGHTED RELAXATION OF DECOMPOSED ADVERSARIAL TRAINING"
MOTIVATION,0.11608961303462322,"As previous analysis, the inner-maximization of Adversarial Training is not very compatible with
Federated Learning due to the exacerbation of heterogeneity when combing them together. An idea
to alleviate this problem is building a mediating function that keeps the original goal but is friendly
to two paradigms. In this section, we present one possible solution to this intuition, which tries to
Ô¨Ånd a relaxation of the inner-maximization in Adversarial Training. Formally, we decompose the
inner-maximization objective into the independent K populations that corresponds to the K clients
in Federated Learning, and relaxes it into a lower bound by the Œ±-weighted mechanism as follows,"
MOTIVATION,0.11812627291242363,"LAT = 1 N N
X"
MOTIVATION,0.12016293279022404,"n=1
max
Àúxn‚ààBœµ[xn] ‚Ñì(f(Àúxn), yn) = K
X k=1 Nk N"
NK,0.12219959266802444,"1
Nk Nk
X"
NK,0.12423625254582485,"n=1
max
Àúxn‚ààBœµ[xn] ‚Ñì(f(Àúxk
n), yk
n) !"
NK,0.12627291242362526,"|
{z
}
Lk"
NK,0.12830957230142567,"‚â•(1 + Œ±) b
K
X k=1 NœÜ(k)"
NK,0.13034623217922606,"N
LœÜ(k) + (1 ‚àíŒ±) K
X"
NK,0.13238289205702647,"k= b
K+1 NœÜ(k)"
NK,0.13441955193482688,"N
LœÜ(k)
s.t. Œ± ‚àà[0, 1), bK ‚â§K 2"
NK,0.1364562118126273,".= LŒ±( bK), (3)"
NK,0.1384928716904277,where œÜ(¬∑) is a function which maps the index to the original population sorted by { Nk
NK,0.14052953156822812,"N Lk} in an
ascending order. The following theorems provide us more analysis about the Œ±-weighted relaxation."
NK,0.1425661914460285,"Theorem 4.1. LŒ±( bK) is monotonically decreasing w.r.t. both Œ± and bK, i.e., LŒ±1( bK) < LŒ±2( bK)
if Œ±1 > Œ±2 and LŒ±( bK1) < LŒ±( bK2) if bK1 > bK2. SpeciÔ¨Åcally, LŒ±( bK) recovers L of adversarial
training when Œ± achieves 0, and LŒ±( bK) relaxes L to a lower bound objective by increasing bK and Œ±."
NK,0.1446028513238289,"We can Ô¨Çexibly emphasize the importance of partial populations by setting the proper hyperparameters,
alleviating the evenly averaging of harsh heterogeneous updates in FedAvg (McMahan et al., 2017)."
NK,0.14663951120162932,"Theorem 4.2. Assume the loss function ‚Ñì(¬∑, ¬∑) in Eq. (3) satisÔ¨Åes the Lipschitzian smoothness
condition w.r.t. the model parameter Œ∏ and the training sample x, and is Œª-strongly concave for all
x, and E
h
||‚àáLŒ±( bK) ‚àí‚àáŒ∏‚Ñì(f(Àúx), y)||2
2
i
‚â§Œ¥2, where Àúx is the adversarial example. Then, after the"
NK,0.14867617107942974,"sufÔ¨Åcient T-step optimization i.e., T ‚â•L‚àÜ"
NK,0.15071283095723015,"Œ¥2 , for Œ±-weighted relaxation of decomposed Adversarial"
NK,0.15274949083503056,"Training with the constant stepsize
q"
NK,0.15478615071283094,"‚àÜ
LT œÉ2 in PGD, we have the following convergence property,"
T,0.15682281059063136,"1
T T
X t
E """
T,0.15885947046843177,"‚àáLŒ±( bK)

Œ∏t   2 2 # ‚â§  1 + Œ±"
"T
PT",0.16089613034623218,"1
T
PT
t Œæ(t) N"
"T
PT",0.1629327902240326,"!  
4L2
Œ∏xœµ
Œª
+ 4Œ¥ r L‚àÜ T ! ,
(4)"
"T
PT",0.164969450101833,where L = LŒ∏Œ∏ + LŒ∏xLxŒ∏
"T
PT",0.1670061099796334,"Œª
deÔ¨Åned by the Lipschitzian constraints, ‚àÜ‚â•LŒ±( bK)|Œ∏0 ‚àíinfŒ∏ LŒ±( bK) and"
"T
PT",0.1690427698574338,"Œæ(t) = P b
K
k N (t)
œÜ(k) ‚àíPK
b
K+1 N (t)
œÜ(k) meaning the accumulative counting difference of the t-th step."
"T
PT",0.1710794297352342,"When Œ± = 0, Eq.(3) recovers the original loss of Adversarial Training, and the Ô¨Årst part in the RHS of
Eq. (4) goes to 1 that recovers the convergence rate of Adversarial Training (Sinha et al., 2018). When
Œ± ‚Üí1, Eq.(3) becomes more biased, while simultaneously the straightforward beneÔ¨Åt is that we"
"T
PT",0.17311608961303462,can achieve a faster convergence in Eq. (4) if 1
"T
PT",0.17515274949083504,"T
PT
t Œæ(t) < 0, i.e.,

1 + Œ±"
"T
PT",0.17718940936863545,"1
T
PT
t Œæ(t)"
"T
PT",0.17922606924643583,"N

< 1. Actually,
this is possible when the sample number is approximately similar among all clients and the top-1
choice easily has ‚àíN < Œæ(t) = N (t)
œÜ(1) ‚àíPK
k=2 N (t)
œÜ(k) < 0 in each optimization step. Especially, a
larger Œ± has a faster convergence in this case. Therefore, the Œ±-weighted relaxation of decomposed
Adversarial Training provides us a trade-off between maintaining the robustness from the standard
robust training and achieving the faster convergence with some biased approximation by Œ± and bK."
"T
PT",0.18126272912423624,"4.3
Œ±-WEIGHTED FEDERATED ADVERSARIAL TRAINING"
"T
PT",0.18329938900203666,"Inspired by the previous analysis of Œ±-weighted relaxation, we propose an Œ±-Weighted Federated
Adversarial Training to combine Adversarial Training and Federated Learning. The intuition is"
"T
PT",0.18533604887983707,Under review as a conference paper at ICLR 2022
"T
PT",0.18737270875763748,Algorithm 1 Œ±-Weighted Federated Adversarial Training (Œ±-WFAT)
"T
PT",0.1894093686354379,"Input: number of clients: K, number of communication rounds: T, number of client training epochs
per round: E, initial server‚Äôs model parameter: Œ∏0, hyper-parameter for aggregation: Œ±, number
of enhanced clients: bK;
Output: a globally robust model with parameter Œ∏T ;"
"T
PT",0.19144602851323828,"1: for t = 0, . . . , T ‚àí1 do
2:
Clients: [ perform adversarial training]
3:
for client k = 1, . . . , K do
4:
Œ∏t
k, Lk = AT(Œ∏t
k, E) (Madry et al., 2018)
5:
end for
6:
Server: [ performs aggregation over weight updates]"
"T
PT",0.1934826883910387,"7:
Lall ‚Üê[ N1"
"T
PT",0.1955193482688391,"N L1, N2"
"T
PT",0.1975560081466395,"N L2, . . . , NK"
"T
PT",0.19959266802443992,"N LK]
8:
Lsorted ‚ÜêAscending_Sort(Lall)
9:
‚àÄk, Pk ‚Üê(1 + Œ±) ¬∑ 1( Nk"
"T
PT",0.20162932790224034,N Lk ‚â§Lsorted[ bK]) + (1 ‚àíŒ±) ¬∑ 1( Nk
"T
PT",0.20366598778004075,N Lk > Lsorted[ bK]);
"T
PT",0.20570264765784113,"10:
Œ∏t+1 =
1
PK
k=1 PkNk
PK
k=1 PkNkŒ∏t
k;
‚ñ∑Œ±-weighted mechanism"
"T
PT",0.20773930753564154,11: end for
"T
PT",0.20977596741344195,"applying the Œ±-weighted mechanism into the inner-maximization in FAT, formalized as follows,"
"T
PT",0.21181262729124237,"min LŒ±‚àíW F AT = min
fŒ∏‚ààF
1
PK
k PkNk K
X"
"T
PT",0.21384928716904278,"k=1
PkNk"
NK,0.2158859470468432,"1
Nk Nk
X"
NK,0.21792260692464357,"n=1
max
Àúxn‚ààBœµ[xn] ‚Ñì(fŒ∏(Àúxk
n), yk
n) !"
NK,0.219959266802444,"|
{z
}
Lk ,
(5)"
NK,0.2219959266802444,where Pk = (1+Œ±)¬∑1( Nk
NK,0.2240325865580448,N Lk ‚â§Lsorted[ bK])+(1‚àíŒ±)¬∑1( Nk
NK,0.22606924643584522,"N Lk > Lsorted[ bK]) denotes the weight
assigned to the k-th client based on the ascending sort of weighted client losses compared with the
bK-th one. We summarize the procedure of Œ±-WFAT in Algorithm 1, which consists of multi-round
iterations between the local training on the client side and the global aggregation on the server side."
NK,0.22810590631364563,"Concretely, on the client side, after downloading the global model parameter from the server, each
client will perform the Adversarial Training on its local data. At the same time, the client loss on the
adversarial examples is also recorded, which acts as the soft-indicator of the local bias induced by the
radical adversarial generation. Then, when the training steps reach to the condition, the client will
upload its model parameter and the loss to the server. On the server side, after collecting the model
parameters {Œ∏k}K
k=1 and the losses {Lk}K
k=1 of all clients, it will Ô¨Årst sort the losses in an ascending
order to Ô¨Ånd the top- bK clients. Based on that, the global model parameters will be aggregated by
the Œ±-weighted mechanism in which the model parameters of the top- bK clients are upweighted with
(1 + Œ±) and the remaining is downweighted by (1 ‚àíŒ±). For some atypical layers (Li et al., 2021b)
e.g., BN, it is outside the scope of this paper and we keep the aggregation same as FedAvg. Note that,
one interesting point in Œ±-WFAT is the top- bK clients with the higher weights are not Ô¨Åxed, and they
can be routing among all clients. In Figure 3, we trace this dynamic of Œ±-WFAT in one experiment."
NK,0.23014256619144602,"In the following, we provide the theoretical analysis of Œ±-WFAT on the convergence in the context of
Federated Learning (Li et al., 2019), which is slightly different from previous centralized counterpart.
Theorem 4.3. Assume the loss function ‚Ñì(¬∑, ¬∑) in Eq. (5) is L-smooth and Œª-strongly concave w.r.t.
the model parameter Œ∏, and the expected norm and the variance of the stochastic gradient in each
client respectively satisfy E

||‚àáŒ∏‚Ñì(f(Àúxk), yk)||2
2

‚â§œÇ2 and E

||‚àáŒ∏‚Ñì(f(Àúxk), yk) ‚àí‚àáŒ∏Lk||2
2

‚â§Œ¥2
k.
Let Œ∫ = L"
NK,0.23217922606924643,"Œª , Œ≥ = max{8Œ∫, E} where E is the iteration number of the local Adversarial Training with
the learning rate Œ∑t =
2
Œª(Œ≥+t). Then, after the sufÔ¨Åcient T-step communication rounds for Œ±-WFAT,
we have the following asymptotics to the optimal point,"
NK,0.23421588594704684,"E[LŒ±‚àíW F AT ] ‚àíL‚àó‚â§
Œ∫
Œ≥ + T ‚àí1 2B"
NK,0.23625254582484725,Œª + ŒªŒ≥
E,0.23828920570264767,"2 E

||Œ∏0 ‚àíŒ∏‚àó||2
,
(6)"
E,0.24032586558044808,"where L‚àóis the minimum value of LŒ±‚àíW F AT , Œ∏‚àóis the optimal model parameter, and B = K
X k"
E,0.24236252545824846,"P (T )
k
1 + Œ± Œæ(T ) N"
E,0.24439918533604887,!2 Nk N Œ¥k
E,0.24643584521384929,"2
+ 6L  L‚àó‚àí K
X k"
E,0.2484725050916497,"P (T )
k
1 + Œ± Œæ(T ) N Nk"
E,0.2505091649694501,"N L‚àó
k !"
E,0.2525458248472505,+ 8(E ‚àí1)2œÇ2.
E,0.2545824847250509,Under review as a conference paper at ICLR 2022
E,0.25661914460285135,"0
20
40
60
80
100
Communication 1 2 3 4 5"
E,0.25865580448065173,Client
E,0.2606924643584521,"Figure 3: The index of the top- bK clients with the small losses in Œ±-WFAT (Œ± = 1/6, bK = 1) in each
communication round on CIFAR-10. We can see that it is dynamically routing among all clients."
E,0.26272912423625255,"When Œ± = 0, we have P (t)
k
= 1 and Eq.( 6) becomes the convergence rate of FedAvg on non-IID
data (Li et al., 2019). Different from Theorem 4.2 that concludes in the centralized training setting,
when Œ± ‚Üí1, the convergence is indeÔ¨Ånite compared to the standard FAT, since the emerging terms in"
E,0.26476578411405294,"B, i.e.,

P (T )
k
1+Œ± Œæ(T ) N"
E,0.2668024439918534,"2
and
P (T )
k
1+Œ± Œæ(T )"
E,0.26883910386965376,"N
, are acted as the scalar timing by the personalized variance bound"
E,0.2708757637474542,"Œ¥2
k and the local optimum L‚àó
k of each client. One possible case is when the optimization approaches
to the optimal parameter Œ∏‚àó, Œ¥2
k can be in a smaller scale relative to the scale of L‚àó
k. In this case, the
increment of the Ô¨Årst term of B can be totally counteracted by the loss of second term of B so that in
sum B becomes smaller. Then, we can have a tighter upper bound for Œ±-WFAT in Eq.( 6) to achieve
a faster convergence than FAT. The completed proof of Theorem 4.3 can refer to Appendix C and the
experiments in the following section will conÔ¨Årm Œ±-WFAT can reach to a more robust optimum."
EXPERIMENTS,0.2729124236252546,"5
EXPERIMENTS"
EXPERIMENTS,0.27494908350305497,"In this section, we will provide an in-depth analysis of Œ±-WFAT and empirically verify its efÔ¨Åciency
compared with the current methods on a range of IID and non-IID datasets."
EXPERIMENTAL SETUP,0.2769857433808554,"5.1
EXPERIMENTAL SETUP"
EXPERIMENTAL SETUP,0.2790224032586558,"Dataset.
We conduct the experiments on three benchmark datasets, i.e., CIFAR-10, CIFAR-
100 (Krizhevsky, 2009) and SVHN (Netzer et al., 2011) for Federated Adversarial Training. For
the IID scenario, we just randomly and evenly distribute the samples to each client. For the Non-
IID scenario, we follow McMahan et al. (2017); Shah et al. (2021) to partition the training data
based on their labels. To be speciÔ¨Åc, a skew parameter s is utilized in the data partition introduced
by Shah et al. (2021), which enables K clients to get a majority of the data samples from a subset
of classes. We denote the set of all classes in a dataset as Y and create Yk by dividing all the class
labels equally among K clients. Accordingly, we split the data across K clients that each client has
(100 ‚àí(K ‚àí1) √ó s)% of data for the class in Yk and s% of data in other split sets. The detailed
training and evaluation settings can refer to Appendix E."
ABLATION STUDY,0.28105906313645623,"5.2
ABLATION STUDY"
ABLATION STUDY,0.2830957230142566,"In this part, we conduct various experiments on CIFAR-10 to visualize the characteristics of Œ±-WFAT."
ABLATION STUDY,0.285132382892057,"Non-AT vs. AT. In the left two panels of Figure 4, we respectively apply our Œ±-weighted mechanism
to Federated Standard Training (Œ±-WFST) and Federated Adversarial Training (Œ±-WFAT) under
bK = 1. We also consider both FedAvg and FedProx in this experiment to guarantee the universality.
From the curves, we can see that Œ±-WFST has the negative effect on the natural accuracy, while
Œ±-WFAT consistently improve the robust accuracy both based on FedAvg or FedProx. This indicates
our Œ±-weighted mechanism is tailored for the inner-maximization of Federated Adversarial Training
instead of the outer-minimization considered by other federated optimization methods."
ABLATION STUDY,0.28716904276985744,"Impact of Œ± and bK. To study the effect of hyperparameter in Œ±-WFAT, we conduct several ablation
experiments to verify the model performance. Regarding the experiments of Œ±, we set the client"
ABLATION STUDY,0.2892057026476578,Under review as a conference paper at ICLR 2022
ABLATION STUDY,0.29124236252545826,"0
20
40
60
80
100
Communication 62.5 65.0 67.5 70.0 72.5 75.0 77.5 80.0"
ABLATION STUDY,0.29327902240325865,Natural Accuracy
ABLATION STUDY,0.2953156822810591,"FedAvg
FedAvg+ -WFST
FedProx
FedProx+ -WFST"
ABLATION STUDY,0.2973523421588595,"0
20
40
60
80
100
Communication 15 20 25 30 35"
ABLATION STUDY,0.29938900203665986,Robust Accuracy
ABLATION STUDY,0.3014256619144603,"FedAvg
FedAvg+ -WFAT
FedProx
FedProx+ -WFAT"
ABLATION STUDY,0.3034623217922607,"0
1/11
1/6
1/13
1/14 35 40 45 50 55 60 65"
ABLATION STUDY,0.3054989816700611,Accuracy
ABLATION STUDY,0.3075356415478615,"Natural Acc
Robust Acc"
ABLATION STUDY,0.3095723014256619,"1/8
2/8
3/8
4/8
K/K 25 30 35 40 45 50 55 60 65"
ABLATION STUDY,0.31160896130346233,Accuracy
ABLATION STUDY,0.3136456211812627,"Natural Acc
Robust Acc"
ABLATION STUDY,0.31568228105906315,"Figure 4: Ablation study on Œ±-WFAT. Left two panels: comparison between Federated Standard
Training and Federated Adversarial Training respectively in combination with the Œ±-weighted mecha-
nism, i.e., (Œ±-WFST) vs. (Œ±-WFAT). Right two panels: the natural accuracy and the robust accuracy
of Œ±-WFAT with different Œ± and different bK on CIFAR-10."
ABLATION STUDY,0.31771894093686354,"number K = 5 and bK = 1 to upweight/downweight the client models in each communication rounds.
The right middle panel of Figure 4 shows Œ± ‚àà(0, 1/6] can signiÔ¨Åcantly improve the robust accuracy
and the natural accuracy, while a larger Œ± might be inappropriate to the natural accuracy. Regarding the
choice of bK, we specially set K = 8 in this experiment to span the range of bK due to the constraint
bK <= K/2. The right panel of Figure 4 presents the accuracy of Œ±-WFAT with increasing bK."
ABLATION STUDY,0.319755600814664,"Table 1: Test accuracy (%) on CIFAR-10 (Non-IID) with
different Adversarial Training methods on the local client."
ABLATION STUDY,0.32179226069246436,"Methods
Natural
PGD-20
CW‚àû"
ABLATION STUDY,0.32382892057026474,"AT
FAT
57.45%
32.58%
30.52%
Œ±-WFAT
62.34%
35.59%
33.06%"
ABLATION STUDY,0.3258655804480652,"TRADES
FAT
64.00%
31.64%
28.95%
Œ±-WFAT
65.26%
35.10%
31.80%"
ABLATION STUDY,0.32790224032586557,"MART
FAT
56.29%
36.27%
32.41%
Œ±-WFAT
58.41%
38.90%
34.67%"
ABLATION STUDY,0.329938900203666,"According to the plot, both the natu-
ral accuracy and the robust accuracy are
improved even with larger bK, which
shows the effect of
bK on the relax-
ation of inner-maximization in the pro-
posed Œ±-WFAT. In addition, we conduct
the experiments about emphasizing/de-
emphasizing the client with smallest ad-
versarial loss by adjusting the Œ±, the re-
sults (in Appendix E.1) conÔ¨Årmed that the
relaxation introduced by our Œ±-WFAT is
needed to improve performance, and is
consistent with our previous analysis."
ABLATION STUDY,0.3319755600814664,"Different AT methods. In Table 1, we
validate the combination of Œ±-weighted mechanism and different Adversarial Training methods (i.e.,
TRADES (Zhang et al., 2019) and MART (Wang et al., 2020c)), where we switch different local
Adversarial Training methods on the client side. Through the comparison with FAT, the results show
that Œ±-WFAT can consistently improve both the natural performance and the robust performance, and
is general to the state-of-the-art Adversarial Training works under Federated Learning scenarios."
PERFORMANCE EVALUATION,0.3340122199592668,"5.3
PERFORMANCE EVALUATION"
PERFORMANCE EVALUATION,0.3360488798370672,"In this section, we compare our Œ±-WFAT with FAT on various benchmark datasets to demonstrate its
effectiveness. SpeciÔ¨Åcally, we validate both the non-IID and IID settings with three represenative
Federated optimization methods i.e., FedAvg, FedProx and Scalffold. Besides, a centralized AT
baseline is provided as the reference of the IID setting. Note that, there is no such a baseline for the
non-IID setting, since the centralized case is one distribution which is incomparable and meaningless.
Considering the sensitivity of data selection in Non-IID settings, we also report the results with Mean
and Std values in Appendix E.2 after running experiments for multiple times."
PERFORMANCE EVALUATION,0.3380855397148676,"According to Table 2 on CIFAR-10, we can Ô¨Ånd that Œ±-WFAT signiÔ¨Åcantly outperforms FAT on the
Non-IID data in terms of both the natural accuracy (‚àº2%-6%) and the robust accuracy (‚àº2%-5%).
For the IID data, our method acquires a similar improvement on the robust accuracy without the
deterioration of the natural accuracy. The reason might be because even the data is IID, Adversarial
Training can still drive the independently-initialized overparameterized network (Allen-Zhu & Li,
2020) on each client side towards at the robust overÔ¨Åtting of different directions, yielding the model
heterogeneity. Thus, the proper relaxation to the inner-maximization makes Adversarial Training more
compatible with Federated Learning. Another interesting observation is that Federated Adversarial
Training shows better performance than centralized Adversarial Training in the case of the IID setting.
This gain could be from the distributed training paradigm that helps Adversarial Training converge"
PERFORMANCE EVALUATION,0.34012219959266804,Under review as a conference paper at ICLR 2022
PERFORMANCE EVALUATION,0.3421588594704684,Table 2: Performance on three benchmark datasets under different federated optimization methods.
PERFORMANCE EVALUATION,0.34419551934826886,"Setting
Non-IID
IID"
PERFORMANCE EVALUATION,0.34623217922606925,"CIFAR-10
Natural
FGSM
PGD-20
CW‚àû
AA
Natural
FGSM
PGD-20
CW‚àû
AA"
PERFORMANCE EVALUATION,0.34826883910386963,"Centralized AT
-
-
-
-
-
66.47%
47.68%
38.18%
37.04%
34.48%"
PERFORMANCE EVALUATION,0.35030549898167007,"FedAvg
FAT
57.45%
39.44%
32.58%
30.52%
29.20%
69.35%
48.45%
37.43%
35.72%
33.96%
Œ±-WFAT
63.44%
45.13%
37.17%
33.99%
32.36%
67.43%
50.33%
42.78%
37.91%
36.20%"
PERFORMANCE EVALUATION,0.35234215885947046,"FedProx
FAT
60.44%
41.59%
33.84%
31.29%
30.02%
66.91%
46.70%
37.14%
34.54%
32.68%
Œ±-WFAT
62.51%
44.29%
36.75%
33.82%
31,98%
68.31%
48.40%
42.41%
37.25%
35.97%"
PERFORMANCE EVALUATION,0.3543788187372709,"Scaffold
FAT
62.81%
43.61%
34.13%
32.53%
30.95%
68.27%
49.25%
39.33%
37.31%
35.30%
Œ±-WFAT
64.12%
46.05%
37.35%
34.78%
33.32%
71.36%
50.42%
43.83%
39.12%
35.47%"
PERFORMANCE EVALUATION,0.3564154786150713,"CIFAR-100
Natural
FGSM
PGD-20
CW‚àû
AA
Natural
FGSM
PGD-20
CW‚àû
AA"
PERFORMANCE EVALUATION,0.35845213849287166,"Centralized AT
-
-
-
-
-
35.81%
23.09%
18.64%
16.48%
15.42%"
PERFORMANCE EVALUATION,0.3604887983706721,"FedAvg
FAT
31.07%
19.60%
16.16%
13.37%
12.47%
38.35%
23.37%
18.44%
16.63%
15.45%
Œ±-WFAT
35.17%
21.26%
16.72%
13.91%
12.83%
38.43%
23.76%
18.82%
16.71%
15.62%"
PERFORMANCE EVALUATION,0.3625254582484725,"FedProx
FAT
33.33%
20.20%
16.08%
13.76%
12.72%
37.18%
22.29%
18.16%
16.33%
15.29%
Œ±-WFAT
34.30%
20.82%
16.74%
13.84%
12.88%
37.37%
23.11%
18.43%
16.36%
15.45%"
PERFORMANCE EVALUATION,0.3645621181262729,"Scaffold
FAT
41.17%
25.17%
20.01%
16.74%
15.49%
42.42%
26.79%
21.18%
18.89%
17.63%
Œ±-WFAT
41.07%
25.55%
20.40%
16.79%
15.59%
42.08%
27.18%
22.26%
19.34%
18.03%"
PERFORMANCE EVALUATION,0.3665987780040733,"SVHN
Natural
FGSM
PGD-20
CW‚àû
AA
Natural
FGSM
PGD-20
CW‚àû
AA"
PERFORMANCE EVALUATION,0.36863543788187375,"Centralized AT
-
-
-
-
-
92.39%
89.75%
72.73%
72.31%
70.93%"
PERFORMANCE EVALUATION,0.37067209775967414,"FedAvg
FAT
91.24%
87.95%
68.87%
67.89%
66.54%
93.52%
90.68%
72.24%
71.22%
70.08%
Œ±-WFAT
91.25%
88.28%
71.72%
69.79%
68.62%
92.75%
90.06%
74.37%
72.34%
71.27%"
PERFORMANCE EVALUATION,0.3727087576374745,"FedProx
FAT
90.92%
87.50%
68.44%
67.18%
65.94%
93.54%
90.66%
72.53%
71.42%
70.21%
Œ±-WFAT
91.25%
88.15%
71.54%
69.53%
68.47%
93.59%
90.80%
74.66%
72.67%
71.48%"
PERFORMANCE EVALUATION,0.37474541751527496,"Scaffold
FAT
89.95%
87.23%
68.66%
67.23%
66.65%
93.80%
91.00%
73.26%
72.05%
70.80%
Œ±-WFAT
90.20%
87.81%
71.39%
68.81%
67.88%
93.92%
91.28%
75.96%
74.05%
72.88%"
PERFORMANCE EVALUATION,0.37678207739307534,"to the more robust optimum by the divide-and-conquer mechanism. This might enlighten the more
explore in Adversarial Training to improve the model robustness via Federated Learning."
PERFORMANCE EVALUATION,0.3788187372708758,"On CIFAR-100 and SVHN, we can Ô¨Ånd the similar improvement in Table 2 as that of CIFAR-10 under
three types of federated optimization methods. Nevertheless, Œ±-WFAT only becomes superior in
terms of the robust accuracy but comparable with FAT in terms of the natural accuracy especially
on CIFAR-100. It indicates that the inner-maximization of Adversarial Training when combined
with Federated Learning mainly affects the model robustness, and thus the Œ±-weighted relaxation
correspondingly helps the model converge to a more robust optimum."
CONCLUSION,0.38085539714867617,"6
CONCLUSION"
CONCLUSION,0.38289205702647655,"In this work, we explore the performance deterioration in the straightforward combination of Adver-
sarial Training with Federated Learning. To alleviate the potential radical optimization, we apply
an Œ±-weighted relaxation into Adversarial Training to relax the inner-maximization. Based on this
Œ±-weighted mechanism, we further propose Œ±-Weighted Federated Adversarial Training (Œ±-WFAT).
We provide the theoretical analysis and empirical evidences to understand the proposed simple but
effective method. The experimental results under different settings conÔ¨Årm the effectiveness of
Œ±-WFAT. Nevertheless, we only move a small step on the heterogeneous issue in the combination of
two paradigms and more issues in their cross Ô¨Åeld could be further explored in the future."
CONCLUSION,0.384928716904277,Under review as a conference paper at ICLR 2022
ETHICS STATEMENT,0.3869653767820774,"7
ETHICS STATEMENT"
ETHICS STATEMENT,0.3890020366598778,"This paper does not raise any ethics concerns. This study does not involve any human subjects,
practices to data set releases, potentially harmful insights, methodologies and applications, potential
conÔ¨Çicts of interest and sponsorship, discrimination/bias/fairness concerns, privacy and security
issues, legal compliance, and research integrity issues."
REPRODUCIBILITY STATEMENT,0.3910386965376782,"8
REPRODUCIBILITY STATEMENT"
REPRODUCIBILITY STATEMENT,0.39307535641547864,"To ensure the reproducibility of experimental results, we will provide a link for an anonymous
repository about the source codes of this paper in the discussion forums."
REFERENCES,0.395112016293279,REFERENCES
REFERENCES,0.3971486761710794,"Zeyuan Allen-Zhu and Yuanzhi Li. Towards understanding ensemble, knowledge distillation and
self-distillation in deep learning. arXiv preprint arXiv:2012.09816, 2020."
REFERENCES,0.39918533604887985,"Nicholas Carlini and David A. Wagner. Towards evaluating the robustness of neural networks. In
Symposium on Security and Privacy (SP), 2017."
REFERENCES,0.40122199592668023,"Tianlong Chen, Sijia Liu, Shiyu Chang, Yu Cheng, Lisa Amini, and Zhangyang Wang. Adversarial
robustness: From self-supervised pre-training to Ô¨Åne-tuning. In CVPR, 2020."
REFERENCES,0.40325865580448067,"Tianlong Chen, Zhenyu Zhang, Sijia Liu, Shiyu Chang, and Zhangyang Wang. Robust overÔ¨Åtting
may be mitigated by properly learned smoothening. In ICLR, 2021."
REFERENCES,0.40529531568228105,"Ruize Gao, Feng Liu, Jingfeng Zhang, Bo Han, Tongliang Liu, Gang Niu, and Masashi Sugiyama.
Maximum mean discrepancy test is aware of adversarial attacks. In ICML, 2021."
REFERENCES,0.4073319755600815,"Ian J. Goodfellow, Jonathon Shlens, and Christian Szegedy. Explaining and harnessing adversarial
examples. In ICLR, 2015."
REFERENCES,0.4093686354378819,"Kaiming He, Xiangyu Zhang, Shaoqing Ren, and Jian Sun. Deep residual learning for image
recognition. In CVPR, 2016."
REFERENCES,0.41140529531568226,"Junyuan Hong, Haotao Wang, Zhangyang Wang, and Jiayu Zhou. Federated robustness propagation:
Sharing adversarial robustness in federated learning. arXiv preprint arXiv:2106.10196, 2021."
REFERENCES,0.4134419551934827,"Ziyu Jiang, Tianlong Chen, Ting Chen, and Zhangyang Wang. Robust pre-training by adversarial
contrastive learning. In NeurIPS, 2020."
REFERENCES,0.4154786150712831,"Peter Kairouz, H Brendan McMahan, Brendan Avent, Aur√©lien Bellet, Mehdi Bennis, Arjun Nitin
Bhagoji, Kallista Bonawitz, Zachary Charles, Graham Cormode, Rachel Cummings, et al. Ad-
vances and open problems in federated learning. arXiv preprint arXiv:1912.04977, 2019."
REFERENCES,0.4175152749490835,"Sai Praneeth Karimireddy, Satyen Kale, Mehryar Mohri, Sashank Reddi, Sebastian Stich, and
Ananda Theertha Suresh. Scaffold: Stochastic controlled averaging for federated learning. In
ICML, 2020."
REFERENCES,0.4195519348268839,"Ron Kohavi, David H Wolpert, et al. Bias plus variance decomposition for zero-one loss functions.
In ICML, 1996."
REFERENCES,0.4215885947046843,"Alex Krizhevsky. Learning multiple layers of features from tiny images. In arXiv, 2009."
REFERENCES,0.42362525458248473,"Alexey Kurakin, Ian Goodfellow, and Samy Bengio. Adversarial machine learning at scale. arXiv
preprint arXiv:1611.01236, 2016."
REFERENCES,0.4256619144602851,"Qinbin Li, Bingsheng He, and Dawn Song. Model-contrastive federated learning. In CVPR, 2021a."
REFERENCES,0.42769857433808556,"Tian Li, Anit Kumar Sahu, Manzil Zaheer, Maziar Sanjabi, Ameet Talwalkar, and Virginia Smith.
Federated optimization in heterogeneous networks. arXiv preprint arXiv:1812.06127, 2018."
REFERENCES,0.42973523421588594,Under review as a conference paper at ICLR 2022
REFERENCES,0.4317718940936864,"Xiang Li, Kaixuan Huang, Wenhao Yang, Shusen Wang, and Zhihua Zhang. On the convergence of
fedavg on non-iid data. In ICLR, 2019."
REFERENCES,0.43380855397148677,"Xiaoxiao Li, Meirui Jiang, Xiaofei Zhang, Michael Kamp, and Qi Dou. Fedbn: Federated learning
on non-iid features via local batch normalization. arXiv preprint arXiv:2102.07623, 2021b."
REFERENCES,0.43584521384928715,"Min Lin, Qiang Chen, and Shuicheng Yan. Network in network. In ICLR, 2014."
REFERENCES,0.4378818737270876,"Aleksander Madry, Aleksandar Makelov, Ludwig Schmidt, Dimitris Tsipras, and Adrian Vladu.
Towards deep learning models resistant to adversarial attacks. In ICLR, 2018."
REFERENCES,0.439918533604888,"Brendan McMahan, Eider Moore, Daniel Ramage, Seth Hampson, and Blaise Aguera y Arcas.
Communication-efÔ¨Åcient learning of deep networks from decentralized data. In AISTATS, 2017."
REFERENCES,0.4419551934826884,"Yuval Netzer, Tao Wang, Adam Coates, Alessandro Bissacco, Bo Wu, and Andrew Y Ng. Reading
digits in natural images with unsupervised feature learning. In NeurIPS Workshop on Deep
Learning and Unsupervised Feature Learning, 2011."
REFERENCES,0.4439918533604888,"Nicolas Papernot, Patrick McDaniel, Xi Wu, Somesh Jha, and Ananthram Swami. Distillation as a
defense to adversarial perturbations against deep neural networks. In 2016 IEEE symposium on
security and privacy (SP), 2016."
REFERENCES,0.4460285132382892,"Amirhossein Reisizadeh, Farzan Farnia, Ramtin Pedarsani, and Ali Jadbabaie. Robust federated
learning: The case of afÔ¨Åne distribution shifts. In NeurIPS, 2020."
REFERENCES,0.4480651731160896,"Devansh Shah, Parijat Dube, Supriyo Chakraborty, and Ashish Verma. Adversarial training in
communication constrained federated learning. arXiv preprint arXiv:2103.01319, 2021."
REFERENCES,0.45010183299389,"Aman Sinha, Hongseok Namkoong, and John Duchi. Certifying some distributional robustness with
principled adversarial training. In ICLR, 2018."
REFERENCES,0.45213849287169044,"Haotao Wang, Tianlong Chen, Shupeng Gui, Ting-Kuei Hu, Ji Liu, and Zhangyang Wang. Once-
for-all adversarial training: In-situ tradeoff between robustness and accuracy for free. In NeurIPS,
2020a."
REFERENCES,0.45417515274949083,"Jianyu Wang, Qinghua Liu, Hao Liang, Gauri Joshi, and H Vincent Poor. Tackling the objective
inconsistency problem in heterogeneous federated optimization. In NeurIPS, 2020b."
REFERENCES,0.45621181262729127,"Yisen Wang, Xingjun Ma, James Bailey, Jinfeng Yi, Bowen Zhou, and Quanquan Gu. On the
convergence and robustness of adversarial training. In ICML, 2019."
REFERENCES,0.45824847250509165,"Yisen Wang, Difan Zou, Jinfeng Yi, James Bailey, Xingjun Ma, and Quanquan Gu. Improving
adversarial robustness requires revisiting misclassiÔ¨Åed examples. In ICLR, 2020c."
REFERENCES,0.46028513238289204,"Dongxian Wu, Shu-Tao Xia, and Yisen Wang. Adversarial weight perturbation helps robust general-
ization. In NeurIPS, 2020."
REFERENCES,0.4623217922606925,"Hongyang Zhang, Yaodong Yu, Jiantao Jiao, Eric P. Xing, Laurent El Ghaoui, and Michael I. Jordan.
Theoretically principled trade-off between robustness and accuracy. In ICML, 2019."
REFERENCES,0.46435845213849286,"Jingfeng Zhang, Xilie Xu, Bo Han, Gang Niu, Lizhen Cui, Masashi Sugiyama, and Mohan Kankan-
halli. Attacks which do not kill training make adversarial learning stronger. In ICML, 2020."
REFERENCES,0.4663951120162933,"Yuchen Zhang, John C Duchi, and Martin J Wainwright. Communication-efÔ¨Åcient algorithms for
statistical optimization. The Journal of Machine Learning Research, 14(1):3321‚Äì3363, 2013."
REFERENCES,0.4684317718940937,"Giulio Zizzo, Ambrish Rawat, Mathieu Sinn, and Beat Buesser. Fat: Federated adversarial training.
arXiv preprint arXiv:2012.01791, 2020."
REFERENCES,0.47046843177189407,Under review as a conference paper at ICLR 2022
REFERENCES,0.4725050916496945,APPENDIX
REFERENCES,0.4745417515274949,"A
PROOF OF EQ. (3) AND THEOREM 4.1"
REFERENCES,0.47657841140529533,We proof the Eq. (3) and Theorem 4.1 in this section.
REFERENCES,0.4786150712830957,"Recall the Œ±-weighted relaxation for the inner-maximization objective decomposition with K inde-
pendent populations as follows,"
REFERENCES,0.48065173116089616,"LAT = 1 N N
X"
REFERENCES,0.48268839103869654,"n=1
max
Àúxn‚ààBœµ[xn] ‚Ñì(f(Àúxn), yn) = K
X k=1 Nk N"
NK,0.4847250509164969,"1
Nk Nk
X"
NK,0.48676171079429736,"n=1
max
Àúxn‚ààBœµ[xn] ‚Ñì(f(Àúxk
n), yk
n) !"
NK,0.48879837067209775,"|
{z
}
Lk"
NK,0.4908350305498982,"‚â•(1 + Œ±) b
K
X k=1 NœÜ(k)"
NK,0.49287169042769857,"N
LœÜ(k) + (1 ‚àíŒ±) K
X"
NK,0.49490835030549896,"k= b
K+1 NœÜ(k)"
NK,0.4969450101832994,"N
LœÜ(k)
s.t. Œ± ‚àà[0, 1), bK ‚â§K 2"
NK,0.4989816700610998,".= LŒ±( bK), (7)"
NK,0.5010183299389002,where œÜ(¬∑) is a function which maps the index to the original population group sorted by { Nk
NK,0.5030549898167006,"N Lk} in
an ascending order."
NK,0.505091649694501,"proof of Eq. (3). The deduction of the inequality in Eq. (7) can be formulated in the following. Given
Œ± ‚àà[0, 1) and bK ‚â§K"
NK,0.5071283095723014,2 with the population sorted by { Nk
NK,0.5091649694501018,"N Lk} in an ascending order, we have
P b
K
k=1
NœÜ(k)"
NK,0.5112016293279023,"N
LœÜ(k) ‚â§PK
k= b
K+1
NœÜ(k)"
NK,0.5132382892057027,"N
LœÜ(k). Then, we have the following relationship by subtraction, b
K
X k=1 NœÜ(k)"
NK,0.515274949083503,"N
LœÜ(k) + K
X"
NK,0.5173116089613035,"k= b
K+1 NœÜ(k)"
NK,0.5193482688391039,"N
LœÜ(k) ‚àí(1 + Œ±) b
K
X k=1 NœÜ(k)"
NK,0.5213849287169042,"N
LœÜ(k) ‚àí(1 ‚àíŒ±) K
X"
NK,0.5234215885947047,"k= b
K+1 NœÜ(k)"
NK,0.5254582484725051,"N
LœÜ(k) = Œ± ¬∑ Ô£´ Ô£≠
K
X"
NK,0.5274949083503055,"k= b
K+1 NœÜ(k)"
NK,0.5295315682281059,"N
LœÜ(k) ‚àí b
K
X k=1 NœÜ(k)"
NK,0.5315682281059063,"N
LœÜ(k) Ô£∂"
NK,0.5336048879837068,"Ô£∏‚â•0.
(8)"
NK,0.5356415478615071,"proof of Theorem 4.1. It can be naturally proved by Eq. (8). If Œ±1 > Œ±2, then we have,"
NK,0.5376782077393075,"LŒ±1( bK) ‚àíLŒ±2( bK) = (1 + Œ±1) b
K
X k=1 NœÜ(k)"
NK,0.539714867617108,"N
LœÜ(k) + (1 ‚àíŒ±1) K
X"
NK,0.5417515274949084,"k= b
K+1 NœÜ(k)"
NK,0.5437881873727087,"N
LœÜ(k)"
NK,0.5458248472505092,"‚àí(1 + Œ±2) b
K
X k=1 NœÜ(k)"
NK,0.5478615071283096,"N
LœÜ(k) ‚àí(1 ‚àíŒ±2) K
X"
NK,0.5498981670061099,"k= b
K+1 NœÜ(k)"
NK,0.5519348268839104,"N
LœÜ(k)
(9)"
NK,0.5539714867617108,"= (Œ±1 ‚àíŒ±2) Ô£´ Ô£≠ b
K
X k=1 NœÜ(k)"
NK,0.5560081466395111,"N
LœÜ(k) ‚àí K
X"
NK,0.5580448065173116,"k= b
K+1 NœÜ(k)"
NK,0.560081466395112,"N
LœÜ(k) Ô£∂ Ô£∏‚â§0"
NK,0.5621181262729125,"Similarly, we can prove LŒ±( bK1) < LŒ±( bK2) if bK1 > bK2."
NK,0.5641547861507128,"B
PROOF OF THEOREM 4.2"
NK,0.5661914460285132,"Based on the convergence of Adversarial Training (Sinha et al., 2018), we proof Theorem 4.2 in this
section."
NK,0.5682281059063137,"proof of Theorem 4.2. Let c : X √ó X ‚ÜíR+ ‚à™{‚àû}, where c(x, x0) is the ‚Äúcost‚Äù for an adversary to
perturb x0 to x. Let f(Œ∏, x; x0) = ‚Ñì(Œ∏; x) ‚àíŒ≥c(x, x0), noting that the gradient steps is preformed as"
NK,0.570264765784114,Under review as a conference paper at ICLR 2022
NK,0.5723014256619144,"gt = ‚àáŒ∏f(Œ∏t, ÀÜx; xt), where ÀÜx is an approximate maximizer of f(Œ∏, x; xt) in x, and Œ∏t+1 = Œ∏t ‚àí¬µtgt."
NK,0.5743380855397149,"We assume ¬µt ‚â§
1
Lœà in the rest of the proof, which is satisÔ¨Åed for the constant step size ¬µ =
q"
NK,0.5763747454175153,"‚àÜL
LœàT Œ¥2"
NK,0.5784114052953157,and T ‚â•Lœà‚àÜL
NK,0.5804480651731161,"Œ¥2
. By a Taylor expansion using the Lœà-smoothness of the objective Lk for k-th client,
we have"
NK,0.5824847250509165,"Lk

Œ∏t+1 ‚â§Lk

Œ∏t +

‚àáLk

Œ∏t, Œ∏t+1 ‚àíŒ∏t
+ Lœà"
NK,0.5845213849287169,"2 ||Œ∏t+1 ‚àíŒ∏t||2
2
(10)"
NK,0.5865580448065173,"= Lk

Œ∏t ‚àí¬µt||‚àáLk

Œ∏t||2
2 + Lœà¬µ2"
NK,0.5885947046843177,"2
||gt||2
2 + ¬µt

‚àáLk

Œ∏t, ‚àáLk

Œ∏t ‚àígt"
NK,0.5906313645621182,"= Lk

Œ∏t ‚àí¬µt"
NK,0.5926680244399185,"
1 ‚àí1"
NK,0.594704684317719,"2Lœà¬µ2

||‚àáLk

Œ∏t||2
2"
NK,0.5967413441955194,"+ ¬µt(1 ‚àíLœà¬µ)

‚àáLk

Œ∏t, ‚àáLk

Œ∏t ‚àígt
+ Lœà¬µ2"
NK,0.5987780040733197,"2
||gt ‚àí‚àáLk

Œ∏t||2
2"
NK,0.6008146639511202,"Consider the function œÜŒ≥(Œ∏; x0) = supx‚ààZ f(Œ∏, x; x0), we deÔ¨Åne the potentially biased errors
Œ∂t = gt ‚àí‚àáŒ∏œÜŒ≥(Œ∏t; xt). Then we have the following relationship,"
NK,0.6028513238289206,"Lk

Œ∏t+1 ‚â§Lk

Œ∏t ‚àí¬µt"
NK,0.604887983706721,"
1 ‚àí1"
NK,0.6069246435845214,"2Lœà¬µ2

||‚àáLk

Œ∏t||2
2
(11)"
NK,0.6089613034623218,"+ ¬µt(1 ‚àíLœà¬µ)

‚àáLk

Œ∏t, ‚àáLk

Œ∏t ‚àí‚àáŒ∏œÜŒ≥(Œ∏t; xt)"
NK,0.6109979633401222,"‚àí¬µt(1 ‚àíLœà¬µt)

‚àáLk

Œ∏t, Œ∂t
+ Lœà¬µ2"
NK,0.6130346232179226,"2
||‚àáŒ∏œÜŒ≥(Œ∏t; xt) + Œ∂2 ‚àí‚àáLk

Œ∏t||2
2"
NK,0.615071283095723,"= Lk

Œ∏t ‚àí¬µt"
NK,0.6171079429735234,"
1 ‚àí1"
NK,0.6191446028513238,"2Lœà¬µ2

||‚àáLk

Œ∏t||2
2"
NK,0.6211812627291242,"+ ¬µt(1 ‚àíLœà¬µ)

‚àáLk

Œ∏t, ‚àáLk

Œ∏t ‚àí‚àáŒ∏œÜŒ≥(Œ∏t; xt)"
NK,0.6232179226069247,"‚àí¬µt(1 ‚àíLœà¬µt)

‚àáLk

Œ∏t, Œ∂t"
NK,0.6252545824847251,"+ Lœà¬µ2
t
2
 
||Œ∂t||2
2 + ||‚àáŒ∏œÜŒ≥(Œ∏t; xt) ‚àí‚àáLk

Œ∏t||2
2 + 2

‚àáŒ∏œÜŒ≥(Œ∏t; xt) ‚àí‚àáLk

Œ∏t, Œ∂t
."
NK,0.6272912423625254,"Since ¬±‚ü®a, b‚ü©‚â§1"
NK,0.6293279022403259,"2
 
||a||2
2 + ||b||2
2

, we have"
NK,0.6313645621181263,"Lk

Œ∏t+1 ‚â§Lk

Œ∏t ‚àí¬µt"
NK,0.6334012219959266,"2 ||‚àáLk

Œ∏t||2
2 + ¬µt((1 ‚àíLœàŒ±))

‚àáLk

Œ∏t, ‚àáLk

Œ∏t ‚àí‚àáŒ∏œÜŒ≥(Œ∏t; xt)

(12)"
NK,0.6354378818737271,+ ¬µt((1 + Lœà¬µ))
NK,0.6374745417515275,"2
||Œ∂||2
2 + Lœà¬µ2
t||‚àáŒ∏œÜŒ≥(Œ∏t; xt) ‚àí‚àáLk

Œ∏t||2
2."
NK,0.639511201629328,"Then, letting xt
‚àó= arg maxx f(Œ∏t, x; xt), the error Œ∂t satisÔ¨Åes,"
NK,0.6415478615071283,"||Œ∂||2
2 =||‚àáŒ∏œÜŒ≥(Œ∏t; xt) ‚àí‚àáf(Œ∏, ÀÜxt; xt)||2
2 = ||‚àáŒ∏‚Ñì(Œ∏, xt
‚àó) ‚àí‚àáŒ∏‚Ñì(Œ∏, ÀÜxt)||2
2
(13)"
NK,0.6435845213849287,"‚â§LŒ∏x||ÀÜxt ‚àíxt
‚àó||2
2 ‚â§2L2
Œ∏x
Œª
œµ,
(14)"
NK,0.6456211812627292,"where the Ô¨Ånal inequality utilize the Œª = Œ≥ ‚àíLxx strong-concavity of x 7‚Üíf(Œ∏, x; x0). For conve-"
NK,0.6476578411405295,"nience, let ÀÜœµ =
2L2
Œ∏x
Œ≥‚àíLxx œµ. Taking conditional expectations in Eq. (12) and using E [‚àáŒ∏œÜŒ≥(Œ∏t; xt)|Œ∏t] =
‚àáLk

Œ∏t, we have,"
NK,0.6496945010183299,"E

Lk

Œ∏t+1 ‚àíLk

Œ∏t|Œ∏t
‚â§‚àí¬µt"
NK,0.6517311608961304,"2 ||‚àáLk

Œ∏t||2
2 + ¬µt((1 + Lœà¬µ))"
NK,0.6537678207739308,"2
ÀÜœµ + Lœà¬µ2
t||‚àáŒ∏œÜŒ≥(Œ∏t; xt) ‚àí‚àáLk

Œ∏t||2
2
(15) ‚â§‚àí¬µt"
NK,0.6558044806517311,"2 ||‚àáLk

Œ∏t||2
2 + ¬µtÀÜœµ + Lœà¬µ2
t||‚àáŒ∏œÜŒ≥(Œ∏t; xt) ‚àí‚àáLk

Œ∏t||2
2"
NK,0.6578411405295316,"Since ¬µt ‚â§
1
Lœà , taking a Ô¨Åxed step size ¬µ, we have,"
NK,0.659877800407332,"E

||‚àáLk

Œ∏t||2
2

‚àí2ÀÜœµ ‚â§2"
NK,0.6619144602851323,"¬µE

Lk

Œ∏t ‚àíLk

Œ∏t+1

+ 2Lœà¬µŒ¥2
(16)"
NK,0.6639511201629328,Under review as a conference paper at ICLR 2022
NK,0.6659877800407332,"Because E
h
||‚àáŒ∏œÜŒ≥(Œ∏; Z) ‚àí‚àáLk

(Œ∏)||2
2
i
‚â§Œ¥2, summing over t, we have,"
T,0.6680244399185336,"1
T T
X"
T,0.670061099796334,"t
E

||‚àáLk

Œ∏t||2
2

‚àí2ÀÜœµ ‚â§
2
¬µT (Lk

Œ∏0 ‚àíE[Lk

Œ∏T ]) + 2Lœà¬µŒ¥2 ‚â§2‚àÜ"
T,0.6720977596741344,"¬µT + 2Lœà¬µŒ¥2
(17)"
T,0.6741344195519349,"Since ¬µ =
q"
T,0.6761710794297352,"Delta
LœàT Œ¥2 , and Œª = Œ≥ ‚àíLxx, we can get the following result,"
T,0.6782077393075356,"1
T T
X"
T,0.6802443991853361,"t
E

||‚àáLk

Œ∏t||2
2

‚â§4L2
Œ∏xœµ
Œª
+ 4Œ¥ r L‚àÜ"
T,0.6822810590631364,"T
(18)"
T,0.6843177189409368,"Adopting our Œ±-weighted relaxation, we have,"
T,0.6863543788187373,"1
T T
X t
E """
T,0.6883910386965377,"‚àáLŒ±( bK)

Œ∏t   2 2 # = 1 T T
X t
E Ô£Æ Ô£∞"
T,0.6904276985743381,"(1 + Œ±) b
K
X k=1"
T,0.6924643584521385,"N (t)
œÜ(k)
N
‚àáLœÜ(k)

Œ∏t + (1 ‚àíŒ±) K
X"
T,0.6945010183299389,"k= b
K+1"
T,0.6965376782077393,"N (t)
œÜ(k)
N
‚àáLœÜ(k)

Œ∏t   2 2 Ô£π Ô£ª ‚â§1 T T
X t Ô£´"
T,0.6985743380855397,"Ô£≠(1 + Œ±) b
K
X k=1"
T,0.7006109979633401,"N (t)
œÜ(k)
N
E """
T,0.7026476578411406,"‚àáLœÜ(k)

Œ∏t   2 2 #"
T,0.7046843177189409,"+ (1 ‚àíŒ±) K
X"
T,0.7067209775967414,"k= b
K+1"
T,0.7087576374745418,"N (t)
œÜ(k)
N
E """
T,0.7107942973523421,"‚àáLœÜ(k)

Œ∏t   2 2 #Ô£∂ Ô£∏ ‚â§1 T T
X t Ô£´"
T,0.7128309572301426,"Ô£≠(1 + Œ±) b
K
X k=1"
T,0.714867617107943,"N (t)
œÜ(k)
N
+ (1 ‚àíŒ±) K
X"
T,0.7169042769857433,"k= b
K+1"
T,0.7189409368635438,"N (t)
œÜ(k)
N Ô£∂ Ô£∏"
T,0.7209775967413442,"4L2
Œ∏xœµ
Œª
+ 4Œ¥ r L‚àÜ T ! = 1 T T
X t Ô£´"
T,0.7230142566191446,Ô£≠1 + Œ±
T,0.725050916496945,"P b
K
k=1 N (t)
œÜ(k) ‚àíPK
k= b
K+1 N (t)
œÜ(k)
N Ô£∂ Ô£∏"
T,0.7270875763747454,"4L2
Œ∏xœµ
Œª
+ 4Œ¥ r L‚àÜ T ! =  1 + Œ±"
"T
PT",0.7291242362525459,"1
T
PT
t Œæ(t) N"
"T
PT",0.7311608961303462,"!  
4L2
Œ∏xœµ
Œª
+ 4Œ¥ r L‚àÜ T ! , (19)"
"T
PT",0.7331975560081466,"where Œæ(t) = P b
K
k=1 N (t)
œÜ(k) ‚àíPK
k= b
K+1 N (t)
œÜ(k) to simplify the notations."
"T
PT",0.7352342158859471,"C
PROOF OF THEOREM 4.3"
"T
PT",0.7372708757637475,"Based on the convergence of FedAvg (Li et al., 2019), we proof Theorem 4.3 in this section."
"T
PT",0.7393075356415478,"First, we make the following assumptions and present some useful lemmas. SpeciÔ¨Åcally, we make
the following assumptions. Assumption C.1 and C.2 are standard (typical examples are the ‚Ñì2-norm
regularized linear regression, logistic regression, or softmax classiÔ¨Åer). Assumption C.3 and C.4 have
been made by the previous works (Zhang et al., 2013; Li et al., 2019).
Assumption C.1. L1, . . . , LK are all L-smooth: for all v and w, Lk(v) ‚â§Lk(w) + (v ‚àí
w)T ‚àáLk(w) + L"
"T
PT",0.7413441955193483,"2 ||v ‚àíw||2
2.
Assumption C.2. L1, . . . , LK are all Œª-strongly convex: for all v and w, Lk(v) ‚â•Lk(w) + (v ‚àí
w)T ‚àáLk(w) + Œª"
"T
PT",0.7433808553971487,"2 ||v ‚àíw||2
2."
"T
PT",0.745417515274949,"Assumption C.3. Let Œæk
t be sampled from the k-th device‚Äôs local data uniformly at random. The
variance of stochastic gradients in each device is bounded: E||‚àáLk(wk
t , Œæk
t ) ‚àí‚àáLk(wk
t )||2 ‚â§Œ¥2
k
for k = 1, ¬∑ ¬∑ ¬∑ , K.
Assumption C.4. The expected squared norm of stochastic gradients is uniformly bounded, i.e.,
E||‚àáLk(wk
t , Œæk
t )||2 ‚â§œÇ2 for all k = 1, ¬∑ ¬∑ ¬∑ , K and t = 1, ¬∑ ¬∑ ¬∑ , T ‚àí1."
"T
PT",0.7474541751527495,Under review as a conference paper at ICLR 2022
"T
PT",0.7494908350305499,"We use the following lemmas proved by Li et al. (2019). Let Œ∏k
t denotes the model parameter main-
tained in the k-th client at t-th step, Œò represents an immediate result of one step SGD update from
Œ∏k
t . For convenience, we deÔ¨Åne ¬ØŒòt = PK
k=1
Nk"
"T
PT",0.7515274949083504,"N Œòt, ¬ØŒ∏t == PK
k=1
Nk"
"T
PT",0.7535641547861507,"N Œ∏t, ¬Øgt = PK
k=1
Nk"
"T
PT",0.7556008146639511,"N ‚àáLk(Œ∏k
t )
and gt = PK
k=1
Nk"
"T
PT",0.7576374745417516,"N ‚àáLk(Œ∏k
t , Œæk
t ). Therefore, Egt = ¬Øgt."
"T
PT",0.7596741344195519,"Lemma C.1 (Results of one step SGD). Assume Assumption C.1 and C.2. If Œ∑t ‚â§
1
4L, we have"
"T
PT",0.7617107942973523,"E||¬ØŒòt+1 ‚àíŒ∏‚àó||2 ‚â§(1 ‚àíŒ∑tŒª)E||¬ØŒ∏t ‚àíŒ∏‚àó||2
(20)"
"T
PT",0.7637474541751528,"+ Œ∑2
t E||gt ‚àí¬Øgt||2 + 6LŒ∑2
t Œì + 2E K
X k=1 Nk"
"T
PT",0.7657841140529531,"N ||¬ØŒ∏t ‚àíŒ∏k
t ||2,"
"T
PT",0.7678207739307535,"where Œì = L‚àó‚àíPK
k Et
Nk"
"T
PT",0.769857433808554,"N L‚àó
k ‚â•0
Lemma C.2 (Bounding the variance). Assume Assumption C.3. It follows that"
"T
PT",0.7718940936863544,"E||gt ‚àí¬Øgt||2 ‚â§ K
X k=1 Nk N"
"T
PT",0.7739307535641547,"2
Œ¥2
k,
(21)"
"T
PT",0.7759674134419552,"Lemma C.3 (Bounding the divergence of Œ∏k
t ). Assume Assumption C.4, that Œ∑t is non-increasing
and Œ∑ ‚â§2Œ∑t+E for all t > 0. It follows that E "" K
X k=1 Nk"
"T
PT",0.7780040733197556,"N ||¬ØŒ∏t ‚àíŒ∏k
t ||2
#"
"T
PT",0.780040733197556,"‚â§4Œ∑2
t (E ‚àí1)2œÇ2
(22)"
"T
PT",0.7820773930753564,"proof of Theorem 4.3. Let ‚àÜt = E||Œ∏t ‚àíŒ∏‚àó||2. From Lemma C.1, Lemma C.2 and Lemma C.3, it
follows that"
"T
PT",0.7841140529531568,"‚àÜt+1 ‚â§(1 ‚àíŒ∑tŒª)‚àÜt + Œ∑2
t B,
(23)"
"T
PT",0.7861507128309573,"where, B = K
X k"
"T
PT",0.7881873727087576,"P (T )
k
1 + Œ± Œæ(T ) N"
"T
PT",0.790224032586558,!2 Nk N Œ¥k
"T
PT",0.7922606924643585,"2
+ 6L  L‚àó‚àí K
X k"
"T
PT",0.7942973523421588,"P (T )
k
1 + Œ± Œæ(T ) N Nk"
"T
PT",0.7963340122199593,"N L‚àó
k !"
"T
PT",0.7983706720977597,"+ 8(E ‚àí1)2œÇ2, (24)"
"T
PT",0.8004073319755601,"and

P (T )
k
1+Œ± Œæ(T ) N"
"T
PT",0.8024439918533605,"2
and
P (T )
k
1+Œ± Œæ(T )"
"T
PT",0.8044806517311609,"N
, are acted as the scalar timing by the personalized variance bound Œ¥2
k
and the local optimum L‚àó
k of each client."
"T
PT",0.8065173116089613,"For a diminishing stepsize, Œ∑t =
Œ≤
Œ≥+t for some Œ≤ > 1"
"T
PT",0.8085539714867617,Œª and Œ≥ > 0 such that Œ∑1 ‚â§min{ 1
"T
PT",0.8105906313645621,"Œª,
1
4L} =
1
4L
and Œ∑t ‚â§2Œ∑t+E. We will prove that ‚àÜt ‚â§
ŒΩ
Œ≥+t, where ŒΩ = max{ Œ≤2B"
"T
PT",0.8126272912423625,"Œ≤Œª‚àí1, (Œ≥ + 1)‚àÜ1}. The above
can be proved by induction. Firstly, the deÔ¨Ånition of ŒΩ ensures that it holds for t = 1. Assume the
conclusion holds for some t, it follows that,"
"T
PT",0.814663951120163,"‚àÜt+1 ‚â§(1 ‚àíŒ∑tŒª)‚àÜt + Œ∑2
t B"
"T
PT",0.8167006109979633,"‚â§(1 ‚àí
Œ≤Œª
t + Œ≥ )
ŒΩ
t + Œ≥ +
Œ≤2B
(t + Œ≥)2"
"T
PT",0.8187372708757638,= t + Œ≥ ‚àí1
"T
PT",0.8207739307535642,"(t + Œ≥)2 ŒΩ + [
Œ≤2B
(t + Œ≥)2 ‚àíŒ≤Œª ‚àí1"
"T
PT",0.8228105906313645,(t + Œ≥)2 ŒΩ]
"T
PT",0.824847250509165,"‚â§
ŒΩ
t + Œ≥ + 1. (25)"
"T
PT",0.8268839103869654,"Then by the L-smoothness of L(¬∑),"
"T
PT",0.8289205702647657,E[Lt] ‚àíL‚àó‚â§L
"T
PT",0.8309572301425662,2 ‚àÜt ‚â§L
"T
PT",0.8329938900203666,"2
ŒΩ
Œ≥ + t
(26)"
"T
PT",0.835030549898167,"SpeciÔ¨Åcally, if we choose Œ≤ = 2"
"T
PT",0.8370672097759674,"Œª, Œ≥ = max{8 L"
"T
PT",0.8391038696537678,"Œª , E} ‚àí1 and denote Œ∫ = L"
"T
PT",0.8411405295315683,"Œª , then Œ∑t = 2"
"T
PT",0.8431771894093686,"Œª
1
Œ≥+t. One
can verify that the choice of Œ∑t satisÔ¨Åes Œ∑t ‚â§2Œ∑t+E for t ‚â•1. Then we have"
"T
PT",0.845213849287169,"ŒΩ = max
 Œ≤2B"
"T
PT",0.8472505091649695,"Œ≤Œª ‚àí1, (Œ≥ + 1)‚àÜ1"
"T
PT",0.8492871690427699,"
‚â§
Œ≤2B
Œ≤Œª ‚àí1 + (Œ≥ + 1)‚àÜ1 ‚â§4B"
"T
PT",0.8513238289205702,"Œª2 + (Œ≥ + 1)‚àÜ1,
(27)"
"T
PT",0.8533604887983707,Under review as a conference paper at ICLR 2022 and
"T
PT",0.8553971486761711,E[Lt] ‚àíL‚àó‚â§L
"T
PT",0.8574338085539714,"2
ŒΩ
Œ≥ + t ‚â§
Œ∫
Œ≥ + t 2B"
"T
PT",0.8594704684317719,"Œª + Œª(Œ≥ + 1) 2
‚àÜ1"
"T
PT",0.8615071283095723,"
(28)"
"T
PT",0.8635437881873728,"D
LEARNING FRAMEWORK AND ALGORITHM ‡∑°ùë≤"
"T
PT",0.8655804480651731,Clients
"T
PT",0.8676171079429735,"Server ùúÉ1 t
ùúÉ2"
"T
PT",0.869653767820774,"t
ùúÉùêæ‚àí1 t
ùúÉùêæ t ùúÉt+1"
"T
PT",0.8716904276985743,... ... ùëÅ1 ùëÅ‚Ñí1 ùëÅ1 ùëÅ‚Ñí1 ùëÅ2
"T
PT",0.8737270875763747,"ùëÅ‚Ñí2
ùëÅùêæ‚àí1"
"T
PT",0.8757637474541752,"ùëÅ
‚Ñíùêæ‚àí1 ùëÅùêæ"
"T
PT",0.8778004073319755,"ùëÅ‚Ñíùêæ
...
Ascending Sort   {
}"
"T
PT",0.879837067209776,"1
1
...
1 + Œ±
‚®Ä M1 tM2"
"T
PT",0.8818737270875764,"t
Œ∏K‚àí1 t ùúÉùêæ t
}
{"
"T
PT",0.8839103869653768,Weighted Average 1 - Œ± ùëÅ2 ùëÅ‚Ñí2 ùëÅùêæ‚àí1
"T
PT",0.8859470468431772,"ùëÅ
‚Ñíùêæ‚àí1 ùëÅùêæ ùëÅ‚Ñíùêæ"
"T
PT",0.8879837067209776,"Figure 5: A brief illustration of our Œ±-Weighted Federated Adversarial Training (Œ±-WFAT) framework.
On the client-side, each client will conduct adversarial training with its local data and update the
optimized model parameter (i.e., Œ∏k) with the adversarial loss (i.e., Nk"
"T
PT",0.890020366598778,"N Lk)). On the server-side, after
collecting the model parameters and the loss value (information of the robustness), the server will
conduct an ascending sort and aggregate the global model with a weighted average (denoted by ‚äô)
which upweights the top populations of the robust client‚Äôs model parameters with Œ±."
"T
PT",0.8920570264765784,"Here, we provide an intuitive illustration of our proposed Œ±-WFAT in Figure 5. Based on the Œ±-
weighted mechanism, we provide a new Ô¨Çexible framework for the combination of adversarial training
with federated learning. It is orthogonal to a variety of different adversarial training (Zhang et al.,
2019; Wu et al., 2020; Zhang et al., 2020; Chen et al., 2020; 2021; Wang et al., 2020a; Jiang et al.,
2020; Wang et al., 2020c) methods and federated learning algorithms (Li et al., 2018; Kairouz et al.,
2019; Hong et al., 2021) which gain the adversarial robustness or alleviate the data heterogeneity on
the client side, and can be simply but effectively combined with other approach."
"T
PT",0.8940936863543788,"E
EXPERIMENTAL DETAILS"
"T
PT",0.8961303462321792,"Dataset.
We conduct the experiments on three benchmark datasets, i.e., SVHN (Netzer et al., 2011),
CIFAR-10 and CIFAR-100 (Krizhevsky, 2009) for federated adversarial training. For the IID scenario,
we randomly distribute these datasets to each client. For simulating the Non-IID scenario, we
follow McMahan et al. (2017); Shah et al. (2021) to distribute the training data based on their labels.
To be speciÔ¨Åc, a skew parameter s is utilized in the data partition introduced by Shah et al. (2021),
which enables K clients to get a majority of the data samples from a subset of classes. We denote the
set of all classes in a dataset as Y and create Yk by dividing all the class labels equally among K
clients. Accordingly, we split the data across K clients that each client has (100 ‚àí(K ‚àí1) √ó s)%
of data for the class in Yk and s% of data in other split sets. In our experiments, we set s = 2 for
simulating the Non-IID partition with 5 clients as Shah et al. (2021) recommended."
"T
PT",0.8981670061099797,"Training and Evaluation.
In the experiments, we follow the previous works to leverage the same
architectures, i.e., NIN (Lin et al., 2014) for CIFAR-10, ResNet-18 (He et al., 2016) for CIFAR-100 and
Small CNN (Zhang et al., 2020) for SVHN. For the local training batch size, we set 32 for CIFAR-10,
128 for CIFAR-100 and SVHN. For the training schedule, SGD is adopted with 0.9 momentum for
100 communication rounds under 5 clients as in (Hong et al., 2021; Shah et al., 2021), and the weight
decay = 0.0001. For adversarial training, we set the conÔ¨Ågurations of PGD respectively (Madry et al.,
2018) for different datasets. On CIFAR-10/CIFAR-100, we set the perturbation bound œµ = 8/255,
the PGD step size 2/255 and set the PGD step number 10. On SVHN, we set the perturbation
bound œµ = 4/255, the PGD step size 1/255, and keep the same step number 10. Regarding the
evaluation, the accuracy for the natural test data and that for the adversarial test data are computed"
"T
PT",0.90020366598778,Under review as a conference paper at ICLR 2022
"T
PT",0.9022403258655805,Table 3: Brief summary of the experimental details about Œ±-WFAT
"T
PT",0.9042769857433809,"Dataset
Network
K
ÀÜK
Œ±"
"T
PT",0.9063136456211812,"CIFAR-10
NIN (Shah et al., 2021)
5
1
1/6"
"T
PT",0.9083503054989817,"CIFAR-100
ResNet-18 (Chen et al., 2021)
5
1
1/41"
"T
PT",0.9103869653767821,"SVHN
SmallCNN (Zhang et al., 2019)
5
1
1/11"
"T
PT",0.9124236252545825,"following Wang et al. (2019); Wu et al. (2020). Note that, the adversarial test data are generated by
FGSM, PGD-20, C&W (Carlini & Wagner, 2017) attack with the same perturbation bound and step
size as the training. All the adversarial generations have a random start, i.e, the uniformly random
perturbation of [‚àíœµ, œµ] added to the natural data before attacking iterations. Besides, we also report
the robustness under a stronger AutoAttack, termed as AA for simplicity."
"T
PT",0.9144602851323829,"As for our Œ±-WFAT, different training tasks adopt different Œ±-weighted mechanism considering
different characteristic of local training data, we set Œ± = 1/6 (i.e., 1+Œ±"
"T
PT",0.9164969450101833,"1‚àíŒ± = 1.4) for the experiments
on CIFAR-10, and Œ± = 1/41 (i.e., 1+Œ±"
"T
PT",0.9185336048879837,"1‚àíŒ± = 1.05) for the experiments on CIFAR-100 and Œ± = 1/11
(i.e., 1+Œ±"
"T
PT",0.9205702647657841,"1‚àíŒ± = 1.2) for the experiments on SVHN. As for FedProx, we set ¬µ = 0.01 for each dataset
and its Œ± for Œ±-weighted mechanism are 1/11, 1/41, and 1/11. As for Scaffold, the Œ± adopted for
previous datasets are 1/11, 1/101 and 1/11 respectively."
"T
PT",0.9226069246435845,"As for the choice of the hyper-parameter Œ±, one useful way to set it might be progressively probing
its effect in a value-growth manner. When the Œ± is very small, the objective will approximately
degenerate the original objective of FAT, so does the performance with no harm. Slightly enlarging Œ±
can improve the performance due to the beneÔ¨Åt of the bias-variance trade-off, and then make a stop
in one point where the performance becomes drop."
"T
PT",0.924643584521385,"E.1
EMPHASIZE/DE-EMPHASIZE IN OUR Œ±-WFAT"
"T
PT",0.9266802443991853,"We conduct an empirical comparison between Œ±-WFAT that emphasizes (relatively de-emphasize
the other clients) the client model with the smallest loss and a contrary variant that de-emphasizes
it (relatively emphasize the other clients) as follows. We Ô¨Ånd that de-emphasizing the client with
smallest loss (relatively emphasize those with larger loss) consistently harm the model performance
across these evaluations."
"T
PT",0.9287169042769857,Table 4: Comparison with emphasize/de-emphasize the client with smallest loss.
"T
PT",0.9307535641547862,"Setting
Non-IID"
"T
PT",0.9327902240325866,"CIFAR-10
Natural
FGSM
PGD-20
CW‚àû"
"T
PT",0.9348268839103869,FedAvg
"T
PT",0.9368635437881874,Œ±-WFAT: 1+Œ±
"T
PT",0.9389002036659878,"1‚àíŒ± = 1.4
emphasize
63.44%
45.13%
37.17%
33.99%
Œ±-WFAT: 1+Œ±"
"T
PT",0.9409368635437881,"1‚àíŒ± = 1.2
emphasize
62.26%
44.08%
35.83%
33.31%
FAT: 1+Œ±"
"T
PT",0.9429735234215886,"1‚àíŒ± = 1.0
original
57.45%
39.44%
32.58%
30.52%
Œ±-WFAT: 1+Œ±"
"T
PT",0.945010183299389,"1‚àíŒ± = 0.8
de-emphasize
50.45%
34.34%
27.86%
26.62%
Œ±-WFAT: 1+Œ±"
"T
PT",0.9470468431771895,"1‚àíŒ± = 0.6
de-emphasize
40.47%
28.81%
24.36%
23.19%"
"T
PT",0.9490835030549898,"SVHN
Natural
FGSM
PGD-20
CW‚àû"
"T
PT",0.9511201629327902,FedAvg
"T
PT",0.9531568228105907,Œ±-WFAT: 1+Œ±
"T
PT",0.955193482688391,"1‚àíŒ± = 1.4
emphasize
90.60%
87.75%
73.12%
70.51%
Œ±-WFAT: 1+Œ±"
"T
PT",0.9572301425661914,"1‚àíŒ± = 1.2
emphasize
91.25%
88.28%
71.72%
69.79%
FAT: 1+Œ±"
"T
PT",0.9592668024439919,"1‚àíŒ± = 1.0
original
91.24%
87.95%
68.87%
67.89%
Œ±-WFAT: 1+Œ±"
"T
PT",0.9613034623217923,"1‚àíŒ± = 0.8
de-emphasize
90.03%
86.12%
64.35%
64.32%
Œ±-WFAT: 1+Œ±"
"T
PT",0.9633401221995926,"1‚àíŒ± = 0.6
de-emphasize
89.46%
84.80%
58.64%
58.96%"
"T
PT",0.9653767820773931,Under review as a conference paper at ICLR 2022
"T
PT",0.9674134419551935,"E.2
MEAN AND STD RESULTS OF THE NON-IID SETTINGS"
"T
PT",0.9694501018329938,"Considering that the Non-IID results are sensitive to the selection of data in each client, we conduct
our experiments on Non-IID settings for multiple times and conclude the results as follows. In
summary, our Œ±-WFAT can consistently improve the model robustness with comparable or even
better natural performance than previous federated optimization methods."
"T
PT",0.9714867617107943,"Table 5:
Performance on Non-IID settings under different federated optimization methods
(Mean¬±Std)."
"T
PT",0.9735234215885947,"Setting
Non-IID"
"T
PT",0.9755600814663951,"CIFAR-10
Natural
FGSM
PGD-20
CW‚àû
AA"
"T
PT",0.9775967413441955,"FedAvg
FAT
58.13¬±0.68%
40.06¬±0.62%
32.56¬±0.01%
30.88¬±0.37%
29.17¬±0.03%
Œ±-WFAT
63.36¬±0.07%
44.82¬±0.32%
37.14¬±0.03%
33.39¬±0.61%
31.66¬±0.70%"
"T
PT",0.9796334012219959,"FedProx
FAT
59.95¬±0.45%
41.44¬±0.15%
33.83¬±0.01%
31.65¬±0.36%
30.11¬±0.09%
Œ±-WFAT
62.04¬±0.47%
44.21¬±0.08%
36.64¬±0.11%
32.62¬±0.20%
31.83¬±0.15%"
"T
PT",0.9816700610997964,"Scaffold
FAT
61.44¬±1.37%
42.85¬±0.76%
34.08¬±0.05%
32.56¬±0.02%
31.03¬±0.08%
Œ±-WFAT
63.16¬±0.96%
45.55¬±0.50%
37.33¬±0.02%
34.82¬±0.04%
33.32¬±0.01%"
"T
PT",0.9837067209775967,"CIFAR-100
Natural
FGSM
PGD-20
CW‚àû
AA"
"T
PT",0.9857433808553971,"FedAvg
FAT
31.93¬±0.85%
20.04¬±0.44%
16.34¬±0.18%
13.65¬±0.28%
12.70¬±0.03%
Œ±-WFAT
34.80¬±0.37%
20.91¬±0.35%
16.66¬±0.06%
13.78¬±0.13%
12.79¬±0.04%"
"T
PT",0.9877800407331976,"FedProx
FAT
34.07¬±0.74%
20.49¬±0.29%
16.20¬±0.12%
13.68¬±0.06%
12.67¬±0.08%
Œ±-WFAT
33.95¬±0.39%
20.86¬±0.40%
16.73¬±0.01%
13.80¬±0.04%
12.80¬±0.02%"
"T
PT",0.9898167006109979,"Scaffold
FAT
39.89¬±1.28%
24.78¬±0.40%
19.82¬±0.20%
16.73¬±0.01%
15.51¬±0.02%
Œ±-WFAT
39.80¬±1.27%
25.05¬±0.51%
20.27¬±0.13%
16.79¬±0.01%
15.58¬±0.01%"
"T
PT",0.9918533604887984,"SVHN
Natural
FGSM
PGD-20
CW‚àû
AA"
"T
PT",0.9938900203665988,"FedAvg
FAT
91.52¬±0.28%
88.13¬±0.18%
68.98¬±0.11%
68.04¬±0.15%
66.59¬±0.04%
Œ±-WFAT
91.26¬±0.01%
88.27¬±0.02%
72.04¬±0.32%
69.96¬±0.16%
68.89¬±0.27%"
"T
PT",0.9959266802443992,"FedProx
FAT
91.00¬±0.08%
87.65¬±0.15%
68.48¬±0.04%
67.16¬±0.02%
65.76¬±0.18%
Œ±-WFAT
91.19¬±0.06%
88.15¬±0.01%
71.84¬±0.30%
69.88¬±0.35%
68.84¬±0.37%"
"T
PT",0.9979633401221996,"Scaffold
FAT
90.82¬±0.87%
87.89¬±0.66%
69.51¬±0.84%
68.12¬±0.88%
67.19¬±0.54%
Œ±-WFAT
90.93¬±0.76%
88.27¬±0.45%
71.77¬±0.38%
69.49¬±0.67%
68.37¬±0.48%"
